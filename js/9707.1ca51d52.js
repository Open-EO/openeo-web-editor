"use strict";(globalThis["webpackChunk_openeo_web_editor"]=globalThis["webpackChunk_openeo_web_editor"]||[]).push([[9707],{56772:(e,t,r)=>{r.d(t,{A:()=>E});var i=r(90025),n=r(74238),s=r(4087),o=r(9703),a=r(70915),l=r(82241),h=r(60764),d=r(6933);class c extends i.A{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){(0,s.b0)()}calculateMatrices2D(e){const t=e.viewState,r=e.coordinateToPixelTransform,i=e.pixelToCoordinateTransform;(0,o.Zz)(r,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),(0,o.T9)(i,r)}forEachFeatureAtCoordinate(e,t,r,i,n,s,o,l){let c;const u=t.viewState;function g(e,t,r,i){return n.call(s,t,e?r:null,i)}const p=u.projection,f=(0,d.Li)(e.slice(),p),m=[[0,0]];if(p.canWrapX()&&i){const e=p.getExtent(),t=(0,a.RG)(e);m.push([-t,0],[t,0])}const T=t.layerStatesArray,_=T.length,x=[],R=[];for(let a=0;a<m.length;a++)for(let i=_-1;i>=0;--i){const n=T[i],s=n.layer;if(s.hasRenderer()&&(0,h.l)(n,u)&&o.call(l,s)){const i=s.getRenderer(),o=s.getSource();if(i&&o){const s=o.getWrapX()?f:e,l=g.bind(null,n.managed);R[0]=s[0]+m[a][0],R[1]=s[1]+m[a][1],c=i.forEachFeatureAtCoordinate(R,t,r,l,x)}if(c)return c}}if(0===x.length)return;const y=1/x.length;return x.forEach(((e,t)=>e.distanceSq+=t*y)),x.sort(((e,t)=>e.distanceSq-t.distanceSq)),x.some((e=>c=e.callback(e.feature,e.layer,e.geometry))),c}hasFeatureAtCoordinate(e,t,r,i,s,o){const a=this.forEachFeatureAtCoordinate(e,t,r,i,n.rT,this,s,o);return void 0!==a}getMap(){return this.map_}renderFrame(e){(0,s.b0)()}flushDeclutterItems(e){}scheduleExpireIconCache(e){l.u.canExpireCache()&&e.postRenderFunctions.push(u)}}function u(e,t){l.u.expire()}const g=c;var p=r(28450),f=r(9960),m=r(83984),T=r(25176),_=r(38774),x=r(9438),R=r(68711);class y extends g{constructor(e){super(e),this.fontChangeListenerKey_=(0,x.KT)(_.yY,p.A.PROPERTYCHANGE,e.redrawText.bind(e)),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=T.XI+" ol-layers";const r=e.getViewport();r.insertBefore(this.element_,r.firstChild||null),this.children_=[],this.renderedVisible_=!0,this.declutterLayers_=[]}dispatchRenderEvent(e,t){const r=this.getMap();if(r.hasListener(e)){const i=new f.A(e,void 0,t);r.dispatchEvent(i)}}disposeInternal(){(0,x.JH)(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(e){if(!e)return void(this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1));this.calculateMatrices2D(e),this.dispatchRenderEvent(m.A.PRECOMPOSE,e);const t=e.layerStatesArray.sort((function(e,t){return e.zIndex-t.zIndex})),r=e.viewState;this.children_.length=0;const i=this.declutterLayers_;i.length=0;let n=null;for(let s=0,o=t.length;s<o;++s){const o=t[s];e.layerIndex=s;const a=o.layer,l=a.getSourceState();if(!(0,h.l)(o,r)||"ready"!=l&&"undefined"!=l){a.unrender();continue}const d=a.render(e,n);d&&(d!==n&&(this.children_.push(d),n=d),"getDeclutter"in a&&i.push(a))}this.flushDeclutterItems(e),(0,R.WM)(this.element_,this.children_),this.dispatchRenderEvent(m.A.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}flushDeclutterItems(e){const t=this.declutterLayers_;for(let r=t.length-1;r>=0;--r)t[r].renderDeclutter(e);t.length=0}}const E=y},5986:(e,t,r)=>{r.d(t,{A:()=>l});var i=r(6837),n=r(6141),s=r(11854),o=r(4087);class a extends s.A{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.declutterExecutorGroup=null}getFeatures(e){return(0,o.b0)()}getData(e){return null}prepareFrame(e){return(0,o.b0)()}renderFrame(e,t){return(0,o.b0)()}loadedTileCallback(e,t,r){e[t]||(e[t]={}),e[t][r.tileCoord.toString()]=r}createLoadedTileFinder(e,t,r){return(i,n)=>{const s=this.loadedTileCallback.bind(this,r,i);return e.forEachLoadedTile(t,i,n,s)}}forEachFeatureAtCoordinate(e,t,r,i,n){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){const t=e.target;t.getState()!==n.A.LOADED&&t.getState()!==n.A.ERROR||this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=n.A.LOADED&&t!=n.A.ERROR&&e.addEventListener(i.A.CHANGE,this.boundHandleImageChange_),t==n.A.IDLE&&(e.load(),t=e.getState()),t==n.A.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&"ready"===e.getSourceState()&&e.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}}const l=a},69796:(e,t,r)=>{r.d(t,{A:()=>d});var i=r(96769),n=r(6141),s=r(62703),o=r(9703),a=r(70915),l=r(89718);class h extends i.A{constructor(e){super(e),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],r=e.pixelRatio,i=e.viewState,o=i.resolution,h=this.getLayer().getSource(),d=e.viewHints;let c=e.extent;if(void 0!==t.extent&&(c=(0,a._N)(c,(0,l.fromUserExtent)(t.extent,i.projection))),!d[s.A.ANIMATING]&&!d[s.A.INTERACTING]&&!(0,a.Im)(c))if(h){const e=i.projection,t=h.getImage(c,o,r,e);t&&(this.loadImage(t)?this.image_=t:t.getState()===n.A.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(e){const t=this.frameState;if(!t)return null;const r=this.getLayer(),i=(0,o.Bb)(t.pixelToCoordinateTransform,e.slice()),n=r.getExtent();if(n&&!(0,a.Ym)(n,i))return null;const s=this.image_.getExtent(),l=this.getImage(),h=(0,a.RG)(s),d=Math.floor(l.width*((i[0]-s[0])/h));if(d<0||d>=l.width)return null;const c=(0,a.Oq)(s),u=Math.floor(l.height*((s[3]-i[1])/c));return u<0||u>=l.height?null:this.getImageData(l,d,u)}renderFrame(e,t){const r=this.image_,i=r.getExtent(),n=r.getResolution(),s=r.getPixelRatio(),h=e.layerStatesArray[e.layerIndex],d=e.pixelRatio,c=e.viewState,u=c.center,g=c.resolution,p=d*n/(g*s),f=e.extent,m=c.resolution,T=c.rotation,_=Math.round((0,a.RG)(f)/m*d),x=Math.round((0,a.Oq)(f)/m*d);(0,o.Zz)(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/d,1/d,T,-_/2,-x/2),(0,o.T9)(this.inversePixelTransform,this.pixelTransform);const R=(0,o.dI)(this.pixelTransform);this.useContainer(t,R,this.getBackground(e));const y=this.context,E=y.canvas;E.width!=_||E.height!=x?(E.width=_,E.height=x):this.containerReused||y.clearRect(0,0,_,x);let v=!1,A=!0;if(h.extent){const t=(0,l.fromUserExtent)(h.extent,c.projection);A=(0,a.HY)(t,e.extent),v=A&&!(0,a.ms)(t,e.extent),v&&this.clipUnrotated(y,e,t)}const S=this.getImage(),C=(0,o.Zz)(this.tempTransform,_/2,x/2,p,p,0,s*(i[0]-u[0])/n,s*(u[1]-i[3])/n);this.renderedResolution=n*d/s;const I=S.width*C[0],w=S.height*C[3];if(this.getLayer().getSource().getInterpolate()||(y.imageSmoothingEnabled=!1),this.preRender(y,e),A&&I>=.5&&w>=.5){const e=C[4],t=C[5],r=h.opacity;let i;1!==r&&(i=y.globalAlpha,y.globalAlpha=r),y.drawImage(S,0,0,+S.width,+S.height,e,t,I,w),1!==r&&(y.globalAlpha=i)}return this.postRender(y,e),v&&y.restore(),y.imageSmoothingEnabled=!0,R!==E.style.transform&&(E.style.transform=R),this.container}}const d=h},96769:(e,t,r)=>{r.d(t,{A:()=>f,B:()=>c});var i=r(5986),n=r(9960),s=r(83984),o=r(9703),a=r(89352),l=r(68711),h=r(66514),d=r(70915);const c=[];let u=null;function g(){u=(0,l.Y)(1,1,void 0,{willReadFrequently:!0})}class p extends i.A{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=(0,o.vt)(),this.pixelTransform=(0,o.vt)(),this.inversePixelTransform=(0,o.vt)(),this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(e,t,r){let i;u||g(),u.clearRect(0,0,1,1);try{u.drawImage(e,t,r,1,1,0,0,1,1),i=u.getImageData(0,0,1,1).data}catch(n){return u=null,null}return i}getBackground(e){const t=this.getLayer();let r=t.getBackground();return"function"===typeof r&&(r=r(e.viewState.resolution)),r||void 0}useContainer(e,t,r){const i=this.getLayer().getClassName();let n,s;if(e&&e.className===i&&(!r||e&&e.style.backgroundColor&&(0,h.aI)((0,a._j)(e.style.backgroundColor),(0,a._j)(r)))){const t=e.firstElementChild;t instanceof HTMLCanvasElement&&(s=t.getContext("2d"))}if(s&&s.canvas.style.transform===t?(this.container=e,this.context=s,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){n=document.createElement("div"),n.className=i;let e=n.style;e.position="absolute",e.width="100%",e.height="100%",s=(0,l.Y)();const t=s.canvas;n.appendChild(t),e=t.style,e.position="absolute",e.left="0",e.transformOrigin="top left",this.container=n,this.context=s}this.containerReused||!r||this.container.style.backgroundColor||(this.container.style.backgroundColor=r)}clipUnrotated(e,t,r){const i=(0,d.Py)(r),n=(0,d.WU)(r),s=(0,d.k_)(r),a=(0,d.R)(r);(0,o.Bb)(t.coordinateToPixelTransform,i),(0,o.Bb)(t.coordinateToPixelTransform,n),(0,o.Bb)(t.coordinateToPixelTransform,s),(0,o.Bb)(t.coordinateToPixelTransform,a);const l=this.inversePixelTransform;(0,o.Bb)(l,i),(0,o.Bb)(l,n),(0,o.Bb)(l,s),(0,o.Bb)(l,a),e.save(),e.beginPath(),e.moveTo(Math.round(i[0]),Math.round(i[1])),e.lineTo(Math.round(n[0]),Math.round(n[1])),e.lineTo(Math.round(s[0]),Math.round(s[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.clip()}dispatchRenderEvent_(e,t,r){const i=this.getLayer();if(i.hasListener(e)){const s=new n.A(e,this.inversePixelTransform,r,t);i.dispatchEvent(s)}}preRender(e,t){this.frameState=t,this.dispatchRenderEvent_(s.A.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(s.A.POSTRENDER,e,t)}getRenderTransform(e,t,r,i,n,s,a){const l=n/2,h=s/2,d=i/t,c=-d,u=-e[0]+a,g=-e[1];return(0,o.Zz)(this.tempTransform,l,h,d,c,-r,u,g)}disposeInternal(){delete this.frameState,super.disposeInternal()}}const f=p},24029:(e,t,r)=>{r.d(t,{A:()=>f});var i=r(96769),n=r(40190),s=r(97404),o=r(91110),a=r(11078),l=r(9703),h=r(66514),d=r(70915),c=r(89718),u=r(4087),g=r(6782);class p extends i.A{constructor(e){super(e),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=(0,d.S5)(),this.tmpTileRange_=new o.A(0,0,0,0)}isDrawableTile(e){const t=this.getLayer(),r=e.getState(),i=t.getUseInterimTilesOnError();return r==a.A.LOADED||r==a.A.EMPTY||r==a.A.ERROR&&!i}getTile(e,t,r,i){const n=i.pixelRatio,s=i.viewState.projection,o=this.getLayer(),l=o.getSource();let h=l.getTile(e,t,r,n,s);return h.getState()==a.A.ERROR&&o.getUseInterimTilesOnError()&&o.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(h)||(h=h.getInterimTile()),h}getData(e){const t=this.frameState;if(!t)return null;const r=this.getLayer(),i=(0,l.Bb)(t.pixelToCoordinateTransform,e.slice()),o=r.getExtent();if(o&&!(0,d.Ym)(o,i))return null;const h=t.pixelRatio,c=t.viewState.projection,u=t.viewState,p=r.getRenderSource(),f=p.getTileGridForProjection(u.projection),m=p.getTilePixelRatio(t.pixelRatio);for(let l=f.getZForResolution(u.resolution);l>=f.getMinZoom();--l){const e=f.getTileCoordForCoordAndZ(i,l),t=p.getTile(l,e[1],e[2],h,c);if(!(t instanceof n.A||t instanceof s.A)||t instanceof s.A&&t.getState()===a.A.EMPTY)return null;if(t.getState()!==a.A.LOADED)continue;const r=f.getOrigin(l),o=(0,g.xq)(f.getTileSize(l)),d=f.getResolution(l),T=Math.floor(m*((i[0]-r[0])/d-e[1]*o[0])),_=Math.floor(m*((r[1]-i[1])/d-e[2]*o[1])),x=Math.round(m*p.getGutterForProjection(u.projection));return this.getImageData(t.getImage(),T+x,_+x)}return null}loadedTileCallback(e,t,r){return!!this.isDrawableTile(r)&&super.loadedTileCallback(e,t,r)}prepareFrame(e){return!!this.getLayer().getSource()}renderFrame(e,t){const r=e.layerStatesArray[e.layerIndex],i=e.viewState,n=i.projection,s=i.resolution,o=i.center,g=i.rotation,p=e.pixelRatio,f=this.getLayer(),m=f.getSource(),T=m.getRevision(),_=m.getTileGridForProjection(n),x=_.getZForResolution(s,m.zDirection),R=_.getResolution(x);let y=e.extent;const E=e.viewState.resolution,v=m.getTilePixelRatio(p),A=Math.round((0,d.RG)(y)/E*p),S=Math.round((0,d.Oq)(y)/E*p),C=r.extent&&(0,c.fromUserExtent)(r.extent,n);C&&(y=(0,d._N)(y,(0,c.fromUserExtent)(r.extent,n)));const I=R*A/2/v,w=R*S/2/v,b=[o[0]-I,o[1]-w,o[0]+I,o[1]+w],F=_.getTileRangeForExtentAndZ(y,x),P={};P[x]={};const L=this.createLoadedTileFinder(m,n,P),D=this.tmpExtent,G=this.tmpTileRange_;this.newTiles_=!1;const M=g?(0,d.Yw)(i.center,E,g,e.size):void 0;for(let l=F.minX;l<=F.maxX;++l)for(let t=F.minY;t<=F.maxY;++t){if(g&&!_.tileCoordIntersectsViewport([x,l,t],M))continue;const i=this.getTile(x,l,t,e);if(this.isDrawableTile(i)){const t=(0,u.v6)(this);if(i.getState()==a.A.LOADED){P[x][i.tileCoord.toString()]=i;let e=i.inTransition(t);e&&1!==r.opacity&&(i.endTransition(t),e=!1),this.newTiles_||!e&&this.renderedTiles.includes(i)||(this.newTiles_=!0)}if(1===i.getAlpha(t,e.time))continue}const n=_.getTileCoordChildTileRange(i.tileCoord,G,D);let s=!1;n&&(s=L(x+1,n)),s||_.forEachTileCoordParentTileRange(i.tileCoord,L,G,D)}const B=R/s*p/v;(0,l.Zz)(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/p,1/p,g,-A/2,-S/2);const O=(0,l.dI)(this.pixelTransform);this.useContainer(t,O,this.getBackground(e));const N=this.context,j=N.canvas;(0,l.T9)(this.inversePixelTransform,this.pixelTransform),(0,l.Zz)(this.tempTransform,A/2,S/2,B,B,0,-A/2,-S/2),j.width!=A||j.height!=S?(j.width=A,j.height=S):this.containerReused||N.clearRect(0,0,A,S),C&&this.clipUnrotated(N,e,C),m.getInterpolate()||(N.imageSmoothingEnabled=!1),this.preRender(N,e),this.renderedTiles.length=0;let z,k,H,U=Object.keys(P).map(Number);U.sort(h.V_),1!==r.opacity||this.containerReused&&!m.getOpaque(e.viewState.projection)?(z=[],k=[]):U=U.reverse();for(let a=U.length-1;a>=0;--a){const t=U[a],r=m.getTilePixelSize(t,p,n),i=_.getResolution(t),s=i/R,o=r[0]*s*B,h=r[1]*s*B,c=_.getTileCoordForCoordAndZ((0,d.Py)(b),t),g=_.getTileCoordExtent(c),f=(0,l.Bb)(this.tempTransform,[v*(g[0]-b[0])/R,v*(b[3]-g[3])/R]),T=v*m.getGutterForProjection(n),y=P[t];for(const n in y){const r=y[n],i=r.tileCoord,s=c[1]-i[1],a=Math.round(f[0]-(s-1)*o),l=c[2]-i[2],g=Math.round(f[1]-(l-1)*h),p=Math.round(f[0]-s*o),_=Math.round(f[1]-l*h),R=a-p,E=g-_,v=x===t,A=v&&1!==r.getAlpha((0,u.v6)(this),e.time);let S=!1;if(!A)if(z){H=[p,_,p+R,_,p+R,_+E,p,_+E];for(let e=0,r=z.length;e<r;++e)if(x!==t&&t<k[e]){const t=z[e];(0,d.HY)([p,_,p+R,_+E],[t[0],t[3],t[4],t[7]])&&(S||(N.save(),S=!0),N.beginPath(),N.moveTo(H[0],H[1]),N.lineTo(H[2],H[3]),N.lineTo(H[4],H[5]),N.lineTo(H[6],H[7]),N.moveTo(t[6],t[7]),N.lineTo(t[4],t[5]),N.lineTo(t[2],t[3]),N.lineTo(t[0],t[1]),N.clip())}z.push(H),k.push(t)}else N.clearRect(p,_,R,E);this.drawTileImage(r,e,p,_,R,E,T,v),z&&!A?(S&&N.restore(),this.renderedTiles.unshift(r)):this.renderedTiles.push(r),this.updateUsedTiles(e.usedTiles,m,r)}}return this.renderedRevision=T,this.renderedResolution=R,this.extentChanged=!this.renderedExtent_||!(0,d.aI)(this.renderedExtent_,b),this.renderedExtent_=b,this.renderedPixelRatio=p,this.renderedProjection=n,this.manageTilePyramid(e,m,_,p,n,y,x,f.getPreload()),this.scheduleExpireCache(e,m),this.postRender(N,e),r.extent&&N.restore(),N.imageSmoothingEnabled=!0,O!==j.style.transform&&(j.style.transform=O),this.container}drawTileImage(e,t,r,i,n,s,o,a){const l=this.getTileImage(e);if(!l)return;const h=(0,u.v6)(this),d=t.layerStatesArray[t.layerIndex],c=d.opacity*(a?e.getAlpha(h,t.time):1),g=c!==this.context.globalAlpha;g&&(this.context.save(),this.context.globalAlpha=c),this.context.drawImage(l,o,o,l.width-2*o,l.height-2*o,r,i,n,s),g&&this.context.restore(),c!==d.opacity?t.animate=!0:a&&e.endTransition(h)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}scheduleExpireCache(e,t){if(t.canExpireCache()){const r=function(e,t,r){const i=(0,u.v6)(e);i in r.usedTiles&&e.expireCache(r.viewState.projection,r.usedTiles[i])}.bind(null,t);e.postRenderFunctions.push(r)}}updateUsedTiles(e,t,r){const i=(0,u.v6)(t);i in e||(e[i]={}),e[i][r.getKey()]=!0}manageTilePyramid(e,t,r,i,n,s,o,l,h){const c=(0,u.v6)(t);c in e.wantedTiles||(e.wantedTiles[c]={});const g=e.wantedTiles[c],p=e.tileQueue,f=r.getMinZoom(),m=e.viewState.rotation,T=m?(0,d.Yw)(e.viewState.center,e.viewState.resolution,m,e.size):void 0;let _,x,R,y,E,v,A=0;for(v=f;v<=o;++v)for(x=r.getTileRangeForExtentAndZ(s,v,x),R=r.getResolution(v),y=x.minX;y<=x.maxX;++y)for(E=x.minY;E<=x.maxY;++E)m&&!r.tileCoordIntersectsViewport([v,y,E],T)||(o-v<=l?(++A,_=t.getTile(v,y,E,i,n),_.getState()==a.A.IDLE&&(g[_.getKey()]=!0,p.isKeyQueued(_.getKey())||p.enqueue([_,c,r.getTileCoordCenter(_.tileCoord),R])),void 0!==h&&h(_)):t.useTile(v,y,E,n));t.updateCacheSize(A,n)}}const f=p},32348:(e,t,r)=>{r.d(t,{A:()=>_});var i=r(70587),n=r(96769),s=r(4961),o=r(83984),a=r(62703),l=r(57849),h=r(9703),d=r(70915),c=r(68711),u=r(73608),g=r(66514),p=r(89718),f=r(4087),m=r(6933);class T extends n.A{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=(0,d.S5)(),this.wrappedRenderedExtent_=(0,d.S5)(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.declutterExecutorGroup=null,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(e,t,r){const i=t.extent,n=t.viewState,s=n.center,o=n.resolution,l=n.projection,h=n.rotation,c=l.getExtent(),u=this.getLayer().getSource(),g=t.pixelRatio,p=t.viewHints,f=!(p[a.A.ANIMATING]||p[a.A.INTERACTING]),m=this.compositionContext_,T=Math.round(t.size[0]*g),_=Math.round(t.size[1]*g),x=u.getWrapX()&&l.canWrapX(),R=x?(0,d.RG)(c):null,y=x?Math.ceil((i[2]-c[2])/R)+1:1;let E=x?Math.floor((i[0]-c[0])/R):0;do{const t=this.getRenderTransform(s,o,h,g,T,_,E*R);e.execute(m,1,t,h,f,void 0,r)}while(++E<y)}setupCompositionContext_(){if(1!==this.opacity_){const e=(0,c.Y)(this.context.canvas.width,this.context.canvas.height,n.B);this.compositionContext_=e}else this.compositionContext_=this.context}releaseCompositionContext_(){if(1!==this.opacity_){const e=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=e,(0,c.Yg)(this.compositionContext_),n.B.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(e){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,e,e.declutterTree),this.releaseCompositionContext_())}renderFrame(e,t){const r=e.pixelRatio,i=e.layerStatesArray[e.layerIndex];(0,h.rQ)(this.pixelTransform,1/r,1/r),(0,h.T9)(this.inversePixelTransform,this.pixelTransform);const n=(0,h.dI)(this.pixelTransform);this.useContainer(t,n,this.getBackground(e));const s=this.context,a=s.canvas,l=this.replayGroup_,c=this.declutterExecutorGroup;let u=l&&!l.isEmpty()||c&&!c.isEmpty();if(!u){const e=this.getLayer().hasListener(o.A.PRERENDER)||this.getLayer().hasListener(o.A.POSTRENDER);if(!e)return null}const g=Math.round(e.size[0]*r),f=Math.round(e.size[1]*r);a.width!=g||a.height!=f?(a.width=g,a.height=f,a.style.transform!==n&&(a.style.transform=n)):this.containerReused||s.clearRect(0,0,g,f),this.preRender(s,e);const m=e.viewState,T=m.projection;this.opacity_=i.opacity,this.setupCompositionContext_();let _=!1;if(u&&i.extent&&this.clipping){const t=(0,p.fromUserExtent)(i.extent,T);u=(0,d.HY)(t,e.extent),_=u&&!(0,d.ms)(t,e.extent),_&&this.clipUnrotated(this.compositionContext_,e,t)}return u&&this.renderWorlds(l,e),_&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(s,e),this.renderedRotation_!==m.rotation&&(this.renderedRotation_=m.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(e){return new Promise((t=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const e=[this.context.canvas.width,this.context.canvas.height];(0,h.Bb)(this.pixelTransform,e);const t=this.renderedCenter_,r=this.renderedResolution_,i=this.renderedRotation_,n=this.renderedProjection_,s=this.wrappedRenderedExtent_,o=this.getLayer(),a=[],c=e[0]*l.tF,u=e[1]*l.tF;a.push(this.getRenderTransform(t,r,i,l.tF,c,u,0).slice());const g=o.getSource(),p=n.getExtent();if(g.getWrapX()&&n.canWrapX()&&!(0,d.ms)(p,s)){let e=s[0];const n=(0,d.RG)(p);let o,h=0;while(e<p[0])--h,o=n*h,a.push(this.getRenderTransform(t,r,i,l.tF,c,u,o).slice()),e+=n;h=0,e=s[2];while(e>p[2])++h,o=n*h,a.push(this.getRenderTransform(t,r,i,l.tF,c,u,o).slice()),e-=n}this.hitDetectionImageData_=(0,l._7)(e,a,this.renderedFeatures_,o.getStyleFunction(),s,r,i)}t((0,l.F8)(e,this.renderedFeatures_,this.hitDetectionImageData_))}))}forEachFeatureAtCoordinate(e,t,r,i,n){if(!this.replayGroup_)return;const s=t.viewState.resolution,o=t.viewState.rotation,a=this.getLayer(),l={},h=function(e,t,r){const s=(0,f.v6)(e),o=l[s];if(o){if(!0!==o&&r<o.distanceSq){if(0===r)return l[s]=!0,n.splice(n.lastIndexOf(o),1),i(e,a,t);o.geometry=t,o.distanceSq=r}}else{if(0===r)return l[s]=!0,i(e,a,t);n.push(l[s]={feature:e,layer:a,geometry:t,distanceSq:r,callback:i})}};let d;const c=[this.replayGroup_];return this.declutterExecutorGroup&&c.push(this.declutterExecutorGroup),c.some((i=>d=i.forEachFeatureAtCoordinate(e,s,o,r,h,i===this.declutterExecutorGroup&&t.declutterTree?t.declutterTree.all().map((e=>e.value)):null))),d}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const t=this.getLayer(),r=t.getSource();if(!r)return!1;const n=e.viewHints[a.A.ANIMATING],o=e.viewHints[a.A.INTERACTING],l=t.getUpdateWhileAnimating(),h=t.getUpdateWhileInteracting();if(this.ready&&!l&&n||!h&&o)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const c=e.extent,f=e.viewState,T=f.projection,_=f.resolution,x=e.pixelRatio,R=t.getRevision(),y=t.getRenderBuffer();let E=t.getRenderOrder();void 0===E&&(E=u.Eo);const v=f.center.slice(),A=(0,d.r)(c,y*_),S=A.slice(),C=[A.slice()],I=T.getExtent();if(r.getWrapX()&&T.canWrapX()&&!(0,d.ms)(I,e.extent)){const e=(0,d.RG)(I),t=Math.max((0,d.RG)(A)/2,e);A[0]=I[0]-t,A[2]=I[2]+t,(0,m.Li)(v,T);const r=(0,d.Li)(C[0],T);r[0]<I[0]&&r[2]<I[2]?C.push([r[0]+e,r[1],r[2]+e,r[3]]):r[0]>I[0]&&r[2]>I[2]&&C.push([r[0]-e,r[1],r[2]-e,r[3]])}if(this.ready&&this.renderedResolution_==_&&this.renderedRevision_==R&&this.renderedRenderOrder_==E&&(0,d.ms)(this.wrappedRenderedExtent_,A))return(0,g.aI)(this.renderedExtent_,S)||(this.hitDetectionImageData_=null,this.renderedExtent_=S),this.renderedCenter_=v,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const w=new i.A((0,u.gY)(_,x),A,_,x);let b;this.getLayer().getDeclutter()&&(b=new i.A((0,u.gY)(_,x),A,_,x));const F=(0,p.getUserProjection)();let P;if(F){for(let e=0,t=C.length;e<t;++e){const t=C[e],i=(0,p.toUserExtent)(t,T);r.loadFeatures(i,(0,p.toUserResolution)(_,T),F)}P=(0,p.getTransformFromProjections)(F,T)}else for(let i=0,s=C.length;i<s;++i)r.loadFeatures(C[i],_,T);const L=(0,u.j)(_,x);let D=!0;const G=e=>{let r;const i=e.getStyleFunction()||t.getStyleFunction();if(i&&(r=i(e,_)),r){const t=this.renderFeature(e,L,r,w,P,b);D=D&&!t}},M=(0,p.toUserExtent)(A,T),B=r.getFeaturesInExtent(M);E&&B.sort(E);for(let i=0,s=B.length;i<s;++i)G(B[i]);this.renderedFeatures_=B,this.ready=D;const O=w.finish(),N=new s.A(A,_,x,r.getOverlaps(),O,t.getRenderBuffer());return b&&(this.declutterExecutorGroup=new s.A(A,_,x,r.getOverlaps(),b.finish(),t.getRenderBuffer())),this.renderedResolution_=_,this.renderedRevision_=R,this.renderedRenderOrder_=E,this.renderedExtent_=S,this.wrappedRenderedExtent_=A,this.renderedCenter_=v,this.renderedProjection_=T,this.replayGroup_=N,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,r,i,n,s){if(!r)return!1;let o=!1;if(Array.isArray(r))for(let a=0,l=r.length;a<l;++a)o=(0,u.nl)(i,e,r[a],t,this.boundHandleStyleImageChange_,n,s)||o;else o=(0,u.nl)(i,e,r,t,this.boundHandleStyleImageChange_,n,s);return o}}const _=T},25288:(e,t,r)=>{r.d(t,{A:()=>_});var i=r(70587),n=r(4961),s=r(24029),o=r(11078),a=r(62703),l=r(57849),h=r(9703),d=r(70915),c=r(73608),u=r(4087),g=r(6782),p=r(6933);const f={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},m={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class T extends s.A{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.tmpTransform_=(0,h.vt)()}prepareTile(e,t,r){let i;const n=e.getState();return n!==o.A.LOADED&&n!==o.A.ERROR||(this.updateExecutorGroup_(e,t,r),this.tileImageNeedsRender_(e)&&(i=!0)),i}getTile(e,t,r,i){const n=i.pixelRatio,s=i.viewState,o=s.resolution,l=s.projection,h=this.getLayer(),d=h.getSource().getTile(e,t,r,n,l),c=i.viewHints,u=!(c[a.A.ANIMATING]||c[a.A.INTERACTING]);!u&&d.wantedResolution||(d.wantedResolution=o);const g=this.prepareTile(d,n,l);return g&&(u||Date.now()-i.time<8)&&"vector"!==h.getRenderMode()&&this.renderTileImage_(d,i),super.getTile(e,t,r,i)}isDrawableTile(e){const t=this.getLayer();return super.isDrawableTile(e)&&("vector"===t.getRenderMode()?(0,u.v6)(t)in e.executorGroups:e.hasContext(t))}getTileImage(e){return e.getImage(this.getLayer())}prepareFrame(e){const t=this.getLayer().getRevision();return this.renderedLayerRevision_!==t&&(this.renderedLayerRevision_=t,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,t,r){const s=this.getLayer(),a=s.getRevision(),l=s.getRenderOrder()||null,h=e.wantedResolution,g=e.getReplayState(s);if(!g.dirty&&g.renderedResolution===h&&g.renderedRevision==a&&g.renderedRenderOrder==l)return;const p=s.getSource(),f=s.getDeclutter(),m=p.getTileGrid(),T=p.getTileGridForProjection(r),_=T.getTileCoordExtent(e.wrappedTileCoord),x=p.getSourceTiles(t,r,e),R=(0,u.v6)(s);delete e.hitDetectionImageData[R],e.executorGroups[R]=[],f&&(e.declutterExecutorGroups[R]=[]),g.dirty=!1;for(let u=0,y=x.length;u<y;++u){const r=x[u];if(r.getState()!=o.A.LOADED)continue;const a=r.tileCoord,T=m.getTileCoordExtent(a),y=(0,d._N)(_,T),E=(0,d.r)(y,s.getRenderBuffer()*h,this.tmpExtent),v=(0,d.aI)(T,y)?null:E,A=new i.A(0,E,h,t),S=f?new i.A(0,y,h,t):void 0,C=(0,c.j)(h,t),I=function(e){let t;const r=e.getStyleFunction()||s.getStyleFunction();if(r&&(t=r(e,h)),t){const r=this.renderFeature(e,C,t,A,S);g.dirty=g.dirty||r}},w=r.getFeatures();l&&l!==g.renderedRenderOrder&&w.sort(l);for(let e=0,t=w.length;e<t;++e){const t=w[e];v&&!(0,d.HY)(v,t.getGeometry().getExtent())||I.call(this,t)}const b=A.finish(),F="vector"!==s.getRenderMode()&&f&&1===x.length?null:y,P=new n.A(F,h,t,p.getOverlaps(),b,s.getRenderBuffer());if(e.executorGroups[R].push(P),S){const r=new n.A(null,h,t,p.getOverlaps(),S.finish(),s.getRenderBuffer());e.declutterExecutorGroups[R].push(r)}}g.renderedRevision=a,g.renderedRenderOrder=l,g.renderedResolution=h}forEachFeatureAtCoordinate(e,t,r,i,n){const s=t.viewState.resolution,o=t.viewState.rotation;r=void 0==r?0:r;const a=this.getLayer(),l=a.getSource(),h=l.getTileGridForProjection(t.viewState.projection),c=(0,d.Tr)([e]);(0,d.r)(c,s*r,c);const g={},p=function(e,t,r){let s=e.getId();void 0===s&&(s=(0,u.v6)(e));const o=g[s];if(o){if(!0!==o&&r<o.distanceSq){if(0===r)return g[s]=!0,n.splice(n.lastIndexOf(o),1),i(e,a,t);o.geometry=t,o.distanceSq=r}}else{if(0===r)return g[s]=!0,i(e,a,t);n.push(g[s]={feature:e,layer:a,geometry:t,distanceSq:r,callback:i})}},f=this.renderedTiles;let m;for(let T=0,_=f.length;!m&&T<_;++T){const i=f[T],n=h.getTileCoordExtent(i.wrappedTileCoord);if(!(0,d.HY)(n,c))continue;const l=(0,u.v6)(a),g=[i.executorGroups[l]],_=i.declutterExecutorGroups[l];_&&g.push(_),g.some((i=>{const n=i===_?t.declutterTree.all().map((e=>e.value)):null;for(let t=0,a=i.length;t<a;++t){const a=i[t];if(m=a.forEachFeatureAtCoordinate(e,s,o,r,p,n),m)return!0}}))}return m}getFeatures(e){return new Promise(((t,r)=>{const i=this.getLayer(),n=(0,u.v6)(i),s=i.getSource(),a=this.renderedProjection,c=a.getExtent(),f=this.renderedResolution,m=s.getTileGridForProjection(a),T=(0,h.Bb)(this.renderedPixelToCoordinateTransform_,e.slice()),_=m.getTileCoordForCoordAndResolution(T,f);let x;for(let e=0,l=this.renderedTiles.length;e<l;++e)if(_.toString()===this.renderedTiles[e].tileCoord.toString()){if(x=this.renderedTiles[e],x.getState()===o.A.LOADED){const e=m.getTileCoordExtent(x.tileCoord);s.getWrapX()&&a.canWrapX()&&!(0,d.ms)(c,e)&&(0,p.Li)(T,a);break}x=void 0}if(!x||x.loadingSourceTiles>0)return void t([]);const R=m.getTileCoordExtent(x.wrappedTileCoord),y=(0,d.Py)(R),E=[(T[0]-y[0])/f,(y[1]-T[1])/f],v=x.getSourceTiles().reduce((function(e,t){return e.concat(t.getFeatures())}),[]);let A=x.hitDetectionImageData[n];if(!A){const e=(0,g.xq)(m.getTileSize(m.getZForResolution(f,s.zDirection))),t=this.renderedRotation_,r=[this.getRenderTransform(m.getTileCoordCenter(x.wrappedTileCoord),f,0,l.tF,e[0]*l.tF,e[1]*l.tF,0)];A=(0,l._7)(e,r,v,i.getStyleFunction(),m.getTileCoordExtent(x.wrappedTileCoord),x.getReplayState(i).renderedResolution,t),x.hitDetectionImageData[n]=A}t((0,l.F8)(E,v,A))}))}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&void 0!==this.renderedLayerRevision_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e){const t=this.context,r=t.globalAlpha;t.globalAlpha=this.getLayer().getOpacity();const i=e.viewHints,n=!(i[a.A.ANIMATING]||i[a.A.INTERACTING]),s=this.renderedTiles;for(let o=0,a=s.length;o<a;++o){const t=s[o],r=t.declutterExecutorGroups[(0,u.v6)(this.getLayer())];if(r)for(let i=r.length-1;i>=0;--i)r[i].execute(this.context,1,this.getTileRenderTransform(t,e),e.viewState.rotation,n,void 0,e.declutterTree)}t.globalAlpha=r}getTileRenderTransform(e,t){const r=t.pixelRatio,i=t.viewState,n=i.center,s=i.resolution,o=i.rotation,a=t.size,l=Math.round(a[0]*r),d=Math.round(a[1]*r),c=this.getLayer().getSource(),u=c.getTileGridForProjection(t.viewState.projection),g=e.tileCoord,p=u.getTileCoordExtent(e.wrappedTileCoord),f=u.getTileCoordExtent(g,this.tmpExtent)[0]-p[0],m=(0,h.lw)((0,h.hs)(this.inversePixelTransform.slice(),1/r,1/r),this.getRenderTransform(n,s,o,r,l,d,f));return m}postRender(e,t){const r=t.viewHints,i=!(r[a.A.ANIMATING]||r[a.A.INTERACTING]);this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation;const n=this.getLayer(),s=n.getRenderMode(),o=e.globalAlpha;e.globalAlpha=n.getOpacity();const l=m[s],h=t.viewState,c=h.rotation,g=n.getSource(),p=g.getTileGridForProjection(h.projection),f=p.getZForResolution(h.resolution,g.zDirection),T=this.renderedTiles,_=[],x=[];let R=!0;for(let a=T.length-1;a>=0;--a){const r=T[a];R=R&&!r.getReplayState(n).dirty;const s=r.executorGroups[(0,u.v6)(n)].filter((e=>e.hasExecutors(l)));if(0===s.length)continue;const o=this.getTileRenderTransform(r,t),h=r.tileCoord[0];let g=!1;const p=s[0].getClipCoords(o);if(p){for(let t=0,r=_.length;t<r;++t)if(f!==h&&h<x[t]){const r=_[t];(0,d.HY)([p[0],p[3],p[4],p[7]],[r[0],r[3],r[4],r[7]])&&(g||(e.save(),g=!0),e.beginPath(),e.moveTo(p[0],p[1]),e.lineTo(p[2],p[3]),e.lineTo(p[4],p[5]),e.lineTo(p[6],p[7]),e.moveTo(r[6],r[7]),e.lineTo(r[4],r[5]),e.lineTo(r[2],r[3]),e.lineTo(r[0],r[1]),e.clip())}_.push(p),x.push(h)}for(let t=0,n=s.length;t<n;++t){const r=s[t];r.execute(e,1,o,c,i,l)}g&&e.restore()}e.globalAlpha=o,this.ready=R,super.postRender(e,t)}renderFeature(e,t,r,i,n){if(!r)return!1;let s=!1;if(Array.isArray(r))for(let o=0,a=r.length;o<a;++o)s=(0,c.nl)(i,e,r[o],t,this.boundHandleStyleImageChange_,void 0,n)||s;else s=(0,c.nl)(i,e,r,t,this.boundHandleStyleImageChange_,void 0,n);return s}tileImageNeedsRender_(e){const t=this.getLayer();if("vector"===t.getRenderMode())return!1;const r=e.getReplayState(t),i=t.getRevision(),n=e.wantedResolution;return r.renderedTileResolution!==n||r.renderedTileRevision!==i}renderTileImage_(e,t){const r=this.getLayer(),i=e.getReplayState(r),n=r.getRevision(),s=e.executorGroups[(0,u.v6)(r)];i.renderedTileRevision=n;const o=e.wrappedTileCoord,a=o[0],l=r.getSource();let d=t.pixelRatio;const c=t.viewState,g=c.projection,p=l.getTileGridForProjection(g),m=p.getResolution(e.tileCoord[0]),T=t.pixelRatio/e.wantedResolution*m,_=p.getResolution(a),x=e.getContext(r);d=Math.round(Math.max(d,T/d));const R=l.getTilePixelSize(a,d,g);x.canvas.width=R[0],x.canvas.height=R[1];const y=d/T;if(1!==y){const e=(0,h.cL)(this.tmpTransform_);(0,h.hs)(e,y,y),x.setTransform.apply(x,e)}const E=p.getTileCoordExtent(o,this.tmpExtent),v=T/_,A=(0,h.cL)(this.tmpTransform_);(0,h.hs)(A,v,-v),(0,h.Tl)(A,-E[0],-E[3]);for(let h=0,u=s.length;h<u;++h){const e=s[h];e.execute(x,y,A,0,!0,f[r.getRenderMode()])}i.renderedTileResolution=e.wantedResolution}}const _=T},73608:(e,t,r)=>{r.d(t,{Eo:()=>a,gY:()=>h,j:()=>l,nl:()=>c});var i=r(6141),n=r(4087);const s=.5,o={Point:_,LineString:f,Polygon:R,MultiPoint:x,MultiLineString:m,MultiPolygon:T,GeometryCollection:p,Circle:d};function a(e,t){return parseInt((0,n.v6)(e),10)-parseInt((0,n.v6)(t),10)}function l(e,t){const r=h(e,t);return r*r}function h(e,t){return s*e/t}function d(e,t,r,i,n){const s=r.getFill(),o=r.getStroke();if(s||o){const n=e.getBuilder(r.getZIndex(),"Circle");n.setFillStrokeStyle(s,o),n.drawCircle(t,i)}const a=r.getText();if(a&&a.getText()){const s=(n||e).getBuilder(r.getZIndex(),"Text");s.setTextStyle(a),s.drawText(t,i)}}function c(e,t,r,n,s,o,a){let l=!1;const h=r.getImage();if(h){const e=h.getImageState();e==i.A.LOADED||e==i.A.ERROR?h.unlistenImageChange(s):(e==i.A.IDLE&&h.load(),h.listenImageChange(s),l=!0)}return u(e,t,r,n,o,a),l}function u(e,t,r,i,n,s){const a=r.getGeometryFunction()(t);if(!a)return;const l=a.simplifyTransformed(i,n),h=r.getRenderer();if(h)g(e,l,r,t);else{const i=o[l.getType()];i(e,l,r,t,s)}}function g(e,t,r,i){if("GeometryCollection"==t.getType()){const n=t.getGeometries();for(let t=0,s=n.length;t<s;++t)g(e,n[t],r,i);return}const n=e.getBuilder(r.getZIndex(),"Default");n.drawCustom(t,i,r.getRenderer(),r.getHitDetectionRenderer())}function p(e,t,r,i,n){const s=t.getGeometriesArray();let a,l;for(a=0,l=s.length;a<l;++a){const t=o[s[a].getType()];t(e,s[a],r,i,n)}}function f(e,t,r,i,n){const s=r.getStroke();if(s){const n=e.getBuilder(r.getZIndex(),"LineString");n.setFillStrokeStyle(null,s),n.drawLineString(t,i)}const o=r.getText();if(o&&o.getText()){const s=(n||e).getBuilder(r.getZIndex(),"Text");s.setTextStyle(o),s.drawText(t,i)}}function m(e,t,r,i,n){const s=r.getStroke();if(s){const n=e.getBuilder(r.getZIndex(),"LineString");n.setFillStrokeStyle(null,s),n.drawMultiLineString(t,i)}const o=r.getText();if(o&&o.getText()){const s=(n||e).getBuilder(r.getZIndex(),"Text");s.setTextStyle(o),s.drawText(t,i)}}function T(e,t,r,i,n){const s=r.getFill(),o=r.getStroke();if(o||s){const n=e.getBuilder(r.getZIndex(),"Polygon");n.setFillStrokeStyle(s,o),n.drawMultiPolygon(t,i)}const a=r.getText();if(a&&a.getText()){const s=(n||e).getBuilder(r.getZIndex(),"Text");s.setTextStyle(a),s.drawText(t,i)}}function _(e,t,r,n,s){const o=r.getImage(),a=r.getText();let l;if(o){if(o.getImageState()!=i.A.LOADED)return;let h=e;if(s){const i=o.getDeclutterMode();if("none"!==i)if(h=s,"obstacle"===i){const i=e.getBuilder(r.getZIndex(),"Image");i.setImageStyle(o,l),i.drawPoint(t,n)}else a&&a.getText()&&(l={})}const d=h.getBuilder(r.getZIndex(),"Image");d.setImageStyle(o,l),d.drawPoint(t,n)}if(a&&a.getText()){let i=e;s&&(i=s);const o=i.getBuilder(r.getZIndex(),"Text");o.setTextStyle(a,l),o.drawText(t,n)}}function x(e,t,r,n,s){const o=r.getImage(),a=r.getText();let l;if(o){if(o.getImageState()!=i.A.LOADED)return;let h=e;if(s){const i=o.getDeclutterMode();if("none"!==i)if(h=s,"obstacle"===i){const i=e.getBuilder(r.getZIndex(),"Image");i.setImageStyle(o,l),i.drawMultiPoint(t,n)}else a&&a.getText()&&(l={})}const d=h.getBuilder(r.getZIndex(),"Image");d.setImageStyle(o,l),d.drawMultiPoint(t,n)}if(a&&a.getText()){let i=e;s&&(i=s);const o=i.getBuilder(r.getZIndex(),"Text");o.setTextStyle(a,l),o.drawText(t,n)}}function R(e,t,r,i,n){const s=r.getFill(),o=r.getStroke();if(s||o){const n=e.getBuilder(r.getZIndex(),"Polygon");n.setFillStrokeStyle(s,o),n.drawPolygon(t,i)}const a=r.getText();if(a&&a.getText()){const s=(n||e).getBuilder(r.getZIndex(),"Text");s.setTextStyle(a),s.drawText(t,i)}}},60492:(e,t,r)=>{r.d(t,{A:()=>d});var i=r(75332),n=r(5986),s=r(9960),o=r(83984),a=r(63722),l=r(9703);class h extends n.A{constructor(e,t){super(e),t=t||{},this.inversePixelTransform_=(0,l.vt)(),this.pixelContext_=null,this.postProcesses_=t.postProcesses,this.uniforms_=t.uniforms,this.helper,e.addChangeListener(i.A.MAP,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(e,t){const r=this.getLayer();if(r.hasListener(o.A.PRECOMPOSE)){const i=new s.A(o.A.PRECOMPOSE,void 0,t,e);r.dispatchEvent(i)}}dispatchPostComposeEvent(e,t){const r=this.getLayer();if(r.hasListener(o.A.POSTCOMPOSE)){const i=new s.A(o.A.POSTCOMPOSE,void 0,t,e);r.dispatchEvent(i)}}reset(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(e){if(this.getLayer().getRenderSource()){let t,r=!0,i=-1;for(let s=0,o=e.layerStatesArray.length;s<o;s++){const n=e.layerStatesArray[s].layer,o=n.getRenderer();if(!(o instanceof h)){r=!0;continue}const a=n.getClassName();if((r||a!==t)&&(i+=1,r=!1),t=a,o===this)break}const n="map/"+e.mapId+"/group/"+i;this.helper&&this.helper.canvasCacheKeyMatches(n)||(this.removeHelper(),this.helper=new a.Ay({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:n}),t&&(this.helper.getCanvas().className=t),this.afterHelperCreated())}return this.prepareFrameInternal(e)}afterHelperCreated(){}prepareFrameInternal(e){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(e,t,r){const i=this.getLayer();if(i.hasListener(e)){(0,l.Zz)(this.inversePixelTransform_,0,0,r.pixelRatio,-r.pixelRatio,0,0,-r.size[1]);const n=new s.A(e,this.inversePixelTransform_,r,t);i.dispatchEvent(n)}}preRender(e,t){this.dispatchRenderEvent_(o.A.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(o.A.POSTRENDER,e,t)}}const d=h},7981:(e,t,r)=>{r.d(t,{A:()=>y});var i=r(16323),n=r(88280),s=r(62703),o=r(20259),a=r(60492),l=r(89940),h=r(90130),d=r(63722);const c={GENERATE_POLYGON_BUFFERS:"GENERATE_POLYGON_BUFFERS",GENERATE_POINT_BUFFERS:"GENERATE_POINT_BUFFERS",GENERATE_LINE_STRING_BUFFERS:"GENERATE_LINE_STRING_BUFFERS"};var u=r(9703),g=r(90588),p=r(70915);r(66570);function f(e,t){t=t||[];const r=256,i=r-1;return t[0]=Math.floor(e/r/r/r)/i,t[1]=Math.floor(e/r/r)%r/i,t[2]=Math.floor(e/r)%r/i,t[3]=e%r/i,t}function m(e){let t=0;const r=256,i=r-1;return t+=Math.round(e[0]*r*r*r*i),t+=Math.round(e[1]*r*r*i),t+=Math.round(e[2]*r*i),t+=Math.round(e[3]*i),t}var T=r(35339),_=r(4087),x=r(9438);class R extends a.A{constructor(e,t){const r=t.uniforms||{},i=(0,u.vt)();r[d.M8.PROJECTION_MATRIX]=i,super(e,{uniforms:r,postProcesses:t.postProcesses}),this.sourceRevision_=-1,this.verticesBuffer_=new o.Ay(h.H7,h.Be),this.indicesBuffer_=new o.Ay(h.IP,h.Be),this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.program_,this.hitDetectionEnabled_=t.hitDetectionEnabled??!0;const s=t.attributes?t.attributes.map((function(e){return{name:"a_"+e.name,size:1,type:d.jQ.FLOAT}})):[];this.attributes=[{name:"a_position",size:2,type:d.jQ.FLOAT},{name:"a_index",size:1,type:d.jQ.FLOAT}],this.hitDetectionEnabled_&&(this.attributes.push({name:"a_hitColor",size:4,type:d.jQ.FLOAT}),this.attributes.push({name:"a_featureUid",size:1,type:d.jQ.FLOAT})),this.attributes.push(...s),this.customAttributes=t.attributes?t.attributes:[],this.previousExtent_=(0,p.S5)(),this.currentTransform_=i,this.renderTransform_=(0,u.vt)(),this.invertRenderTransform_=(0,u.vt)(),this.renderInstructions_=new Float32Array(0),this.hitRenderTarget_,this.lastSentId=0,this.worker_=(0,T.v)(),this.worker_.addEventListener("message",(e=>{const t=e.data;if(t.type===c.GENERATE_POINT_BUFFERS){const r=t.projectionTransform;this.verticesBuffer_.fromArrayBuffer(t.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_),this.indicesBuffer_.fromArrayBuffer(t.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=r,(0,u.T9)(this.invertRenderTransform_,this.renderTransform_),this.renderInstructions_=new Float32Array(e.data.renderInstructions),t.id===this.lastSentId&&(this.ready=!0),this.getLayer().changed()}})),this.featureCache_={},this.featureCount_=0;const a=this.getLayer().getSource();this.sourceListenKeys_=[(0,x.KT)(a,n.A.ADDFEATURE,this.handleSourceFeatureAdded_,this),(0,x.KT)(a,n.A.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),(0,x.KT)(a,n.A.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),(0,x.KT)(a,n.A.CLEAR,this.handleSourceFeatureClear_,this)],a.forEachFeature((e=>{this.featureCache_[(0,_.v6)(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()},this.featureCount_++}))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new l.A(this.helper))}handleSourceFeatureAdded_(e){const t=e.feature;this.featureCache_[(0,_.v6)(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()},this.featureCount_++}handleSourceFeatureChanged_(e){const t=e.feature;this.featureCache_[(0,_.v6)(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()}}handleSourceFeatureDelete_(e){const t=e.feature;delete this.featureCache_[(0,_.v6)(t)],this.featureCount_--}handleSourceFeatureClear_(){this.featureCache_={},this.featureCount_=0}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e);const[r,i,n]=this.getWorldParameters_(e);this.renderWorlds(e,!1,r,i,n),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const s=this.helper.getCanvas();return this.hitDetectionEnabled_&&(this.renderWorlds(e,!0,r,i,n),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e),s}getWorldParameters_(e){const t=e.viewState.projection,r=this.getLayer(),i=r.getSource(),n=i.getWrapX()&&t.canWrapX(),s=t.getExtent(),o=e.extent,a=n?(0,p.RG)(s):null,l=n?Math.ceil((o[2]-s[2])/a)+1:1,h=n?Math.floor((o[0]-s[0])/a):0;return[h,l,a]}prepareFrameInternal(e){const t=this.getLayer(),r=t.getSource(),n=e.viewState,o=!e.viewHints[s.A.ANIMATING]&&!e.viewHints[s.A.INTERACTING],a=!(0,p.aI)(this.previousExtent_,e.extent),l=this.sourceRevision_<r.getRevision();if(l&&(this.sourceRevision_=r.getRevision()),o&&(a||l)){const s=n.projection,o=n.resolution,a=t instanceof i.A?t.getRenderBuffer():0,l=(0,p.r)(e.extent,a*o);r.loadFeatures(l,o,s),this.rebuildBuffers_(e),this.previousExtent_=e.extent.slice()}return this.helper.useProgram(this.program_,e),this.helper.prepareDraw(e),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0}rebuildBuffers_(e){const t=(0,u.vt)();this.helper.makeProjectionTransform(e,t);const r=this.hitDetectionEnabled_?7:2,i=r+this.customAttributes.length,n=i*this.featureCount_;let s,o;this.renderInstructions_&&this.renderInstructions_.length===n||(this.renderInstructions_=new Float32Array(n));const a=[],l=[];let h=-1;for(const c in this.featureCache_)if(s=this.featureCache_[c],o=s.geometry,o&&"Point"===o.getType()){if(a[0]=o.getFlatCoordinates()[0],a[1]=o.getFlatCoordinates()[1],(0,u.Bb)(t,a),this.renderInstructions_[++h]=a[0],this.renderInstructions_[++h]=a[1],this.hitDetectionEnabled_){const e=f(h+5,l);this.renderInstructions_[++h]=e[0],this.renderInstructions_[++h]=e[1],this.renderInstructions_[++h]=e[2],this.renderInstructions_[++h]=e[3],this.renderInstructions_[++h]=Number(c)}for(let e=0;e<this.customAttributes.length;e++){const t=this.customAttributes[e].callback(s.feature,s.properties);this.renderInstructions_[++h]=t}}const d={id:++this.lastSentId,type:c.GENERATE_POINT_BUFFERS,renderInstructions:this.renderInstructions_.buffer,customAttributesSize:i-2};d["projectionTransform"]=t,this.ready=!1,this.worker_.postMessage(d,[this.renderInstructions_.buffer]),this.renderInstructions_=null}forEachFeatureAtCoordinate(e,t,r,i,n){if((0,g.v)(this.hitDetectionEnabled_,66),!this.renderInstructions_||!this.hitDetectionEnabled_)return;const s=(0,u.Bb)(t.coordinateToPixelTransform,e.slice()),o=this.hitRenderTarget_.readPixel(s[0]/2,s[1]/2),a=[o[0]/255,o[1]/255,o[2]/255,o[3]/255],l=m(a),h=this.renderInstructions_[l],d=Math.floor(h).toString(),c=this.getLayer().getSource(),p=c.getFeatureByUid(d);return p?i(p,this.getLayer(),null):void 0}renderWorlds(e,t,r,i,n){let s=r;this.helper.useProgram(this.program_,e),t&&(this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0)),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes);do{this.helper.makeProjectionTransform(e,this.currentTransform_),(0,u.Tl)(this.currentTransform_,s*n,0),(0,u.lw)(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(e),this.helper.applyHitDetectionUniform(t);const r=this.indicesBuffer_.getSize();this.helper.drawElements(0,r)}while(++s<i)}disposeInternal(){this.worker_.terminate(),this.layer_=null,this.sourceListenKeys_.forEach((function(e){(0,x.JH)(e)})),this.sourceListenKeys_=null,super.disposeInternal()}}const y=R}}]);
//# sourceMappingURL=9707.1ca51d52.js.map