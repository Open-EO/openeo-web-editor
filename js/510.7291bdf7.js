"use strict";(globalThis["webpackChunk_openeo_web_editor"]=globalThis["webpackChunk_openeo_web_editor"]||[]).push([[510],{77264:(e,t,a)=>{a.r(t),a.d(t,{default:()=>_e});var s=function(){var e=this,t=e._self._c;return e.selectedSchema?t("div",{staticClass:"fieldContainer"},[e.showDataTypeChooser?t("div",{staticClass:"dataTypeChooser"},[t("select",{attrs:{name:"dataType",disabled:!e.editable},domProps:{value:e.selectedType},on:{input:e.onSelectType}},[e.selectableTypes.length>1?e._l(e.selectableTypes,(function(a){return t("optgroup",{key:a.name,attrs:{label:a.name}},e._l(a.types,(function(a,s){return t("option",{key:s,domProps:{value:s}},[e._v(e._s(e._f("dataTypeTitle")(a)))])})),0)})):e._l(e.selectableTypes[0].types,(function(a,s){return t("option",{key:s,domProps:{value:s}},[e._v(e._s(e._f("dataTypeTitle")(a)))])}))],2)]):e._e(),!e.isItem&&e.selectedSchema.description()?t("div",{staticClass:"description"},[t("i",{staticClass:"fas fa-info-circle"}),t("Description",{attrs:{description:e.selectedSchema.description(),compact:!0}})],1):e._e(),t("ParameterDataType",{attrs:{editable:e.editable,parameter:e.parameter,schema:e.selectedSchema,context:e.context,parent:e.parent},on:{changeType:e.setSelected,reset:e.resetValue},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}})],1):e._e()},i=[],r=(a(98992),a(54520),a(72577),a(2566)),n=a(14894),o=a(28019),l=a.n(o),d=a(31572),c=null;class u extends n.JsonSchemaValidator{static create(e){return null===c&&(c=new u(e)),c}constructor(e){super(),this.store=e,this.setFileFormats(this.store.getters.fileFormats)}async validateBandName(e){return e.length>0}async validateEpsgCode(e){if(await this.store.dispatch("editor/loadEpsgCodes"),this.store.state.editor.epsgCodes[e])return!0;throw new(l().ValidationError)([{message:"Invalid EPSG code '"+e+"' specified."}])}async validateCollectionId(e){if(this.store.state.collections.filter((t=>t.id===e)).length>0)return!0;throw new(l().ValidationError)([{message:"Collection with id '"+e+"' doesn't exist."}])}async validateFilePath(e){if(this.store.getters["files/getById"](e))return!0;throw new(l().ValidationError)([{message:"File at '"+e+"' doesn't exist."}])}async validateInputFormatOptions(e){throw"Not supported"}async validateOutputFormatOptions(e){throw"Not supported"}async validateJobId(e){if(this.store.getters["jobs/getById"](e))return!0;throw new(l().ValidationError)([{message:"Job with id '"+e+"' doesn't exist."}])}async validateUri(e){if(e.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/))return!0;throw new(l().ValidationError)([{message:"URI is invalid"}])}async validateUdfCode(e){if(e.match(/(\r|\n)/))return!0;throw new(l().ValidationError)([{message:"UDF Code is invalid"}])}async validateUdfRuntime(e){if(e in this.store.state.udfRuntimes)return!0;throw new(l().ValidationError)([{message:"UDF runtime '"+e+"' is not supported."}])}async validateUdfRuntimeVersion(e){if(d.Versions.validate(e))return!0;throw new(l().ValidationError)([{message:"UDF runtime version '"+e+"' is not a valid version number."}])}}var p=function(){var e=this,t=e._self._c;return t("div",{staticClass:"fieldEditorContainer"},[e.isResult?[t("div",{staticClass:"fieldValue externalData fromNode"},[t("span",[e._v("Output of "),t("code",[e._v("#"+e._s(e.state.from_node))])])]),"array"===e.nativeParameterType?t("button",{attrs:{type:"button"},on:{click:function(t){return e.convertToArray()}}},[t("i",{staticClass:"fas fa-list"}),e._v(" Convert to array")]):e._e()]:"raster-cube"===e.type||"vector-cube"===e.type||"datacube"===e.type?t("div",{staticClass:"fieldValue description"},[t("i",{staticClass:"fas fa-exclamation-circle"}),t("p",[e._v('This parameter can only be set by creating a connection between an "Output" / "Result" and this parameter in the Visual Model.')])]):e.isPgParameter?[t("div",{staticClass:"fieldValue externalData fromArgument"},[t("span",[e._v("Value of process parameter "),t("code",[e._v(e._s(e.state.from_parameter))])])]),"array"===e.nativeParameterType?t("button",{attrs:{type:"button"},on:{click:function(t){return e.convertToArray()}}},[t("i",{staticClass:"fas fa-list"}),e._v(" Convert to array")]):e._e()]:"undefined"===e.type?t("div",{staticClass:"description"},[t("i",{staticClass:"fas fa-info-circle"}),t("p",[e._v("No value is set.")])]):"null"===e.type?t("div",{staticClass:"description"},[t("i",{staticClass:"fas fa-info-circle"}),e._m(0)]):e.isSelection?t("SelectBox",{key:e.type,attrs:{type:e.type,editable:e.editable,schema:e.schema,context:e.dependency,openDirection:"band-name"===e.type?"below":"auto"},on:{onDetails:e.onSelectDetails},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}}):e.isTemporal?t("TemporalPicker",{key:e.type,attrs:{type:e.type,editable:e.editable},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}}):"bounding-box"===e.type?t("MapAreaSelect",{key:e.type,staticClass:"areaSelector",attrs:{editable:e.editable},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}}):"geojson"===e.type?t("GeoJsonEditor",{key:e.type,staticClass:"geoJsonEditor",attrs:{editable:e.editable},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}}):"process-graph"===e.type?t("Editor",{staticClass:"callbackEditor",attrs:{editable:e.editable,parent:e.parent,parentSchema:e.schema,showDiscoveryToolbar:!0,defaultValue:e.editorDefaultValue},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}}):"output-format-options"===e.type||"input-format-options"===e.type?t("FileFormatOptionsEditor",{ref:"fileFormatOptionsEditor",attrs:{type:e.type,format:e.dependency},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}}):"budget"===e.type?t("Budget",{attrs:{editable:e.editable},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}}):"duration"===e.type?t("Duration",{attrs:{editable:e.editable},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}}):"kernel"===e.type?t("Kernel",{attrs:{editable:e.editable},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}}):"udf-code"===e.type?t("TextEditor",{staticClass:"fieldValue textarea",attrs:{id:e.name,editable:e.editable,language:e.dependency},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}}):"commonmark"===e.type?t("TextEditor",{staticClass:"fieldValue textarea",attrs:{id:e.name,editable:e.editable,language:"markdown"},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}}):"wkt2-definition"===e.type||"proj-definition"===e.type?t("TextEditor",{staticClass:"fieldValue textarea",attrs:{id:e.name,editable:e.editable},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}}):"json"==e.type?t("TextEditor",{staticClass:"fieldValue textarea",attrs:{id:e.name,editable:e.editable,language:"json"},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}}):"boolean"===e.type?t("input",{directives:[{name:"model",rawName:"v-model",value:e.state,expression:"state"}],staticClass:"fieldValue",attrs:{type:"checkbox",name:e.name,disabled:!e.editable},domProps:{checked:Array.isArray(e.state)?e._i(e.state,null)>-1:e.state},on:{change:function(t){var a=e.state,s=t.target,i=!!s.checked;if(Array.isArray(a)){var r=null,n=e._i(a,r);s.checked?n<0&&(e.state=a.concat([r])):n>-1&&(e.state=a.slice(0,n).concat(a.slice(n+1)))}else e.state=i}}}):"integer"===e.type||"number"===e.type?t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.state,expression:"state",modifiers:{number:!0}}],staticClass:"fieldValue",attrs:{type:"number",min:e.numericMin,max:e.numericMax,step:e.numericStep,name:e.name,disabled:!e.editable},domProps:{value:e.state},on:{input:function(t){t.target.composing||(e.state=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}):"url"===e.type||"uri"===e.type?t("input",{directives:[{name:"model",rawName:"v-model",value:e.state,expression:"state"}],staticClass:"fieldValue",attrs:{type:"url",name:e.name,disabled:!e.editable},domProps:{value:e.state},on:{input:function(t){t.target.composing||(e.state=t.target.value)}}}):"object"===e.nativeType||"array"===e.nativeType?t("ObjectEditor",{key:e.type,attrs:{editable:e.editable,parameter:e.parameter,schema:e.schema,isObject:"object"===e.nativeType,parent:e.parent,context:e.context},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}}):t("input",{directives:[{name:"model",rawName:"v-model",value:e.state,expression:"state"}],staticClass:"fieldValue",attrs:{type:"text",name:e.name,disabled:!e.editable},domProps:{value:e.state},on:{input:function(t){t.target.composing||(e.state=t.target.value)}}})],2)},m=[function(){var e=this,t=e._self._c;return t("p",[e._v("This is set to "),t("strong",[t("code",[e._v("null")])]),e._v(", which is usually used as placeholder for no-data values or a default value.")])}],h=a(61663),f=function(){var e=this,t=e._self._c;return t("div",{staticClass:"object-editor",on:{drop:e.onDrop,dragover:e.allowDrop}},[e.isTopLevel?[t("Tabs",{ref:"tabs",attrs:{id:"object-tabs",position:"bottom"}},[t("Tab",{attrs:{id:"visual",name:"Visual",icon:"fa-project-diagram",selected:!0},on:{show:e.showVisual}},[e.visual?t("ObjectEditorDnD",{ref:"visual",attrs:{parameter:e.parameter,editable:e.editable,schema:e.schema,parent:e.parent,context:e.context,value:e.data,isObject:e.isObject},on:{input:e.updateFromVisual}}):e._e()],1),t("Tab",{attrs:{id:"source",name:"Code",icon:"fa-code"},on:{show:e.showCode}},[t("TextEditor",{ref:"sourceEditor",attrs:{editable:e.editable,value:e.data,id:"object-texteditor",language:"json"},on:{input:e.updateFromCode}})],1)],1),e.editable&&e.isObject?t("small",{staticClass:"info"},[e._v(" To easily import an object, you can drag & drop a JSON file into this area. ")]):e._e()]:[t("ObjectEditorDnD",{ref:"visual",attrs:{parameter:e.parameter,editable:e.editable,schema:e.schema,parent:e.parent,context:e.context,value:e.data,isObject:e.isObject},on:{input:e.updateFromVisual}})]],2)},y=[],b=a(4615),g=a(58379),v=function(){var e=this,t=e._self._c;return t("div",{class:{editor:!0,array:!e.isObject,object:e.isObject}},[t("div",{staticClass:"buttons"},[e.editable&&e.canAdd?t("button",{staticClass:"addBtn",attrs:{type:"button",disabled:e.count>=e.maxCount},on:{click:function(t){return e.add()}}},[t("i",{staticClass:"fas fa-plus"}),e._v(" Add")]):e._e(),t("FullscreenButton",{attrs:{element:()=>this.$el}})],1),e.elements.length?t("draggable",{attrs:{handle:".mover"},model:{value:e.elements,callback:function(t){e.elements=t},expression:"elements"}},e._l(e.elements,(function(a,s){return t("div",{key:a.id,staticClass:"fieldValue element"},[t("div",{staticClass:"row"},[t("label",{staticClass:"fieldLabel"},[e.isObject&&(a.prop.title||a.prop.required)?[e._v(e._s(a.prop.title||a.key))]:e.isObject?t("input",{directives:[{name:"model",rawName:"v-model",value:a.key,expression:"e.key"}],attrs:{type:"text",disabled:!e.editable},domProps:{value:a.key},on:{input:function(t){t.target.composing||e.$set(a,"key",t.target.value)}}}):[e._v(e._s(s+1))]],2),t("ParameterDataTypes",{attrs:{editable:e.editable,parameter:e.elementSchema(s,a.key),isItem:!0,parent:e.parent,context:e.context},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"e.value"}}),e.editable&&!a.prop.required?t("button",{staticClass:"deleteBtn",attrs:{disabled:e.count<=e.minCount,type:"button"},on:{click:function(t){return e.remove(s)}}},[t("i",{staticClass:"fas fa-trash"})]):e._e(),t("button",{directives:[{name:"show",rawName:"v-show",value:e.editable&&!e.isObject,expression:"editable && !isObject"}],staticClass:"mover",attrs:{type:"button"}},[t("i",{staticClass:"fas fa-arrows-alt"})])],1),a.prop.description?t("div",{staticClass:"row"},[t("div",{staticClass:"description"},[t("i",{staticClass:"fas fa-info-circle"}),t("Description",{attrs:{description:a.prop.description,compact:!0}})],1)]):e._e()])})),0):t("div",{staticClass:"empty description"},[t("i",{staticClass:"fas fa-info-circle"}),e.isObject?[e._v(" Object is empty")]:[e._v(" Array is empty")]],2)],1)},x=[],w=(a(81454),a(432)),T=a.n(w),j=a(27261),A=a(82574);const _={name:"ObjectEditorDnD",components:{draggable:T(),Description:j["default"],FullscreenButton:A.A,ParameterDataTypes:()=>Promise.resolve().then(a.bind(a,77264))},props:{parameter:Object,editable:{type:Boolean,default:!0},schema:Object,value:{},isObject:{type:Boolean,default:!1},parent:Object,context:{}},data(){return{elements:[]}},computed:{count(){return r.A.size(this.elements)},maxCount(){return(this.isObject?this.schema.schema.maxProperties:this.schema.schema.maxItems)||Number.MAX_VALUE},minCount(){return(this.isObject?this.schema.schema.minProperties:this.schema.schema.minItems)||0},canAdd(){return!this.isObject||!1!==this.schema.schema.additionalProperties},prefill(){let e=this.schema.schema;if(this.isObject&&r.A.isObject(e.properties)){let t=[];for(let a in e.properties){const s=e.properties[a];if(s.not)continue;let i=!1;Array.isArray(e.required)&&e.required.includes(a)&&(i=!0),t.push(Object.assign({name:a,required:i},s))}return t}return!this.isObject&&this.minCount>0?[...Array(this.minCount).keys()].map((e=>({name:e}))):[]},newValue(){if(this.isObject){let e={};for(let t of this.elements)e[t.key]=t.value;return e}return this.elements.map((e=>e.value))}},watch:{newValue:{deep:!0,handler(e){this.$emit("input",e)}},value:{immediate:!0,handler(e){if(this.newValue!==e)if(this.elements=[],0===r.A.size(e)&&this.prefill.length>0)for(let t of this.prefill)this.add(t.name,void 0,t);else if(e&&"object"===typeof e)for(let t in e)this.add(t,e[t])}}},methods:{elementSchema(e,t=null){let a=d.ProcessUtils.getElementJsonSchema(this.schema.schema,t||e),s=new d.ProcessSchema(a);return this.schema.parent instanceof d.ProcessSchema&&(s.refs=this.schema.parent.refs||[]),s},add(e=null,t=void 0,a={}){let s={id:String(this.elements.length),value:t};this.isObject&&(s.key=e||"unnamed"+this.elements.length),s.prop=a,"undefined"===typeof s.value&&("undefined"!==typeof a.default?s.value=a.default:s.value=this.elementSchema(this.elements.length,s.key).default),this.elements.push(s)},remove(e){this.elements.splice(e,1)}}},S=_;var C=a(81656),O=(0,C.A)(S,v,x,!1,null,"4e9c9c72",null);const P=O.exports;var E=a(57497);const D={name:"ObjectEditor",components:{ObjectEditorDnD:P,Tab:g["default"],Tabs:b["default"],TextEditor:E.A},data(){return{data:this.value,visual:!0,isTopLevel:!0}},props:{parameter:Object,editable:{type:Boolean,default:!0},schema:Object,value:{},isObject:{type:Boolean,default:!1},parent:Object,context:{}},watch:{value(e){this.data=e},data(e){this.$emit("input",e)}},mounted(){let e=this.$parent;while(e){if("ObjectEditor"===e.$options.name){this.isTopLevel=!1;break}e=e.$parent}},methods:{showVisual(){this.visual=!0},showCode(){this.visual=!1,this.$refs.sourceEditor.updateState()},updateFromCode(e){this.visual||(this.data=e)},updateFromVisual(e){this.visual&&(this.data=e)},allowDrop(e){this.editable&&this.isTopLevel&&e.preventDefault()},onDrop(e){let t=e.dataTransfer.files;if(1===t.length){let t=e.dataTransfer.files[0],s=["text/json","application/json","application/geo+json","text/plain"],i=t.name.toLowerCase(),n=s.includes(t.type)||i.endsWith(".geojson")||i.endsWith(".json");if(n){var a=new FileReader;a.onload=async e=>{let t;try{t=JSON.parse(e.target.result)}catch(a){return console.error(a),r.A.error(this,"The provided file is not a valid JSON file")}this.isObject&&r.A.isObject(t)||!this.isObject&&Array.isArray(t)?this.data=t:r.A.error(this,"The provided file doesn't seem to be a JSON file that contains an object")},a.onerror=e=>r.A.exception(this,e,"Reading the file failed"),a.readAsText(t,"UTF-8")}}else r.A.error(this,"Please provide a single JSON file");return e.preventDefault()}}},V=D;var k=(0,C.A)(V,f,y,!1,null,"909fe7a6",null);const F=k.exports;var B=function(){var e=this,t=e._self._c;return t("div",{staticClass:"datatypeEditor budget"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.hasBudget,expression:"hasBudget"}],attrs:{type:"checkbox",disabled:!e.editable},domProps:{checked:Array.isArray(e.hasBudget)?e._i(e.hasBudget,null)>-1:e.hasBudget},on:{change:function(t){var a=e.hasBudget,s=t.target,i=!!s.checked;if(Array.isArray(a)){var r=null,n=e._i(a,r);s.checked?n<0&&(e.hasBudget=a.concat([r])):n>-1&&(e.hasBudget=a.slice(0,n).concat(a.slice(n+1)))}else e.hasBudget=i}}}),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.amount,expression:"amount",modifiers:{number:!0}}],attrs:{type:"number",min:"0.00",max:e.max,step:"0.01",disabled:!e.hasBudget||!e.editable},domProps:{value:e.amount},on:{input:function(t){t.target.composing||(e.amount=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),e._v(" "+e._s(e.capabilities.currency())+" ")])},N=[];const J={name:"Budget",computed:{...r.A.mapState(["userInfo"]),...r.A.mapGetters(["capabilities"]),max(){return this.userInfo.budget>0?this.userInfo.budget:Number.MAX_VALUE}},props:{value:{type:Number,default:null},editable:{type:Boolean,default:!0}},data(){return{hasBudget:"number"===typeof this.value,amount:this.value}},watch:{hasBudget(){this.updateData()},amount(){this.updateData()}},methods:{updateData(){this.$emit("input",this.hasBudget&&!Number.isNaN(this.amount)?this.amount:null)}}},I=J;var $=(0,C.A)(I,B,N,!1,null,null,null);const R=$.exports;var M=a(15486),G=function(){var e=this,t=e._self._c;return t("div",{staticClass:"geojson-editor",on:{drop:e.onDrop,dragover:e.allowDrop}},[t("Tabs",{ref:"tabs",attrs:{id:"geojson-tabs",position:"bottom"}},[t("Tab",{attrs:{id:"map",name:"Map",icon:"fa-map",selected:!0},on:{show:e.showMap}},[t("GeoJsonMapEditor",{ref:"map",attrs:{editable:e.editable},model:{value:e.data,callback:function(t){e.data=t},expression:"data"}})],1),t("Tab",{attrs:{id:"source",name:"Code",icon:"fa-code"},on:{show:e.showCode}},[t("TextEditor",{ref:"sourceEditor",attrs:{editable:e.editable,id:"geojson-texteditor",language:"json"},model:{value:e.data,callback:function(t){e.data=t},expression:"data"}})],1)],1),e.editable?t("small",{staticClass:"info"},[e._v(" To easily import your area of interest, you can drag & drop GeoJSON and KML files into this area. ")]):e._e()],1)},U=[],L=function(){var e=this,t=e._self._c;return t("div",{staticClass:"geojson-map-editor",attrs:{id:e.id}},[t("ProgressControl",{ref:"progress",attrs:{map:e.map}}),t("UserLocationControl",{attrs:{map:e.map}})],1)},q=[],W=a(95104),K=a(66451),z=a(31660),Y=a(41312),X=a(78983),H=a(70915),Q=a(43070),Z=a(7683),ee=a(26186),te=a(47921);const ae={name:"GeoJsonMapEditor",mixins:[z.A,W.A,K.A],props:{value:{type:Object,default:null}},data(){return{geoJsonLayer:null}},methods:{async renderMap(){let e=!0;if(this.value){let t=this.createGeoJsonSource(this.value),a=t.getExtent();(0,H.Im)(a)||(e=!1!==r.A.isBboxInWebMercator(r.A.extentToBBox(a)))}if(await this.createMap(e?"EPSG:3857":"EPSG:4326"),this.addBasemaps(),this.editable?this.geoJsonLayer=this.geoJsonEditor(e?this.value:source):this.geoJsonLayer=this.addGeoJson(e?this.value:source),this.editable){var t=()=>this.$emit("input",this.getGeoJson());this.geoJsonLayer.getSource().on("change",t),this.addGeocoder((e=>{if(!e)return;let t=(new Y.A).readFeature(e,{featureProjection:this.map.getView().getProjection()});this.geoJsonLayer.getSource().addFeature(t),this.map.getView().fit(this.geoJsonLayer.getSource().getExtent(),this.getFitOptions())}),!0)}},geoJsonEditor(e){var t=this.addGeoJson(e),a=new Q.A;this.map.addControl(a);var s=new ee.A({source:t.getSource(),interactions:{Info:!1,DrawHole:!1,Offset:!1,Split:!1}});a.addControl(s);var i=new te.A;this.map.addInteraction(i),i.on("undo",(e=>{"addfeature"===e.action.type&&(s.getInteraction("Select").getFeatures().clear(),s.getInteraction("Transform").select())}));var r=new Q.A({group:!0,controls:[new Z.A({html:'<i class="fas fa-undo-alt"></i>',title:"Undo",handleClick:()=>i.undo()}),new Z.A({html:'<i class="fas fa-redo-alt"></i>',title:"Redo",handleClick:()=>i.redo()})]});return a.addControl(r),this.map.addInteraction(new X.A({source:t.getSource()})),t},getGeoJson(){var e=new Y.A,t=this.geoJsonLayer.getSource().getFeatures(),a=[];for(var s in t)a.push(e.writeFeatureObject(t[s],{dataProjection:"EPSG:4326",featureProjection:this.map.getView().getProjection()}));return 0===a.length?null:1===a.length?!a[0].properties&&a[0].geometry?a[0].geometry:a[0]:{type:"FeatureCollection",features:a}}}},se=ae;var ie=(0,C.A)(se,L,q,!1,null,null,null);const re=ie.exports;var ne=a(20992);const oe={name:"GeoJsonEditor",components:{GeoJsonMapEditor:re,Tab:g["default"],Tabs:b["default"],TextEditor:E.A},data(){return{data:this.value}},props:{editable:{type:Boolean,default:!0},value:{type:Object,default:null}},watch:{value(e){this.data=e},data(e){this.$emit("input",e)}},methods:{showMap(){this.$refs.map.renderMap()},showCode(){this.$refs.sourceEditor.updateState()},allowDrop(e){this.editable&&e.preventDefault()},onDrop(e){let t=e.dataTransfer.files;if(1===t.length){let t=e.dataTransfer.files[0],s=["text/json","application/json","application/geo+json","text/plain"],i=["text/xml","application/xml","application/vnd.google-earth.kml+xml"],n=t.name.toLowerCase(),o=s.includes(t.type)||n.endsWith(".geojson")||n.endsWith(".json"),l=i.includes(t.type)||n.endsWith(".kml")||n.endsWith(".xml");if(o||l){var a=new FileReader;a.onload=async e=>{let t;if(l)try{t=(0,ne.bW)((new DOMParser).parseFromString(e.target.result,"text/xml"))}catch(a){return console.error(a),r.A.error(this,"The provided file is not a valid KML file")}else try{t=JSON.parse(e.target.result)}catch(a){return console.error(a),r.A.error(this,"The provided file is not a valid JSON file")}r.A.detectGeoJson(t)?(this.data=t,this.$refs.map&&this.$refs.map.renderMap()):r.A.error(this,"The provided file doesn't seem to be a GeoJSON file")},a.onerror=e=>r.A.exception(this,e,"Reading the file failed"),a.readAsText(t,"UTF-8")}}else r.A.error(this,"Please provide a single JSON or GeoJSON file");return e.preventDefault()}}},le=oe;var de=(0,C.A)(le,G,U,!1,null,"6d150dd6",null);const ce=de.exports;var ue=a(60478);const pe={name:"ParameterDataType",mixins:[h.A],components:{ObjectEditor:F,Budget:R,MapAreaSelect:M.A,GeoJsonEditor:ce,TextEditor:E.A,Editor:()=>Promise.all([a.e(4638),a.e(7828)]).then(a.bind(a,98087)),FileFormatOptionsEditor:()=>a.e(4016).then(a.bind(a,54016)),ParameterDataTypes:()=>Promise.resolve().then(a.bind(a,77264)),Duration:()=>a.e(3165).then(a.bind(a,63165)),Kernel:()=>a.e(1203).then(a.bind(a,1203)),SelectBox:()=>Promise.all([a.e(5262),a.e(5213)]).then(a.bind(a,5213)),TemporalPicker:()=>Promise.all([a.e(7349),a.e(4741)]).then(a.bind(a,27349))},props:{parameter:Object,editable:{type:Boolean,default:!0},schema:Object,value:{},context:{},parent:{}},data(){return{state:this.value}},computed:{type(){return this.schema.dataType()},nativeType(){return this.schema.nativeDataType()},nativeParameterType(){return this.parameter.nativeDataType()},editorDefaultValue(){if("process-graph"===this.type){if("undefined"!==typeof this.parameter.default)return this.parameter.default;if(this.parameter.nullable())return null}},isTemporal(){return"date"===this.type||"time"===this.type||"date-time"===this.type||"temporal-interval"===this.type||"year"===this.type},isSelection(){switch(this.type){case"collection-id":case"job-id":case"file-path":case"file-paths":case"epsg-code":case"input-format":case"openeo-datatype":case"output-format":case"service-type":case"billing-plan":case"udf-runtime":case"udf-runtime-version":return!0;case"band-name":return!!this.dependency;default:return this.schema.isEnum()}},name(){return this.parameter.name+(Array.isArray(this.parameter.value)?"[]":"")},isResult(){return Boolean(r.A.isObject(this.state)&&this.state.from_node&&1===r.A.size(this.state)&&this.schema.schema.isRef)},isPgParameter(){return Boolean(r.A.isObject(this.state)&&this.state.from_parameter&&1===r.A.size(this.state)&&this.schema.schema.isRef)},numericMin(){return"number"===typeof this.schema.minimum?this.schema.minimum:""},numericMax(){return"number"===typeof this.schema.maximum?this.schema.maximum:""},numericStep(){return"number"===typeof this.schema.multipleOf?this.schema.multipleOf:"integer"===this.type?1:"any"},newValue(){if("number"===this.type){var e=Number.parseFloat(this.state);return Number.isNaN(e)?null:e}if("integer"===this.type){e=Number.parseInt(this.state);return Number.isNaN(e)?null:e}if("null"===this.type)return null;if("string"===typeof this.state&&this.state.length>0&&("any"===this.type||"mixed"===this.type)){e=Number(this.state);return Number.isNaN(e)?this.state:e}return this.state},dependency(){switch(this.type){case"output-format-options":case"input-format-options":return this.getValueFromOtherParameterByDataType(this.type.replace("-options",""));case"udf-runtime-version":case"udf-code":return this.getValueFromOtherParameterByDataType("udf-runtime");case"band-name":return this.getValueFromOtherParameterByDataType("collection-id");case"array":if("band-name"===ue.A.arrayOf(this.schema))return this.getValueFromOtherParameterByDataType("collection-id");default:return}}},watch:{value(e){e!==this.newValue&&(this.state=this.value)},newValue(e){this.$emit("input",e)},dependency(e,t){"undefined"!==typeof t&&e!==t&&this.$emit("reset")}},methods:{getValueFromOtherParameterByDataType(e){if(r.A.isObject(this.context)&&r.A.isObject(this.context.schemas)&&r.A.isObject(this.context.values))for(let t in this.context.schemas){let a=this.context.schemas[t];if(r.A.isObject(a)&&a.dataType()===e)return this.context.values[t]}},convertToArray(){this.state=[this.state],this.$emit("input",this.state),this.$emit("changeType","array")},onSelectDetails(){"collection-id"===this.type&&this.broadcast("showCollection",this.state)}}},me=pe;var he=(0,C.A)(me,p,m,!1,null,"0b98f1e9",null);const fe=he.exports;var ye=a(63610);const be=["Basics","References","Spatial","Temporal","File and Folders","Resources","CRS","UDF","Other"],ge=e=>e&&"object"===typeof e?r.A.deepClone(e):e,ve=()=>(new Date).toISOString().replace(/\.\d+/,""),xe=[{subtype:"undefined",title:"No Value",const:void 0,not:{},group:"Basics"},{type:"null",const:null,group:"Basics"},{type:"string",default:"",group:"Basics"},{type:"integer",default:0,group:"Basics"},{type:"number",default:0,group:"Basics"},{type:"boolean",default:!1,group:"Basics"},{type:"array",default:[],group:"Basics"},{type:"object",default:{},group:"Basics",properties:{from_node:{not:{}},from_parameter:{not:{}}},default:{}},{type:"string",subtype:"date-time",format:"date-time",title:"Date and Time",group:"Temporal",default:()=>ve()},{type:"string",subtype:"date",format:"date",title:"Date only",group:"Temporal",default:()=>ve().substring(0,10)},{type:"string",subtype:"time",format:"time",title:"Time only",group:"Temporal",default:()=>ve().substring(11)},{type:"string",subtype:"year",title:"Year only",group:"Temporal"},{type:"array",subtype:"temporal-interval",title:"Temporal interval",group:"Temporal"},{type:"array",subtype:"temporal-intervals",title:"Temporal intervals (multiple)",group:"Temporal",default:[]},{type:"object",subtype:"geojson",title:"GeoJSON",group:"Spatial"},{type:"object",subtype:"bounding-box",title:"Bounding Box",group:"Spatial"},{type:"string",subtype:"band-name",title:"Band",group:"Resources"},{type:"string",subtype:"collection-id",title:"Collection",group:"Resources"},{type:"string",subtype:"job-id",title:"Batch Job",group:"Resources"},{type:"string",subtype:"udf-code",title:"UDF Source Code",group:"UDF",default:""},{type:"string",subtype:"udf-runtime",title:"UDF Runtime",group:"UDF"},{type:"string",subtype:"udf-runtime-version",title:"UDF Runtime Version",group:"UDF",any:!1},{type:"integer",subtype:"epsg-code",title:"EPSG Code (CRS)",group:"CRS"},{type:"string",subtype:"proj-definition",title:"PROJ defintiion (CRS)",group:"CRS",default:""},{type:"string",subtype:"wkt2-definition",title:"WKT2 defintiion (CRS)",group:"CRS",default:""},{type:"array",subtype:"file-path",title:"File path",group:"File and Folders"},{type:"array",subtype:"file-paths",title:"File paths (multiple)",group:"File and Folders",default:[]},{type:"string",subtype:"uri",format:"uri",title:"URI / URL",group:"File and Folders"},{type:"string",subtype:"output-format",title:"Export file format",group:"File and Folders"},{type:"object",subtype:"output-format-options",title:"Export file format parameters",group:"File and Folders",any:!1},{type:"string",subtype:"input-format",title:"Import file format",group:"File and Folders"},{type:"object",subtype:"input-format-options",title:"Import file format parameters",group:"File and Folders",any:!1},{type:"object",subtype:"process-graph",title:"Custom Process"},{tyoe:"object",subtype:"json-schema",title:"Data Type (JSON Schema)",any:!1},{subtype:"json",title:"JSON",noAutoDetect:!0}],we={type:"object",additionalProperties:!1,properties:{from_node:{type:"string"},from_parameter:{type:"string"}}},Te={name:"ParameterDataTypes",mixins:[h.A],components:{Description:j["default"],ParameterDataType:fe},props:{parameter:{type:Object,default:()=>new d.ProcessParameter({})},editable:{type:Boolean,default:!0},value:{},isItem:{type:Boolean,default:!1},context:{},parent:{}},data(){return{state:void 0,selectedType:null,selectedNativeType:null,selectedSchema:null,jsonSchemaValidator:u.create(this.$store)}},filters:{dataTypeTitle(e){if(e.schema&&!e.schema.title){let t=xe.find((t=>t.subtype===e.schema.subtype||t.type===e.schema.type));if(t&&t.title)return t.title}return e.title()}},async created(){await this.detectType()},computed:{refSchemas(){if(!Array.isArray(this.parameter.refs))return{};let e={};for(let t of this.parameter.refs){let a;t.from_node?(a="from_node:"+t.from_node,e[a]=new d.ProcessDataType({type:"object",group:"References",subtype:a,isRef:"from_node",from_node:t.from_node,title:"Output of #"+t.from_node,required:["from_node"],properties:{from_node:{type:"string",const:t.from_node}},default:t,additionalProperties:!1})):t.from_parameter&&(a="from_parameter:"+t.from_parameter,e[a]=new d.ProcessDataType({type:"object",group:"References",subtype:a,isRef:"from_parameter",from_parameter:t.from_parameter,title:'Value of process parameter "'+t.from_parameter+'"',required:["from_parameter"],properties:{from_parameter:{type:"string",const:t.from_parameter}},default:t,additionalProperties:!1}))}return e},showDataTypeChooser(){return r.A.size(this.allowedTypes)>1},allowedTypes(){let e={};if("any"===this.parameter.dataType())Object.assign(e,this.supportedTypes);else for(let t of this.parameter.schemas){const a=this.getUniqueKey(e,t.dataType());e[a]=t}return Object.assign(e,this.refSchemas),e},supportedTypes(){let e={};for(let t of xe){if(!1===t.any)continue;const a=t.subtype||t.type,s=Object.assign({},ye.API_TYPES[a],t);e[a]=new d.ProcessDataType(s,this.parameter)}return e},selectableTypes(){let e={};for(let a in this.allowedTypes){let t=this.allowedTypes[a],s=t.group();r.A.isObject(e[s])||(e[s]={}),e[s][a]=t}let t=be.map((t=>({name:t,types:e[t]||[]}))).filter((e=>0!==e.types.length));return t},detectableTypes(){const e={};for(let t in this.allowedTypes){let a=this.allowedTypes[t];a.schema.noAutoDetect||(e[t]=a)}return e}},watch:{value:{immediate:!0,handler(e){"undefined"!==typeof this.state&&e===this.state||("undefined"!==typeof e||this.allowedTypes.undefined?this.state=e:this.state=ge(this.parameter.default))}},state:{deep:!0,handler(e){this.$emit("input",e)}},selectedType(e){this.$emit("schemaSelected",this.supportedTypes[e])}},methods:{getUniqueKey(e,t){let a=t,s=2;while(e[a])a=t+String(s),s++;return a},async isValueInvalid(e,t){let a=r.A.deepClone(t);"array"===a.type&&r.A.isObject(a.items)&&(a.items={oneOf:[a.items,we]});let s=await this.jsonSchemaValidator.validateValue(e,a);return s.length>0},async getTypeForValue(e,t){const a=[];for(let i in e){let r=e[i];try{if(await this.isValueInvalid(t,r.schema))continue;a.push(i)}catch(s){}}return a},async detectType(){let e=Object.keys(this.allowedTypes),t="undefined"===typeof this.state;if(0===e.length)await this.setSelected("json");else if(1===e.length)await this.setSelected(e[0],t);else if(t)if(this.allowedTypes.undefined)await this.setSelected(this.allowedTypes.undefined,!1);else{let t=e.filter((e=>"null"!==e));await this.setSelected(t[0],!0)}else{let e=await this.getTypeForValue(this.detectableTypes,this.state);if(0===e.length)await this.setSelected("json");else if(1===e.length)await this.setSelected(e[0]);else{e.includes("integer")&&e.includes("number")&&(e=e.filter((e=>"integer"!==e))),!r.A.isRef(this.state)&&e.length>1&&console.warn("A parameter is ambiguous. Potential types: "+e.join(", ")+". Value: "+JSON.stringify(this.state));let t=e.findIndex((e=>ye.NATIVE_TYPES.includes(e)));-1===t&&(t=0),await this.setSelected(e[t])}}},async onSelectType(e){await this.setSelected(e.target.value,!0)},resetValue(){this.state=ge(this.parameter.default),this.detectType()},async setSelected(e,t=!1){let a=e;if(e instanceof d.ProcessDataType?(this.selectedSchema=e,this.selectedType=e.dataType(),a=e.nativeDataType()):(this.selectedSchema=this.allowedTypes[e]?this.allowedTypes[e]:this.supportedTypes[e],this.selectedType=e),t){if("number"===typeof this.state&&"string"===a)this.state=String(this.state);else if("string"===typeof this.state&&"integer"===a){if(this.state.match(/^([+-]?\d+)$/)){let e=Number.parseInt(this.state,10);Number.isNaN(e)||(this.state=e)}}else if("string"===typeof this.state&&"number"===a){let e=Number.parseFloat(this.state);Number.isNaN(e)||(this.state=e)}if(this.selectedSchema.isNull())this.state=null;else if("undefined"!==typeof this.selectedSchema.const)this.state=this.selectedSchema.const;else if(this.selectedSchema.isEnum()&&1===this.selectedSchema.getEnumChoices().length)this.state=this.selectedSchema.getEnumChoices()[0];else{let e=ge(this.selectedSchema.default());try{("undefined"===typeof this.state||await this.isValueInvalid(this.state,this.selectedSchema))&&(this.state=e)}catch(s){this.state=e}}}}}},je=Te;var Ae=(0,C.A)(je,s,i,!1,null,null,null);const _e=Ae.exports},10510:(e,t,a)=>{a.d(t,{A:()=>p});var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"parameters"},e._l(e.parameters,(function(a,s){return t("div",{directives:[{name:"show",rawName:"v-show",value:e.toggleParamVisibility(a),expression:"toggleParamVisibility(param)"}],key:s,staticClass:"fieldRow"},[t("label",{class:{fieldLabel:!0,highlight:a.name===e.selectParameter,info:a.info}},[e._v(" "+e._s(e.displayLabel(a))+" "),a.info||a.optional?e._e():t("strong",{staticClass:"required",attrs:{title:"required"}},[e._v("*")]),a.description?t("div",{staticClass:"description"},[t("Description",{attrs:{description:a.description}})],1):e._e()]),a.info?e._e():t("ParameterDataTypes",{ref:a.name,refInFor:!0,attrs:{editable:e.editable,parameter:a,context:e.context,parent:e.parent},on:{schemaSelected:function(t){return e.updateType(a,t)}},model:{value:e.value[a.name],callback:function(t){e.$set(e.value,a.name,t)},expression:"value[param.name]"}}),!a.info&&a.unspecified?t("button",{staticClass:"deleteBtn",attrs:{title:"Delete unspecified parameter",type:"button"},on:{click:function(t){return e.deleteParam(s)}}},[t("i",{staticClass:"fas fa-trash"})]):e._e()],1)})),0)},i=[],r=a(2566),n=a(27261),o=a(77264);const l={name:"Parameters",components:{Description:n["default"],ParameterDataTypes:o["default"]},props:{parameters:{type:Array,required:!0},value:{type:Object,required:!0},editable:{type:Boolean,default:!0},selectParameter:{type:String,default:null},parent:{type:Object,default:null}},data(){return{show:!0,schemas:{}}},computed:{context(){return{values:this.value,schemas:this.schemas,parameters:this.parameters}}},watch:{value:{deep:!0,handler(){this.$emit("input",this.value)}}},mounted(){this.$nextTick((()=>this.setSelected()))},methods:{toggleParamVisibility(e){return!e||!e.toggledBy||!!this.value[e.toggledBy]},deleteParam(e){let t=this.parameters[e].name;this.$delete(this.parameters,e),this.$delete(this.schemas,t),this.$delete(this.value,t)},updateType(e,t){this.$set(this.schemas,e.name,t)},displayLabel(e){return"string"===typeof e.label&&e.label.length>0?e.label:r.A.prettifyString(e.name)},componentforParameter(e){return e&&Array.isArray(this.$refs[e])&&this.$refs[e][0]?this.$refs[e][0]:null},setSelected(e=0){let t;this.selectParameter?t=this.componentforParameter(this.selectParameter):this.parameters.length>0&&(t=this.componentforParameter(this.parameters[0].name)),t&&(t.$el&&t.$el.scrollIntoView?(this.selectParameter&&t.$el.scrollIntoView(),this.setInputFocus(t.$el)):e<10&&setTimeout((()=>this.setSelected(++e)),250))},setInputFocus(e,t=0){if(e.querySelector){let t=e.querySelector('input:not([type="hidden"]):not([disabled]):not([class~="multiselect__input"]), button:not([disabled]), textarea:not([disabled]), select:not([disabled]), datalist:not([disabled])');t&&t.focus()}else t<10&&setTimeout((()=>this.setInputFocus(e,++t)),250)}}},d=l;var c=a(81656),u=(0,c.A)(d,s,i,!1,null,"e173c10e",null);const p=u.exports},31660:(e,t,a)=>{a.d(t,{A:()=>p});a(81454);var s=a(66684),i=a.n(s);a(98992),a(54520);class r{constructor(e,t=!1){this.url=e,this.geojson=t}getParameters(e){return{url:this.url,params:{q:e.query,format:"json",limit:10,"accept-language":"en",polygon_geojson:this.geojson?1:0,polygon_threshold:.001}}}handleResponse(e){return 0===e.length?[]:e.filter((e=>["boundary","geological","leisure","natural","place","water","waterway"].includes(e.class))).map((e=>({lon:e.lon,lat:e.lat,bbox:e.boundingbox,address:{name:e.display_name},original:{formatted:e.display_name,details:e.address,geojson:e.geojson}})))}}const n={methods:{addGeocoder(e,t=!1){if(!this.$config.geocoder)return;const a={provider:new r(this.$config.geocoder,t),placeholder:"Search for ...",keepOpen:!0,preventDefault:!0},s=new(i())("nominatim",a);s.on("addresschosen",(a=>{if(t)e(a.place?.original?.geojson,a);else if(a.place.bbox){let t=a.place.bbox.map((e=>parseFloat(e))),s={west:t[2],east:t[3],north:t[1],south:t[0]};e(s,a)}else e(null,a)})),this.map.addControl(s)}}},o=n;var l,d,c=a(81656),u=(0,c.A)(o,l,d,!1,null,null,null);const p=u.exports},15486:(e,t,a)=>{a.d(t,{A:()=>x});a(81454);var s=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:e.id}},[t("ProgressControl",{ref:"progress",attrs:{map:e.map}}),t("UserLocationControl",{attrs:{map:e.map}}),t("TextControl",{attrs:{text:e.help,map:e.map}})],1)},i=[],r=a(66451),n=a(31660),o=a(95104),l=a(2566),d=a(73926),c=a(89718),u=a(70915),p=a(29276),m=a(55193),h=a(953),f=a(13628);const y={name:"MapAreaSelect",mixins:[r.A,n.A,o.A],components:{TextControl:m.A},props:{value:{type:[Object,Array],default:()=>null},showMaxExtent:{type:[Object,Array],default:()=>null}},data(){return{interaction:null,extent:this.toExtent(this.value)}},computed:{returnAsObject(){return!Array.isArray(this.value)},projectedExtent(){return this.extent?(0,c.transformExtent)(this.extent,"EPSG:4326",this.map.getView().getProjection()):null},outerArea(){if(!this.showMaxExtent)return null;let{west:e,east:t,north:a,south:s}=this.showMaxExtent;return{type:"Polygon",coordinates:[[[-180,90],[-180,-90],[180,-90],[180,90],[-180,90]],[[e,a],[e,s],[t,s],[t,a],[e,a]]]}},bbox(){return l.A.extentToBBox(this.extent)},help(){return this.extent?"Click inside the bounding box to remove it.":"Click on the map to add a bounding box."}},methods:{update(e){e.extent?this.extent=(0,c.transformExtent)(e.extent,this.map.getView().getProjection(),"EPSG:4326"):this.extent=null,this.$emit("input",this.returnAsObject?this.bbox:this.extent)},async renderMap(){let e=!1!==l.A.isBboxInWebMercator(this.bbox);if(await this.createMap(e?"EPSG:3857":"EPSG:4326"),this.addBasemaps(),this.addGeocoder((e=>{if(!e)return;let t=this.toExtent(e);t=(0,c.transformExtent)(t,"EPSG:4326",this.map.getView().getProjection()),this.interaction.setExtent(t),this.fitMap()})),this.showMaxExtent){const e=new p["default"]({fill:new f.A({color:"#00000099"}),stroke:new h.A({width:0,color:"#00000000"})});this.addGeoJson(this.outerArea,!1,"unsupported area",e);let t=this.toExtent(this.showMaxExtent);t=(0,c.transformExtent)(t,"EPSG:4326",this.map.getView().getProjection()),this.map.getView().fit(t,this.getFitOptions(1))}let t=e=>{if(!this.editable)return!1;if("singleclick"===e.type){if(!this.extent){let t=this.map.getSize().map((e=>.2*e)),a=this.map.getView().calculateExtent(t),s=[a[2]-a[0],a[3]-a[1]],i=[e.coordinate[0]-s[0],e.coordinate[1]-s[1],e.coordinate[0]+s[0],e.coordinate[1]+s[1]];return this.interaction.setExtent(i),!1}(0,u.Rj)(this.projectedExtent,...e.coordinate)&&(this.interaction.setExtent(null),this.interaction.vertexOverlay_.getSource().clear(),this.interaction.vertexFeature_=null)}else if(this.interaction.handlingDownUpSequence||this.interaction.snapToVertex_(e.pixel,e.map))return!0;return!1};this.interaction=new d.A({extent:this.projectedExtent,condition:t,boxStyle:(0,p.createDefaultStyle)(),pixelTolerance:15}),this.editable&&this.interaction.on("extentchanged",this.update),this.map.addInteraction(this.interaction),this.fitMap()},fitMap(){if(this.projectedExtent){var e=this.getFitOptions(this.editable?10:33);this.map.getView().fit(this.projectedExtent,e)}}}},b=y;var g=a(81656),v=(0,g.A)(b,s,i,!1,null,null,null);const x=v.exports},55193:(e,t,a)=>{a.d(t,{A:()=>c});var s=function(){var e=this,t=e._self._c;return e.texts.length>0?t("div",{staticClass:"ol-unselectable ol-control value",class:{pointer:e.texts.length>1},on:{click:e.toggle}},[e._v(e._s(e.current))]):e._e()},i=[],r=a(23634);const n={name:"TextControl",mixins:[r.A],data(){return{i:0}},computed:{texts(){return Array.isArray(this.text)?this.text:"string"===typeof this.text&&this.text.length>0?[this.text]:[]},current(){return 0===this.texts.length?"":this.texts[this.i%this.text.length]}},props:{text:{text:[String,Array],default:""}},methods:{toggle(){this.i++}}},o=n;var l=a(81656),d=(0,l.A)(o,s,i,!1,null,"52fec35a",null);const c=d.exports},63610:(e,t,a)=>{a.r(t),a.d(t,{API_TYPES:()=>i,NATIVE_TYPES:()=>r});var s=a(2566);const i=s.A.resolveJsonRefs(a(96318)).definitions,r=["string","integer","number","boolean","array","object"]}}]);
//# sourceMappingURL=510.7291bdf7.js.map