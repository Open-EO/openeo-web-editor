"use strict";(globalThis["webpackChunk_openeo_web_editor"]=globalThis["webpackChunk_openeo_web_editor"]||[]).push([[1959],{69636:(t,e,r)=>{r.d(e,{Z:()=>g});var n=r(24832),i=r(58661),o=r(81090),a=r(2033),s=r(92371),l=r(22556);const c={mixins:[n.Z],methods:{async addExtent(t,e=!0){let r=null;r=i.Z.isObject(t)?"Collection"===t.type?t.extent.spatial.bbox.map((t=>i.Z.extentToBBox(t))):"Feature"!==t.type||t.geometry||t.bbox?t:null:t,Array.isArray(r)&&r.length>0?this.addRectangles(r,e):r&&this.addGeoJson(r,!1,"Footprint",e)},addRectangles(t,e=!0){let r=this.map.getView().getProjection(),n=t.map((t=>{let e=(0,a.oJ)([t.west,t.south,t.east,t.north]).transform("EPSG:4326",r);return new o.Z(e)})),i=new l.Z({features:n,projection:r,wrapX:!1}),c=new s.Z({title:"Bounding Boxes",displayInLayerSwitcher:!1,source:i});return e||this.removeLayerFill(c),this.map.addLayer(c),this.map.getView().fit(i.getExtent(),this.getFitOptions()),c},removeLayerFill(t){let e=t.getStyle();"function"===typeof e&&(e=e()[0]),e.setFill(null)}}},u=c;var h,f,d=r(1001),p=(0,d.Z)(u,h,f,!1,null,null,null);const g=p.exports},45281:(t,e,r)=>{r.d(e,{Z:()=>u});var n=function(){var t=this,e=t._self._c;return t.texts.length>0?e("div",{staticClass:"ol-unselectable ol-control value",class:{pointer:t.texts.length>1},on:{click:t.toggle}},[t._v(" "+t._s(t.current)+" ")]):t._e()},i=[],o=r(89518);const a={name:"TextControl",mixins:[o.Z],data(){return{i:0}},computed:{texts(){return Array.isArray(this.text)?this.text:"string"===typeof this.text&&this.text.length>0?[this.text]:[]},current(){return 0===this.texts.length?"":this.texts[this.i%this.text.length]}},props:{text:{text:[String,Array],default:""}},methods:{toggle(){this.i++}}},s=a;var l=r(1001),c=(0,l.Z)(s,n,i,!1,null,"fe2bcd86",null);const u=c.exports},84342:(t,e,r)=>{r.r(e),r.d(e,{default:()=>Xn});var n=function(){var t=this,e=t._self._c;return e("Splitpanes",{staticClass:"default-theme",attrs:{horizontal:""}},[e("Pane",{attrs:{id:"map"}},[e("div",{staticClass:"map-viewer",attrs:{id:t.id}},[e("ProgressControl",{ref:"progress",attrs:{map:t.map}}),t.isGeoTiff?e("TextControl",{attrs:{text:t.textControlText}}):t._e(),t.isGeoTiff&&!t.colorMap?e("ChannelControl",{attrs:{bands:t.bands},on:{update:t.updateGeoTiffStyle}}):t._e(),t.loading?e("div",{staticClass:"map-loading"},[e("i",{staticClass:"fas fa-spinner fa-spin"}),e("span",[t._v("Loading map...")])]):t._e()],1)]),t.chart?e("Pane",{attrs:{id:"chart",size:33}},[e("ScatterChart",t._b({attrs:{height:220}},"ScatterChart",t.chart,!1))],1):t._e()],1)},i=[],o=(r(26699),r(76943)),a=r(58661),s=r(5695),l=r(25171),c=r(66209),u=r(69636),h=r(45281),f=function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"show",rawName:"v-show",value:t.channels.length>0,expression:"channels.length > 0"}],staticClass:"ol-unselectable ol-control channels"},[e("table",[e("thead",[e("tr",[t.isGray?t._e():e("th",[t._v("Channel")]),t.multiBand?e("th",[t._v("Band")]):t._e(),e("th",[t._v("Min")]),e("th",[t._v("Max")])])]),e("tbody",t._l(t.channels,(function(r,n){return e("tr",{key:n},[t.isGray?t._e():e("th",[t._v(t._s(t.labels[n]))]),t.multiBand?e("td",[e("select",{directives:[{name:"model",rawName:"v-model.number",value:r.id,expression:"channel.id",modifiers:{number:!0}}],on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(e){var r="_value"in e?e._value:e.value;return t._n(r)}));t.$set(r,"id",e.target.multiple?n:n[0])}}},t._l(t.bands,(function(r){return e("option",{key:r.id,domProps:{value:r.id}},[t._v(t._s(r.name||r.id))])})),0)]):t._e(),e("td",[e("input",{directives:[{name:"model",rawName:"v-model.number",value:r.min,expression:"channel.min",modifiers:{number:!0}}],attrs:{type:"number",required:""},domProps:{value:r.min},on:{input:function(e){e.target.composing||t.$set(r,"min",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]),e("td",[e("input",{directives:[{name:"model",rawName:"v-model.number",value:r.max,expression:"channel.max",modifiers:{number:!0}}],attrs:{type:"number",required:""},domProps:{value:r.max},on:{input:function(e){e.target.composing||t.$set(r,"max",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})])])})),0),t.multiBand?e("tfoot",[e("tr",[e("td",{attrs:{colspan:t.cols}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.isGray,expression:"isGray"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.isGray)?t._i(t.isGray,null)>-1:t.isGray},on:{change:function(e){var r=t.isGray,n=e.target,i=!!n.checked;if(Array.isArray(r)){var o=null,a=t._i(r,o);n.checked?a<0&&(t.isGray=r.concat([o])):a>-1&&(t.isGray=r.slice(0,a).concat(r.slice(a+1)))}else t.isGray=i}}}),t._v(" Grayscale ")])])]):t._e()])])},d=[],p=r(89518);const g={name:"ChannelControl",mixins:[p.Z],props:{bands:{type:Array,default:()=>[]}},computed:{multiBand(){return this.bands.length>1},cols(){return this.isGray?this.multiBand?3:2:4},labels(){return this.isGray?["Grayscale"]:["Red","Green","Blue"]}},data(){return{channels:[],isGray:1===this.bands.length}},watch:{bands:{immediate:!0,handler(){1===this.bands.length&&(this.isGray=!0),this.updateChannels()}},isGray(){this.updateChannels(),this.emit()},channels:{deep:!0,handler(){this.emit()}}},methods:{isValid(t){return"number"===typeof t},updateChannels(){this.channels=this.bands.slice(0,this.isGray?1:3).map((t=>Object.assign({},t))),2===this.channels.length&&this.channels.push(Object.assign({},this.channels[1]))},emit(){this.channels.filter((t=>this.isValid(t.min)&&this.isValid(t.max))).length>0&&this.$emit("update","channels",this.channels)}}},m=g;var v=r(1001),_=(0,v.Z)(m,f,d,!1,null,null,null);const y=_.exports;var T=r(94272),E=r(71912),S=r(46131),w=r(2519),x=r(37195),R=r(94806),D=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),b=function(t){function e(e){var r=this,n=x.Z.IDLE;return r=t.call(this,e.tileCoord,n,{transition:e.transition,interpolate:e.interpolate})||this,r.loader_=e.loader,r.data_=null,r.error_=null,r.size_=e.size||[256,256],r}return D(e,t),e.prototype.getSize=function(){return this.size_},e.prototype.getData=function(){return this.data_},e.prototype.getError=function(){return this.error_},e.prototype.load=function(){if(this.state===x.Z.IDLE||this.state===x.Z.ERROR){this.state=x.Z.LOADING,this.changed();var t=this;this.loader_().then((function(e){t.data_=e,t.state=x.Z.LOADED,t.changed()})).catch((function(e){t.error_=e,t.state=x.Z.ERROR,t.changed()}))}},e}(R.Z);const O=b;var C=r(208),A=r(85487),N=r(20825),L=r(96113),M=r(22988),I=r(41536),P=r(4307),G=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function U(t,e,r){var n=r?t.LINEAR:t.NEAREST;t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,n)}function F(t,e,r,n){U(t,e,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)}function Z(t,e,r,n,i,o){var a,s,l=t.getGL();if(r instanceof Float32Array){a=l.FLOAT,t.getExtension("OES_texture_float");var c=t.getExtension("OES_texture_float_linear");s=null!==c}else a=l.UNSIGNED_BYTE,s=!0;U(l,e,o&&s);var u,h=r.byteLength/n[1],f=1;switch(h%8===0?f=8:h%4===0?f=4:h%2===0&&(f=2),i){case 1:u=l.LUMINANCE;break;case 2:u=l.LUMINANCE_ALPHA;break;case 3:u=l.RGB;break;case 4:u=l.RGBA;break;default:throw new Error("Unsupported number of bands: ".concat(i))}var d=l.getParameter(l.UNPACK_ALIGNMENT);l.pixelStorei(l.UNPACK_ALIGNMENT,f),l.texImage2D(l.TEXTURE_2D,0,u,n[0],n[1],0,u,a,r),l.pixelStorei(l.UNPACK_ALIGNMENT,d)}var B=null;function X(){var t=document.createElement("canvas");t.width=1,t.height=1,B=t.getContext("2d")}var j=function(t){function e(e){var r=t.call(this)||this;r.tile,r.textures=[],r.handleTileChange_=r.handleTileChange_.bind(r),r.renderSize_=(0,P.Pq)(e.grid.getTileSize(e.tile.tileCoord[0])),r.gutter_=e.gutter||0,r.bandCount=NaN,r.helper_=e.helper;var n=new M.ZP(I.qO,I.MB);return n.fromArray([0,1,1,1,1,0,0,0]),r.helper_.flushBufferData(n),r.coords=n,r.setTile(e.tile),r}return G(e,t),e.prototype.setTile=function(t){if(t!==this.tile)if(this.tile&&this.tile.removeEventListener(A.Z.CHANGE,this.handleTileChange_),this.tile=t,this.textures.length=0,this.loaded=t.getState()===x.Z.LOADED,this.loaded)this.uploadTile_();else{if(t instanceof N.Z){var e=t.getImage();e instanceof Image&&!e.crossOrigin&&(e.crossOrigin="anonymous")}t.addEventListener(A.Z.CHANGE,this.handleTileChange_)}},e.prototype.uploadTile_=function(){var t=this.helper_,e=t.getGL(),r=this.tile;if(r instanceof N.Z||r instanceof L.Z){var n=e.createTexture();return this.textures.push(n),this.bandCount=4,void F(e,n,r.getImage(),r.interpolate)}var i=r.getSize(),o=[i[0]+2*this.gutter_,i[1]+2*this.gutter_],a=r.getData(),s=a instanceof Float32Array,l=o[0]*o[1],c=s?Float32Array:Uint8Array,u=c.BYTES_PER_ELEMENT,h=a.byteLength/o[1];this.bandCount=Math.floor(h/u/o[0]);var f=Math.ceil(this.bandCount/4);if(1===f){n=e.createTexture();return this.textures.push(n),void Z(t,n,a,o,this.bandCount,r.interpolate)}for(var d=new Array(f),p=0;p<f;++p){n=e.createTexture();this.textures.push(n);var g=p<f-1?4:this.bandCount%4;d[p]=new c(l*g)}for(var m=0,v=0,_=o[0]*this.bandCount,y=0;y<o[1];++y){for(var T=0;T<_;++T){var E=a[v+T],S=Math.floor(m/this.bandCount),w=T%this.bandCount,x=(p=Math.floor(w/4),d[p]),R=(g=x.length/l,w%4);x[S*g+R]=E,++m}v+=h/u}for(p=0;p<f;++p){n=this.textures[p],x=d[p],g=x.length/l;Z(t,n,x,o,g,r.interpolate)}},e.prototype.handleTileChange_=function(){this.tile.getState()===x.Z.LOADED&&(this.loaded=!0,this.uploadTile_(),this.dispatchEvent(A.Z.CHANGE))},e.prototype.disposeInternal=function(){var t=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(var e=0;e<this.textures.length;++e)t.deleteTexture(this.textures[e]);this.tile.removeEventListener(A.Z.CHANGE,this.handleTileChange_)},e.prototype.getPixelData=function(t,e){if(!this.loaded)return null;var r=this.renderSize_[0],n=this.renderSize_[1],i=this.gutter_;if(this.tile instanceof O){var o=this.tile.getSize(),a=o[0],s=o[1],l=a+2*i,c=s+2*i,u=i+Math.floor(a*(t/r)),h=i+Math.floor(s*(e/n)),f=this.tile.getData();if(f instanceof DataView){var d=f.byteLength/(l*c),p=d*(h*l+u),g=f.buffer.slice(p,p+d);return new DataView(g)}var m=this.bandCount*(h*l+u);return f.slice(m,m+this.bandCount)}B||X(),B.clearRect(0,0,1,1);var v,_=this.tile.getImage(),y=_.width,T=_.height,E=y-2*i,S=T-2*i,w=i+Math.floor(E*(t/r)),x=i+Math.floor(S*(e/n));try{B.drawImage(_,w,x,1,1,0,0,1,1),v=B.getImageData(0,0,1,1).data}catch(R){return B=null,null}return v},e}(C.Z);const z=j;var k=r(35455),V=r(37751),W=r(6101),H=r(28641),Y=r(81428),K=r(98634),q=r(63432),$=r(74187),J=r(65537),Q=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),tt={TILE_TEXTURE_ARRAY:"u_tileTextures",TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY",RENDER_EXTENT:"u_renderExtent",RESOLUTION:"u_resolution",ZOOM:"u_zoom"},et={TEXTURE_COORD:"a_textureCoord"},rt=[{name:et.TEXTURE_COORD,size:2,type:V.GC.FLOAT}],nt={};function it(t){return 2*(1-1/(t+1))-1}function ot(t,e,r){r in t||(t[r]=[]),t[r].push(e)}function at(t,e){var r=t.layerStatesArray[t.layerIndex];r.extent&&(e=(0,H.Ed)(e,(0,q.dY)(r.extent,t.viewState.projection)));var n=r.layer.getRenderSource();if(!n.getWrapX()){var i=n.getTileGridForProjection(t.viewState.projection).getExtent();i&&(e=(0,H.Ed)(e,i))}return e}function st(t,e){return"".concat(t.getKey(),",").concat((0,K.km)(e))}var lt=function(t){function e(e,r){var n=t.call(this,e,{uniforms:r.uniforms})||this;n.renderComplete=!1,n.tileTransform_=(0,W.Ue)(),n.tempMat4_=(0,Y.U)(),n.tempTileRange_=new w.Z(0,0,0,0),n.tempTileCoord_=(0,K.T9)(0,0,0),n.tempSize_=[0,0],n.program_,n.vertexShader_=r.vertexShader,n.fragmentShader_=r.fragmentShader,n.indices_=new M.ZP(I.cX,I.MB),n.indices_.fromArray([0,1,3,1,2,3]);var i=void 0!==r.cacheSize?r.cacheSize:512;return n.tileTextureCache_=new S.Z(i),n.paletteTextures_=r.paletteTextures||[],n.frameState_=null,n}return Q(e,t),e.prototype.reset=function(e){t.prototype.reset.call(this,{uniforms:e.uniforms}),this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.paletteTextures_=e.paletteTextures||[],this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))},e.prototype.afterHelperCreated=function(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)},e.prototype.isDrawableTile_=function(t){var e=this.getLayer(),r=t.getState(),n=e.getUseInterimTilesOnError();return r==x.Z.LOADED||r==x.Z.EMPTY||r==x.Z.ERROR&&!n},e.prototype.prepareFrameInternal=function(t){var e=this.getLayer(),r=e.getRenderSource();return!!r&&(!(0,H.xb)(at(t,t.extent))&&"ready"===r.getState())},e.prototype.enqueueTiles=function(t,e,r,n){var i=t.viewState,o=this.getLayer(),a=o.getRenderSource(),s=a.getTileGridForProjection(i.projection),l=a.getGutterForProjection(i.projection),c=(0,$.sq)(a);c in t.wantedTiles||(t.wantedTiles[c]={});for(var u=t.wantedTiles[c],h=this.tileTextureCache_,f=Math.max(r-o.getPreload(),s.getMinZoom(),o.getMinZoom()),d=r;d>=f;--d)for(var p=s.getTileRangeForExtentAndZ(e,d,this.tempTileRange_),g=s.getResolution(d),m=p.minX;m<=p.maxX;++m)for(var v=p.minY;v<=p.maxY;++v){var _=(0,K.T9)(d,m,v,this.tempTileCoord_),y=st(a,_),T=void 0,E=void 0;if(h.containsKey(y)&&(T=h.get(y),E=T.tile),!T||T.tile.key!==a.getKey())if(E=a.getTile(d,m,v,t.pixelRatio,i.projection),T)if(this.isDrawableTile_(E))T.setTile(E);else{var S=E.getInterimTile();T.setTile(S)}else T=new z({tile:E,grid:s,helper:this.helper,gutter:l}),h.set(y,T);ot(n,T,d);var w=E.getKey();u[w]=!0,E.getState()===x.Z.IDLE&&(t.tileQueue.isKeyQueued(w)||t.tileQueue.enqueue([E,c,s.getTileCoordCenter(_),g]))}},e.prototype.renderFrame=function(t){this.frameState_=t,this.renderComplete=!0;var e=this.helper.getGL();this.preRender(e,t);var r=t.viewState,n=this.getLayer(),i=n.getRenderSource(),o=i.getTileGridForProjection(r.projection),a=i.getGutterForProjection(r.projection),s=at(t,t.extent),l=o.getZForResolution(r.resolution,i.zDirection),c={};if(t.nextExtent){var u=o.getZForResolution(r.nextResolution,i.zDirection),h=at(t,t.nextExtent);this.enqueueTiles(t,h,u,c)}this.enqueueTiles(t,s,l,c);for(var f={},d=(0,$.sq)(this),p=t.time,g=!1,m=c[l],v=0,_=m.length;v<_;++v){var y=m[v],T=y.tile,E=T.tileCoord;if(y.loaded){var S=T.getAlpha(d,p);if(1===S){T.endTransition(d);continue}g=!0;var w=(0,K.km)(E);f[w]=S}this.renderComplete=!1;var x=this.findAltTiles_(o,E,l+1,c);if(!x)for(var R=o.getMinZoom(),D=l-1;D>=R;--D){var b=this.findAltTiles_(o,E,D,c);if(b)break}}this.helper.useProgram(this.program_),this.helper.prepareDraw(t,!g);for(var O=Object.keys(c).map(Number).sort(J.kK),C=r.center[0],A=r.center[1],N=0,L=O.length;N<L;++N){var M=O[N],I=o.getResolution(M),G=(0,P.Pq)(o.getTileSize(M),this.tempSize_),U=o.getOrigin(M),F=G[0]+2*a,Z=G[1]+2*a,B=F/Z,X=(C-U[0])/(G[0]*I),j=(U[1]-A)/(G[1]*I),z=r.resolution/I,k=it(M),V=c[M];for(v=0,_=V.length;v<_;++v){y=V[v];if(y.loaded){T=y.tile,E=T.tileCoord,w=(0,K.km)(E);var q=E[1],Q=E[2];(0,W.mc)(this.tileTransform_),(0,W.bA)(this.tileTransform_,2/(t.size[0]*z/F),-2/(t.size[1]*z/F)),(0,W.U1)(this.tileTransform_,r.rotation),(0,W.bA)(this.tileTransform_,1,1/B),(0,W.Iu)(this.tileTransform_,(G[0]*(q-X)-a)/F,(G[1]*(Q-j)-a)/Z),this.helper.setUniformMatrixValue(tt.TILE_TRANSFORM,(0,Y.u)(this.tempMat4_,this.tileTransform_)),this.helper.bindBuffer(y.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(rt);var et=0;while(et<y.textures.length){var ot="TEXTURE"+et,st="".concat(tt.TILE_TEXTURE_ARRAY,"[").concat(et,"]");e.activeTexture(e[ot]),e.bindTexture(e.TEXTURE_2D,y.textures[et]),e.uniform1i(this.helper.getUniformLocation(st),et),++et}for(var lt=0;lt<this.paletteTextures_.length;++lt){var ct=this.paletteTextures_[lt];e.activeTexture(e["TEXTURE"+et]);var ut=ct.getTexture(e);e.bindTexture(e.TEXTURE_2D,ut),e.uniform1i(this.helper.getUniformLocation(ct.name),et),++et}S=w in f?f[w]:1;S<1&&(t.animate=!0),this.helper.setUniformFloatValue(tt.TRANSITION_ALPHA,S),this.helper.setUniformFloatValue(tt.DEPTH,k),this.helper.setUniformFloatValue(tt.TEXTURE_PIXEL_WIDTH,F),this.helper.setUniformFloatValue(tt.TEXTURE_PIXEL_HEIGHT,Z),this.helper.setUniformFloatValue(tt.TEXTURE_RESOLUTION,I),this.helper.setUniformFloatValue(tt.TEXTURE_ORIGIN_X,U[0]+q*G[0]*I-a*I),this.helper.setUniformFloatValue(tt.TEXTURE_ORIGIN_Y,U[1]-Q*G[1]*I+a*I);var ht=s;a>0&&(ht=o.getTileCoordExtent(E),(0,H.Ed)(ht,s,ht)),this.helper.setUniformFloatVec4(tt.RENDER_EXTENT,ht),this.helper.setUniformFloatValue(tt.RESOLUTION,r.resolution),this.helper.setUniformFloatValue(tt.ZOOM,r.zoom),this.helper.drawElements(0,this.indices_.getSize())}}}this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);var ft=this.helper.getCanvas(),dt=this.tileTextureCache_;while(dt.canExpireCache()){y=dt.pop();y.dispose()}var pt=function(t,e){i.expireCache(e.viewState.projection,nt)};return t.postRenderFunctions.push(pt),this.postRender(e,t),ft},e.prototype.getData=function(t){var e=this.helper.getGL();if(!e)return null;var r=this.frameState_;if(!r)return null;var n=this.getLayer(),i=(0,W.nn)(r.pixelToCoordinateTransform,t.slice()),o=r.viewState,a=n.getExtent();if(a&&!(0,H.b8)((0,q.dY)(a,o.projection),i))return null;var s,l,c,u=n.getSources((0,H.hI)([i]),o.resolution);for(s=u.length-1;s>=0;--s)if(l=u[s],"ready"===l.getState()){if(c=l.getTileGridForProjection(o.projection),l.getWrapX())break;var h=c.getExtent();if(!h||(0,H.b8)(h,i))break}if(s<0)return null;for(var f=this.tileTextureCache_,d=c.getZForResolution(o.resolution);d>=c.getMinZoom();--d){var p=c.getTileCoordForCoordAndZ(i,d),g=st(l,p);if(f.containsKey(g)){var m=f.get(g);if(m.loaded){var v=c.getOrigin(d),_=(0,P.Pq)(c.getTileSize(d)),y=c.getResolution(d),T=(i[0]-v[0])/y-p[1]*_[0],E=(v[1]-i[1])/y-p[2]*_[1];return m.getPixelData(T,E)}}}return null},e.prototype.findAltTiles_=function(t,e,r,n){var i=t.getTileRangeForTileCoordAndZ(e,r,this.tempTileRange_);if(!i)return!1;for(var o=!0,a=this.tileTextureCache_,s=this.getLayer().getRenderSource(),l=i.minX;l<=i.maxX;++l)for(var c=i.minY;c<=i.maxY;++c){var u=st(s,[r,l,c]),h=!1;if(a.containsKey(u)){var f=a.get(u);f.loaded&&(ot(n,f,r),h=!0)}h||(o=!1)}return o},e.prototype.removeHelper=function(){if(this.helper){var e=this.tileTextureCache_;e.forEach((function(t){return t.dispose()})),e.clear()}t.prototype.removeHelper.call(this)},e.prototype.disposeInternal=function(){var e=this.helper;if(e){var r=e.getGL();r.deleteProgram(this.program_),delete this.program_,e.deleteBuffer(this.indices_)}t.prototype.disposeInternal.call(this),delete this.indices_,delete this.tileTextureCache_,delete this.frameState_},e}(k.ZP);const ct=lt;var ut=function(){function t(t,e){this.name=t,this.data=e,this.texture_=null}return t.prototype.getTexture=function(t){if(!this.texture_){var e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.data.length/4,1,0,t.RGBA,t.UNSIGNED_BYTE,this.data),this.texture_=e}return this.texture_},t}();const ht=ut;var ft=r(79706),dt=r(33983),pt={NUMBER:1,STRING:2,COLOR:4,BOOLEAN:8,NUMBER_ARRAY:16,ANY:31,NONE:0},gt={};function mt(t){if("number"===typeof t)return pt.NUMBER;if("boolean"===typeof t)return pt.BOOLEAN;if("string"===typeof t)return(0,ft.e1)(t)?pt.COLOR|pt.STRING:pt.STRING;if(!Array.isArray(t))throw new Error("Unhandled value type: ".concat(JSON.stringify(t)));var e=t,r=e.every((function(t){return"number"===typeof t}));if(r)return 3===e.length||4===e.length?pt.COLOR|pt.NUMBER_ARRAY:pt.NUMBER_ARRAY;if("string"!==typeof e[0])throw new Error("Expected an expression operator but received: ".concat(JSON.stringify(e)));var n=gt[e[0]];if(void 0===n)throw new Error("Unrecognized expression operator: ".concat(JSON.stringify(e)));return n.getReturnType(e.slice(1))}function vt(t){return(0,dt.k3)(t)%1===0}function _t(t){var e=t.toString();return-1===e.indexOf(".")?e+".0":e}function yt(t){if(t.length<2||t.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return"vec".concat(t.length,"(").concat(t.map(_t).join(", "),")")}function Tt(t){var e=(0,ft._2)(t).slice();return e.length<4&&e.push(1),yt(e.map((function(t,e){return e<3?t/255:t})))}function Et(t,e){return void 0===t.stringLiteralsMap[e]&&(t.stringLiteralsMap[e]=Object.keys(t.stringLiteralsMap).length),t.stringLiteralsMap[e]}function St(t,e){return _t(Et(t,e))}function wt(t,e,r){if(Array.isArray(e)&&"string"===typeof e[0]){var n=gt[e[0]];if(void 0===n)throw new Error("Unrecognized expression operator: ".concat(JSON.stringify(e)));return n.toGlsl(t,e.slice(1),r)}var i=mt(e);if((i&pt.NUMBER)>0)return _t(e);if((i&pt.BOOLEAN)>0)return e.toString();if((i&pt.STRING)>0&&(void 0===r||r==pt.STRING))return St(t,e.toString());if((i&pt.COLOR)>0&&(void 0===r||r==pt.COLOR))return Tt(e);if((i&pt.NUMBER_ARRAY)>0)return yt(e);throw new Error("Unexpected expression ".concat(e," (expected type ").concat(r,")"))}function xt(t){if(!(mt(t)&pt.NUMBER))throw new Error("A numeric value was expected, got ".concat(JSON.stringify(t)," instead"))}function Rt(t){for(var e=0;e<t.length;e++)xt(t[e])}function Dt(t){if(!(mt(t)&pt.STRING))throw new Error("A string value was expected, got ".concat(JSON.stringify(t)," instead"))}function bt(t){if(!(mt(t)&pt.BOOLEAN))throw new Error("A boolean value was expected, got ".concat(JSON.stringify(t)," instead"))}function Ot(t,e){if(t.length!==e)throw new Error("Exactly ".concat(e," arguments were expected, got ").concat(t.length," instead"))}function Ct(t,e){if(t.length<e)throw new Error("At least ".concat(e," arguments were expected, got ").concat(t.length," instead"))}function At(t,e){if(t.length>e)throw new Error("At most ".concat(e," arguments were expected, got ").concat(t.length," instead"))}function Nt(t){if(t.length%2!==0)throw new Error("An even amount of arguments was expected, got ".concat(t," instead"))}function Lt(t){if(t.length%2===0)throw new Error("An odd amount of arguments was expected, got ".concat(t," instead"))}function Mt(t,e){if(!vt(e))throw new Error("Could not infer only one type from the following expression: ".concat(JSON.stringify(t)))}function It(t){return"u_var_"+t}gt["get"]={getReturnType:function(t){return pt.ANY},toGlsl:function(t,e){Ot(e,1),Dt(e[0]);var r=e[0].toString();-1===t.attributes.indexOf(r)&&t.attributes.push(r);var n=t.inFragmentShader?"v_":"a_";return n+r}},gt["var"]={getReturnType:function(t){return pt.ANY},toGlsl:function(t,e){Ot(e,1),Dt(e[0]);var r=e[0].toString();return-1===t.variables.indexOf(r)&&t.variables.push(r),It(r)}};var Pt="u_paletteTextures";gt["palette"]={getReturnType:function(t){return pt.COLOR},toGlsl:function(t,e){Ot(e,2),xt(e[0]);var r=wt(t,e[0]),n=e[1];if(!Array.isArray(n))throw new Error("The second argument of palette must be an array");for(var i=n.length,o=new Uint8Array(4*i),a=0;a<i;a++){var s=n[a],l=void 0;if("string"===typeof s)l=(0,ft.mL)(s);else{if(!Array.isArray(s))throw new Error("The second argument of palette must be an array of strings or colors");var c=s.length;if(4===c)l=s;else{if(3!==c)throw new Error("Expected palette color to have 3 or 4 values, got ".concat(c));l=[s[0],s[1],s[2],1]}}var u=4*a;o[u]=l[0],o[u+1]=l[1],o[u+2]=l[2],o[u+3]=255*l[3]}t.paletteTextures||(t.paletteTextures=[]);var h="".concat(Pt,"[").concat(t.paletteTextures.length,"]"),f=new ht(h,o);return t.paletteTextures.push(f),"texture2D(".concat(h,", vec2((").concat(r," + 0.5) / ").concat(i,".0, 0.5))")}};var Gt="getBandValue";function Ut(t){return{getReturnType:function(t){return pt.BOOLEAN},toGlsl:function(e,r){Ot(r,2);for(var n=pt.ANY,i=0;i<r.length;i++)n&=mt(r[i]);if(n===pt.NONE)throw new Error("All arguments should be of compatible type, got ".concat(JSON.stringify(r)," instead"));return n&=~pt.COLOR,"(".concat(wt(e,r[0],n)," ").concat(t," ").concat(wt(e,r[1],n),")")}}}function Ft(t){return{getReturnType:function(t){return pt.BOOLEAN},toGlsl:function(e,r){Ct(r,2);for(var n=0;n<r.length;n++)bt(r[n]);var i="";return i=r.map((function(t){return wt(e,t)})).join(" ".concat(t," ")),i="(".concat(i,")"),i}}}gt["band"]={getReturnType:function(t){return pt.NUMBER},toGlsl:function(t,e){Ct(e,1),At(e,3);var r=e[0];if(!(Gt in t.functions)){for(var n="",i=t.bandCount||1,o=0;o<i;o++){var a=Math.floor(o/4),s=o%4;s===i-1&&1===s&&(s=3);var l="".concat(tt.TILE_TEXTURE_ARRAY,"[").concat(a,"]");n+="\n          if (band == ".concat(o+1,".0) {\n            return texture2D(").concat(l,", v_textureCoord + vec2(dx, dy))[").concat(s,"];\n          }\n        ")}t.functions[Gt]="\n        float getBandValue(float band, float xOffset, float yOffset) {\n          float dx = xOffset / ".concat(tt.TEXTURE_PIXEL_WIDTH,";\n          float dy = yOffset / ").concat(tt.TEXTURE_PIXEL_HEIGHT,";\n          ").concat(n,"\n        }\n      ")}var c=wt(t,r),u=wt(t,e[1]||0),h=wt(t,e[2]||0);return"".concat(Gt,"(").concat(c,", ").concat(u,", ").concat(h,")")}},gt["time"]={getReturnType:function(t){return pt.NUMBER},toGlsl:function(t,e){return Ot(e,0),"u_time"}},gt["zoom"]={getReturnType:function(t){return pt.NUMBER},toGlsl:function(t,e){return Ot(e,0),"u_zoom"}},gt["resolution"]={getReturnType:function(t){return pt.NUMBER},toGlsl:function(t,e){return Ot(e,0),"u_resolution"}},gt["*"]={getReturnType:function(t){return pt.NUMBER},toGlsl:function(t,e){return Ot(e,2),Rt(e),"(".concat(wt(t,e[0])," * ").concat(wt(t,e[1]),")")}},gt["/"]={getReturnType:function(t){return pt.NUMBER},toGlsl:function(t,e){return Ot(e,2),Rt(e),"(".concat(wt(t,e[0])," / ").concat(wt(t,e[1]),")")}},gt["+"]={getReturnType:function(t){return pt.NUMBER},toGlsl:function(t,e){return Ot(e,2),Rt(e),"(".concat(wt(t,e[0])," + ").concat(wt(t,e[1]),")")}},gt["-"]={getReturnType:function(t){return pt.NUMBER},toGlsl:function(t,e){return Ot(e,2),Rt(e),"(".concat(wt(t,e[0])," - ").concat(wt(t,e[1]),")")}},gt["clamp"]={getReturnType:function(t){return pt.NUMBER},toGlsl:function(t,e){Ot(e,3),Rt(e);var r=wt(t,e[1]),n=wt(t,e[2]);return"clamp(".concat(wt(t,e[0]),", ").concat(r,", ").concat(n,")")}},gt["%"]={getReturnType:function(t){return pt.NUMBER},toGlsl:function(t,e){return Ot(e,2),Rt(e),"mod(".concat(wt(t,e[0]),", ").concat(wt(t,e[1]),")")}},gt["^"]={getReturnType:function(t){return pt.NUMBER},toGlsl:function(t,e){return Ot(e,2),Rt(e),"pow(".concat(wt(t,e[0]),", ").concat(wt(t,e[1]),")")}},gt["abs"]={getReturnType:function(t){return pt.NUMBER},toGlsl:function(t,e){return Ot(e,1),Rt(e),"abs(".concat(wt(t,e[0]),")")}},gt["floor"]={getReturnType:function(t){return pt.NUMBER},toGlsl:function(t,e){return Ot(e,1),Rt(e),"floor(".concat(wt(t,e[0]),")")}},gt["round"]={getReturnType:function(t){return pt.NUMBER},toGlsl:function(t,e){return Ot(e,1),Rt(e),"floor(".concat(wt(t,e[0])," + 0.5)")}},gt["ceil"]={getReturnType:function(t){return pt.NUMBER},toGlsl:function(t,e){return Ot(e,1),Rt(e),"ceil(".concat(wt(t,e[0]),")")}},gt["sin"]={getReturnType:function(t){return pt.NUMBER},toGlsl:function(t,e){return Ot(e,1),Rt(e),"sin(".concat(wt(t,e[0]),")")}},gt["cos"]={getReturnType:function(t){return pt.NUMBER},toGlsl:function(t,e){return Ot(e,1),Rt(e),"cos(".concat(wt(t,e[0]),")")}},gt["atan"]={getReturnType:function(t){return pt.NUMBER},toGlsl:function(t,e){return Ct(e,1),At(e,2),Rt(e),2===e.length?"atan(".concat(wt(t,e[0]),", ").concat(wt(t,e[1]),")"):"atan(".concat(wt(t,e[0]),")")}},gt[">"]={getReturnType:function(t){return pt.BOOLEAN},toGlsl:function(t,e){return Ot(e,2),Rt(e),"(".concat(wt(t,e[0])," > ").concat(wt(t,e[1]),")")}},gt[">="]={getReturnType:function(t){return pt.BOOLEAN},toGlsl:function(t,e){return Ot(e,2),Rt(e),"(".concat(wt(t,e[0])," >= ").concat(wt(t,e[1]),")")}},gt["<"]={getReturnType:function(t){return pt.BOOLEAN},toGlsl:function(t,e){return Ot(e,2),Rt(e),"(".concat(wt(t,e[0])," < ").concat(wt(t,e[1]),")")}},gt["<="]={getReturnType:function(t){return pt.BOOLEAN},toGlsl:function(t,e){return Ot(e,2),Rt(e),"(".concat(wt(t,e[0])," <= ").concat(wt(t,e[1]),")")}},gt["=="]=Ut("=="),gt["!="]=Ut("!="),gt["!"]={getReturnType:function(t){return pt.BOOLEAN},toGlsl:function(t,e){return Ot(e,1),bt(e[0]),"(!".concat(wt(t,e[0]),")")}},gt["all"]=Ft("&&"),gt["any"]=Ft("||"),gt["between"]={getReturnType:function(t){return pt.BOOLEAN},toGlsl:function(t,e){Ot(e,3),Rt(e);var r=wt(t,e[1]),n=wt(t,e[2]),i=wt(t,e[0]);return"(".concat(i," >= ").concat(r," && ").concat(i," <= ").concat(n,")")}},gt["array"]={getReturnType:function(t){return pt.NUMBER_ARRAY},toGlsl:function(t,e){Ct(e,2),At(e,4),Rt(e);var r=e.map((function(e){return wt(t,e,pt.NUMBER)}));return"vec".concat(e.length,"(").concat(r.join(", "),")")}},gt["color"]={getReturnType:function(t){return pt.COLOR},toGlsl:function(t,e){Ct(e,3),At(e,4),Rt(e);var r=e;3===e.length&&r.push(1);var n=e.map((function(e,r){return wt(t,e,pt.NUMBER)+(r<3?" / 255.0":"")}));return"vec".concat(e.length,"(").concat(n.join(", "),")")}},gt["interpolate"]={getReturnType:function(t){for(var e=pt.COLOR|pt.NUMBER,r=3;r<t.length;r+=2)e&=mt(t[r]);return e},toGlsl:function(t,e,r){Nt(e),Ct(e,6);var n,i=e[0];switch(i[0]){case"linear":n=1;break;case"exponential":n=i[1];break;default:n=null}if(!n)throw new Error('Invalid interpolation type for "interpolate" operator, received: '.concat(JSON.stringify(i)));var o=void 0!==r?r:pt.ANY,a=gt["interpolate"].getReturnType(e)&o;Mt(e,a);for(var s=wt(t,e[1]),l=_t(n),c="",u=2;u<e.length-2;u+=2){var h=wt(t,e[u]),f=c||wt(t,e[u+1],a),d=wt(t,e[u+2]),p=wt(t,e[u+3],a);c="mix(".concat(f,", ").concat(p,", pow(clamp((").concat(s," - ").concat(h,") / (").concat(d," - ").concat(h,"), 0.0, 1.0), ").concat(l,"))")}return c}},gt["match"]={getReturnType:function(t){for(var e=pt.ANY,r=2;r<t.length;r+=2)e&=mt(t[r]);return e&=mt(t[t.length-1]),e},toGlsl:function(t,e,r){Nt(e),Ct(e,4);var n=void 0!==r?r:pt.ANY,i=gt["match"].getReturnType(e)&n;Mt(e,i);for(var o=wt(t,e[0]),a=wt(t,e[e.length-1],i),s=null,l=e.length-3;l>=1;l-=2){var c=wt(t,e[l]),u=wt(t,e[l+1],i);s="(".concat(o," == ").concat(c," ? ").concat(u," : ").concat(s||a,")")}return s}},gt["case"]={getReturnType:function(t){for(var e=pt.ANY,r=1;r<t.length;r+=2)e&=mt(t[r]);return e&=mt(t[t.length-1]),e},toGlsl:function(t,e,r){Lt(e),Ct(e,3);var n=void 0!==r?r:pt.ANY,i=gt["case"].getReturnType(e)&n;Mt(e,i);for(var o=0;o<e.length-1;o+=2)bt(e[o]);var a=wt(t,e[e.length-1],i),s=null;for(o=e.length-3;o>=0;o-=2){var l=wt(t,e[o]),c=wt(t,e[o+1],i);s="(".concat(l," ? ").concat(c," : ").concat(s||a,")")}return s}};var Zt=r(69374),Bt=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function Xt(t,e){var r="\n    attribute vec2 ".concat(et.TEXTURE_COORD,";\n    uniform mat4 ").concat(tt.TILE_TRANSFORM,";\n    uniform float ").concat(tt.TEXTURE_PIXEL_WIDTH,";\n    uniform float ").concat(tt.TEXTURE_PIXEL_HEIGHT,";\n    uniform float ").concat(tt.TEXTURE_RESOLUTION,";\n    uniform float ").concat(tt.TEXTURE_ORIGIN_X,";\n    uniform float ").concat(tt.TEXTURE_ORIGIN_Y,";\n    uniform float ").concat(tt.DEPTH,";\n\n    varying vec2 v_textureCoord;\n    varying vec2 v_mapCoord;\n\n    void main() {\n      v_textureCoord = ").concat(et.TEXTURE_COORD,";\n      v_mapCoord = vec2(\n        ").concat(tt.TEXTURE_ORIGIN_X," + ").concat(tt.TEXTURE_RESOLUTION," * ").concat(tt.TEXTURE_PIXEL_WIDTH," * v_textureCoord[0],\n        ").concat(tt.TEXTURE_ORIGIN_Y," - ").concat(tt.TEXTURE_RESOLUTION," * ").concat(tt.TEXTURE_PIXEL_HEIGHT," * v_textureCoord[1]\n      );\n      gl_Position = ").concat(tt.TILE_TRANSFORM," * vec4(").concat(et.TEXTURE_COORD,", ").concat(tt.DEPTH,", 1.0);\n    }\n  "),n={inFragmentShader:!0,variables:[],attributes:[],stringLiteralsMap:{},functions:{},bandCount:e},i=[];if(void 0!==t.color){var o=wt(n,t.color,pt.COLOR);i.push("color = ".concat(o,";"))}if(void 0!==t.contrast){var a=wt(n,t.contrast,pt.NUMBER);i.push("color.rgb = clamp((".concat(a," + 1.0) * color.rgb - (").concat(a," / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));"))}if(void 0!==t.exposure){var s=wt(n,t.exposure,pt.NUMBER);i.push("color.rgb = clamp((".concat(s," + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));"))}if(void 0!==t.saturation){var l=wt(n,t.saturation,pt.NUMBER);i.push("\n      float saturation = ".concat(l," + 1.0;\n      float sr = (1.0 - saturation) * 0.2126;\n      float sg = (1.0 - saturation) * 0.7152;\n      float sb = (1.0 - saturation) * 0.0722;\n      mat3 saturationMatrix = mat3(\n        sr + saturation, sr, sr,\n        sg, sg + saturation, sg,\n        sb, sb, sb + saturation\n      );\n      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));\n    "))}if(void 0!==t.gamma){var c=wt(n,t.gamma,pt.NUMBER);i.push("color.rgb = pow(color.rgb, vec3(1.0 / ".concat(c,"));"))}if(void 0!==t.brightness){var u=wt(n,t.brightness,pt.NUMBER);i.push("color.rgb = clamp(color.rgb + ".concat(u,", vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));"))}var h={},f=n.variables.length;if(f>1&&!t.variables)throw new Error("Missing variables in style (expected ".concat(n.variables,")"));for(var d=function(e){var r=n.variables[e];if(!(r in t.variables))throw new Error("Missing '".concat(r,"' in style variables"));var i=It(r);h[i]=function(){var e=t.variables[r];return"string"===typeof e&&(e=Et(n,e)),void 0!==e?e:-9999999}},p=0;p<f;++p)d(p);var g=Object.keys(h).map((function(t){return"uniform float ".concat(t,";")})),m=Math.ceil(e/4);g.push("uniform sampler2D ".concat(tt.TILE_TEXTURE_ARRAY,"[").concat(m,"];")),n.paletteTextures&&g.push("uniform sampler2D ".concat(Pt,"[").concat(n.paletteTextures.length,"];"));var v=Object.keys(n.functions).map((function(t){return n.functions[t]})),_="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    #else\n    precision mediump float;\n    #endif\n\n    varying vec2 v_textureCoord;\n    varying vec2 v_mapCoord;\n    uniform vec4 ".concat(tt.RENDER_EXTENT,";\n    uniform float ").concat(tt.TRANSITION_ALPHA,";\n    uniform float ").concat(tt.TEXTURE_PIXEL_WIDTH,";\n    uniform float ").concat(tt.TEXTURE_PIXEL_HEIGHT,";\n    uniform float ").concat(tt.RESOLUTION,";\n    uniform float ").concat(tt.ZOOM,";\n\n    ").concat(g.join("\n"),"\n\n    ").concat(v.join("\n"),"\n\n    void main() {\n      if (\n        v_mapCoord[0] < ").concat(tt.RENDER_EXTENT,"[0] ||\n        v_mapCoord[1] < ").concat(tt.RENDER_EXTENT,"[1] ||\n        v_mapCoord[0] > ").concat(tt.RENDER_EXTENT,"[2] ||\n        v_mapCoord[1] > ").concat(tt.RENDER_EXTENT,"[3]\n      ) {\n        discard;\n      }\n\n      vec4 color = texture2D(").concat(tt.TILE_TEXTURE_ARRAY,"[0],  v_textureCoord);\n\n      ").concat(i.join("\n"),"\n\n      if (color.a == 0.0) {\n        discard;\n      }\n\n      gl_FragColor = color;\n      gl_FragColor.rgb *= gl_FragColor.a;\n      gl_FragColor *= ").concat(tt.TRANSITION_ALPHA,";\n    }");return{vertexShader:r,fragmentShader:_,uniforms:h,paletteTextures:n.paletteTextures}}var jt=function(t){function e(e){var r=this,n=e?(0,Zt.f0)({},e):{},i=n.style||{};delete n.style;var o=n.cacheSize;return delete n.cacheSize,r=t.call(this,n)||this,r.sources_=n.sources,r.renderedSource_=null,r.renderedResolution_=NaN,r.style_=i,r.cacheSize_=o,r.styleVariables_=r.style_.variables||{},r.addChangeListener(E.Z.SOURCE,r.handleSourceUpdate_),r}return Bt(e,t),e.prototype.getSources=function(t,e){var r=this.getSource();return this.sources_?"function"===typeof this.sources_?this.sources_(t,e):this.sources_:r?[r]:[]},e.prototype.getRenderSource=function(){return this.renderedSource_||this.getSource()},e.prototype.getSourceState=function(){var t=this.getRenderSource();return t?t.getState():"undefined"},e.prototype.handleSourceUpdate_=function(){this.getSource()&&this.setStyle(this.style_)},e.prototype.getSourceBandCount_=function(){var t=Number.MAX_SAFE_INTEGER,e=this.getSources([-t,-t,t,t],t);return e&&e.length&&"bandCount"in e[0]?e[0].bandCount:4},e.prototype.createRenderer=function(){var t=Xt(this.style_,this.getSourceBandCount_());return new ct(this,{vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,cacheSize:this.cacheSize_,paletteTextures:t.paletteTextures})},e.prototype.renderSources=function(t,e){for(var r,n=this.getRenderer(),i=0,o=e.length;i<o;++i)this.renderedSource_=e[i],n.prepareFrame(t)&&(r=n.renderFrame(t));return r},e.prototype.render=function(t,e){var r=this;this.rendered=!0;for(var n=t.viewState,i=this.getSources(t.extent,n.resolution),o=!0,a=function(t,e){var n=i[t],a=n.getState();if("loading"==a){var s=function(){"ready"==n.getState()&&(n.removeEventListener("change",s),r.changed())};n.addEventListener("change",s)}o=o&&"ready"==a},s=0,l=i.length;s<l;++s)a(s,l);var c=this.renderSources(t,i);if(this.getRenderer().renderComplete&&o)return this.renderedResolution_=n.resolution,c;if(this.renderedResolution_>.5*n.resolution){var u=this.getSources(t.extent,this.renderedResolution_).filter((function(t){return!i.includes(t)}));if(u.length>0)return this.renderSources(t,u)}return c},e.prototype.setStyle=function(t){this.styleVariables_=t.variables||{},this.style_=t;var e=Xt(this.style_,this.getSourceBandCount_()),r=this.getRenderer();r.reset({vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,paletteTextures:e.paletteTextures}),this.changed()},e.prototype.updateStyleVariables=function(t){(0,Zt.f0)(this.styleVariables_,t),this.changed()},e}(T.Z);jt.prototype.dispose;const zt=jt;var kt=r(88815),Vt=r(57302),Wt=r(57248),Ht=r(36885),Yt=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Kt=function(t){function e(e){var r=this,n=void 0===e.projection?"EPSG:3857":e.projection,i=e.tileGrid;if(void 0===i&&n&&(i=(0,Wt.dl)({extent:(0,Wt.Tl)(n),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize})),r=t.call(this,{cacheSize:.1,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:n,tileGrid:i,opaque:e.opaque,state:e.state,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate})||this,r.gutter_=void 0!==e.gutter?e.gutter:0,r.tileSize_=e.tileSize?(0,P.Pq)(e.tileSize):null,!r.tileSize_&&e.tilePixelRatio&&i){var o=(0,P.Pq)(i.getTileSize(0));r.tileSize_=[o[0]*e.tilePixelRatio,o[1]*e.tilePixelRatio]}return r.tileSizes_=null,r.tileLoadingKeys_={},r.loader_=e.loader,r.handleTileChange_=r.handleTileChange_.bind(r),r.bandCount=void 0===e.bandCount?4:e.bandCount,r}return Yt(e,t),e.prototype.setTileSizes=function(t){this.tileSizes_=t},e.prototype.getTileSize=function(t){if(this.tileSizes_)return this.tileSizes_[t];if(this.tileSize_)return this.tileSize_;var e=this.getTileGrid();return e?(0,P.Pq)(e.getTileSize(t)):[256,256]},e.prototype.getGutterForProjection=function(t){return this.gutter_},e.prototype.setLoader=function(t){this.loader_=t},e.prototype.getTile=function(t,e,r,n,i){var o=this.getTileSize(t),a=(0,K.lg)(t,e,r);if(this.tileCache.containsKey(a))return this.tileCache.get(a);var s=this.loader_;function l(){return(0,Ht.Vi)((function(){return s(t,e,r)}))}var c=(0,Zt.f0)({tileCoord:[t,e,r],loader:l,size:o},this.tileOptions),u=new O(c);return u.key=this.getKey(),u.addEventListener(A.Z.CHANGE,this.handleTileChange_),this.tileCache.set(a,u),u},e.prototype.handleTileChange_=function(t){var e,r=t.target,n=(0,$.sq)(r),i=r.getState();i==x.Z.LOADING?(this.tileLoadingKeys_[n]=!0,e=kt.Z.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],e=i==x.Z.ERROR?kt.Z.TILELOADERROR:i==x.Z.LOADED?kt.Z.TILELOADEND:void 0),e&&this.dispatchEvent(new Vt.s(e,r))},e}(Vt.Z);const qt=Kt;var $t=r(8738),Jt=r(14812);const Qt="undefined"!==typeof navigator&&navigator.hardwareConcurrency||2;class te{constructor(t=Qt,e){this.workers=null,this._awaitingDecoder=null,this.size=t,this.messageId=0,t&&(this._awaitingDecoder=e?Promise.resolve(e):new Promise((t=>{r.e(8831).then(r.bind(r,28831)).then((e=>{t(e.create)}))})),this._awaitingDecoder.then((e=>{this._awaitingDecoder=null,this.workers=[];for(let r=0;r<t;r++)this.workers.push({worker:e(),idle:!0})})))}async decode(t,e){return this._awaitingDecoder&&await this._awaitingDecoder,0===this.size?(0,Jt.X)(t).then((r=>r.decode(t,e))):new Promise((r=>{const n=this.workers.find((t=>t.idle))||this.workers[Math.floor(Math.random()*this.size)];n.idle=!1;const i=this.messageId++,o=t=>{t.data.id===i&&(n.idle=!0,r(t.data.decoded),n.worker.removeEventListener("message",o))};n.worker.addEventListener("message",o),n.worker.postMessage({fileDirectory:t,buffer:e,id:i},[e])}))}destroy(){this.workers&&(this.workers.forEach((t=>{t.worker.terminate()})),this.workers=null)}}const ee=te;var re,ne=r(38193),ie=r(58375),oe=r(25108),ae=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),se="STATISTICS_MAXIMUM",le="STATISTICS_MINIMUM";function ce(){return re||(re=new ee),re}function ue(t){try{return t.getBoundingBox()}catch(r){var e=t.fileDirectory;return[0,0,e.ImageWidth,e.ImageLength]}}function he(t){try{return t.getOrigin().slice(0,2)}catch(e){return[0,t.fileDirectory.ImageLength]}}function fe(t,e){try{return t.getResolution(e)}catch(r){return[e.fileDirectory.ImageWidth/t.fileDirectory.ImageWidth,e.fileDirectory.ImageHeight/t.fileDirectory.ImageHeight]}}function de(t){var e=t.geoKeys;if(!e)return null;if(e.ProjectedCSTypeGeoKey){var r="EPSG:"+e.ProjectedCSTypeGeoKey,n=(0,q.U2)(r);if(!n){var i=(0,ie.Ne)(e.ProjLinearUnitsGeoKey);i&&(n=new q.kv({code:r,units:i}))}return n}if(e.GeographicTypeGeoKey){r="EPSG:"+e.GeographicTypeGeoKey,n=(0,q.U2)(r);if(!n){i=(0,ie.Ne)(e.GeogAngularUnitsGeoKey);i&&(n=new q.kv({code:r,units:i}))}return n}return null}function pe(t){return t.getImageCount().then((function(e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t.getImage(n);return Promise.all(r)}))}function ge(t,e){var r;return r=t.blob?(0,ne.mK)(t.blob):t.overviews?(0,ne.MS)(t.url,t.overviews,e):(0,ne.W0)(t.url,e),r.then(pe)}function me(t,e,r,n,i){if(Array.isArray(t)){var o=t.length;if(!Array.isArray(e)||o!=e.length){var a=new Error(n);throw i(a),a}for(var s=0;s<o;++s)me(t[s],e[s],r,n,i)}else if(Math.abs(t-e)>r*t)throw new Error(n)}function ve(t){return t instanceof Int8Array?-128:t instanceof Int16Array?-32768:t instanceof Int32Array?-2147483648:t instanceof Float32Array?12e-39:0}function _e(t){return t instanceof Int8Array?127:t instanceof Uint8Array||t instanceof Uint8ClampedArray?255:t instanceof Int16Array?32767:t instanceof Uint16Array?65535:t instanceof Int32Array?2147483647:t instanceof Uint32Array?4294967295:t instanceof Float32Array?34e37:255}var ye=function(t){function e(e){var r=t.call(this,{state:"loading",tileGrid:null,projection:null,opaque:e.opaque,transition:e.transition,interpolate:!1!==e.interpolate,wrapX:e.wrapX})||this;r.sourceInfo_=e.sources;var n=r.sourceInfo_.length;r.sourceOptions_=e.sourceOptions,r.sourceImagery_=new Array(n),r.resolutionFactors_=new Array(n),r.samplesPerPixel_,r.nodataValues_,r.metadata_,r.normalize_=!1!==e.normalize,r.addAlpha_=!1,r.error_=null,r.readMethod_=e.convertToRGB?"readRGB":"readRasters",r.setKey(r.sourceInfo_.map((function(t){return t.url})).join(","));for(var i=r,o=new Array(n),a=0;a<n;++a)o[a]=ge(r.sourceInfo_[a],r.sourceOptions_);return Promise.all(o).then((function(t){i.configure_(t)})).catch((function(t){oe.error(t),i.error_=t,i.setState("error")})),r}return ae(e,t),e.prototype.getError=function(){return this.error_},e.prototype.configure_=function(t){for(var e,r,n,i,o,a=new Array(t.length),s=new Array(t.length),l=new Array(t.length),c=0,u=t.length,h=function(u){var h=t[u],d=h.length,p=void 0,g=void 0,m=new Array(d),v=new Array(d),_=new Array(d);s[u]=new Array(d),l[u]=new Array(d);for(var y=0;y<d;++y){var T=h[y],E=T.getGDALNoData();l[u][y]=T.getGDALMetadata(0),s[u][y]=E;var S=f.sourceInfo_[u].bands;a[u]=S?S.length:T.getSamplesPerPixel();var w=d-(y+1);p||(p=ue(T)),g||(g=he(T));var x=fe(T,h[0]);_[w]=x[0];var R=[T.getTileWidth(),T.getTileHeight()];m[w]=R;var D=x[0]/Math.abs(x[1]);v[w]=[R[0],R[1]/D]}if(e?(0,H.Ed)(e,p,e):e=p,r){var b="Origin mismatch for source ".concat(u,", got [").concat(g,"] but expected [").concat(r,"]");me(r,g,0,b,f.viewRejector)}else r=g;if(o){o.length-c>_.length&&(c=o.length-_.length);var O=o[o.length-1]/_[_.length-1];f.resolutionFactors_[u]=O;var C=_.map((function(t){return t*O}));b="Resolution mismatch for source ".concat(u,", got [").concat(C,"] but expected [").concat(o,"]");me(o.slice(c,o.length),C,.02,b,f.viewRejector)}else o=_,f.resolutionFactors_[u]=1;n?me(n.slice(c,n.length),v,.01,"Tile size mismatch for source ".concat(u),f.viewRejector):n=v,i?me(i.slice(c,i.length),m,0,"Tile size mismatch for source ".concat(u),f.viewRejector):i=m,f.sourceImagery_[u]=h.reverse()},f=this,d=0;d<u;++d)h(d);for(var p=0,g=this.sourceImagery_.length;p<g;++p){var m=this.sourceImagery_[p];while(m.length<o.length)m.unshift(void 0)}if(!this.getProjection()){var v=t[0];for(p=v.length-1;p>=0;--p){var _=v[p],y=de(_);if(y){this.projection=y;break}}}this.samplesPerPixel_=a,this.nodataValues_=s,this.metadata_=l;t:for(d=0;d<u;++d){if(void 0!==this.sourceInfo_[d].nodata){this.addAlpha_=!0;break}var T=s[d],E=this.sourceInfo_[d].bands;if(E){for(p=0;p<E.length;++p)if(null!==T[E[p]-1]){this.addAlpha_=!0;break t}}else for(var S=0;S<T.length;++S)if(null!==T[S]){this.addAlpha_=!0;break t}}var w=this.addAlpha_?1:0;this.bandCount=a.reduce((function(t,e){return t+=e,t}),0)+w;var x=new $t.Z({extent:e,minZoom:c,origin:r,resolutions:o,tileSizes:n});this.tileGrid=x,this.setTileSizes(i),this.setLoader(this.loadTile_.bind(this)),this.setState("ready"),this.viewResolver({projection:this.projection,resolutions:o,center:(0,q.lO)((0,H.qg)(e),this.projection),extent:(0,q.Fj)(e,this.projection),zoom:0})},e.prototype.loadTile_=function(t,e,r){for(var n=this.getTileSize(t),i=this.sourceImagery_.length,o=new Array(i),a=this.addAlpha_,s=this.bandCount,l=this.samplesPerPixel_,c=this.nodataValues_,u=this.sourceInfo_,h=function(i){var a=u[i],s=f.resolutionFactors_[i],l=[Math.round(e*(n[0]*s)),Math.round(r*(n[1]*s)),Math.round((e+1)*(n[0]*s)),Math.round((r+1)*(n[1]*s))],h=f.sourceImagery_[i][t],d=void 0;a.bands&&(d=a.bands.map((function(t){return t-1})));var p=void 0;p="nodata"in a&&null!==a.nodata?a.nodata:d?d.map((function(t){return c[i][t]})):c[i],o[i]=h[f.readMethod_]({window:l,width:n[0],height:n[1],samples:d,fillValue:p,pool:ce(),interleave:!1})},f=this,d=0;d<i;++d)h(d);var p=n[0]*n[1],g=p*s,m=this.normalize_,v=this.metadata_;return Promise.all(o).then((function(t){var e;e=m?new Uint8Array(g):new Float32Array(g);for(var r=0,n=0;n<p;++n){for(var o=a,s=0;s<i;++s){var h=u[s],f=h.min,d=h.max,_=void 0,y=void 0;if(m){var T=v[s][0];void 0===f&&(f=T&&le in T?parseFloat(T[le]):ve(t[s][0])),void 0===d&&(d=T&&se in T?parseFloat(T[se]):_e(t[s][0])),_=255/(d-f),y=-f*_}for(var E=0;E<l[s];++E){var S=t[s][E][n],w=void 0;if(w=m?(0,dt.uZ)(_*S+y,0,255):S,a){var x=h.nodata;if(void 0===x){var R=void 0;R=h.bands?h.bands[E]-1:E,x=c[s][R]}var D=isNaN(x);(!D&&S!==x||D&&!isNaN(S))&&(o=!1,e[r]=w)}else e[r]=w;r++}}a&&(o||(e[r]=255),r++)}return e})).catch((function(t){throw oe.error(t),t}))},e}(qt);ye.prototype.getView;const Te=ye,Ee={components:{ChannelControl:y,TextControl:h.Z},data(){return{textControlText:"Pixel Value: -",layer:null,source:null,colorMap:null,noData:[],channels:[],bands:[]}},methods:{getBandVar(t){return["band",["var",`${t}band`]]},getFormula(t){let e=["var",`${t}min`],r=["var",`${t}max`],n=this.getBandVar(t),i=["*",["/",["-",n,e],["-",r,e]],255];return["clamp",i,0,255]},getNoDataFormula(){let t=this.getBandVar("alpha");return["case",["==",t,0],0,1]},async addGeoTiff(t,e="GeoTiff"){this.bands=t.getBands(),this.colorMap=t.getColorMap(),this.noData=t.getNoData(),this.source=new Te({interpolate:!1,normalize:!1,convertToRGB:t.convertToRGB,sources:[{url:t.getUrl(),nodata:this.noData[0]}]}),this.layer=new zt({id:t.getUrl(),title:e,source:this.source,cacheSize:2048}),this.layer.set("events",{pointermove:t=>{let e=this.layer.getData(t.pixel),r=a.Z.displayRGBA(e,this.noData,this.noData.length>0),n=`Pixel Value: ${r}`,i=this.formatCoords(t.coordinate);this.textControlText=[n,`${n} @ ${i}`]},click:t=>{let e=this.layer.getData(t.pixel);if(!e)return void(this.chart=null);if(e=Array.from(e).slice(0,this.bands.length),e.length<2||e.every((t=>!isFinite(t))))return void(this.chart=null);let r=this.formatCoords(t.coordinate),n=`Coordinate: ${r}`,i=[{label:n,data:e}];this.chart={labels:this.bands.map((t=>String(t.name||t.id))),datasets:i}}}),this.addLayerToMap(this.layer);let r=t.getExtent();return r&&this.map.getView().fit(r,this.getFitOptions(10)),await new Promise((t=>setTimeout(t,1250))),this.setStyle(),this.source},formatCoords(t){return t.map((t=>String(parseFloat(t.toFixed(6))))).join(", ")},updateGeoTiffStyle(t,e){switch(t){case"channels":this.channels=e;break}this.setStyle()},setStyle(){if(!this.layer)return;let t={};for(let r in this.channels){let e=this.channels[r];t[`${r}band`]=e.id,t[`${r}min`]=e.min,t[`${r}max`]=e.max}t.alphaband=this.bands.length+1;let e=[];if(this.colorMap)e.push("palette"),e.push(["band",1]),e.push(this.colorMap);else{if(0===this.channels.length)return null;if(1===this.channels.length){e.push("color");let t=this.getFormula(0);e.push(t),e.push(t),e.push(t),this.noData.length>0&&e.push(this.getNoDataFormula())}else e.push("color"),e.push(this.getFormula(0)),e.push(this.getFormula(1)),e.push(this.getFormula(2)),this.noData.length>0&&e.push(this.getNoDataFormula())}this.layer.setStyle({variables:t,color:e})}}},Se=Ee;var we,xe,Re=(0,v.Z)(Se,we,xe,!1,null,null,null);const De=Re.exports;var be=r(12766),Oe=r(94782),Ce=r(78714),Ae=r(68734),Ne=r(41666),Le=r(54680);function Me(t,e){return We().createElementNS(t,e)}function Ie(t,e){return Pe(t,e,[]).join("")}function Pe(t,e,r){if(t.nodeType==Node.CDATA_SECTION_NODE||t.nodeType==Node.TEXT_NODE)e?r.push(String(t.nodeValue).replace(/(\r\n|\r|\n)/g,"")):r.push(t.nodeValue);else{var n=void 0;for(n=t.firstChild;n;n=n.nextSibling)Pe(n,e,r)}return r}function Ge(t){return"documentElement"in t}function Ue(t){return(new DOMParser).parseFromString(t,"application/xml")}function Fe(t,e){return function(r,n){var i=t.call(void 0!==e?e:this,r,n);if(void 0!==i){var o=n[n.length-1];o.push(i)}}}function Ze(t,e,r){return function(n,i){var o=t.call(void 0!==r?r:this,n,i);if(void 0!==o){var a=i[i.length-1],s=void 0!==e?e:n.localName,l=void 0;s in a?l=a[s]:(l=[],a[s]=l),l.push(o)}}}function Be(t,e,r){return function(n,i){var o=t.call(void 0!==r?r:this,n,i);if(void 0!==o){var a=i[i.length-1],s=void 0!==e?e:n.localName;a[s]=o}}}function Xe(t,e){var r=t;return function(t,n,i){var o=n[n.length-1],a=o.node,s=r;void 0===s&&(s=i);var l=void 0!==e?e:a.namespaceURI;return Me(l,s)}}Xe();function je(t,e,r){var n,i,o=void 0!==r?r:{};for(n=0,i=t.length;n<i;++n)o[t[n]]=e;return o}function ze(t,e,r,n){var i;for(i=e.firstElementChild;i;i=i.nextElementSibling){var o=t[i.namespaceURI];if(void 0!==o){var a=o[i.localName];void 0!==a&&a.call(n,i,r)}}}function ke(t,e,r,n,i){return n.push(t),ze(e,r,n,i),n.pop()}var Ve=void 0;function We(){return void 0===Ve&&"undefined"!==typeof document&&(Ve=document.implementation.createDocument("","",null)),Ve}var He=function(){function t(){}return t.prototype.read=function(t){if(t){if("string"===typeof t){var e=Ue(t);return this.readFromDocument(e)}return Ge(t)?this.readFromDocument(t):this.readFromNode(t)}return null},t.prototype.readFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null},t.prototype.readFromNode=function(t){},t}();const Ye=He;var Ke="http://www.w3.org/1999/xlink";function qe(t){return t.getAttributeNS(Ke,"href")}function $e(t){var e=Ie(t,!1);return Je(e)}function Je(t){var e=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(t);return e?parseFloat(e[1]):void 0}function Qe(t){var e=Ie(t,!1);return tr(e)}function tr(t){var e=/^\s*(\d+)\s*$/.exec(t);return e?parseInt(e[1],10):void 0}function er(t){return Ie(t,!1).trim()}var rr=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),nr=[null,"http://www.opengis.net/ows/1.1"],ir=je(nr,{ServiceIdentification:Be(Cr),ServiceProvider:Be(Nr),OperationsMetadata:Be(br)}),or=function(t){function e(){return t.call(this)||this}return rr(e,t),e.prototype.readFromNode=function(t){var e=ke({},ir,t,[]);return e||null},e}(Ye),ar=je(nr,{DeliveryPoint:Be(er),City:Be(er),AdministrativeArea:Be(er),PostalCode:Be(er),Country:Be(er),ElectronicMailAddress:Be(er)}),sr=je(nr,{Value:Ze(Lr)}),lr=je(nr,{AllowedValues:Be(Tr)}),cr=je(nr,{Phone:Be(Or),Address:Be(yr)}),ur=je(nr,{HTTP:Be(Rr)}),hr=je(nr,{Get:Ze(xr),Post:void 0}),fr=je(nr,{DCP:Be(wr)}),dr=je(nr,{Operation:Dr}),pr=je(nr,{Voice:Be(er),Facsimile:Be(er)}),gr=je(nr,{Constraint:Ze(Er)}),mr=je(nr,{IndividualName:Be(er),PositionName:Be(er),ContactInfo:Be(Sr)}),vr=je(nr,{Abstract:Be(er),AccessConstraints:Be(er),Fees:Be(er),Title:Be(er),ServiceTypeVersion:Be(er),ServiceType:Be(er)}),_r=je(nr,{ProviderName:Be(er),ProviderSite:Be(qe),ServiceContact:Be(Ar)});function yr(t,e){return ke({},ar,t,e)}function Tr(t,e){return ke({},sr,t,e)}function Er(t,e){var r=t.getAttribute("name");if(r)return ke({name:r},lr,t,e)}function Sr(t,e){return ke({},cr,t,e)}function wr(t,e){return ke({},ur,t,e)}function xr(t,e){var r=qe(t);if(r)return ke({href:r},gr,t,e)}function Rr(t,e){return ke({},hr,t,e)}function Dr(t,e){var r=t.getAttribute("name"),n=ke({},fr,t,e);if(n){var i=e[e.length-1];i[r]=n}}function br(t,e){return ke({},dr,t,e)}function Or(t,e){return ke({},pr,t,e)}function Cr(t,e){return ke({},vr,t,e)}function Ar(t,e){return ke({},mr,t,e)}function Nr(t,e){return ke({},_r,t,e)}function Lr(t,e){return er(t)}const Mr=or;var Ir=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Pr=[null,"http://www.opengis.net/wmts/1.0"],Gr=[null,"http://www.opengis.net/ows/1.1"],Ur=je(Pr,{Contents:Be(Kr)}),Fr=function(t){function e(){var e=t.call(this)||this;return e.owsParser_=new Mr,e}return Ir(e,t),e.prototype.readFromNode=function(t){var e=t.getAttribute("version");e&&(e=e.trim());var r=this.owsParser_.readFromNode(t);return r?(r["version"]=e,r=ke(r,Ur,t,[]),r||null):null},e}(Ye),Zr=je(Pr,{Layer:Ze(qr),TileMatrixSet:Ze($r)}),Br=je(Pr,{Style:Ze(Jr),Format:Ze(er),TileMatrixSetLink:Ze(Qr),Dimension:Ze(tn),ResourceURL:Ze(en)},je(Gr,{Title:Be(er),Abstract:Be(er),WGS84BoundingBox:Be(rn),Identifier:Be(er)})),Xr=je(Pr,{LegendURL:Ze(nn)},je(Gr,{Title:Be(er),Identifier:Be(er)})),jr=je(Pr,{TileMatrixSet:Be(er),TileMatrixSetLimits:Be(sn)}),zr=je(Pr,{TileMatrixLimits:Fe(ln)}),kr=je(Pr,{TileMatrix:Be(er),MinTileRow:Be(Qe),MaxTileRow:Be(Qe),MinTileCol:Be(Qe),MaxTileCol:Be(Qe)}),Vr=je(Pr,{Default:Be(er),Value:Ze(er)},je(Gr,{Identifier:Be(er)})),Wr=je(Gr,{LowerCorner:Fe(on),UpperCorner:Fe(on)}),Hr=je(Pr,{WellKnownScaleSet:Be(er),TileMatrix:Ze(an)},je(Gr,{SupportedCRS:Be(er),Identifier:Be(er),BoundingBox:Be(rn)})),Yr=je(Pr,{TopLeftCorner:Be(on),ScaleDenominator:Be($e),TileWidth:Be(Qe),TileHeight:Be(Qe),MatrixWidth:Be(Qe),MatrixHeight:Be(Qe)},je(Gr,{Identifier:Be(er)}));function Kr(t,e){return ke({},Zr,t,e)}function qr(t,e){return ke({},Br,t,e)}function $r(t,e){return ke({},Hr,t,e)}function Jr(t,e){var r=ke({},Xr,t,e);if(r){var n="true"===t.getAttribute("isDefault");return r["isDefault"]=n,r}}function Qr(t,e){return ke({},jr,t,e)}function tn(t,e){return ke({},Vr,t,e)}function en(t,e){var r=t.getAttribute("format"),n=t.getAttribute("template"),i=t.getAttribute("resourceType"),o={};return r&&(o["format"]=r),n&&(o["template"]=n),i&&(o["resourceType"]=i),o}function rn(t,e){var r=ke([],Wr,t,e);if(2==r.length)return(0,H.hI)(r)}function nn(t,e){var r={};return r["format"]=t.getAttribute("format"),r["href"]=qe(t),r}function on(t,e){var r=er(t).split(/\s+/);if(r&&2==r.length){var n=+r[0],i=+r[1];if(!isNaN(n)&&!isNaN(i))return[n,i]}}function an(t,e){return ke({},Yr,t,e)}function sn(t,e){return ke([],zr,t,e)}function ln(t,e){return ke({},kr,t,e)}const cn=Fr;var un=r(88799);function hn(t,e){var r=[];Object.keys(e).forEach((function(t){null!==e[t]&&void 0!==e[t]&&r.push(t+"="+encodeURIComponent(e[t]))}));var n=r.join("&");return t=t.replace(/[?&]$/,""),t=-1===t.indexOf("?")?t+"?":t+"&",t+n}var fn=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),dn=function(t){function e(e){var r=t.call(this,{extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes})||this;return r.matrixIds_=e.matrixIds,r}return fn(e,t),e.prototype.getMatrixId=function(t){return this.matrixIds_[t]},e.prototype.getMatrixIds=function(){return this.matrixIds_},e}($t.Z);function pn(t,e,r){var n=[],i=[],o=[],a=[],s=[],l=void 0!==r?r:[],c="SupportedCRS",u="TileMatrix",h="Identifier",f="ScaleDenominator",d="TopLeftCorner",p="TileWidth",g="TileHeight",m=t[c],v=(0,q.U2)(m),_=v.getMetersPerUnit(),y="ne"==v.getAxisOrientation().substr(0,2);return t[u].sort((function(t,e){return e[f]-t[f]})),t[u].forEach((function(e){var r;if(r=!(l.length>0)||(0,J.sE)(l,(function(r){return e[h]==r[u]||-1===e[h].indexOf(":")&&t[h]+":"+e[h]===r[u]})),r){i.push(e[h]);var c=28e-5*e[f]/_,m=e[p],v=e[g];y?o.push([e[d][1],e[d][0]]):o.push(e[d]),n.push(c),a.push(m==v?m:[m,v]),s.push([e["MatrixWidth"],e["MatrixHeight"]])}})),new dn({extent:e,origins:o,resolutions:n,matrixIds:i,tileSizes:a,sizes:s})}var gn=r(67848),mn=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),vn=function(t){function e(e){var r=this,n=void 0===e.imageSmoothing||e.imageSmoothing;void 0!==e.interpolate&&(n=e.interpolate);var i=void 0!==e.requestEncoding?e.requestEncoding:"KVP",o=e.tileGrid,a=e.urls;return void 0===a&&void 0!==e.url&&(a=(0,gn.Gk)(e.url)),r=t.call(this,{attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:n,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:o,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,urls:a,wrapX:void 0!==e.wrapX&&e.wrapX,transition:e.transition,zDirection:e.zDirection})||this,r.version_=void 0!==e.version?e.version:"1.0.0",r.format_=void 0!==e.format?e.format:"image/jpeg",r.dimensions_=void 0!==e.dimensions?e.dimensions:{},r.layer_=e.layer,r.matrixSet_=e.matrixSet,r.style_=e.style,r.requestEncoding_=i,r.setKey(r.getKeyForDimensions_()),a&&a.length>0&&(r.tileUrlFunction=(0,gn.Un)(a.map(r.createFromWMTSTemplate.bind(r)))),r}return mn(e,t),e.prototype.setUrls=function(t){this.urls=t;var e=t.join("\n");this.setTileUrlFunction((0,gn.Un)(t.map(this.createFromWMTSTemplate.bind(this))),e)},e.prototype.getDimensions=function(){return this.dimensions_},e.prototype.getFormat=function(){return this.format_},e.prototype.getLayer=function(){return this.layer_},e.prototype.getMatrixSet=function(){return this.matrixSet_},e.prototype.getRequestEncoding=function(){return this.requestEncoding_},e.prototype.getStyle=function(){return this.style_},e.prototype.getVersion=function(){return this.version_},e.prototype.getKeyForDimensions_=function(){var t=0,e=[];for(var r in this.dimensions_)e[t++]=r+"-"+this.dimensions_[r];return e.join("/")},e.prototype.updateDimensions=function(t){(0,Zt.f0)(this.dimensions_,t),this.setKey(this.getKeyForDimensions_())},e.prototype.createFromWMTSTemplate=function(t){var e=this.requestEncoding_,r={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};"KVP"==e&&(0,Zt.f0)(r,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),t="KVP"==e?hn(t,r):t.replace(/\{(\w+?)\}/g,(function(t,e){return e.toLowerCase()in r?r[e.toLowerCase()]:t}));var n=this.tileGrid,i=this.dimensions_;return function(r,o,a){if(r){var s={TileMatrix:n.getMatrixId(r[0]),TileCol:r[1],TileRow:r[2]};(0,Zt.f0)(s,i);var l=t;return l="KVP"==e?hn(l,s):l.replace(/\{(\w+?)\}/g,(function(t,e){return s[e]})),l}}},e}(un.Z);const _n=vn;function yn(t,e){var r=t["Contents"]["Layer"],n=(0,J.sE)(r,(function(t,r,n){return t["Identifier"]==e["layer"]}));if(null===n)return null;var i,o=t["Contents"]["TileMatrixSet"];i=n["TileMatrixSetLink"].length>1?"projection"in e?(0,J.cx)(n["TileMatrixSetLink"],(function(t,r,n){var i=(0,J.sE)(o,(function(e){return e["Identifier"]==t["TileMatrixSet"]})),a=i["SupportedCRS"],s=(0,q.U2)(a),l=(0,q.U2)(e["projection"]);return s&&l?(0,q.OP)(s,l):a==e["projection"]})):(0,J.cx)(n["TileMatrixSetLink"],(function(t,r,n){return t["TileMatrixSet"]==e["matrixSet"]})):0,i<0&&(i=0);var a=n["TileMatrixSetLink"][i]["TileMatrixSet"],s=n["TileMatrixSetLink"][i]["TileMatrixSetLimits"],l=n["Format"][0];"format"in e&&(l=e["format"]),i=(0,J.cx)(n["Style"],(function(t,r,n){return"style"in e?t["Title"]==e["style"]:t["isDefault"]})),i<0&&(i=0);var c=n["Style"][i]["Identifier"],u={};"Dimension"in n&&n["Dimension"].forEach((function(t,e,r){var n=t["Identifier"],i=t["Default"];void 0===i&&(i=t["Value"][0]),u[n]=i}));var h,f=t["Contents"]["TileMatrixSet"],d=(0,J.sE)(f,(function(t,e,r){return t["Identifier"]==a})),p=d["SupportedCRS"];if(p&&(h=(0,q.U2)(p)),"projection"in e){var g=(0,q.U2)(e["projection"]);g&&(h&&!(0,q.OP)(g,h)||(h=g))}var m=!1,v="ne"==h.getAxisOrientation().substr(0,2),_=d.TileMatrix[0],y={MinTileCol:0,MinTileRow:0,MaxTileCol:_.MatrixWidth-1,MaxTileRow:_.MatrixHeight-1};if(s){y=s[s.length-1];var T=(0,J.sE)(d.TileMatrix,(function(t){return t.Identifier===y.TileMatrix||d.Identifier+":"+t.Identifier===y.TileMatrix}));T&&(_=T)}var E=28e-5*_.ScaleDenominator/h.getMetersPerUnit(),S=v?[_.TopLeftCorner[1],_.TopLeftCorner[0]]:_.TopLeftCorner,w=_.TileWidth*E,x=_.TileHeight*E,R=d["BoundingBox"];R&&v&&(R=[R[1],R[0],R[3],R[2]]);var D=[S[0]+w*y.MinTileCol,S[1]-x*(1+y.MaxTileRow),S[0]+w*(1+y.MaxTileCol),S[1]-x*y.MinTileRow];if(void 0!==R&&!(0,H.r4)(R,D)){var b=n["WGS84BoundingBox"],O=(0,q.U2)("EPSG:4326").getExtent();if(D=R,b)m=b[0]===O[0]&&b[2]===O[2];else{var C=(0,q.$A)(R,d["SupportedCRS"],"EPSG:4326");m=C[0]-1e-10<=O[0]&&C[2]+1e-10>=O[2]}}var A=pn(d,D,s),N=[],L=e["requestEncoding"];if(L=void 0!==L?L:"","OperationsMetadata"in t&&"GetTile"in t["OperationsMetadata"])for(var M=t["OperationsMetadata"]["GetTile"]["DCP"]["HTTP"]["Get"],I=0,P=M.length;I<P;++I)if(M[I]["Constraint"]){var G=(0,J.sE)(M[I]["Constraint"],(function(t){return"GetEncoding"==t["name"]})),U=G["AllowedValues"]["Value"];if(""===L&&(L=U[0]),"KVP"!==L)break;(0,J.q9)(U,"KVP")&&N.push(M[I]["href"])}else M[I]["href"]&&(L="KVP",N.push(M[I]["href"]));return 0===N.length&&(L="REST",n["ResourceURL"].forEach((function(t){"tile"===t["resourceType"]&&(l=t["format"],N.push(t["template"]))}))),{urls:N,layer:e["layer"],matrixSet:a,format:l,projection:h,requestEncoding:L,tileGrid:A,style:c,dimensions:u,wrapX:m,crossOrigin:e["crossOrigin"]}}var Tn=r(10044),En=r(22556),Sn=r(88775),wn=r(52463),xn=function(t){var e=wn.Z.create("DIV",{className:(t.className||"")+" ol-timeline"+(t.target?"":" ol-unselectable ol-control")+(t.zoomButton?" ol-hasbutton":"")});Sn.Z.call(this,{element:e,target:t.target}),this._scrollDiv=wn.Z.create("DIV",{className:"ol-scroll",parent:this.element}),this._buttons=wn.Z.create("DIV",{className:"ol-buttons",parent:this.element}),t.zoomButton&&(this.addButton({className:"ol-zoom-in",handleClick:function(){var t=this.get("zoom");t>=1?t++:t=Math.min(1,t+.1),t=Math.round(100*t)/100,this.refresh(t)}.bind(this)}),this.addButton({className:"ol-zoom-out",handleClick:function(){var t=this.get("zoom");t>1?t--:t-=.1,t=Math.round(100*t)/100,this.refresh(t)}.bind(this)})),this._intervalDiv=wn.Z.create("DIV",{className:"ol-center-date",parent:this.element}),this.element.addEventListener("mouseover",function(){this._select&&this._select.elt.classList.remove("ol-select")}.bind(this));var r=null;this._scrollDiv.addEventListener("scroll",function(){this._setScrollLeft(),r&&(clearTimeout(r),r=null),r=setTimeout(function(){this.dispatchEvent({type:"scroll",date:this.getDate(),dateStart:this.getDate("start"),dateEnd:this.getDate("end")})}.bind(this),t.scrollTimeout||15)}.bind(this)),wn.Z.scrollDiv(this._scrollDiv,{onmove:function(t){this._moving=t}.bind(this)}),this._tline=[],this._scrollLeft=0,this.set("maxWidth",t.maxWidth||2e3),this.set("minDate",t.minDate||1/0),this.set("maxDate",t.maxDate||-1/0),this.set("graduation",t.graduation),this.set("minZoom",t.minZoom||.2),this.set("maxZoom",t.maxZoom||4),this.setInterval(t.interval),t.getHTML&&(this._getHTML=t.getHTML),t.getFeatureDate&&(this._getFeatureDate=t.getFeatureDate),t.endFeatureDate&&(this._endFeatureDate=t.endFeatureDate),this.setFeatures(t.features||t.source,t.zoom)};(0,Tn.Z)(xn,Sn.Z),xn.prototype.setMap=function(t){Sn.Z.prototype.setMap.call(this,t),this.refresh(this.get("zoom")||1,!0)},xn.prototype.addButton=function(t){this.element.classList.add("ol-hasbutton"),wn.Z.create("BUTTON",{className:t.className||void 0,title:t.title,html:t.html,click:t.handleClick,parent:this._buttons})},xn.prototype.setInterval=function(t){"string"===typeof t&&(t=/s$/.test(t)?1e3*parseFloat(t):/mn$/.test(t)?1e3*parseFloat(t)*60:/h$/.test(t)?1e3*parseFloat(t)*3600:/d$/.test(t)?1e3*parseFloat(t)*3600*24:/y$/.test(t)?1e3*parseFloat(t)*3600*24*365:0),this.set("interval",t||0),t?this.element.classList.add("ol-interval"):this.element.classList.remove("ol-interval"),this.refresh(this.get("zoom"))},xn.prototype._getHTML=function(t){return t.get("name")||""},xn.prototype._getFeatureDate=function(t){return t&&t.get?t.get("date"):null},xn.prototype._endFeatureDate=function(){},xn.prototype.isCollapsed=function(){return this.element.classList.contains("ol-collapsed")},xn.prototype.collapse=function(t){t?this.element.classList.add("ol-collapsed"):this.element.classList.remove("ol-collapsed"),this.dispatchEvent({type:"collapse",collapsed:this.isCollapsed()})},xn.prototype.toggle=function(){this.element.classList.toggle("ol-collapsed"),this.dispatchEvent({type:"collapse",collapsed:this.isCollapsed()})},xn.prototype.setFeatures=function(t,e){this._features=this._source=null,t instanceof En.Z?this._source=t:this._features=t instanceof Array?t:[],this.refresh(e)},xn.prototype.getFeatures=function(){return this._features||this._source.getFeatures()},xn.prototype.refresh=function(t,e){if(this.getMap()){t||(t=this.get("zoom")),t=Math.min(this.get("maxZoom"),Math.max(this.get("minZoom"),t||1)),this.set("zoom",t),this._scrollDiv.innerHTML="";var r,n,i=this.getFeatures(),o=this._tline=[];i.forEach(function(t){(r=this._getFeatureDate(t))&&(r instanceof Date||(r=new Date(r)),this._endFeatureDate&&(n=this._endFeatureDate(t),n instanceof Date||(n=new Date(n))),isNaN(r)||o.push({date:r,end:isNaN(n)?null:n,feature:t}))}.bind(this)),o.sort((function(t,e){return t.date<e.date?-1:t.date===e.date?0:1}));var a=wn.Z.create("DIV",{parent:this._scrollDiv}),s=this._minDate=Math.min(this.get("minDate"),o.length?o[0].date:1/0),l=this._maxDate=Math.max(this.get("maxDate"),o.length?o[o.length-1].date:-1/0);isFinite(s)||(this._minDate=s=new Date),isFinite(l)||(this._maxDate=l=new Date);var c=l-s,u=this.get("maxWidth"),h=this._scale=(c>u?u/c:1)*t;s=this._minDate=this._minDate-10/h,c=(l-s)*h,wn.Z.setStyle(a,{width:c,maxWidth:"unset"}),this._drawTime(a,s,l,h),this.get("interval")?wn.Z.setStyle(this._intervalDiv,{width:this.get("interval")*h}):wn.Z.setStyle(this._intervalDiv,{width:""});var f=[],d=wn.Z.getStyle(this._scrollDiv,"lineHeight"),p=wn.Z.create("DIV",{className:"ol-features",parent:a});o.forEach(function(t){for(var e=t.date,r=t.elt=wn.Z.create("DIV",{className:"ol-feature",style:{left:Math.round((e-s)*h)},html:this._getHTML(t.feature),parent:p}),n=r.querySelectorAll("img"),i=0;i<n.length;i++)n[i].ondragstart=function(){return!1};t.end&&wn.Z.setStyle(r,{minWidth:(t.end-e)*h,width:(t.end-e)*h,maxWidth:"unset"});var o,a,l=wn.Z.getStyle(r,"left");for(r.addEventListener("click",function(){this._moving||this.dispatchEvent({type:"select",feature:t.feature})}.bind(this)),o=0;a=f[o];o++)if(l>a)break;f[o]=l+wn.Z.getStyle(r,"width"),wn.Z.setStyle(r,{top:o*d})}.bind(this)),this._nbline=f.length,e&&this.setDate(this._minDate,{anim:!1,position:"start"}),this.dispatchEvent({type:"scroll",date:this.getDate(),dateStart:this.getDate("start"),dateEnd:this.getDate("end")})}},xn.prototype._getOffsetFromDate=function(t){return(t-this._minDate)*this._scale},xn.prototype._getDateFromOffset=function(t){return t/this._scale+this._minDate},xn.prototype._setScrollLeft=function(t){this._scrollLeft=t,void 0!==t&&(this._scrollDiv.scrollLeft=t)},xn.prototype._getScrollLeft=function(){return void 0===this._scrollLeft?this._scrollDiv.scrollLeft:this._scrollLeft},xn.prototype._drawTime=function(t,e,r,n){var i,o,a,s,l=wn.Z.create("DIV",{className:"ol-times",parent:t}),c=wn.Z.getStyle(l,"left"),u=wn.Z.getStyle(l,"height"),h=new Date(this._minDate).getFullYear();o=(new Date(0).setFullYear(String(h))-new Date(0).setFullYear(String(h-1)))*n;var f=Math.round(2*u/o)+1;while(1){if(i=new Date(0).setFullYear(h),i>this._maxDate)break;wn.Z.create("DIV",{className:"ol-time ol-year",style:{left:this._getOffsetFromDate(i)-c},html:h,parent:l}),h+=f}if(/day|month/.test(this.get("graduation"))&&(o=(new Date(0,0,1).setFullYear(String(h))-new Date(0,0,1).setFullYear(String(h-1)))*n,s=Math.max(1,Math.round(12/Math.round(o/u/2))),s<12)){h=new Date(this._minDate).getFullYear(),a=s+1;while(1){if(i=new Date(0,0,1),i.setFullYear(h),i.setMonth(a-1),i>this._maxDate)break;wn.Z.create("DIV",{className:"ol-time ol-month",style:{left:this._getOffsetFromDate(i)-c},html:i.toLocaleDateString(void 0,{month:"short"}),parent:l}),a+=s,a>12&&(h++,a=s+1)}}if("day"===this.get("graduation")){o=(new Date(0,1,1)-new Date(0,0,1))*n;var d=Math.max(1,Math.round(31/Math.round(o/u/2)));if(d<31){h=new Date(this._minDate).getFullYear(),a=0;var p=d;while(1)if(i=new Date(0,0,1),i.setFullYear(h),i.setMonth(a),i.setDate(p),isNaN(i))a++,a>12&&(a=1,h++),p=d;else{if(i>this._maxDate)break;if(p>1){var g=this._getOffsetFromDate(i);this._getOffsetFromDate(new Date(h,a+1,1))-g>u&&wn.Z.create("DIV",{className:"ol-time ol-day",style:{left:g-c},html:p,parent:l})}h=i.getFullYear(),a=i.getMonth(),p=i.getDate()+d,p>new Date(h,a+1,0).getDate()&&(a++,p=d)}}}},xn.prototype.setDate=function(t,e){var r;if(e=e||{},t instanceof Date?r=t:(this.getFeatures().indexOf(t)>=0&&(r=this._getFeatureDate(t)),!r||r instanceof Date||(r=new Date(r)),r&&!isNaN(r)||(r=new Date(String(t)))),!isNaN(r)){!1===e.anim&&this._scrollDiv.classList.add("ol-move");var n=this._getOffsetFromDate(r);if("start"===e.position?n+=wn.Z.outerWidth(this._scrollDiv)/2-wn.Z.getStyle(this._scrollDiv,"marginLeft")/2:"end"===e.position&&(n-=wn.Z.outerWidth(this._scrollDiv)/2-wn.Z.getStyle(this._scrollDiv,"marginLeft")/2),this._setScrollLeft(n),!1===e.anim&&this._scrollDiv.classList.remove("ol-move"),t)for(var i,o=0;i=this._tline[o];o++)i.feature===t?(i.elt.classList.add("ol-select"),this._select=i):i.elt.classList.remove("ol-select")}},xn.prototype.roundDate=function(t,e){switch(e){case"mn":return new Date(this._roundTo(t,6e4));case"hour":return new Date(this._roundTo(t,36e5));case"day":return new Date(this._roundTo(t,864e5));case"month":return t=new Date(this._roundTo(t,864e5)),t.getDate()>15&&(t=new Date(t.setMonth(t.getMonth()+1))),t=t.setDate(1),new Date(t);default:return new Date(t)}},xn.prototype.getDate=function(t,e){var r;switch(e||(e=t),t){case"start":r=this.get("interval")?-wn.Z.getStyle(this._intervalDiv,"width")/2+wn.Z.getStyle(this._scrollDiv,"marginLeft")/2:-wn.Z.outerWidth(this._scrollDiv)/2+wn.Z.getStyle(this._scrollDiv,"marginLeft")/2;break;case"end":r=this.get("interval")?wn.Z.getStyle(this._intervalDiv,"width")/2-wn.Z.getStyle(this._scrollDiv,"marginLeft")/2:wn.Z.outerWidth(this._scrollDiv)/2-wn.Z.getStyle(this._scrollDiv,"marginLeft")/2;break;default:r=0;break}var n=this._getDateFromOffset(this._getScrollLeft()+r);return n=this.roundDate(n,e),new Date(n)},xn.prototype._roundTo=function(t,e){return Math.round(t/e)*e},xn.prototype.getStartDate=function(){return new Date(this.get("minDate"))},xn.prototype.getEndDate=function(){return new Date(this.get("maxDate"))};const Rn=xn;var Dn=r(25108);const bn={data(){return{WMTSCapabilities:{},timeline:null}},methods:{async addWebService(t){switch(t.type.toLowerCase()){case"xyz":return this.updateXYZLayer(t);case"wmts":return await this.updateWMTSLayer(t);default:return a.Z.error(this,"Sorry, this web service type is not supported."),null}},getWMTSTimes(t,e){const r=t.Contents.Layer||[];let n=r.find((t=>t.Identifier==e));if(!n||!n.Dimension)return[];let i=n.Dimension.find((t=>"TIME"===t.Identifier));return i?i.Value.sort():[]},async initWMTSLayer(t){if(!this.WMTSCapabilities[t.url])try{let r=new URL(t.url);r.searchParams.set("service","wmts"),r.searchParams.set("request","GetCapabilities");let n=await axios.get(r.toString(),{responseType:"text"});var e=new cn;this.WMTSCapabilities[t.url]=e.read(n.data)}catch(error){a.Z.exception(this,error,"WMTS Discovery failed")}return this.WMTSCapabilities[t.url]},async updateWMTSLayer(t,e="Service"){let r=t.attributes||{},n=await this.initWMTSLayer(t);n||a.Z.exception(this,error,"WMTS Discovery failed");let i,o=null,s=null,l=null,c=null,u=a.Z.getResourceTitle(t,e),h=new Ce.Z;Array.isArray(r.layers)?i=r.layers:Array.isArray(n.Contents.Layer)&&(i=layers.map((t=>t.Identifier)));for(let p of i){if(!p)continue;let e=yn(n,{layer:p,matrixSet:"EPSG:3857"});l||(l=new Date(e.dimensions.TIME));let i=this.getWMTSTimes(n,p);if(i.length){let t=new Date(i[0]),e=new Date(i[i.length-1]);(!o||t<o)&&(o=t),(!s||e>s)&&(s=e)}a.Z.isObject(r.dimensions)&&Object.assign(e.dimensions,t.attributes.dimensions),c=new _n(e);var f=new Ne.Z({title:u,source:this.trackTileProgress(c),noSwitcherDelete:!0});h.push(f)}if(o&&s){let t;this.timeline=new Rn({className:"ol-pointer",graduation:"day",minDate:o,maxDate:s}),this.timeline.on("scroll",(function(e){!e.date||e.date>s||e.date<o||(t&&window.clearTimeout(t),t=window.setTimeout((()=>{try{let t=e.date.toISOString().substr(0,10);c.updateDimensions({TIME:t});let r=document.getElementsByClassName("timeline-date-label");r[0].innerText=t,r[0].disabled=!0}catch(error){Dn.log(error)}t=null}),500))})),this.map.addControl(this.timeline),this.timeline.addButton({className:"timeline-date-label",title:`The date that is shown on the map for the collection '${u}'`,html:"No date"}),this.timeline.setDate(l)}let d=new Ae.Z({id:t.id,title:u,layers:h});return d.on("change:visible",(()=>{this.timeline&&this.timeline.element&&(this.timeline.element.style.display=d.getVisible()?"block":"none")})),this.addLayerToMap(d),this.timeline&&this.map.getLayers().on("remove",(t=>{t.element===d&&(this.map.removeControl(this.timeline),this.timeline=null)})),d},updateXYZLayer(t,e="Service"){let r=a.Z.replaceParam(t.url,"__editorSessionId",(new Date).getTime()).replace(/%7B/g,"{").replace(/%7D/g,"}"),n=a.Z.getResourceTitle(t,e),i=new Ne.Z({title:n,source:this.trackTileProgress(new Le.Z({url:r})),noSwitcherDelete:!0}),o=new Ae.Z({id:t.id,title:n,layers:[i]});return this.addLayerToMap(o),o}}},On=bn;var Cn,An,Nn=(0,v.Z)(On,Cn,An,!1,null,null,null);const Ln=Nn.exports;var Mn=r(6139),In=r(81090),Pn=r(2033),Gn=r(92371),Un=r(25108);o.Z.prototype.getSampleByteSize=function(t){if(this.fileDirectory.BitsPerSample&&0!==this.fileDirectory.BitsPerSample.length)return t>=this.fileDirectory.BitsPerSample.length&&(t=0),Math.ceil(this.fileDirectory.BitsPerSample[t]/8)},o.Z.prototype.getReaderForSample=function(t){const e=this.getSampleFormat(t),r=this.getBitsPerSample(t);switch(e){case 1:if(r<=8)return DataView.prototype.getUint8;if(r<=16)return DataView.prototype.getUint16;if(r<=32)return DataView.prototype.getUint32;break;case 2:if(r<=8)return DataView.prototype.getInt8;if(r<=16)return DataView.prototype.getInt16;if(r<=32)return DataView.prototype.getInt32;break;case 3:switch(r){case 16:return function(t,e){return getFloat16(this,t,e)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64;default:break}break;default:break}throw Error("Unsupported data format/bitsPerSample")},o.Z.prototype.getSampleFormat=function(t=0){return this.fileDirectory.SampleFormat&&0!==this.fileDirectory.SampleFormat.length?"undefined"!==typeof this.fileDirectory.SampleFormat[t]?this.fileDirectory.SampleFormat[t]:this.fileDirectory.SampleFormat[0]:1},o.Z.prototype.getBitsPerSample=function(t=0){if(this.fileDirectory.BitsPerSample&&0!==this.fileDirectory.BitsPerSample.length)return"undefined"!==typeof this.fileDirectory.BitsPerSample[t]?this.fileDirectory.BitsPerSample[t]:this.fileDirectory.BitsPerSample[0]};const Fn={name:"MapViewer",mixins:[u.Z,De,be.Z,Ln],components:{Pane:c.X,ScatterChart:Oe.Z,Splitpanes:c.F},props:{data:{}},data(){return{loading:!0,chart:null}},computed:{...a.Z.mapState(["connection"]),isWebService(){return this.data instanceof Mn.Service&&"string"===typeof this.data.type},isGeoTiff(){return this.data instanceof s.Z},isGeoJson(){return this.data instanceof l.Z&&this.data.isGeoJson}},mounted(){this.$emit("mounted",this)},methods:{async renderMap(){try{let t,e;if(this.isGeoJson)e=await this.data.loadData(this.connection);else if(this.isGeoTiff){e=await this.data.loadData(this.connection);let r=e.getProjection();r&&(t=r)}else{if(!this.isWebService||!a.Z.isMapServiceSupported(this.data.type))throw new Error("Sorry, the given data can't be shown on a web map.");if("wmts"===this.data.type.toLowerCase()){await this.initWMTSLayer(this.data)}}if(await this.createMap(t),this.addLayerSwitcher(),this.isGeoJson)this.addBasemaps(),this.addGeoJson(e,!0);else if(this.isGeoTiff){let t=this.map.getView().getProjection();(t.basemap||["EPSG:3857","EPSG:4326"].includes(t.getCode()))&&this.addBasemaps();let r=this.data.getContext();r&&this.addExtent(r,!1),this.addGeoTiff(e)}else this.isWebService&&a.Z.isMapServiceSupported(this.data.type)&&(this.addBasemaps(),this.addWebService(this.data));this.$listeners&&this.$listeners.drop&&(this.map.getViewport().addEventListener("dragover",(t=>t.preventDefault())),this.map.getViewport().addEventListener("drop",this.$listeners.drop))}catch(error){a.Z.exception(this,error)}this.loading=!1},async addCollection(){let t=this.showWebService(this.data);try{let e=service.attributes.bbox,r=[...this.fromLonLat([e.west,e.south]),...this.fromLonLat([e.east,e.north])],n=new Gn.Z({title:"Extent",noSwitcherDelete:!0,source:new En.Z({features:[new In.Z((0,Pn.oJ)(r))],projection:"EPSG:4326",wrapX:!1})});this.removeLayerFill(n),t.getLayers().push(n),this.map.getView().fit(r,this.getFitOptions(10))}catch(error){Un.log(error)}}}},Zn=Fn;var Bn=(0,v.Z)(Zn,n,i,!1,null,null,null);const Xn=Bn.exports}}]);
//# sourceMappingURL=1959.e0755ee3.js.map