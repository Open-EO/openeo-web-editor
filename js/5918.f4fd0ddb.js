"use strict";(globalThis["webpackChunk_openeo_web_editor"]=globalThis["webpackChunk_openeo_web_editor"]||[]).push([[5918],{24328:(e,t,r)=>{r.d(t,{Z:()=>E});var n=r(55431),i=r(36885),s=r(74187),o=r(6101),a=r(28641),l=r(92710),h=r(1295),d=r(91900);class c extends n.Z{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){(0,s.O3)()}calculateMatrices2D(e){const t=e.viewState,r=e.coordinateToPixelTransform,n=e.pixelToCoordinateTransform;(0,o.qC)(r,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),(0,o.nb)(n,r)}forEachFeatureAtCoordinate(e,t,r,n,i,s,o,l){let c;const u=t.viewState;function g(e,t,r,n){return i.call(s,t,e?r:null,n)}const p=u.projection,f=(0,d.Cf)(e.slice(),p),m=[[0,0]];if(p.canWrapX()&&n){const e=p.getExtent(),t=(0,a.dz)(e);m.push([-t,0],[t,0])}const T=t.layerStatesArray,_=T.length,x=[],R=[];for(let a=0;a<m.length;a++)for(let n=_-1;n>=0;--n){const i=T[n],s=i.layer;if(s.hasRenderer()&&(0,h.j)(i,u)&&o.call(l,s)){const n=s.getRenderer(),o=s.getSource();if(n&&o){const s=o.getWrapX()?f:e,l=g.bind(null,i.managed);R[0]=s[0]+m[a][0],R[1]=s[1]+m[a][1],c=n.forEachFeatureAtCoordinate(R,t,r,l,x)}if(c)return c}}if(0===x.length)return;const y=1/x.length;return x.forEach(((e,t)=>e.distanceSq+=t*y)),x.sort(((e,t)=>e.distanceSq-t.distanceSq)),x.some((e=>c=e.callback(e.feature,e.layer,e.geometry))),c}hasFeatureAtCoordinate(e,t,r,n,s,o){const a=this.forEachFeatureAtCoordinate(e,t,r,n,i.uX,this,s,o);return void 0!==a}getMap(){return this.map_}renderFrame(e){(0,s.O3)()}scheduleExpireIconCache(e){l.c.canExpireCache()&&e.postRenderFunctions.push(u)}}function u(e,t){l.c.expire()}const g=c;var p=r(35990),f=r(57380),m=r(98771),T=r(10245),_=r(50147),x=r(65818),R=r(68326);class y extends g{constructor(e){super(e),this.fontChangeListenerKey_=(0,x.oL)(_.sG,p.Z.PROPERTYCHANGE,e.redrawText.bind(e)),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=T.XV+" ol-layers";const r=e.getViewport();r.insertBefore(this.element_,r.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(e,t){const r=this.getMap();if(r.hasListener(e)){const n=new f.Z(e,void 0,t);r.dispatchEvent(n)}}disposeInternal(){(0,x.bN)(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(e){if(!e)return void(this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1));this.calculateMatrices2D(e),this.dispatchRenderEvent(m.Z.PRECOMPOSE,e);const t=e.layerStatesArray.sort((function(e,t){return e.zIndex-t.zIndex})),r=e.viewState;this.children_.length=0;const n=[];let i=null;for(let s=0,o=t.length;s<o;++s){const o=t[s];e.layerIndex=s;const a=o.layer,l=a.getSourceState();if(!(0,h.j)(o,r)||"ready"!=l&&"undefined"!=l){a.unrender();continue}const d=a.render(e,i);d&&(d!==i&&(this.children_.push(d),i=d),"getDeclutter"in a&&n.push(a))}for(let s=n.length-1;s>=0;--s)n[s].renderDeclutter(e);(0,R.hF)(this.element_,this.children_),this.dispatchRenderEvent(m.Z.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}}const E=y},10115:(e,t,r)=>{r.d(t,{Z:()=>l});var n=r(85487),i=r(70553),s=r(62706),o=r(74187);class a extends s.Z{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.declutterExecutorGroup=null}getFeatures(e){return(0,o.O3)()}getData(e){return null}prepareFrame(e){return(0,o.O3)()}renderFrame(e,t){return(0,o.O3)()}loadedTileCallback(e,t,r){e[t]||(e[t]={}),e[t][r.tileCoord.toString()]=r}createLoadedTileFinder(e,t,r){return(n,i)=>{const s=this.loadedTileCallback.bind(this,r,n);return e.forEachLoadedTile(t,n,i,s)}}forEachFeatureAtCoordinate(e,t,r,n,i){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){const t=e.target;t.getState()===i.Z.LOADED&&this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=i.Z.LOADED&&t!=i.Z.ERROR&&e.addEventListener(n.Z.CHANGE,this.boundHandleImageChange_),t==i.Z.IDLE&&(e.load(),t=e.getState()),t==i.Z.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&"ready"===e.getSourceState()&&e.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}}const l=a},29186:(e,t,r)=>{r.d(t,{Z:()=>d});var n=r(57581),i=r(70553),s=r(37755),o=r(6101),a=r(28641),l=r(63432);class h extends n.Z{constructor(e){super(e),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],r=e.pixelRatio,n=e.viewState,o=n.resolution,h=this.getLayer().getSource(),d=e.viewHints;let c=e.extent;if(void 0!==t.extent&&(c=(0,a.Ed)(c,(0,l.fromUserExtent)(t.extent,n.projection))),!d[s.Z.ANIMATING]&&!d[s.Z.INTERACTING]&&!(0,a.xb)(c))if(h){const e=n.projection,t=h.getImage(c,o,r,e);t&&(this.loadImage(t)?this.image_=t:t.getState()===i.Z.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(e){const t=this.frameState;if(!t)return null;const r=this.getLayer(),n=(0,o.nn)(t.pixelToCoordinateTransform,e.slice()),i=r.getExtent();if(i&&!(0,a.b8)(i,n))return null;const s=this.image_.getExtent(),l=this.getImage(),h=(0,a.dz)(s),d=Math.floor(l.width*((n[0]-s[0])/h));if(d<0||d>=l.width)return null;const c=(0,a.Cr)(s),u=Math.floor(l.height*((s[3]-n[1])/c));return u<0||u>=l.height?null:this.getImageData(l,d,u)}renderFrame(e,t){const r=this.image_,n=r.getExtent(),i=r.getResolution(),s=r.getPixelRatio(),h=e.layerStatesArray[e.layerIndex],d=e.pixelRatio,c=e.viewState,u=c.center,g=c.resolution,p=d*i/(g*s),f=e.extent,m=c.resolution,T=c.rotation,_=Math.round((0,a.dz)(f)/m*d),x=Math.round((0,a.Cr)(f)/m*d);(0,o.qC)(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/d,1/d,T,-_/2,-x/2),(0,o.nb)(this.inversePixelTransform,this.pixelTransform);const R=(0,o.BB)(this.pixelTransform);this.useContainer(t,R,this.getBackground(e));const y=this.context,E=y.canvas;E.width!=_||E.height!=x?(E.width=_,E.height=x):this.containerReused||y.clearRect(0,0,_,x);let C=!1,S=!0;if(h.extent){const t=(0,l.fromUserExtent)(h.extent,c.projection);S=(0,a.kK)(t,e.extent),C=S&&!(0,a.r4)(t,e.extent),C&&this.clipUnrotated(y,e,t)}const I=this.getImage(),v=(0,o.qC)(this.tempTransform,_/2,x/2,p,p,0,s*(n[0]-u[0])/i,s*(u[1]-n[3])/i);this.renderedResolution=i*d/s;const w=I.width*v[0],b=I.height*v[3];if(this.getLayer().getSource().getInterpolate()||(y.imageSmoothingEnabled=!1),this.preRender(y,e),S&&w>=.5&&b>=.5){const e=v[4],t=v[5],r=h.opacity;let n;1!==r&&(n=y.globalAlpha,y.globalAlpha=r),y.drawImage(I,0,0,+I.width,+I.height,e,t,w,b),1!==r&&(y.globalAlpha=n)}return this.postRender(y,e),C&&y.restore(),y.imageSmoothingEnabled=!0,R!==E.style.transform&&(E.style.transform=R),this.container}}const d=h},57581:(e,t,r)=>{r.d(t,{Z:()=>f,r:()=>c});var n=r(10115),i=r(57380),s=r(98771),o=r(6101),a=r(79706),l=r(68326),h=r(65537),d=r(28641);const c=[];let u=null;function g(){u=(0,l.E4)(1,1,void 0,{willReadFrequently:!0})}class p extends n.Z{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=(0,o.Ue)(),this.pixelTransform=(0,o.Ue)(),this.inversePixelTransform=(0,o.Ue)(),this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(e,t,r){let n;u||g(),u.clearRect(0,0,1,1);try{u.drawImage(e,t,r,1,1,0,0,1,1),n=u.getImageData(0,0,1,1).data}catch(i){return u=null,null}return n}getBackground(e){const t=this.getLayer();let r=t.getBackground();return"function"===typeof r&&(r=r(e.viewState.resolution)),r||void 0}useContainer(e,t,r){const n=this.getLayer().getClassName();let i,s;if(e&&e.className===n&&(!r||e&&e.style.backgroundColor&&(0,h.fS)((0,a._2)(e.style.backgroundColor),(0,a._2)(r)))){const t=e.firstElementChild;t instanceof HTMLCanvasElement&&(s=t.getContext("2d"))}if(s&&s.canvas.style.transform===t?(this.container=e,this.context=s,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){i=document.createElement("div"),i.className=n;let e=i.style;e.position="absolute",e.width="100%",e.height="100%",s=(0,l.E4)();const t=s.canvas;i.appendChild(t),e=t.style,e.position="absolute",e.left="0",e.transformOrigin="top left",this.container=i,this.context=s}this.containerReused||!r||this.container.style.backgroundColor||(this.container.style.backgroundColor=r)}clipUnrotated(e,t,r){const n=(0,d.rL)(r),i=(0,d.Xv)(r),s=(0,d.w$)(r),a=(0,d.hC)(r);(0,o.nn)(t.coordinateToPixelTransform,n),(0,o.nn)(t.coordinateToPixelTransform,i),(0,o.nn)(t.coordinateToPixelTransform,s),(0,o.nn)(t.coordinateToPixelTransform,a);const l=this.inversePixelTransform;(0,o.nn)(l,n),(0,o.nn)(l,i),(0,o.nn)(l,s),(0,o.nn)(l,a),e.save(),e.beginPath(),e.moveTo(Math.round(n[0]),Math.round(n[1])),e.lineTo(Math.round(i[0]),Math.round(i[1])),e.lineTo(Math.round(s[0]),Math.round(s[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.clip()}dispatchRenderEvent_(e,t,r){const n=this.getLayer();if(n.hasListener(e)){const s=new i.Z(e,this.inversePixelTransform,r,t);n.dispatchEvent(s)}}preRender(e,t){this.frameState=t,this.dispatchRenderEvent_(s.Z.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(s.Z.POSTRENDER,e,t)}getRenderTransform(e,t,r,n,i,s,a){const l=i/2,h=s/2,d=n/t,c=-d,u=-e[0]+a,g=-e[1];return(0,o.qC)(this.tempTransform,l,h,d,c,-r,u,g)}disposeInternal(){delete this.frameState,super.disposeInternal()}}const f=p},8845:(e,t,r)=>{r.d(t,{Z:()=>f});var n=r(57581),i=r(20825),s=r(16675),o=r(2519),a=r(37195),l=r(6101),h=r(65537),d=r(28641),c=r(63432),u=r(74187),g=r(4307);class p extends n.Z{constructor(e){super(e),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=(0,d.lJ)(),this.tmpTileRange_=new o.Z(0,0,0,0)}isDrawableTile(e){const t=this.getLayer(),r=e.getState(),n=t.getUseInterimTilesOnError();return r==a.Z.LOADED||r==a.Z.EMPTY||r==a.Z.ERROR&&!n}getTile(e,t,r,n){const i=n.pixelRatio,s=n.viewState.projection,o=this.getLayer(),l=o.getSource();let h=l.getTile(e,t,r,i,s);return h.getState()==a.Z.ERROR&&o.getUseInterimTilesOnError()&&o.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(h)||(h=h.getInterimTile()),h}getData(e){const t=this.frameState;if(!t)return null;const r=this.getLayer(),n=(0,l.nn)(t.pixelToCoordinateTransform,e.slice()),o=r.getExtent();if(o&&!(0,d.b8)(o,n))return null;const h=t.pixelRatio,c=t.viewState.projection,u=t.viewState,p=r.getRenderSource(),f=p.getTileGridForProjection(u.projection),m=p.getTilePixelRatio(t.pixelRatio);for(let l=f.getZForResolution(u.resolution);l>=f.getMinZoom();--l){const e=f.getTileCoordForCoordAndZ(n,l),t=p.getTile(l,e[1],e[2],h,c);if(!(t instanceof i.Z||t instanceof s.Z)||t instanceof s.Z&&t.getState()===a.Z.EMPTY)return null;if(t.getState()!==a.Z.LOADED)continue;const r=f.getOrigin(l),o=(0,g.Pq)(f.getTileSize(l)),d=f.getResolution(l),T=Math.floor(m*((n[0]-r[0])/d-e[1]*o[0])),_=Math.floor(m*((r[1]-n[1])/d-e[2]*o[1])),x=Math.round(m*p.getGutterForProjection(u.projection));return this.getImageData(t.getImage(),T+x,_+x)}return null}loadedTileCallback(e,t,r){return!!this.isDrawableTile(r)&&super.loadedTileCallback(e,t,r)}prepareFrame(e){return!!this.getLayer().getSource()}renderFrame(e,t){const r=e.layerStatesArray[e.layerIndex],n=e.viewState,i=n.projection,s=n.resolution,o=n.center,g=n.rotation,p=e.pixelRatio,f=this.getLayer(),m=f.getSource(),T=m.getRevision(),_=m.getTileGridForProjection(i),x=_.getZForResolution(s,m.zDirection),R=_.getResolution(x);let y=e.extent;const E=e.viewState.resolution,C=m.getTilePixelRatio(p),S=Math.round((0,d.dz)(y)/E*p),I=Math.round((0,d.Cr)(y)/E*p),v=r.extent&&(0,c.fromUserExtent)(r.extent,i);v&&(y=(0,d.Ed)(y,(0,c.fromUserExtent)(r.extent,i)));const w=R*S/2/C,b=R*I/2/C,P=[o[0]-w,o[1]-b,o[0]+w,o[1]+b],F=_.getTileRangeForExtentAndZ(y,x),A={};A[x]={};const Z=this.createLoadedTileFinder(m,i,A),L=this.tmpExtent,D=this.tmpTileRange_;this.newTiles_=!1;const G=g?(0,d.dY)(n.center,E,g,e.size):void 0;for(let l=F.minX;l<=F.maxX;++l)for(let t=F.minY;t<=F.maxY;++t){if(g&&!_.tileCoordIntersectsViewport([x,l,t],G))continue;const n=this.getTile(x,l,t,e);if(this.isDrawableTile(n)){const t=(0,u.sq)(this);if(n.getState()==a.Z.LOADED){A[x][n.tileCoord.toString()]=n;let e=n.inTransition(t);e&&1!==r.opacity&&(n.endTransition(t),e=!1),this.newTiles_||!e&&this.renderedTiles.includes(n)||(this.newTiles_=!0)}if(1===n.getAlpha(t,e.time))continue}const i=_.getTileCoordChildTileRange(n.tileCoord,D,L);let s=!1;i&&(s=Z(x+1,i)),s||_.forEachTileCoordParentTileRange(n.tileCoord,Z,D,L)}const M=R/s*p/C;(0,l.qC)(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/p,1/p,g,-S/2,-I/2);const O=(0,l.BB)(this.pixelTransform);this.useContainer(t,O,this.getBackground(e));const B=this.context,N=B.canvas;(0,l.nb)(this.inversePixelTransform,this.pixelTransform),(0,l.qC)(this.tempTransform,S/2,I/2,M,M,0,-S/2,-I/2),N.width!=S||N.height!=I?(N.width=S,N.height=I):this.containerReused||B.clearRect(0,0,S,I),v&&this.clipUnrotated(B,e,v),m.getInterpolate()||(B.imageSmoothingEnabled=!1),this.preRender(B,e),this.renderedTiles.length=0;let U,k,z,j=Object.keys(A).map(Number);j.sort(h.j2),1!==r.opacity||this.containerReused&&!m.getOpaque(e.viewState.projection)?(U=[],k=[]):j=j.reverse();for(let a=j.length-1;a>=0;--a){const t=j[a],r=m.getTilePixelSize(t,p,i),n=_.getResolution(t),s=n/R,o=r[0]*s*M,h=r[1]*s*M,c=_.getTileCoordForCoordAndZ((0,d.rL)(P),t),g=_.getTileCoordExtent(c),f=(0,l.nn)(this.tempTransform,[C*(g[0]-P[0])/R,C*(P[3]-g[3])/R]),T=C*m.getGutterForProjection(i),y=A[t];for(const i in y){const r=y[i],n=r.tileCoord,s=c[1]-n[1],a=Math.round(f[0]-(s-1)*o),l=c[2]-n[2],g=Math.round(f[1]-(l-1)*h),p=Math.round(f[0]-s*o),_=Math.round(f[1]-l*h),R=a-p,E=g-_,C=x===t,S=C&&1!==r.getAlpha((0,u.sq)(this),e.time);let I=!1;if(!S)if(U){z=[p,_,p+R,_,p+R,_+E,p,_+E];for(let e=0,r=U.length;e<r;++e)if(x!==t&&t<k[e]){const t=U[e];(0,d.kK)([p,_,p+R,_+E],[t[0],t[3],t[4],t[7]])&&(I||(B.save(),I=!0),B.beginPath(),B.moveTo(z[0],z[1]),B.lineTo(z[2],z[3]),B.lineTo(z[4],z[5]),B.lineTo(z[6],z[7]),B.moveTo(t[6],t[7]),B.lineTo(t[4],t[5]),B.lineTo(t[2],t[3]),B.lineTo(t[0],t[1]),B.clip())}U.push(z),k.push(t)}else B.clearRect(p,_,R,E);this.drawTileImage(r,e,p,_,R,E,T,C),U&&!S?(I&&B.restore(),this.renderedTiles.unshift(r)):this.renderedTiles.push(r),this.updateUsedTiles(e.usedTiles,m,r)}}return this.renderedRevision=T,this.renderedResolution=R,this.extentChanged=!this.renderedExtent_||!(0,d.fS)(this.renderedExtent_,P),this.renderedExtent_=P,this.renderedPixelRatio=p,this.renderedProjection=i,this.manageTilePyramid(e,m,_,p,i,y,x,f.getPreload()),this.scheduleExpireCache(e,m),this.postRender(B,e),r.extent&&B.restore(),B.imageSmoothingEnabled=!0,O!==N.style.transform&&(N.style.transform=O),this.container}drawTileImage(e,t,r,n,i,s,o,a){const l=this.getTileImage(e);if(!l)return;const h=(0,u.sq)(this),d=t.layerStatesArray[t.layerIndex],c=d.opacity*(a?e.getAlpha(h,t.time):1),g=c!==this.context.globalAlpha;g&&(this.context.save(),this.context.globalAlpha=c),this.context.drawImage(l,o,o,l.width-2*o,l.height-2*o,r,n,i,s),g&&this.context.restore(),c!==d.opacity?t.animate=!0:a&&e.endTransition(h)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}scheduleExpireCache(e,t){if(t.canExpireCache()){const r=function(e,t,r){const n=(0,u.sq)(e);n in r.usedTiles&&e.expireCache(r.viewState.projection,r.usedTiles[n])}.bind(null,t);e.postRenderFunctions.push(r)}}updateUsedTiles(e,t,r){const n=(0,u.sq)(t);n in e||(e[n]={}),e[n][r.getKey()]=!0}manageTilePyramid(e,t,r,n,i,s,o,l,h){const c=(0,u.sq)(t);c in e.wantedTiles||(e.wantedTiles[c]={});const g=e.wantedTiles[c],p=e.tileQueue,f=r.getMinZoom(),m=e.viewState.rotation,T=m?(0,d.dY)(e.viewState.center,e.viewState.resolution,m,e.size):void 0;let _,x,R,y,E,C,S=0;for(C=f;C<=o;++C)for(x=r.getTileRangeForExtentAndZ(s,C,x),R=r.getResolution(C),y=x.minX;y<=x.maxX;++y)for(E=x.minY;E<=x.maxY;++E)m&&!r.tileCoordIntersectsViewport([C,y,E],T)||(o-C<=l?(++S,_=t.getTile(C,y,E,n,i),_.getState()==a.Z.IDLE&&(g[_.getKey()]=!0,p.isKeyQueued(_.getKey())||p.enqueue([_,c,r.getTileCoordCenter(_.tileCoord),R])),void 0!==h&&h(_)):t.useTile(C,y,E,i));t.updateCacheSize(S,i)}}const f=p},25682:(e,t,r)=>{r.d(t,{Z:()=>T});var n=r(35570),i=r(57581),s=r(15240),o=r(37755),a=r(12382),l=r(6101),h=r(28641),d=r(68326),c=r(76234),u=r(65537),g=r(63432),p=r(74187),f=r(91900);class m extends i.Z{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=(0,h.lJ)(),this.wrappedRenderedExtent_=(0,h.lJ)(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.declutterExecutorGroup=null,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(e,t,r){const n=t.extent,i=t.viewState,s=i.center,a=i.resolution,l=i.projection,d=i.rotation,c=l.getExtent(),u=this.getLayer().getSource(),g=t.pixelRatio,p=t.viewHints,f=!(p[o.Z.ANIMATING]||p[o.Z.INTERACTING]),m=this.compositionContext_,T=Math.round(t.size[0]*g),_=Math.round(t.size[1]*g),x=u.getWrapX()&&l.canWrapX(),R=x?(0,h.dz)(c):null,y=x?Math.ceil((n[2]-c[2])/R)+1:1;let E=x?Math.floor((n[0]-c[0])/R):0;do{const t=this.getRenderTransform(s,a,d,g,T,_,E*R);e.execute(m,1,t,d,f,void 0,r)}while(++E<y)}setupCompositionContext_(){if(1!==this.opacity_){const e=(0,d.E4)(this.context.canvas.width,this.context.canvas.height,i.r);this.compositionContext_=e}else this.compositionContext_=this.context}releaseCompositionContext_(){if(1!==this.opacity_){const e=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=e,(0,d.jy)(this.compositionContext_),i.r.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(e){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,e,e.declutterTree),this.releaseCompositionContext_())}renderFrame(e,t){const r=e.pixelRatio,n=e.layerStatesArray[e.layerIndex];(0,l.n3)(this.pixelTransform,1/r,1/r),(0,l.nb)(this.inversePixelTransform,this.pixelTransform);const i=(0,l.BB)(this.pixelTransform);this.useContainer(t,i,this.getBackground(e));const s=this.context,o=s.canvas,a=this.replayGroup_,d=this.declutterExecutorGroup;if((!a||a.isEmpty())&&(!d||d.isEmpty()))return null;const c=Math.round(e.size[0]*r),u=Math.round(e.size[1]*r);o.width!=c||o.height!=u?(o.width=c,o.height=u,o.style.transform!==i&&(o.style.transform=i)):this.containerReused||s.clearRect(0,0,c,u),this.preRender(s,e);const p=e.viewState,f=p.projection;this.opacity_=n.opacity,this.setupCompositionContext_();let m=!1,T=!0;if(n.extent&&this.clipping){const t=(0,g.fromUserExtent)(n.extent,f);T=(0,h.kK)(t,e.extent),m=T&&!(0,h.r4)(t,e.extent),m&&this.clipUnrotated(this.compositionContext_,e,t)}return T&&this.renderWorlds(a,e),m&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(s,e),this.renderedRotation_!==p.rotation&&(this.renderedRotation_=p.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(e){return new Promise((t=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const e=[this.context.canvas.width,this.context.canvas.height];(0,l.nn)(this.pixelTransform,e);const t=this.renderedCenter_,r=this.renderedResolution_,n=this.renderedRotation_,i=this.renderedProjection_,s=this.wrappedRenderedExtent_,o=this.getLayer(),d=[],c=e[0]*a.UN,u=e[1]*a.UN;d.push(this.getRenderTransform(t,r,n,a.UN,c,u,0).slice());const g=o.getSource(),p=i.getExtent();if(g.getWrapX()&&i.canWrapX()&&!(0,h.r4)(p,s)){let e=s[0];const i=(0,h.dz)(p);let o,l=0;while(e<p[0])--l,o=i*l,d.push(this.getRenderTransform(t,r,n,a.UN,c,u,o).slice()),e+=i;l=0,e=s[2];while(e>p[2])++l,o=i*l,d.push(this.getRenderTransform(t,r,n,a.UN,c,u,o).slice()),e-=i}this.hitDetectionImageData_=(0,a.TU)(e,d,this.renderedFeatures_,o.getStyleFunction(),s,r,n)}t((0,a.ix)(e,this.renderedFeatures_,this.hitDetectionImageData_))}))}forEachFeatureAtCoordinate(e,t,r,n,i){if(!this.replayGroup_)return;const s=t.viewState.resolution,o=t.viewState.rotation,a=this.getLayer(),l={},h=function(e,t,r){const s=(0,p.sq)(e),o=l[s];if(o){if(!0!==o&&r<o.distanceSq){if(0===r)return l[s]=!0,i.splice(i.lastIndexOf(o),1),n(e,a,t);o.geometry=t,o.distanceSq=r}}else{if(0===r)return l[s]=!0,n(e,a,t);i.push(l[s]={feature:e,layer:a,geometry:t,distanceSq:r,callback:n})}};let d;const c=[this.replayGroup_];return this.declutterExecutorGroup&&c.push(this.declutterExecutorGroup),c.some((n=>d=n.forEachFeatureAtCoordinate(e,s,o,r,h,n===this.declutterExecutorGroup&&t.declutterTree?t.declutterTree.all().map((e=>e.value)):null))),d}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const t=this.getLayer(),r=t.getSource();if(!r)return!1;const i=e.viewHints[o.Z.ANIMATING],a=e.viewHints[o.Z.INTERACTING],l=t.getUpdateWhileAnimating(),d=t.getUpdateWhileInteracting();if(this.ready&&!l&&i||!d&&a)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const p=e.extent,m=e.viewState,T=m.projection,_=m.resolution,x=e.pixelRatio,R=t.getRevision(),y=t.getRenderBuffer();let E=t.getRenderOrder();void 0===E&&(E=c.eR);const C=m.center.slice(),S=(0,h.f3)(p,y*_),I=S.slice(),v=[S.slice()],w=T.getExtent();if(r.getWrapX()&&T.canWrapX()&&!(0,h.r4)(w,e.extent)){const e=(0,h.dz)(w),t=Math.max((0,h.dz)(S)/2,e);S[0]=w[0]-t,S[2]=w[2]+t,(0,f.Cf)(C,T);const r=(0,h.Cf)(v[0],T);r[0]<w[0]&&r[2]<w[2]?v.push([r[0]+e,r[1],r[2]+e,r[3]]):r[0]>w[0]&&r[2]>w[2]&&v.push([r[0]-e,r[1],r[2]-e,r[3]])}if(this.ready&&this.renderedResolution_==_&&this.renderedRevision_==R&&this.renderedRenderOrder_==E&&(0,h.r4)(this.wrappedRenderedExtent_,S))return(0,u.fS)(this.renderedExtent_,I)||(this.hitDetectionImageData_=null,this.renderedExtent_=I),this.renderedCenter_=C,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const b=new n.Z((0,c.Qz)(_,x),S,_,x);let P;this.getLayer().getDeclutter()&&(P=new n.Z((0,c.Qz)(_,x),S,_,x));const F=(0,g.getUserProjection)();let A;if(F){for(let e=0,t=v.length;e<t;++e){const t=v[e],n=(0,g.toUserExtent)(t,T);r.loadFeatures(n,(0,g.toUserResolution)(_,T),F)}A=(0,g.getTransformFromProjections)(F,T)}else for(let n=0,s=v.length;n<s;++n)r.loadFeatures(v[n],_,T);const Z=(0,c.se)(_,x);let L=!0;const D=e=>{let r;const n=e.getStyleFunction()||t.getStyleFunction();if(n&&(r=n(e,_)),r){const t=this.renderFeature(e,Z,r,b,A,P);L=L&&!t}},G=(0,g.toUserExtent)(S,T),M=r.getFeaturesInExtent(G);E&&M.sort(E);for(let n=0,s=M.length;n<s;++n)D(M[n]);this.renderedFeatures_=M,this.ready=L;const O=b.finish(),B=new s.Z(S,_,x,r.getOverlaps(),O,t.getRenderBuffer());return P&&(this.declutterExecutorGroup=new s.Z(S,_,x,r.getOverlaps(),P.finish(),t.getRenderBuffer())),this.renderedResolution_=_,this.renderedRevision_=R,this.renderedRenderOrder_=E,this.renderedExtent_=I,this.wrappedRenderedExtent_=S,this.renderedCenter_=C,this.renderedProjection_=T,this.replayGroup_=B,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,r,n,i,s){if(!r)return!1;let o=!1;if(Array.isArray(r))for(let a=0,l=r.length;a<l;++a)o=(0,c.Pn)(n,e,r[a],t,this.boundHandleStyleImageChange_,i,s)||o;else o=(0,c.Pn)(n,e,r,t,this.boundHandleStyleImageChange_,i,s);return o}}const T=m},85980:(e,t,r)=>{r.d(t,{Z:()=>_});var n=r(35570),i=r(15240),s=r(8845),o=r(37195),a=r(37755),l=r(12382),h=r(6101),d=r(28641),c=r(76234),u=r(74187),g=r(4307),p=r(91900);const f={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},m={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class T extends s.Z{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.tmpTransform_=(0,h.Ue)()}prepareTile(e,t,r){let n;const i=e.getState();return i!==o.Z.LOADED&&i!==o.Z.ERROR||(this.updateExecutorGroup_(e,t,r),this.tileImageNeedsRender_(e)&&(n=!0)),n}getTile(e,t,r,n){const i=n.pixelRatio,s=n.viewState,o=s.resolution,l=s.projection,h=this.getLayer(),d=h.getSource().getTile(e,t,r,i,l),c=n.viewHints,u=!(c[a.Z.ANIMATING]||c[a.Z.INTERACTING]);!u&&d.wantedResolution||(d.wantedResolution=o);const g=this.prepareTile(d,i,l);return g&&(u||Date.now()-n.time<8)&&"vector"!==h.getRenderMode()&&this.renderTileImage_(d,n),super.getTile(e,t,r,n)}isDrawableTile(e){const t=this.getLayer();return super.isDrawableTile(e)&&("vector"===t.getRenderMode()?(0,u.sq)(t)in e.executorGroups:e.hasContext(t))}getTileImage(e){return e.getImage(this.getLayer())}prepareFrame(e){const t=this.getLayer().getRevision();return this.renderedLayerRevision_!==t&&(this.renderedLayerRevision_=t,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,t,r){const s=this.getLayer(),a=s.getRevision(),l=s.getRenderOrder()||null,h=e.wantedResolution,g=e.getReplayState(s);if(!g.dirty&&g.renderedResolution===h&&g.renderedRevision==a&&g.renderedRenderOrder==l)return;const p=s.getSource(),f=s.getDeclutter(),m=p.getTileGrid(),T=p.getTileGridForProjection(r),_=T.getTileCoordExtent(e.wrappedTileCoord),x=p.getSourceTiles(t,r,e),R=(0,u.sq)(s);delete e.hitDetectionImageData[R],e.executorGroups[R]=[],f&&(e.declutterExecutorGroups[R]=[]),g.dirty=!1;for(let u=0,y=x.length;u<y;++u){const r=x[u];if(r.getState()!=o.Z.LOADED)continue;const a=r.tileCoord,T=m.getTileCoordExtent(a),y=(0,d.Ed)(_,T),E=(0,d.f3)(y,s.getRenderBuffer()*h,this.tmpExtent),C=(0,d.fS)(T,y)?null:E,S=new n.Z(0,E,h,t),I=f?new n.Z(0,y,h,t):void 0,v=(0,c.se)(h,t),w=function(e){let t;const r=e.getStyleFunction()||s.getStyleFunction();if(r&&(t=r(e,h)),t){const r=this.renderFeature(e,v,t,S,I);g.dirty=g.dirty||r}},b=r.getFeatures();l&&l!==g.renderedRenderOrder&&b.sort(l);for(let e=0,t=b.length;e<t;++e){const t=b[e];C&&!(0,d.kK)(C,t.getGeometry().getExtent())||w.call(this,t)}const P=S.finish(),F="vector"!==s.getRenderMode()&&f&&1===x.length?null:y,A=new i.Z(F,h,t,p.getOverlaps(),P,s.getRenderBuffer());if(e.executorGroups[R].push(A),I){const r=new i.Z(null,h,t,p.getOverlaps(),I.finish(),s.getRenderBuffer());e.declutterExecutorGroups[R].push(r)}}g.renderedRevision=a,g.renderedRenderOrder=l,g.renderedResolution=h}forEachFeatureAtCoordinate(e,t,r,n,i){const s=t.viewState.resolution,o=t.viewState.rotation;r=void 0==r?0:r;const a=this.getLayer(),l=a.getSource(),h=l.getTileGridForProjection(t.viewState.projection),c=(0,d.hI)([e]);(0,d.f3)(c,s*r,c);const g={},p=function(e,t,r){let s=e.getId();void 0===s&&(s=(0,u.sq)(e));const o=g[s];if(o){if(!0!==o&&r<o.distanceSq){if(0===r)return g[s]=!0,i.splice(i.lastIndexOf(o),1),n(e,a,t);o.geometry=t,o.distanceSq=r}}else{if(0===r)return g[s]=!0,n(e,a,t);i.push(g[s]={feature:e,layer:a,geometry:t,distanceSq:r,callback:n})}},f=this.renderedTiles;let m;for(let T=0,_=f.length;!m&&T<_;++T){const n=f[T],i=h.getTileCoordExtent(n.wrappedTileCoord);if(!(0,d.kK)(i,c))continue;const l=(0,u.sq)(a),g=[n.executorGroups[l]],_=n.declutterExecutorGroups[l];_&&g.push(_),g.some((n=>{const i=n===_?t.declutterTree.all().map((e=>e.value)):null;for(let t=0,a=n.length;t<a;++t){const a=n[t];if(m=a.forEachFeatureAtCoordinate(e,s,o,r,p,i),m)return!0}}))}return m}getFeatures(e){return new Promise(((t,r)=>{const n=this.getLayer(),i=(0,u.sq)(n),s=n.getSource(),a=this.renderedProjection,c=a.getExtent(),f=this.renderedResolution,m=s.getTileGridForProjection(a),T=(0,h.nn)(this.renderedPixelToCoordinateTransform_,e.slice()),_=m.getTileCoordForCoordAndResolution(T,f);let x;for(let e=0,l=this.renderedTiles.length;e<l;++e)if(_.toString()===this.renderedTiles[e].tileCoord.toString()){if(x=this.renderedTiles[e],x.getState()===o.Z.LOADED){const e=m.getTileCoordExtent(x.tileCoord);s.getWrapX()&&a.canWrapX()&&!(0,d.r4)(c,e)&&(0,p.Cf)(T,a);break}x=void 0}if(!x||x.loadingSourceTiles>0)return void t([]);const R=m.getTileCoordExtent(x.wrappedTileCoord),y=(0,d.rL)(R),E=[(T[0]-y[0])/f,(y[1]-T[1])/f],C=x.getSourceTiles().reduce((function(e,t){return e.concat(t.getFeatures())}),[]);let S=x.hitDetectionImageData[i];if(!S){const e=(0,g.Pq)(m.getTileSize(m.getZForResolution(f,s.zDirection))),t=this.renderedRotation_,r=[this.getRenderTransform(m.getTileCoordCenter(x.wrappedTileCoord),f,0,l.UN,e[0]*l.UN,e[1]*l.UN,0)];S=(0,l.TU)(e,r,C,n.getStyleFunction(),m.getTileCoordExtent(x.wrappedTileCoord),x.getReplayState(n).renderedResolution,t),x.hitDetectionImageData[i]=S}t((0,l.ix)(E,C,S))}))}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&void 0!==this.renderedLayerRevision_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e){const t=this.context,r=t.globalAlpha;t.globalAlpha=this.getLayer().getOpacity();const n=e.viewHints,i=!(n[a.Z.ANIMATING]||n[a.Z.INTERACTING]),s=this.renderedTiles;for(let o=0,a=s.length;o<a;++o){const t=s[o],r=t.declutterExecutorGroups[(0,u.sq)(this.getLayer())];if(r)for(let n=r.length-1;n>=0;--n)r[n].execute(this.context,1,this.getTileRenderTransform(t,e),e.viewState.rotation,i,void 0,e.declutterTree)}t.globalAlpha=r}getTileRenderTransform(e,t){const r=t.pixelRatio,n=t.viewState,i=n.center,s=n.resolution,o=n.rotation,a=t.size,l=Math.round(a[0]*r),d=Math.round(a[1]*r),c=this.getLayer().getSource(),u=c.getTileGridForProjection(t.viewState.projection),g=e.tileCoord,p=u.getTileCoordExtent(e.wrappedTileCoord),f=u.getTileCoordExtent(g,this.tmpExtent)[0]-p[0],m=(0,h.Jp)((0,h.bA)(this.inversePixelTransform.slice(),1/r,1/r),this.getRenderTransform(i,s,o,r,l,d,f));return m}postRender(e,t){const r=t.viewHints,n=!(r[a.Z.ANIMATING]||r[a.Z.INTERACTING]);this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation;const i=this.getLayer(),s=i.getRenderMode(),o=e.globalAlpha;e.globalAlpha=i.getOpacity();const l=m[s],h=t.viewState,c=h.rotation,g=i.getSource(),p=g.getTileGridForProjection(h.projection),f=p.getZForResolution(h.resolution,g.zDirection),T=this.renderedTiles,_=[],x=[];let R=!0;for(let a=T.length-1;a>=0;--a){const r=T[a];R=R&&!r.getReplayState(i).dirty;const s=r.executorGroups[(0,u.sq)(i)].filter((e=>e.hasExecutors(l)));if(0===s.length)continue;const o=this.getTileRenderTransform(r,t),h=r.tileCoord[0];let g=!1;const p=s[0].getClipCoords(o);if(p){for(let t=0,r=_.length;t<r;++t)if(f!==h&&h<x[t]){const r=_[t];(0,d.kK)([p[0],p[3],p[4],p[7]],[r[0],r[3],r[4],r[7]])&&(g||(e.save(),g=!0),e.beginPath(),e.moveTo(p[0],p[1]),e.lineTo(p[2],p[3]),e.lineTo(p[4],p[5]),e.lineTo(p[6],p[7]),e.moveTo(r[6],r[7]),e.lineTo(r[4],r[5]),e.lineTo(r[2],r[3]),e.lineTo(r[0],r[1]),e.clip())}_.push(p),x.push(h)}for(let t=0,i=s.length;t<i;++t){const r=s[t];r.execute(e,1,o,c,n,l)}g&&e.restore()}e.globalAlpha=o,this.ready=R,super.postRender(e,t)}renderFeature(e,t,r,n,i){if(!r)return!1;let s=!1;if(Array.isArray(r))for(let o=0,a=r.length;o<a;++o)s=(0,c.Pn)(n,e,r[o],t,this.boundHandleStyleImageChange_,void 0,i)||s;else s=(0,c.Pn)(n,e,r,t,this.boundHandleStyleImageChange_,void 0,i);return s}tileImageNeedsRender_(e){const t=this.getLayer();if("vector"===t.getRenderMode())return!1;const r=e.getReplayState(t),n=t.getRevision(),i=e.wantedResolution;return r.renderedTileResolution!==i||r.renderedTileRevision!==n}renderTileImage_(e,t){const r=this.getLayer(),n=e.getReplayState(r),i=r.getRevision(),s=e.executorGroups[(0,u.sq)(r)];n.renderedTileRevision=i;const o=e.wrappedTileCoord,a=o[0],l=r.getSource();let d=t.pixelRatio;const c=t.viewState,g=c.projection,p=l.getTileGridForProjection(g),m=p.getResolution(e.tileCoord[0]),T=t.pixelRatio/e.wantedResolution*m,_=p.getResolution(a),x=e.getContext(r);d=Math.round(Math.max(d,T/d));const R=l.getTilePixelSize(a,d,g);x.canvas.width=R[0],x.canvas.height=R[1];const y=d/T;if(1!==y){const e=(0,h.mc)(this.tmpTransform_);(0,h.bA)(e,y,y),x.setTransform.apply(x,e)}const E=p.getTileCoordExtent(o,this.tmpExtent),C=T/_,S=(0,h.mc)(this.tmpTransform_);(0,h.bA)(S,C,-C),(0,h.Iu)(S,-E[0],-E[3]);for(let h=0,u=s.length;h<u;++h){const e=s[h];e.execute(x,y,S,0,!0,f[r.getRenderMode()])}n.renderedTileResolution=e.wantedResolution}}const _=T},76234:(e,t,r)=>{r.d(t,{Pn:()=>c,Qz:()=>h,eR:()=>a,se:()=>l});var n=r(70553),i=r(74187);const s=.5,o={Point:_,LineString:f,Polygon:R,MultiPoint:x,MultiLineString:m,MultiPolygon:T,GeometryCollection:p,Circle:d};function a(e,t){return parseInt((0,i.sq)(e),10)-parseInt((0,i.sq)(t),10)}function l(e,t){const r=h(e,t);return r*r}function h(e,t){return s*e/t}function d(e,t,r,n,i){const s=r.getFill(),o=r.getStroke();if(s||o){const i=e.getBuilder(r.getZIndex(),"Circle");i.setFillStrokeStyle(s,o),i.drawCircle(t,n)}const a=r.getText();if(a&&a.getText()){const s=(i||e).getBuilder(r.getZIndex(),"Text");s.setTextStyle(a),s.drawText(t,n)}}function c(e,t,r,i,s,o,a){let l=!1;const h=r.getImage();if(h){const e=h.getImageState();e==n.Z.LOADED||e==n.Z.ERROR?h.unlistenImageChange(s):(e==n.Z.IDLE&&h.load(),h.listenImageChange(s),l=!0)}return u(e,t,r,i,o,a),l}function u(e,t,r,n,i,s){const a=r.getGeometryFunction()(t);if(!a)return;const l=a.simplifyTransformed(n,i),h=r.getRenderer();if(h)g(e,l,r,t);else{const n=o[l.getType()];n(e,l,r,t,s)}}function g(e,t,r,n){if("GeometryCollection"==t.getType()){const i=t.getGeometries();for(let t=0,s=i.length;t<s;++t)g(e,i[t],r,n);return}const i=e.getBuilder(r.getZIndex(),"Default");i.drawCustom(t,n,r.getRenderer(),r.getHitDetectionRenderer())}function p(e,t,r,n,i){const s=t.getGeometriesArray();let a,l;for(a=0,l=s.length;a<l;++a){const t=o[s[a].getType()];t(e,s[a],r,n,i)}}function f(e,t,r,n,i){const s=r.getStroke();if(s){const i=e.getBuilder(r.getZIndex(),"LineString");i.setFillStrokeStyle(null,s),i.drawLineString(t,n)}const o=r.getText();if(o&&o.getText()){const s=(i||e).getBuilder(r.getZIndex(),"Text");s.setTextStyle(o),s.drawText(t,n)}}function m(e,t,r,n,i){const s=r.getStroke();if(s){const i=e.getBuilder(r.getZIndex(),"LineString");i.setFillStrokeStyle(null,s),i.drawMultiLineString(t,n)}const o=r.getText();if(o&&o.getText()){const s=(i||e).getBuilder(r.getZIndex(),"Text");s.setTextStyle(o),s.drawText(t,n)}}function T(e,t,r,n,i){const s=r.getFill(),o=r.getStroke();if(o||s){const i=e.getBuilder(r.getZIndex(),"Polygon");i.setFillStrokeStyle(s,o),i.drawMultiPolygon(t,n)}const a=r.getText();if(a&&a.getText()){const s=(i||e).getBuilder(r.getZIndex(),"Text");s.setTextStyle(a),s.drawText(t,n)}}function _(e,t,r,i,s){const o=r.getImage(),a=r.getText();let l;if(o){if(o.getImageState()!=n.Z.LOADED)return;let h=e;if(s){const n=o.getDeclutterMode();if("none"!==n)if(h=s,"obstacle"===n){const n=e.getBuilder(r.getZIndex(),"Image");n.setImageStyle(o,l),n.drawPoint(t,i)}else a&&a.getText()&&(l={})}const d=h.getBuilder(r.getZIndex(),"Image");d.setImageStyle(o,l),d.drawPoint(t,i)}if(a&&a.getText()){let n=e;s&&(n=s);const o=n.getBuilder(r.getZIndex(),"Text");o.setTextStyle(a,l),o.drawText(t,i)}}function x(e,t,r,i,s){const o=r.getImage(),a=r.getText();let l;if(o){if(o.getImageState()!=n.Z.LOADED)return;let h=e;if(s){const n=o.getDeclutterMode();if("none"!==n)if(h=s,"obstacle"===n){const n=e.getBuilder(r.getZIndex(),"Image");n.setImageStyle(o,l),n.drawMultiPoint(t,i)}else a&&a.getText()&&(l={})}const d=h.getBuilder(r.getZIndex(),"Image");d.setImageStyle(o,l),d.drawMultiPoint(t,i)}if(a&&a.getText()){let n=e;s&&(n=s);const o=n.getBuilder(r.getZIndex(),"Text");o.setTextStyle(a,l),o.drawText(t,i)}}function R(e,t,r,n,i){const s=r.getFill(),o=r.getStroke();if(s||o){const i=e.getBuilder(r.getZIndex(),"Polygon");i.setFillStrokeStyle(s,o),i.drawPolygon(t,n)}const a=r.getText();if(a&&a.getText()){const s=(i||e).getBuilder(r.getZIndex(),"Text");s.setTextStyle(a),s.drawText(t,n)}}},35455:(e,t,r)=>{r.d(t,{Z:()=>d});var n=r(71912),i=r(10115),s=r(57380),o=r(98771),a=r(37751),l=r(6101);class h extends i.Z{constructor(e,t){super(e),t=t||{},this.inversePixelTransform_=(0,l.Ue)(),this.pixelContext_=null,this.postProcesses_=t.postProcesses,this.uniforms_=t.uniforms,this.helper,e.addChangeListener(n.Z.MAP,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(e,t){const r=this.getLayer();if(r.hasListener(o.Z.PRECOMPOSE)){const n=new s.Z(o.Z.PRECOMPOSE,void 0,t,e);r.dispatchEvent(n)}}dispatchPostComposeEvent(e,t){const r=this.getLayer();if(r.hasListener(o.Z.POSTCOMPOSE)){const n=new s.Z(o.Z.POSTCOMPOSE,void 0,t,e);r.dispatchEvent(n)}}reset(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(e){if(this.getLayer().getRenderSource()){let t,r=!0,n=-1;for(let s=0,o=e.layerStatesArray.length;s<o;s++){const i=e.layerStatesArray[s].layer,o=i.getRenderer();if(!(o instanceof h)){r=!0;continue}const a=i.getClassName();if((r||a!==t)&&(n+=1,r=!1),t=a,o===this)break}const i="map/"+e.mapId+"/group/"+n;this.helper&&this.helper.canvasCacheKeyMatches(i)||(this.removeHelper(),this.helper=new a.ZP({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:i}),t&&(this.helper.getCanvas().className=t),this.afterHelperCreated())}return this.prepareFrameInternal(e)}afterHelperCreated(){}prepareFrameInternal(e){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(e,t,r){const n=this.getLayer();if(n.hasListener(e)){(0,l.qC)(this.inversePixelTransform_,0,0,r.pixelRatio,-r.pixelRatio,0,0,-r.size[1]);const i=new s.Z(e,this.inversePixelTransform_,r,t);n.dispatchEvent(i)}}preRender(e,t){this.dispatchRenderEvent_(o.Z.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(o.Z.POSTRENDER,e,t)}}const d=h},70961:(e,t,r)=>{r.d(t,{Z:()=>y});var n=r(12582),i=r(22796),s=r(37755),o=r(22988),a=r(35455),l=r(60931),h=r(41536),d=r(37751);const c={GENERATE_POLYGON_BUFFERS:"GENERATE_POLYGON_BUFFERS",GENERATE_POINT_BUFFERS:"GENERATE_POINT_BUFFERS",GENERATE_LINE_STRING_BUFFERS:"GENERATE_LINE_STRING_BUFFERS"};var u=r(6101),g=r(99515),p=r(28641);r(9187);function f(e,t){t=t||[];const r=256,n=r-1;return t[0]=Math.floor(e/r/r/r)/n,t[1]=Math.floor(e/r/r)%r/n,t[2]=Math.floor(e/r)%r/n,t[3]=e%r/n,t}function m(e){let t=0;const r=256,n=r-1;return t+=Math.round(e[0]*r*r*r*n),t+=Math.round(e[1]*r*r*n),t+=Math.round(e[2]*r*n),t+=Math.round(e[3]*n),t}var T=r(21025),_=r(74187),x=r(65818);class R extends a.Z{constructor(e,t){const r=t.uniforms||{},n=(0,u.Ue)();r[d.ZC.PROJECTION_MATRIX]=n,super(e,{uniforms:r,postProcesses:t.postProcesses}),this.ready=!1,this.sourceRevision_=-1,this.verticesBuffer_=new o.ZP(h.qO,h.kd),this.hitVerticesBuffer_=new o.ZP(h.qO,h.kd),this.indicesBuffer_=new o.ZP(h.cX,h.kd),this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.program_,this.hitDetectionEnabled_=!(!t.hitFragmentShader||!t.hitVertexShader),this.hitVertexShader_=t.hitVertexShader,this.hitFragmentShader_=t.hitFragmentShader,this.hitProgram_;const s=t.attributes?t.attributes.map((function(e){return{name:"a_"+e.name,size:1,type:d.GC.FLOAT}})):[];this.attributes=[{name:"a_position",size:2,type:d.GC.FLOAT},{name:"a_index",size:1,type:d.GC.FLOAT}].concat(s),this.hitDetectionAttributes=[{name:"a_position",size:2,type:d.GC.FLOAT},{name:"a_index",size:1,type:d.GC.FLOAT},{name:"a_hitColor",size:4,type:d.GC.FLOAT},{name:"a_featureUid",size:1,type:d.GC.FLOAT}].concat(s),this.customAttributes=t.attributes?t.attributes:[],this.previousExtent_=(0,p.lJ)(),this.currentTransform_=n,this.renderTransform_=(0,u.Ue)(),this.invertRenderTransform_=(0,u.Ue)(),this.renderInstructions_=new Float32Array(0),this.hitRenderInstructions_=new Float32Array(0),this.hitRenderTarget_,this.generateBuffersRun_=0,this.worker_=(0,T.U)(),this.worker_.addEventListener("message",(e=>{const t=e.data;if(t.type===c.GENERATE_POINT_BUFFERS){const r=t.projectionTransform;t.hitDetection?(this.hitVerticesBuffer_.fromArrayBuffer(t.vertexBuffer),this.helper.flushBufferData(this.hitVerticesBuffer_)):(this.verticesBuffer_.fromArrayBuffer(t.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_)),this.indicesBuffer_.fromArrayBuffer(t.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=r,(0,u.nb)(this.invertRenderTransform_,this.renderTransform_),t.hitDetection?this.hitRenderInstructions_=new Float32Array(e.data.renderInstructions):(this.renderInstructions_=new Float32Array(e.data.renderInstructions),t.generateBuffersRun===this.generateBuffersRun_&&(this.ready=!0)),this.getLayer().changed()}})),this.featureCache_={},this.featureCount_=0;const a=this.getLayer().getSource();this.sourceListenKeys_=[(0,x.oL)(a,i.Z.ADDFEATURE,this.handleSourceFeatureAdded_,this),(0,x.oL)(a,i.Z.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),(0,x.oL)(a,i.Z.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),(0,x.oL)(a,i.Z.CLEAR,this.handleSourceFeatureClear_,this)],a.forEachFeature((e=>{this.featureCache_[(0,_.sq)(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()},this.featureCount_++}))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitProgram_=this.helper.getProgram(this.hitFragmentShader_,this.hitVertexShader_),this.hitRenderTarget_=new l.Z(this.helper))}handleSourceFeatureAdded_(e){const t=e.feature;this.featureCache_[(0,_.sq)(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()},this.featureCount_++}handleSourceFeatureChanged_(e){const t=e.feature;this.featureCache_[(0,_.sq)(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()}}handleSourceFeatureDelete_(e){const t=e.feature;delete this.featureCache_[(0,_.sq)(t)],this.featureCount_--}handleSourceFeatureClear_(){this.featureCache_={},this.featureCount_=0}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e);const r=e.viewState.projection,n=this.getLayer(),i=n.getSource(),s=i.getWrapX()&&r.canWrapX(),o=r.getExtent(),a=e.extent,l=s?(0,p.dz)(o):null,h=s?Math.ceil((a[2]-o[2])/l)+1:1,d=s?Math.floor((a[0]-o[0])/l):0;let c=d;const g=this.indicesBuffer_.getSize();do{this.helper.makeProjectionTransform(e,this.currentTransform_),(0,u.Iu)(this.currentTransform_,c*l,0),(0,u.Jp)(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(e),this.helper.drawElements(0,g)}while(++c<h);this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const f=this.helper.getCanvas();return this.hitDetectionEnabled_&&(this.renderHitDetection(e,d,h,l),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e),f}prepareFrameInternal(e){const t=this.getLayer(),r=t.getSource(),i=e.viewState,o=!e.viewHints[s.Z.ANIMATING]&&!e.viewHints[s.Z.INTERACTING],a=!(0,p.fS)(this.previousExtent_,e.extent),l=this.sourceRevision_<r.getRevision();if(l&&(this.sourceRevision_=r.getRevision()),o&&(a||l)){const s=i.projection,o=i.resolution,a=t instanceof n.Z?t.getRenderBuffer():0,l=(0,p.f3)(e.extent,a*o);r.loadFeatures(l,o,s),this.rebuildBuffers_(e),this.previousExtent_=e.extent.slice()}return this.helper.useProgram(this.program_,e),this.helper.prepareDraw(e),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0}rebuildBuffers_(e){const t=(0,u.Ue)();this.helper.makeProjectionTransform(e,t);const r=(2+this.customAttributes.length)*this.featureCount_;if(this.renderInstructions_&&this.renderInstructions_.length===r||(this.renderInstructions_=new Float32Array(r)),this.hitDetectionEnabled_){const e=(7+this.customAttributes.length)*this.featureCount_;this.hitRenderInstructions_&&this.hitRenderInstructions_.length===e||(this.hitRenderInstructions_=new Float32Array(e))}let n,i;const s=[],o=[];let a,l=0,h=0;for(const c in this.featureCache_){if(n=this.featureCache_[c],i=n.geometry,!i||"Point"!==i.getType())continue;let e;s[0]=i.getFlatCoordinates()[0],s[1]=i.getFlatCoordinates()[1],(0,u.nn)(t,s),a=f(h+6,o),this.renderInstructions_[l++]=s[0],this.renderInstructions_[l++]=s[1],this.hitDetectionEnabled_&&(this.hitRenderInstructions_[h++]=s[0],this.hitRenderInstructions_[h++]=s[1],this.hitRenderInstructions_[h++]=a[0],this.hitRenderInstructions_[h++]=a[1],this.hitRenderInstructions_[h++]=a[2],this.hitRenderInstructions_[h++]=a[3],this.hitRenderInstructions_[h++]=Number(c));for(let t=0;t<this.customAttributes.length;t++)e=this.customAttributes[t].callback(n.feature,n.properties),this.renderInstructions_[l++]=e,this.hitDetectionEnabled_&&(this.hitRenderInstructions_[h++]=e)}const d={id:0,type:c.GENERATE_POINT_BUFFERS,renderInstructions:this.renderInstructions_.buffer,customAttributesCount:this.customAttributes.length};if(d["projectionTransform"]=t,d["generateBuffersRun"]=++this.generateBuffersRun_,this.ready=!1,this.worker_.postMessage(d,[this.renderInstructions_.buffer]),this.renderInstructions_=null,this.hitDetectionEnabled_){const e={id:0,type:c.GENERATE_POINT_BUFFERS,renderInstructions:this.hitRenderInstructions_.buffer,customAttributesCount:5+this.customAttributes.length};e["projectionTransform"]=t,e["hitDetection"]=!0,this.worker_.postMessage(e,[this.hitRenderInstructions_.buffer]),this.hitRenderInstructions_=null}}forEachFeatureAtCoordinate(e,t,r,n,i){if((0,g.h)(this.hitDetectionEnabled_,66),!this.hitRenderInstructions_)return;const s=(0,u.nn)(t.coordinateToPixelTransform,e.slice()),o=this.hitRenderTarget_.readPixel(s[0]/2,s[1]/2),a=[o[0]/255,o[1]/255,o[2]/255,o[3]/255],l=m(a),h=this.hitRenderInstructions_[l],d=Math.floor(h).toString(),c=this.getLayer().getSource(),p=c.getFeatureByUid(d);return p?n(p,this.getLayer(),null):void 0}renderHitDetection(e,t,r,n){if(!this.hitVerticesBuffer_.getSize())return;let i=t;this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.useProgram(this.hitProgram_,e),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0),this.helper.bindBuffer(this.hitVerticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.hitDetectionAttributes);do{this.helper.makeProjectionTransform(e,this.currentTransform_),(0,u.Iu)(this.currentTransform_,i*n,0),(0,u.Jp)(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(e);const t=this.indicesBuffer_.getSize();this.helper.drawElements(0,t)}while(++i<r)}disposeInternal(){this.worker_.terminate(),this.layer_=null,this.sourceListenKeys_.forEach((function(e){(0,x.bN)(e)})),this.sourceListenKeys_=null,super.disposeInternal()}}const y=R}}]);
//# sourceMappingURL=5918.f4fd0ddb.js.map