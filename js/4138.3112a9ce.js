(globalThis["webpackChunk_openeo_web_editor"]=globalThis["webpackChunk_openeo_web_editor"]||[]).push([[4138],{20530:function(t,e,n){var r=n(25108);
/*!
 * @kirtandesai/ol-geocoder - v5.0.3
 * A geocoder extension compatible with OpenLayers v7.
 * https://github.com/kirtan-desai/ol-geocoder
 * Built: Thu Nov 17 2022 14:58:35 GMT-0500 (Eastern Standard Time)
 */!function(e,r){t.exports=r(n(88775),n(47539),n(81332),n(92371),n(22556),n(60188),n(81090),n(63432))}(0,(function(t,e,n,i,s,o,a,l){"use strict";function c(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var u=c(t),h=c(e),d=c(n),g=c(i),f=c(s),p=c(o),m=c(a),_=c(l),T="gcd-container",y="gcd-button-control",E="gcd-input-query",R="gcd-input-reset",v={namespace:"ol-geocoder",spin:"gcd-pseudo-rotate",hidden:"gcd-hidden",address:"gcd-address",country:"gcd-country",city:"gcd-city",road:"gcd-road",olControl:"ol-control",glass:{container:"gcd-gl-container",control:"gcd-gl-control",button:"gcd-gl-btn",input:"gcd-gl-input",expanded:"gcd-gl-expanded",reset:"gcd-gl-reset",result:"gcd-gl-result"},inputText:{container:"gcd-txt-container",control:"gcd-txt-control",input:"gcd-txt-input",reset:"gcd-txt-reset",icon:"gcd-txt-glass",result:"gcd-txt-result"}},w={containerId:T,buttonControlId:y,inputQueryId:E,inputResetId:R,cssClasses:v};const x=Object.freeze({__proto__:null,containerId:T,buttonControlId:y,inputQueryId:E,inputResetId:R,cssClasses:v,default:w}),S="addresschosen",b="nominatim",D="reverse",N="glass-button",C="text-input",A="osm",L="mapquest",I="photon",M="bing",$="opencage",O={provider:A,placeholder:"Search for an address",featureStyle:null,targetType:N,lang:"en-US",limit:5,keepOpen:!1,preventDefault:!1,autoComplete:!1,autoCompleteMinLength:2,autoCompleteTimeout:200,debug:!1};function P(t,e="Assertion failed"){if(!t){if("undefined"!=typeof Error)throw new Error(e);throw e}}function G(t){const e=function(){if("performance"in window==0&&(window.performance={}),"now"in window.performance==0){let t=Date.now();performance.timing&&performance.timing.navigationStart&&(t=performance.timing.navigationStart),window.performance.now=()=>Date.now()-t}return window.performance.now()}().toString(36);return t?t+e:e}function U(t){return/^\d+$/u.test(t)}function F(t,e,n){if(Array.isArray(t))return void t.forEach((t=>F(t,e)));const r=Array.isArray(e)?e:e.split(/\s+/u);let i=r.length;for(;i--;)Z(t,r[i])||z(t,r[i],n)}function j(t,e,n){if(Array.isArray(t))return void t.forEach((t=>j(t,e,n)));const r=Array.isArray(e)?e:e.split(/\s+/u);let i=r.length;for(;i--;)Z(t,r[i])&&q(t,r[i],n)}function Z(t,e){return t.classList?t.classList.contains(e):X(e).test(t.className)}function B(t,e){return t.replace(/\{\s*([\w-]+)\s*\}/gu,((t,n)=>{const r=void 0===e[n]?"":e[n];return String(r).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}))}function k(t,e){let n;if(Array.isArray(t)){if(n=document.createElement(t[0]),t[1].id&&(n.id=t[1].id),t[1].classname&&(n.className=t[1].classname),t[1].attr){const{attr:e}=t[1];if(Array.isArray(e)){let t=-1;for(;++t<e.length;)n.setAttribute(e[t].name,e[t].value)}else n.setAttribute(e.name,e.value)}}else n=document.createElement(t);n.innerHTML=e;const r=document.createDocumentFragment();for(;n.childNodes[0];)r.append(n.childNodes[0]);return n.append(r),n}function X(t){return new RegExp(`(^|\\s+) ${t} (\\s+|$)`,"u")}function z(t,e,n){t.classList?t.classList.add(e):t.className=`${t.className} ${e}`.trim(),n&&U(n)&&window.setTimeout((()=>q(t,e)),n)}function q(t,e,n){t.classList?t.classList.remove(e):t.className=t.className.replace(X(e)," ").trim(),n&&U(n)&&window.setTimeout((()=>z(t,e)),n)}const H=x.cssClasses;class V{constructor(t){this.options=t,this.els=this.createControl()}createControl(){let t,e,n;return this.options.targetType===C?(e=`${H.namespace} ${H.inputText.container}`,t=k(["div",{id:x.containerId,classname:e}],V.input),n={container:t,control:t.querySelector(`.${H.inputText.control}`),input:t.querySelector(`.${H.inputText.input}`),reset:t.querySelector(`.${H.inputText.reset}`),result:t.querySelector(`.${H.inputText.result}`)}):(e=`${H.namespace} ${H.glass.container}`,t=k(["div",{id:x.containerId,classname:e}],V.glass),n={container:t,control:t.querySelector(`.${H.glass.control}`),button:t.querySelector(`.${H.glass.button}`),input:t.querySelector(`.${H.glass.input}`),reset:t.querySelector(`.${H.glass.reset}`),result:t.querySelector(`.${H.glass.result}`)}),n.input.placeholder=this.options.placeholder,n}}V.glass=`\n  <div class="${H.glass.control} ${H.olControl}">\n    <button type="button" id="${x.buttonControlId}" class="${H.glass.button}"></button>\n    <input type="text" id="${x.inputQueryId}" class="${H.glass.input}" autocomplete="off" placeholder="Search ...">\n    <a id="${x.inputResetId}" class="${H.glass.reset} ${H.hidden}"></a>\n  </div>\n  <ul class="${H.glass.result}"></ul>\n`,V.input=`\n  <div class="${H.inputText.control}">\n    <input type="text" id="${x.inputQueryId}" class="${H.inputText.input}" autocomplete="off" placeholder="Search ...">\n    <span class="${H.inputText.icon}"></span>\n    <button type="button" id="${x.inputResetId}" class="${H.inputText.reset} ${H.hidden}"></button>\n  </div>\n  <ul class="${H.inputText.result}"></ul>\n`;class Y{constructor(){this.settings={url:"https://photon.komoot.io/api/",params:{q:"",limit:10,lang:"en"},langs:["de","it","fr","en"]}}getParameters(t){return t.lang=t.lang.toLowerCase(),{url:this.settings.url,params:{q:t.query,limit:t.limit||this.settings.params.limit,lang:this.settings.langs.includes(t.lang)?t.lang:this.settings.params.lang}}}handleResponse(t){return 0===t.features.length?[]:t.features.map((t=>({lon:t.geometry.coordinates[0],lat:t.geometry.coordinates[1],address:{name:t.properties.name,postcode:t.properties.postcode,city:t.properties.city,state:t.properties.state,country:t.properties.country},original:{formatted:t.properties.name,details:t.properties}})))}}class K{constructor(){this.settings={url:"https://nominatim.openstreetmap.org/search/",params:{q:"",format:"json",addressdetails:1,limit:10,countrycodes:"","accept-language":"en-US"}}}getParameters(t){return{url:this.settings.url,params:{q:t.query,format:this.settings.params.format,addressdetails:this.settings.params.addressdetails,limit:t.limit||this.settings.params.limit,countrycodes:t.countrycodes||this.settings.params.countrycodes,"accept-language":t.lang||this.settings.params["accept-language"]}}}handleResponse(t){return 0===t.length?[]:t.map((t=>({lon:t.lon,lat:t.lat,bbox:t.boundingbox,address:{name:t.display_name,road:t.address.road||"",houseNumber:t.address.house_number||"",postcode:t.address.postcode,city:t.address.city||t.address.town,state:t.address.state,country:t.address.country},original:{formatted:t.display_name,details:t.address}})))}}class W{constructor(){this.settings={url:"https://open.mapquestapi.com/nominatim/v1/search.php",params:{q:"",key:"",format:"json",addressdetails:1,limit:10,countrycodes:"","accept-language":"en-US"}}}getParameters(t){return{url:this.settings.url,params:{q:t.query,key:t.key,format:"json",addressdetails:1,limit:t.limit||this.settings.params.limit,countrycodes:t.countrycodes||this.settings.params.countrycodes,"accept-language":t.lang||this.settings.params["accept-language"]}}}handleResponse(t){return 0===t.length?[]:t.map((t=>({lon:t.lon,lat:t.lat,address:{name:t.address.neighbourhood||"",road:t.address.road||"",postcode:t.address.postcode,city:t.address.city||t.address.town,state:t.address.state,country:t.address.country},original:{formatted:t.display_name,details:t.address}})))}}class J{constructor(){this.settings={url:"https://dev.virtualearth.net/REST/v1/Locations",callbackName:"jsonp",params:{query:"",key:"",includeNeighborhood:0,maxResults:10}}}getParameters(t){return{url:this.settings.url,callbackName:this.settings.callbackName,params:{query:t.query,key:t.key,includeNeighborhood:t.includeNeighborhood||this.settings.params.includeNeighborhood,maxResults:t.maxResults||this.settings.params.maxResults}}}handleResponse(t){const{resources:e}=t.resourceSets[0];return 0===e.length?[]:e.map((t=>({lon:t.point.coordinates[1],lat:t.point.coordinates[0],address:{name:t.name},original:{formatted:t.address.formattedAddress,details:t.address}})))}}class Q{constructor(){this.settings={url:"https://api.opencagedata.com/geocode/v1/json?",params:{q:"",key:"",limit:10,countrycode:"",pretty:1,no_annotations:1}}}getParameters(t){return{url:this.settings.url,params:{q:t.query,key:t.key,limit:t.limit||this.settings.params.limit,countrycode:t.countrycodes||this.settings.params.countrycodes}}}handleResponse(t){return 0===t.results.length?[]:t.results.map((t=>({lon:t.geometry.lng,lat:t.geometry.lat,address:{name:t.components.house_number||"",road:t.components.road||"",postcode:t.components.postcode,city:t.components.city||t.components.town,state:t.components.state,country:t.components.country},original:{formatted:t.formatted,details:t.components}})))}}function tt(t){return new Promise(((e,n)=>{const r=function(t,e){return e&&"object"==typeof e&&(t+=(/\?/u.test(t)?"&":"?")+et(e)),t}(t.url,t.data),i={method:"GET",mode:"cors",credentials:"same-origin"};t.jsonp?function(t,e,n){const{head:r}=document,i=document.createElement("script"),s=`f${Math.round(Math.random()*Date.now())}`;i.setAttribute("src",`${t+(t.indexOf("?")>0?"&":"?")+e}=${s}`),window[s]=t=>{window[s]=void 0,setTimeout((()=>r.removeChild(i)),0),n(t)},r.append(i)}(r,t.callbackName,e):fetch(r,i).then((t=>t.json())).then(e).catch(n)}))}function et(t){return Object.keys(t).reduce(((e,n)=>(e.push("object"==typeof t[n]?et(t[n]):`${encodeURIComponent(n)}=${encodeURIComponent(t[n])}`),e)),[]).join("&")}const nt=x.cssClasses;class rt{constructor(t,e){this.Base=t,this.layerName=G("geocoder-layer-"),this.layer=new g.default({name:this.layerName,source:new f.default}),this.options=t.options,this.options.provider="string"==typeof this.options.provider?this.options.provider.toLowerCase():this.options.provider,this.provider=this.newProvider(),this.els=e,this.lastQuery="",this.container=this.els.container,this.registeredListeners={mapClick:!1},this.setListeners()}setListeners(){let t,e;const n=t=>{t.stopPropagation(),Z(this.els.control,nt.glass.expanded)?this.collapse():this.expand()};this.els.input.addEventListener("keypress",(t=>{const e=t.target.value.trim();(t.key?"Enter"===t.key:t.which?13===t.which:t.keyCode&&13===t.keyCode)&&(t.preventDefault(),this.query(e))}),!1),this.els.input.addEventListener("click",(t=>t.stopPropagation()),!1),this.els.input.addEventListener("input",(n=>{const r=n.target.value.trim();0!==r.length?j(this.els.reset,nt.hidden):F(this.els.reset,nt.hidden),this.options.autoComplete&&r!==e&&(e=r,t&&clearTimeout(t),t=setTimeout((()=>{r.length>=this.options.autoCompleteMinLength&&this.query(r)}),this.options.autoCompleteTimeout))}),!1),this.els.reset.addEventListener("click",(t=>{this.els.input.focus(),this.els.input.value="",this.lastQuery="",F(this.els.reset,nt.hidden),this.clearResults()}),!1),this.options.targetType===N&&this.els.button.addEventListener("click",n,!1)}query(t){this.provider||(this.provider=this.newProvider());const e=this.provider.getParameters({query:t,key:this.options.key,lang:this.options.lang,countrycodes:this.options.countrycodes,limit:this.options.limit});if(this.lastQuery===t&&this.els.result.firstChild)return;this.lastQuery=t,this.clearResults(),F(this.els.reset,nt.spin);const n={url:e.url,data:e.params};e.callbackName&&(n.jsonp=!0,n.callbackName=e.callbackName),tt(n).then((t=>{this.options.debug&&r.info(t),j(this.els.reset,nt.spin);const e=this.provider.handleResponse(t);e&&(this.createList(e),this.listenMapClick())})).catch((t=>{j(this.els.reset,nt.spin);const e=k("li","<h5>Error! No internet connection?</h5>");this.els.result.append(e)}))}createList(t){const e=this.els.result;t.forEach((t=>{let n;n=this.options.provider===A?`<span class="${nt.road}">${t.address.name}</span>`:this.addressTemplate(t.address);const r=k("li",`<a href="#">${n}</a>`);r.addEventListener("click",(e=>{e.preventDefault(),this.chosen(t,n,t.address,t.original)}),!1),e.append(r)}))}chosen(t,e,n,r){const i=this.Base.getMap(),s=[Number.parseFloat(t.lon),Number.parseFloat(t.lat)],o=i.getView().getProjection(),a=_.default.transform(s,"EPSG:4326",o);let{bbox:l}=t;l&&(l=_.default.transformExtent([l[2],l[1],l[3],l[0]],"EPSG:4326",o));const c={formatted:e,details:n,original:r};if(!1===this.options.keepOpen&&this.clearResults(!0),!0===this.options.preventDefault)this.Base.dispatchEvent({type:S,address:c,coordinate:a,bbox:l,place:t});else{l?i.getView().fit(l,{duration:500}):function(t,e,n=500,r=2.388657133911758){t.getView().animate({duration:n,resolution:r},{duration:n,center:e})}(i,a);const e=this.createFeature(a,c);this.Base.dispatchEvent({type:S,address:c,feature:e,coordinate:a,bbox:l,place:t})}}createFeature(t){const e=new m.default(new p.default(t));return this.addLayer(),e.setStyle(this.options.featureStyle),e.setId(G("geocoder-ft-")),this.getSource().addFeature(e),e}addressTemplate(t){const e=[];return t.name&&e.push(['<span class="',nt.road,'">{name}</span>'].join("")),(t.road||t.building||t.house_number)&&e.push(['<span class="',nt.road,'">{building} {road} {house_number}</span>'].join("")),(t.city||t.town||t.village)&&e.push(['<span class="',nt.city,'">{postcode} {city} {town} {village}</span>'].join("")),(t.state||t.country)&&e.push(['<span class="',nt.country,'">{state} {country}</span>'].join("")),B(e.join("<br>"),t)}newProvider(){switch(this.options.provider){case A:return new K;case L:return new W;case I:return new Y;case M:return new J;case $:return new Q;default:return this.options.provider}}expand(){j(this.els.input,nt.spin),F(this.els.control,nt.glass.expanded),window.setTimeout((()=>this.els.input.focus()),100),this.listenMapClick()}collapse(){this.els.input.value="",this.els.input.blur(),F(this.els.reset,nt.hidden),j(this.els.control,nt.glass.expanded),this.clearResults()}listenMapClick(){if(this.registeredListeners.mapClick)return;const t=this,e=this.Base.getMap().getTargetElement();this.registeredListeners.mapClick=!0,e.addEventListener("click",{handleEvent(n){t.clearResults(!0),e.removeEventListener(n.type,this,!1),t.registeredListeners.mapClick=!1}},!1)}clearResults(t){t&&this.options.targetType===N?this.collapse():function(t){for(;t.firstChild;)t.firstChild.remove()}(this.els.result)}getSource(){return this.layer.getSource()}addLayer(){let t=!1;const e=this.Base.getMap();e.getLayers().forEach((e=>{e===this.layer&&(t=!0)})),t||e.addLayer(this.layer)}}class it extends u.default{constructor(t=b,e={}){let n,r;P("string"==typeof t,"@param `type` should be string!"),P(t===b||t===D,`@param 'type' should be '${b}'\n      or '${D}'!`),P("object"==typeof e,"@param `options` should be object!"),O.featureStyle=[new h.default({image:new d.default({scale:.7,src:"//cdn.rawgit.com/jonataswalker/map-utils/master/images/marker.png"})})];const i=new V(e);if(t===b&&(n=i.els.container),super({element:n}),!(this instanceof it))return new it;this.options=function(t,e){const n={};return Object.keys(t).forEach((e=>{Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e])})),Object.keys(e).forEach((t=>{Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t])})),n}(O,e),this.container=n,t===b&&(r=new rt(this,i.els),this.layer=r.layer)}getLayer(){return this.layer}getSource(){return this.getLayer().getSource()}setProvider(t){this.options.provider=t}setProviderKey(t){this.options.key=t}}return it}))},41668:(t,e,n)=>{"use strict";n.d(e,{Z:()=>a});var r=n(22556),i=n(88775),s=n(43762),o=class extends i["default"]{constructor(t){var e=s.Z.create("DIV",{className:(t.className||"")+" ol-timeline"+(t.target?"":" ol-unselectable ol-control")+(t.zoomButton?" ol-hasbutton":"")});super({element:e,target:t.target}),this._scrollDiv=s.Z.create("DIV",{className:"ol-scroll",parent:this.element}),this._buttons=s.Z.create("DIV",{className:"ol-buttons",parent:this.element}),t.zoomButton&&(this.addButton({className:"ol-zoom-in",handleClick:function(){var t=this.get("zoom");t>=1?t++:t=Math.min(1,t+.1),t=Math.round(100*t)/100,this.refresh(t)}.bind(this)}),this.addButton({className:"ol-zoom-out",handleClick:function(){var t=this.get("zoom");t>1?t--:t-=.1,t=Math.round(100*t)/100,this.refresh(t)}.bind(this)})),this._intervalDiv=s.Z.create("DIV",{className:"ol-center-date",parent:this.element}),this.element.addEventListener("mouseover",function(){this._select&&this._select.elt.classList.remove("ol-select")}.bind(this));var n=null;this._scrollDiv.addEventListener("scroll",function(){this._setScrollLeft(),n&&(clearTimeout(n),n=null),n=setTimeout(function(){this.dispatchEvent({type:"scroll",date:this.getDate(),dateStart:this.getDate("start"),dateEnd:this.getDate("end")})}.bind(this),t.scrollTimeout||15)}.bind(this)),s.Z.scrollDiv(this._scrollDiv,{onmove:function(t){this._moving=t}.bind(this)}),this._tline=[],this._scrollLeft=0,this.set("maxWidth",t.maxWidth||2e3),this.set("minDate",t.minDate||1/0),this.set("maxDate",t.maxDate||-1/0),this.set("graduation",t.graduation),this.set("minZoom",t.minZoom||.2),this.set("maxZoom",t.maxZoom||4),this.setInterval(t.interval),t.getHTML&&(this._getHTML=t.getHTML),t.getFeatureDate&&(this._getFeatureDate=t.getFeatureDate),t.endFeatureDate&&(this._endFeatureDate=t.endFeatureDate),this.setFeatures(t.features||t.source,t.zoom)}setMap(t){super.setMap(t),this.refresh(this.get("zoom")||1,!0)}addButton(t){this.element.classList.add("ol-hasbutton"),s.Z.create("BUTTON",{className:t.className||void 0,title:t.title,html:t.html,click:t.handleClick,parent:this._buttons})}setInterval(t){"string"===typeof t&&(t=/s$/.test(t)?1e3*parseFloat(t):/mn$/.test(t)?1e3*parseFloat(t)*60:/h$/.test(t)?1e3*parseFloat(t)*3600:/d$/.test(t)?1e3*parseFloat(t)*3600*24:/y$/.test(t)?1e3*parseFloat(t)*3600*24*365:0),this.set("interval",t||0),t?this.element.classList.add("ol-interval"):this.element.classList.remove("ol-interval"),this.refresh(this.get("zoom"))}_getHTML(t){return t.get("name")||""}_getFeatureDate(t){return t&&t.get?t.get("date"):null}_endFeatureDate(){}isCollapsed(){return this.element.classList.contains("ol-collapsed")}collapse(t){t?this.element.classList.add("ol-collapsed"):this.element.classList.remove("ol-collapsed"),this.dispatchEvent({type:"collapse",collapsed:this.isCollapsed()})}toggle(){this.element.classList.toggle("ol-collapsed"),this.dispatchEvent({type:"collapse",collapsed:this.isCollapsed()})}setFeatures(t,e){this._features=this._source=null,t instanceof r["default"]?this._source=t:this._features=t instanceof Array?t:[],this.refresh(e)}getFeatures(){return this._features||this._source.getFeatures()}refresh(t,e){if(this.getMap()){t||(t=this.get("zoom")),t=Math.min(this.get("maxZoom"),Math.max(this.get("minZoom"),t||1)),this.set("zoom",t),this._scrollDiv.innerHTML="";var n,r,i=this.getFeatures(),o=this._tline=[];i.forEach(function(t){(n=this._getFeatureDate(t))&&(n instanceof Date||(n=new Date(n)),this._endFeatureDate&&(r=this._endFeatureDate(t),r instanceof Date||(r=new Date(r))),isNaN(n)||o.push({date:n,end:isNaN(r)?null:r,feature:t}))}.bind(this)),o.sort((function(t,e){return t.date<e.date?-1:t.date===e.date?0:1}));var a=s.Z.create("DIV",{parent:this._scrollDiv}),l=this._minDate=Math.min(this.get("minDate"),o.length?o[0].date:1/0),c=this._maxDate=Math.max(this.get("maxDate"),o.length?o[o.length-1].date:-1/0);isFinite(l)||(this._minDate=l=new Date),isFinite(c)||(this._maxDate=c=new Date);var u=c-l,h=this.get("maxWidth"),d=this._scale=(u>h?h/u:1)*t;l=this._minDate=this._minDate-10/d,u=(c-l)*d,s.Z.setStyle(a,{width:u,maxWidth:"unset"}),this._drawTime(a,l,c,d),this.get("interval")?s.Z.setStyle(this._intervalDiv,{width:this.get("interval")*d}):s.Z.setStyle(this._intervalDiv,{width:""});var g=[],f=s.Z.getStyle(this._scrollDiv,"lineHeight"),p=s.Z.create("DIV",{className:"ol-features",parent:a});o.forEach(function(t){for(var e=t.date,n=t.elt=s.Z.create("DIV",{className:"ol-feature",style:{left:Math.round((e-l)*d)},html:this._getHTML(t.feature),parent:p}),r=n.querySelectorAll("img"),i=0;i<r.length;i++)r[i].ondragstart=function(){return!1};t.end&&s.Z.setStyle(n,{minWidth:(t.end-e)*d,width:(t.end-e)*d,maxWidth:"unset"});var o,a,c=s.Z.getStyle(n,"left");for(n.addEventListener("click",function(){this._moving||this.dispatchEvent({type:"select",feature:t.feature})}.bind(this)),o=0;a=g[o];o++)if(c>a)break;g[o]=c+s.Z.getStyle(n,"width"),s.Z.setStyle(n,{top:o*f})}.bind(this)),this._nbline=g.length,e&&this.setDate(this._minDate,{anim:!1,position:"start"}),this.dispatchEvent({type:"scroll",date:this.getDate(),dateStart:this.getDate("start"),dateEnd:this.getDate("end")})}}_getOffsetFromDate(t){return(t-this._minDate)*this._scale}_getDateFromOffset(t){return t/this._scale+this._minDate}_setScrollLeft(t){this._scrollLeft=t,void 0!==t&&(this._scrollDiv.scrollLeft=t)}_getScrollLeft(){return void 0===this._scrollLeft?this._scrollDiv.scrollLeft:this._scrollLeft}_drawTime(t,e,n,r){var i,o,a,l,c=s.Z.create("DIV",{className:"ol-times",parent:t}),u=s.Z.getStyle(c,"left"),h=s.Z.getStyle(c,"height"),d=new Date(this._minDate).getFullYear();o=(new Date(0).setFullYear(String(d))-new Date(0).setFullYear(String(d-1)))*r;var g=Math.round(2*h/o)+1;while(1){if(i=new Date(0).setFullYear(d),i>this._maxDate)break;s.Z.create("DIV",{className:"ol-time ol-year",style:{left:this._getOffsetFromDate(i)-u},html:d,parent:c}),d+=g}if(/day|month/.test(this.get("graduation"))&&(o=(new Date(0,0,1).setFullYear(String(d))-new Date(0,0,1).setFullYear(String(d-1)))*r,l=Math.max(1,Math.round(12/Math.round(o/h/2))),l<12)){d=new Date(this._minDate).getFullYear(),a=l+1;while(1){if(i=new Date(0,0,1),i.setFullYear(d),i.setMonth(a-1),i>this._maxDate)break;s.Z.create("DIV",{className:"ol-time ol-month",style:{left:this._getOffsetFromDate(i)-u},html:i.toLocaleDateString(void 0,{month:"short"}),parent:c}),a+=l,a>12&&(d++,a=l+1)}}if("day"===this.get("graduation")){o=(new Date(0,1,1)-new Date(0,0,1))*r;var f=Math.max(1,Math.round(31/Math.round(o/h/2)));if(f<31){d=new Date(this._minDate).getFullYear(),a=0;var p=f;while(1)if(i=new Date(0,0,1),i.setFullYear(d),i.setMonth(a),i.setDate(p),isNaN(i))a++,a>12&&(a=1,d++),p=f;else{if(i>this._maxDate)break;if(p>1){var m=this._getOffsetFromDate(i);this._getOffsetFromDate(new Date(d,a+1,1))-m>h&&s.Z.create("DIV",{className:"ol-time ol-day",style:{left:m-u},html:p,parent:c})}d=i.getFullYear(),a=i.getMonth(),p=i.getDate()+f,p>new Date(d,a+1,0).getDate()&&(a++,p=f)}}}}setDate(t,e){var n;if(e=e||{},t instanceof Date?n=t:(this.getFeatures().indexOf(t)>=0&&(n=this._getFeatureDate(t)),!n||n instanceof Date||(n=new Date(n)),n&&!isNaN(n)||(n=new Date(String(t)))),!isNaN(n)){!1===e.anim&&this._scrollDiv.classList.add("ol-move");var r=this._getOffsetFromDate(n);if("start"===e.position?r+=s.Z.outerWidth(this._scrollDiv)/2-s.Z.getStyle(this._scrollDiv,"marginLeft")/2:"end"===e.position&&(r-=s.Z.outerWidth(this._scrollDiv)/2-s.Z.getStyle(this._scrollDiv,"marginLeft")/2),this._setScrollLeft(r),!1===e.anim&&this._scrollDiv.classList.remove("ol-move"),t)for(var i,o=0;i=this._tline[o];o++)i.feature===t?(i.elt.classList.add("ol-select"),this._select=i):i.elt.classList.remove("ol-select")}}roundDate(t,e){switch(e){case"mn":return new Date(this._roundTo(t,6e4));case"hour":return new Date(this._roundTo(t,36e5));case"day":return new Date(this._roundTo(t,864e5));case"month":return t=new Date(this._roundTo(t,864e5)),t.getDate()>15&&(t=new Date(t.setMonth(t.getMonth()+1))),t=t.setDate(1),new Date(t);default:return new Date(t)}}getDate(t,e){var n;switch(e||(e=t),t){case"start":n=this.get("interval")?-s.Z.getStyle(this._intervalDiv,"width")/2+s.Z.getStyle(this._scrollDiv,"marginLeft")/2:-s.Z.outerWidth(this._scrollDiv)/2+s.Z.getStyle(this._scrollDiv,"marginLeft")/2;break;case"end":n=this.get("interval")?s.Z.getStyle(this._intervalDiv,"width")/2-s.Z.getStyle(this._scrollDiv,"marginLeft")/2:s.Z.outerWidth(this._scrollDiv)/2-s.Z.getStyle(this._scrollDiv,"marginLeft")/2;break;default:n=0;break}var r=this._getDateFromOffset(this._getScrollLeft()+n);return r=this.roundDate(r,e),new Date(r)}_roundTo(t,e){return Math.round(t/e)*e}getStartDate(){return new Date(this.get("minDate"))}getEndDate(){return new Date(this.get("maxDate"))}};const a=o},80349:(t,e,n)=>{"use strict";n.d(e,{G0:()=>o,ZP:()=>d,px:()=>a,qo:()=>c});var r=n(94806),i=n(37195),s=n(68326);function o(t){return t instanceof Image||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?t:null}function a(t){return t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Float32Array||t instanceof DataView?t:null}let l=null;function c(t){l||(l=(0,s.E4)(t.width,t.height,void 0,{willReadFrequently:!0}));const e=l.canvas,n=t.width;e.width!==n&&(e.width=n);const r=t.height;return e.height!==r&&(e.height=r),l.clearRect(0,0,n,r),l.drawImage(t,0,0),l.getImageData(0,0,n,r).data}const u=[256,256];class h extends r.Z{constructor(t){const e=i.Z.IDLE;super(t.tileCoord,e,{transition:t.transition,interpolate:t.interpolate}),this.loader_=t.loader,this.data_=null,this.error_=null,this.size_=t.size||null}getSize(){if(this.size_)return this.size_;const t=o(this.data_);return t?[t.width,t.height]:u}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==i.Z.IDLE&&this.state!==i.Z.ERROR)return;this.state=i.Z.LOADING,this.changed();const t=this;this.loader_().then((function(e){t.data_=e,t.state=i.Z.LOADED,t.changed()})).catch((function(e){t.error_=e,t.state=i.Z.ERROR,t.changed()}))}}const d=h},77285:(t,e,n)=>{"use strict";n.d(e,{Z:()=>Lt});function r(t,e){return m().createElementNS(t,e)}function i(t,e){return s(t,e,[]).join("")}function s(t,e,n){if(t.nodeType==Node.CDATA_SECTION_NODE||t.nodeType==Node.TEXT_NODE)e?n.push(String(t.nodeValue).replace(/(\r\n|\r|\n)/g,"")):n.push(t.nodeValue);else{let r;for(r=t.firstChild;r;r=r.nextSibling)s(r,e,n)}return n}function o(t){return"documentElement"in t}function a(t){return(new DOMParser).parseFromString(t,"application/xml")}function l(t,e){return function(n,r){const i=t.call(void 0!==e?e:this,n,r);if(void 0!==i){const t=r[r.length-1];t.push(i)}}}function c(t,e,n){return function(r,i){const s=t.call(void 0!==n?n:this,r,i);if(void 0!==s){const t=i[i.length-1],n=void 0!==e?e:r.localName;let o;n in t?o=t[n]:(o=[],t[n]=o),o.push(s)}}}function u(t,e,n){return function(r,i){const s=t.call(void 0!==n?n:this,r,i);if(void 0!==s){const t=i[i.length-1],n=void 0!==e?e:r.localName;t[n]=s}}}function h(t,e){return function(n,i,s){const o=i[i.length-1],a=o.node;let l=t;void 0===l&&(l=s);const c=void 0!==e?e:a.namespaceURI;return r(c,l)}}h();function d(t,e,n){let r,i;for(n=void 0!==n?n:{},r=0,i=t.length;r<i;++r)n[t[r]]=e;return n}function g(t,e,n,r){let i;for(i=e.firstElementChild;i;i=i.nextElementSibling){const e=t[i.namespaceURI];if(void 0!==e){const t=e[i.localName];void 0!==t&&t.call(r,i,n)}}}function f(t,e,n,r,i){return r.push(t),g(e,n,r,i),r.pop()}let p;function m(){return void 0===p&&"undefined"!==typeof document&&(p=document.implementation.createDocument("","",null)),p}class _{read(t){if(!t)return null;if("string"===typeof t){const e=a(t);return this.readFromDocument(e)}return o(t)?this.readFromDocument(t):this.readFromNode(t)}readFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null}readFromNode(t){}}const T=_,y="http://www.w3.org/1999/xlink";function E(t){return t.getAttributeNS(y,"href")}function R(t){const e=i(t,!1);return v(e)}function v(t){const e=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(t);if(e)return parseFloat(e[1])}function w(t){const e=i(t,!1);return x(e)}function x(t){const e=/^\s*(\d+)\s*$/.exec(t);if(e)return parseInt(e[1],10)}function S(t){return i(t,!1).trim()}const b=[null,"http://www.opengis.net/ows/1.1"],D=d(b,{ServiceIdentification:u(J),ServiceProvider:u(tt),OperationsMetadata:u(K)});class N extends T{constructor(){super()}readFromNode(t){const e=f({},D,t,[]);return e||null}}const C=d(b,{DeliveryPoint:u(S),City:u(S),AdministrativeArea:u(S),PostalCode:u(S),Country:u(S),ElectronicMailAddress:u(S)}),A=d(b,{Value:c(et)}),L=d(b,{AllowedValues:u(k)}),I=d(b,{Phone:u(W),Address:u(B)}),M=d(b,{HTTP:u(V)}),$=d(b,{Get:c(H),Post:void 0}),O=d(b,{DCP:u(q)}),P=d(b,{Operation:Y}),G=d(b,{Voice:u(S),Facsimile:u(S)}),U=d(b,{Constraint:c(X)}),F=d(b,{IndividualName:u(S),PositionName:u(S),ContactInfo:u(z)}),j=d(b,{Abstract:u(S),AccessConstraints:u(S),Fees:u(S),Title:u(S),ServiceTypeVersion:u(S),ServiceType:u(S)}),Z=d(b,{ProviderName:u(S),ProviderSite:u(E),ServiceContact:u(Q)});function B(t,e){return f({},C,t,e)}function k(t,e){return f({},A,t,e)}function X(t,e){const n=t.getAttribute("name");if(n)return f({name:n},L,t,e)}function z(t,e){return f({},I,t,e)}function q(t,e){return f({},M,t,e)}function H(t,e){const n=E(t);if(n)return f({href:n},U,t,e)}function V(t,e){return f({},$,t,e)}function Y(t,e){const n=t.getAttribute("name"),r=f({},O,t,e);if(!r)return;const i=e[e.length-1];i[n]=r}function K(t,e){return f({},P,t,e)}function W(t,e){return f({},G,t,e)}function J(t,e){return f({},j,t,e)}function Q(t,e){return f({},F,t,e)}function tt(t,e){return f({},Z,t,e)}function et(t,e){return S(t)}const nt=N;var rt=n(28641);const it=[null,"http://www.opengis.net/wmts/1.0"],st=[null,"http://www.opengis.net/ows/1.1"],ot=d(it,{Contents:u(Tt)});class at extends T{constructor(){super(),this.owsParser_=new nt}readFromNode(t){let e=t.getAttribute("version");e&&(e=e.trim());let n=this.owsParser_.readFromNode(t);return n?(n["version"]=e,n=f(n,ot,t,[]),n||null):null}}const lt=d(it,{Layer:c(yt),TileMatrixSet:c(Et)}),ct=d(it,{Style:c(Rt),Format:c(S),TileMatrixSetLink:c(vt),Dimension:c(wt),ResourceURL:c(xt)},d(st,{Title:u(S),Abstract:u(S),WGS84BoundingBox:u(St),Identifier:u(S)})),ut=d(it,{LegendURL:c(bt)},d(st,{Title:u(S),Identifier:u(S)})),ht=d(it,{TileMatrixSet:u(S),TileMatrixSetLimits:u(Ct)}),dt=d(it,{TileMatrixLimits:l(At)}),gt=d(it,{TileMatrix:u(S),MinTileRow:u(w),MaxTileRow:u(w),MinTileCol:u(w),MaxTileCol:u(w)}),ft=d(it,{Default:u(S),Value:c(S)},d(st,{Identifier:u(S)})),pt=d(st,{LowerCorner:l(Dt),UpperCorner:l(Dt)}),mt=d(it,{WellKnownScaleSet:u(S),TileMatrix:c(Nt)},d(st,{SupportedCRS:u(S),Identifier:u(S),BoundingBox:u(St)})),_t=d(it,{TopLeftCorner:u(Dt),ScaleDenominator:u(R),TileWidth:u(w),TileHeight:u(w),MatrixWidth:u(w),MatrixHeight:u(w)},d(st,{Identifier:u(S)}));function Tt(t,e){return f({},lt,t,e)}function yt(t,e){return f({},ct,t,e)}function Et(t,e){return f({},mt,t,e)}function Rt(t,e){const n=f({},ut,t,e);if(!n)return;const r="true"===t.getAttribute("isDefault");return n["isDefault"]=r,n}function vt(t,e){return f({},ht,t,e)}function wt(t,e){return f({},ft,t,e)}function xt(t,e){const n=t.getAttribute("format"),r=t.getAttribute("template"),i=t.getAttribute("resourceType"),s={};return n&&(s["format"]=n),r&&(s["template"]=r),i&&(s["resourceType"]=i),s}function St(t,e){const n=f([],pt,t,e);if(2==n.length)return(0,rt.hI)(n)}function bt(t,e){const n={};return n["format"]=t.getAttribute("format"),n["href"]=E(t),n}function Dt(t,e){const n=S(t).split(/\s+/);if(!n||2!=n.length)return;const r=+n[0],i=+n[1];return isNaN(r)||isNaN(i)?void 0:[r,i]}function Nt(t,e){return f({},_t,t,e)}function Ct(t,e){return f([],dt,t,e)}function At(t,e){return f({},gt,t,e)}const Lt=at},85066:(t,e,n)=>{"use strict";n.d(e,{Z:()=>It});var r=n(94272),i=n(71912),s=n(63130),o=n(9494),a=n(37195),l=n(208),c=n(85487),u=n(20825),h=n(74187);class d extends l.Z{constructor(t){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter_=t.gutter||0,this.helper_=t.helper,this.loaded=!1,this.ready=!1}setTile(t){if(t!==this.tile)if(this.tile&&this.tile.removeEventListener(c.Z.CHANGE,this.handleTileChange_),this.tile=t,this.loaded=t.getState()===a.Z.LOADED,this.loaded)this.uploadTile();else{if(t instanceof u.Z){const e=t.getImage();e instanceof Image&&!e.crossOrigin&&(e.crossOrigin="anonymous")}t.addEventListener(c.Z.CHANGE,this.handleTileChange_)}}uploadTile(){(0,h.O3)()}setReady(){this.ready=!0,this.dispatchEvent(c.Z.CHANGE)}handleTileChange_(){this.tile.getState()===a.Z.LOADED&&(this.loaded=!0,this.uploadTile())}disposeInternal(){this.tile.removeEventListener(c.Z.CHANGE,this.handleTileChange_)}}const g=d;var f=n(80349),p=n(22988),m=n(41536),_=n(68326),T=n(4307);function y(t,e,n){const r=n?t.LINEAR:t.NEAREST;t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,r)}function E(t,e,n,r){y(t,e,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)}function R(t,e,n,r,i,s){const o=t.getGL();let a,l;if(n instanceof Float32Array){a=o.FLOAT,t.getExtension("OES_texture_float");const e=t.getExtension("OES_texture_float_linear");l=null!==e}else a=o.UNSIGNED_BYTE,l=!0;y(o,e,s&&l);const c=n.byteLength/r[1];let u,h=1;switch(c%8===0?h=8:c%4===0?h=4:c%2===0&&(h=2),i){case 1:u=o.LUMINANCE;break;case 2:u=o.LUMINANCE_ALPHA;break;case 3:u=o.RGB;break;case 4:u=o.RGBA;break;default:throw new Error(`Unsupported number of bands: ${i}`)}const d=o.getParameter(o.UNPACK_ALIGNMENT);o.pixelStorei(o.UNPACK_ALIGNMENT,h),o.texImage2D(o.TEXTURE_2D,0,u,r[0],r[1],0,u,a,n),o.pixelStorei(o.UNPACK_ALIGNMENT,d)}let v=null;function w(){v=(0,_.E4)(1,1,void 0,{willReadFrequently:!0})}class x extends g{constructor(t){super(t),this.textures=[],this.renderSize_=(0,T.Pq)(t.grid.getTileSize(t.tile.tileCoord[0])),this.bandCount=NaN;const e=new p.ZP(m.qO,m.MB);e.fromArray([0,1,1,1,1,0,0,0]),this.helper_.flushBufferData(e),this.coords=e,this.setTile(t.tile)}uploadTile(){const t=this.helper_,e=t.getGL(),n=this.tile;let r;this.textures.length=0,r=n instanceof u.Z||n instanceof o.Z?n.getImage():n.getData();const i=(0,f.G0)(r);if(i){const t=e.createTexture();return this.textures.push(t),this.bandCount=4,E(e,t,i,n.interpolate),void this.setReady()}r=(0,f.px)(r);const s=n.getSize(),a=[s[0]+2*this.gutter_,s[1]+2*this.gutter_],l=r instanceof Float32Array,c=a[0]*a[1],h=l?Float32Array:Uint8Array,d=h.BYTES_PER_ELEMENT,g=r.byteLength/a[1];this.bandCount=Math.floor(g/d/a[0]);const p=Math.ceil(this.bandCount/4);if(1===p){const i=e.createTexture();return this.textures.push(i),R(t,i,r,a,this.bandCount,n.interpolate),void this.setReady()}const m=new Array(p);for(let o=0;o<p;++o){const t=e.createTexture();this.textures.push(t);const n=o<p-1?4:(this.bandCount-1)%4+1;m[o]=new h(c*n)}let _=0,T=0;const y=a[0]*this.bandCount;for(let o=0;o<a[1];++o){for(let t=0;t<y;++t){const e=r[T+t],n=Math.floor(_/this.bandCount),i=t%this.bandCount,s=Math.floor(i/4),o=m[s],a=o.length/c,l=i%4;o[n*a+l]=e,++_}T+=g/d}for(let o=0;o<p;++o){const e=this.textures[o],r=m[o],i=r.length/c;R(t,e,r,a,i,n.interpolate)}this.setReady()}disposeInternal(){const t=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(let e=0;e<this.textures.length;++e)t.deleteTexture(this.textures[e]);this.tile.removeEventListener(c.Z.CHANGE,this.handleTileChange_)}getImagePixelData_(t,e,n){const r=this.gutter_,i=this.renderSize_[0],s=this.renderSize_[1];v||w(),v.clearRect(0,0,1,1);const o=t.width,a=t.height,l=o-2*r,c=a-2*r,u=r+Math.floor(l*(e/i)),h=r+Math.floor(c*(n/s));let d;try{v.drawImage(t,u,h,1,1,0,0,1,1),d=v.getImageData(0,0,1,1).data}catch(g){return v=null,null}return d}getArrayPixelData_(t,e,n,r){const i=this.gutter_,s=this.renderSize_[0],o=this.renderSize_[1],a=e[0],l=e[1],c=a+2*i,u=l+2*i,h=i+Math.floor(a*(n/s)),d=i+Math.floor(l*(r/o));if(t instanceof DataView){const e=t.byteLength/(c*u),n=e*(d*c+h),r=t.buffer.slice(n,n+e);return new DataView(r)}const g=this.bandCount*(d*c+h);return t.slice(g,g+this.bandCount)}getPixelData(t,e){if(!this.loaded)return null;if(this.tile instanceof f.ZP){const n=this.tile.getData(),r=(0,f.px)(n);if(r){const n=this.tile.getSize();return this.getArrayPixelData_(r,n,t,e)}return this.getImagePixelData_((0,f.G0)(n),t,e)}return this.getImagePixelData_(this.tile.getImage(),t,e)}}const S=x;var b=n(46131),D=n(2519),N=n(35455),C=n(81428),A=n(98634),L=n(6101),I=n(65537),M=n(63432),$=n(28641);const O={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"},P={};function G(t){return 1/(t+2)}function U(){return{tileIds:new Set,representationsByZ:{}}}function F(t,e){return t.tileIds.has((0,h.sq)(e))}function j(t,e,n){const r=t.representationsByZ;n in r||(r[n]=new Set),r[n].add(e),t.tileIds.add((0,h.sq)(e.tile))}function Z(t,e){const n=t.layerStatesArray[t.layerIndex];n.extent&&(e=(0,$.Ed)(e,(0,M.fromUserExtent)(n.extent,t.viewState.projection)));const r=n.layer.getRenderSource();if(!r.getWrapX()){const n=r.getTileGridForProjection(t.viewState.projection).getExtent();n&&(e=(0,$.Ed)(e,n))}return e}function B(t,e){return`${t.getKey()},${(0,A.km)(e)}`}class k extends N.Z{constructor(t,e){super(t,{uniforms:e.uniforms,postProcesses:e.postProcesses}),this.renderComplete=!1,this.tileTransform_=(0,L.Ue)(),this.tempMat4=(0,C.U)(),this.tempTileRange_=new D.Z(0,0,0,0),this.tempTileCoord_=(0,A.T9)(0,0,0),this.tempSize_=[0,0];const n=void 0!==e.cacheSize?e.cacheSize:512;this.tileRepresentationCache=new b.Z(n),this.frameState=null,this.projection_=void 0}reset(t){super.reset({uniforms:t.uniforms})}isDrawableTile_(t){const e=this.getLayer(),n=t.getState(),r=e.getUseInterimTilesOnError();return n==a.Z.LOADED||n==a.Z.EMPTY||n==a.Z.ERROR&&!r}prepareFrameInternal(t){this.projection_?t.viewState.projection!==this.projection_&&(this.clearCache(),this.projection_=t.viewState.projection):this.projection_=t.viewState.projection;const e=this.getLayer(),n=e.getRenderSource();return!!n&&(!(0,$.xb)(Z(t,t.extent))&&"ready"===n.getState())}createTileRepresentation(t){return(0,h.O3)()}enqueueTiles(t,e,n,r,i){const s=t.viewState,o=this.getLayer(),l=o.getRenderSource(),c=l.getTileGridForProjection(s.projection),u=l.getGutterForProjection(s.projection),d=(0,h.sq)(l);d in t.wantedTiles||(t.wantedTiles[d]={});const g=t.wantedTiles[d],f=this.tileRepresentationCache,p=o.getMapInternal(),m=Math.max(n-i,c.getMinZoom(),c.getZForResolution(Math.min(o.getMaxResolution(),p?p.getView().getResolutionForZoom(Math.max(o.getMinZoom(),0)):c.getResolution(0)),l.zDirection));for(let h=n;h>=m;--h){const n=c.getTileRangeForExtentAndZ(e,h,this.tempTileRange_),i=c.getResolution(h);for(let e=n.minX;e<=n.maxX;++e)for(let o=n.minY;o<=n.maxY;++o){const n=(0,A.T9)(h,e,o,this.tempTileCoord_),p=B(l,n);let m,_;if(f.containsKey(p)&&(m=f.get(p),_=m.tile),m&&m.tile.key===l.getKey()||(_=l.getTile(h,e,o,t.pixelRatio,s.projection)),F(r,_))continue;if(m)if(this.isDrawableTile_(_))m.setTile(_);else{const t=_.getInterimTile();m.setTile(t)}else m=this.createTileRepresentation({tile:_,grid:c,helper:this.helper,gutter:u}),f.set(p,m);j(r,m,h);const T=_.getKey();g[T]=!0,_.getState()===a.Z.IDLE&&(t.tileQueue.isKeyQueued(T)||t.tileQueue.enqueue([_,d,c.getTileCoordCenter(n),i]))}}}beforeTilesRender(t,e){this.helper.prepareDraw(this.frameState,!e,!0)}renderTile(t,e,n,r,i,s,o,a,l,c,u){}drawTile_(t,e,n,r,i,s,o){if(!e.loaded)return;const a=e.tile,l=a.tileCoord,c=(0,A.km)(l),u=c in s?s[c]:1,h=o.getResolution(n),d=(0,T.Pq)(o.getTileSize(n),this.tempSize_),g=o.getOrigin(n),f=o.getTileCoordExtent(l),p=u<1?-1:G(n);u<1&&(t.animate=!0);const m=t.viewState,_=m.center[0],y=m.center[1],E=d[0]+2*r,R=d[1]+2*r,v=E/R,w=(_-g[0])/(d[0]*h),x=(g[1]-y)/(d[1]*h),S=m.resolution/h,b=l[1],D=l[2];(0,L.mc)(this.tileTransform_),(0,L.bA)(this.tileTransform_,2/(t.size[0]*S/E),-2/(t.size[1]*S/E)),(0,L.U1)(this.tileTransform_,m.rotation),(0,L.bA)(this.tileTransform_,1,1/v),(0,L.Iu)(this.tileTransform_,(d[0]*(b-w)-r)/E,(d[1]*(D-x)-r)/R),this.renderTile(e,this.tileTransform_,t,i,h,d,g,f,p,r,u)}renderFrame(t){this.frameState=t,this.renderComplete=!0;const e=this.helper.getGL();this.preRender(e,t);const n=t.viewState,r=this.getLayer(),i=r.getRenderSource(),l=i.getTileGridForProjection(n.projection),c=i.getGutterForProjection(n.projection),u=Z(t,t.extent),d=l.getZForResolution(n.resolution,i.zDirection),g=U(),f=r.getPreload();if(t.nextExtent){const e=l.getZForResolution(n.nextResolution,i.zDirection),r=Z(t,t.nextExtent);this.enqueueTiles(t,r,e,g,f)}this.enqueueTiles(t,u,d,g,0),f>0&&setTimeout((()=>{this.enqueueTiles(t,u,d-1,g,f-1)}),0);const p={},m=(0,h.sq)(this),_=t.time;let T=!1;for(const h of g.representationsByZ[d]){const t=h.tile;if((t instanceof o.Z||t instanceof s.Z)&&t.getState()===a.Z.EMPTY)continue;const e=t.tileCoord;if(h.loaded){const n=t.getAlpha(m,_);if(1===n){t.endTransition(m);continue}T=!0;const r=(0,A.km)(e);p[r]=n}this.renderComplete=!1;const n=this.findAltTiles_(l,e,d+1,g);if(n)continue;const r=l.getMinZoom();for(let i=d-1;i>=r;--i){const t=this.findAltTiles_(l,e,i,g);if(t)break}}this.beforeTilesRender(t,T);const y=g.representationsByZ,E=Object.keys(y).map(Number).sort(I.$1);for(let s=0,o=E.length;s<o;++s){const e=E[s];for(const n of y[e]){const r=n.tile.tileCoord,i=(0,A.km)(r);i in p||this.drawTile_(t,n,e,c,u,p,l)}}for(const s of y[d]){const e=s.tile.tileCoord,n=(0,A.km)(e);n in p&&this.drawTile_(t,s,d,c,u,p,l)}this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const R=this.helper.getCanvas(),v=this.tileRepresentationCache;while(v.canExpireCache()){const t=v.pop();t.dispose()}const w=function(t,e){i.updateCacheSize(.1,e.viewState.projection),i.expireCache(e.viewState.projection,P)};return t.postRenderFunctions.push(w),this.postRender(e,t),R}findAltTiles_(t,e,n,r){const i=t.getTileRangeForTileCoordAndZ(e,n,this.tempTileRange_);if(!i)return!1;let s=!0;const o=this.tileRepresentationCache,a=this.getLayer().getRenderSource();for(let l=i.minX;l<=i.maxX;++l)for(let t=i.minY;t<=i.maxY;++t){const e=B(a,[n,l,t]);let i=!1;if(o.containsKey(e)){const t=o.get(e);t.loaded&&!F(r,t.tile)&&(j(r,t,n),i=!0)}i||(s=!1)}return s}clearCache(){const t=this.tileRepresentationCache;t.forEach((t=>t.dispose())),t.clear()}removeHelper(){this.helper&&this.clearCache(),super.removeHelper()}disposeInternal(){super.disposeInternal(),delete this.frameState}}const X=k;var z=n(37751);const q={...O,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},H={TEXTURE_COORD:"a_textureCoord"},V=[{name:H.TEXTURE_COORD,size:2,type:z.GC.FLOAT}];class Y extends X{constructor(t,e){super(t,e),this.program_,this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.indices_=new p.ZP(m.cX,m.MB),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=e.paletteTextures||[]}reset(t){super.reset(t),this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}createTileRepresentation(t){return new S(t)}beforeTilesRender(t,e){super.beforeTilesRender(t,e),this.helper.useProgram(this.program_,t)}renderTile(t,e,n,r,i,s,o,a,l,c,u){const h=this.helper.getGL();this.helper.bindBuffer(t.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(V);let d=0;while(d<t.textures.length){const e=`${q.TILE_TEXTURE_ARRAY}[${d}]`;this.helper.bindTexture(t.textures[d],d,e),++d}for(let R=0;R<this.paletteTextures_.length;++R){const t=this.paletteTextures_[R],e=t.getTexture(h);this.helper.bindTexture(e,d,t.name),++d}const g=n.viewState,f=s[0]+2*c,p=s[1]+2*c,m=t.tile,_=m.tileCoord,T=_[1],y=_[2];this.helper.setUniformMatrixValue(q.TILE_TRANSFORM,(0,C.u)(this.tempMat4,e)),this.helper.setUniformFloatValue(q.TRANSITION_ALPHA,u),this.helper.setUniformFloatValue(q.DEPTH,l);let E=r;c>0&&(E=a,(0,$.Ed)(E,r,E)),this.helper.setUniformFloatVec4(q.RENDER_EXTENT,E),this.helper.setUniformFloatValue(q.RESOLUTION,g.resolution),this.helper.setUniformFloatValue(q.ZOOM,g.zoom),this.helper.setUniformFloatValue(q.TEXTURE_PIXEL_WIDTH,f),this.helper.setUniformFloatValue(q.TEXTURE_PIXEL_HEIGHT,p),this.helper.setUniformFloatValue(q.TEXTURE_RESOLUTION,i),this.helper.setUniformFloatValue(q.TEXTURE_ORIGIN_X,o[0]+T*s[0]*i-c*i),this.helper.setUniformFloatValue(q.TEXTURE_ORIGIN_Y,o[1]-y*s[1]*i+c*i),this.helper.drawElements(0,this.indices_.getSize())}getData(t){const e=this.helper.getGL();if(!e)return null;const n=this.frameState;if(!n)return null;const r=this.getLayer(),i=(0,L.nn)(n.pixelToCoordinateTransform,t.slice()),l=n.viewState,c=r.getExtent();if(c&&!(0,$.b8)((0,M.fromUserExtent)(c,l.projection),i))return null;const u=r.getSources((0,$.hI)([i]),l.resolution);let h,d,g;for(h=u.length-1;h>=0;--h)if(d=u[h],"ready"===d.getState()){if(g=d.getTileGridForProjection(l.projection),d.getWrapX())break;const t=g.getExtent();if(!t||(0,$.b8)(t,i))break}if(h<0)return null;const f=this.tileRepresentationCache;for(let p=g.getZForResolution(l.resolution);p>=g.getMinZoom();--p){const t=g.getTileCoordForCoordAndZ(i,p),e=B(d,t);if(!f.containsKey(e))continue;const n=f.get(e),r=n.tile;if((r instanceof o.Z||r instanceof s.Z)&&r.getState()===a.Z.EMPTY)return null;if(!n.loaded)continue;const l=g.getOrigin(p),c=(0,T.Pq)(g.getTileSize(p)),u=g.getResolution(p),h=(i[0]-l[0])/u-t[1]*c[0],m=(l[1]-i[1])/u-t[2]*c[1];return n.getPixelData(h,m)}return null}disposeInternal(){const t=this.helper;if(t){const e=t.getGL();e.deleteProgram(this.program_),delete this.program_,t.deleteBuffer(this.indices_)}super.disposeInternal(),delete this.indices_}}const K=Y;class W{constructor(t,e){this.name=t,this.data=e,this.texture_=null}getTexture(t){if(!this.texture_){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.data.length/4,1,0,t.RGBA,t.UNSIGNED_BYTE,this.data),this.texture_=e}return this.texture_}}const J=W;var Q=n(79706);const tt={NUMBER:1,STRING:2,COLOR:4,BOOLEAN:8,NUMBER_ARRAY:16,ANY:31,NONE:0};function et(t){switch(t){case"string":return tt.STRING;case"color":return tt.COLOR;case"number":return tt.NUMBER;case"boolean":return tt.BOOLEAN;case"number[]":return tt.NUMBER_ARRAY;default:throw new Error(`Unrecognized type hint: ${t}`)}}const nt={};function rt(t){if("number"===typeof t)return tt.NUMBER;if("boolean"===typeof t)return tt.BOOLEAN;if("string"===typeof t)return(0,Q.e1)(t)?tt.COLOR|tt.STRING:tt.STRING;if(!Array.isArray(t))throw new Error(`Unhandled value type: ${JSON.stringify(t)}`);const e=t,n=e.every((function(t){return"number"===typeof t}));if(n)return 3===e.length||4===e.length?tt.COLOR|tt.NUMBER_ARRAY:tt.NUMBER_ARRAY;if("string"!==typeof e[0])throw new Error(`Expected an expression operator but received: ${JSON.stringify(e)}`);const r=nt[e[0]];if(void 0===r)throw new Error(`Unrecognized expression operator: ${JSON.stringify(e)}`);return r.getReturnType(e.slice(1))}function it(t){return Math.log2(t)%1===0}function st(t){const e=[];return(t&tt.NUMBER)>0&&e.push("number"),(t&tt.COLOR)>0&&e.push("color"),(t&tt.BOOLEAN)>0&&e.push("boolean"),(t&tt.NUMBER_ARRAY)>0&&e.push("number[]"),(t&tt.STRING)>0&&e.push("string"),e.length>0?e.join(", "):"(no type)"}function ot(t,e){return`operator_${t}_${Object.keys(e.functions).length}`}function at(t){const e=t.toString();return e.includes(".")?e:e+".0"}function lt(t){if(t.length<2||t.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${t.length}(${t.map(at).join(", ")})`}function ct(t){const e=(0,Q._2)(t),n=e.length>3?e[3]:1;return lt([e[0]/255*n,e[1]/255*n,e[2]/255*n,n])}function ut(t,e){return void 0===t.stringLiteralsMap[e]&&(t.stringLiteralsMap[e]=Object.keys(t.stringLiteralsMap).length),t.stringLiteralsMap[e]}function ht(t,e){return at(ut(t,e))}function dt(t,e,n){const r=void 0!==n?n:tt.NUMBER;if(Array.isArray(e)&&"string"===typeof e[0]){const n=nt[e[0]];if(void 0===n)throw new Error(`Unrecognized expression operator: ${JSON.stringify(e)}`);return n.toGlsl(t,e.slice(1),r)}const i=rt(e)&r;if(vt(e,i,""),(i&tt.NUMBER)>0)return at(e);if((i&tt.BOOLEAN)>0)return e.toString();if((i&tt.STRING)>0)return ht(t,e.toString());if((i&tt.COLOR)>0)return ct(e);if((i&tt.NUMBER_ARRAY)>0)return lt(e);throw new Error(`Unexpected expression ${e} (expected type ${st(r)})`)}function gt(t){if(0===(rt(t)&tt.NUMBER))throw new Error(`A numeric value was expected, got ${JSON.stringify(t)} instead`)}function ft(t){for(let e=0;e<t.length;e++)gt(t[e])}function pt(t){if(0===(rt(t)&tt.STRING))throw new Error(`A string value was expected, got ${JSON.stringify(t)} instead`)}function mt(t){if(0===(rt(t)&tt.BOOLEAN))throw new Error(`A boolean value was expected, got ${JSON.stringify(t)} instead`)}function _t(t,e){if(t.length!==e)throw new Error(`Exactly ${e} arguments were expected, got ${t.length} instead`)}function Tt(t,e){if(t.length<e)throw new Error(`At least ${e} arguments were expected, got ${t.length} instead`)}function yt(t,e){if(t.length>e)throw new Error(`At most ${e} arguments were expected, got ${t.length} instead`)}function Et(t){if(t.length%2!==0)throw new Error(`An even amount of arguments was expected, got ${JSON.stringify(t)} instead`)}function Rt(t){if(t.length%2===0)throw new Error(`An odd amount of arguments was expected, got ${JSON.stringify(t)} instead`)}function vt(t,e,n){if(e===tt.NONE)throw new Error(`No matching type was found for the following expression ${n}: ${JSON.stringify(t)}`)}function wt(t,e,n){if(vt(t,e,n),!it(e))throw new Error(`Expected to have a unique type for the following expression ${n}: ${JSON.stringify(t)}\nGot the following types instead: ${st(e)}`)}function xt(t,e,n,r){if((e&n)===tt.NONE)throw new Error(`Expected the ${r} type of the following expression: ${JSON.stringify(t)} to be of the following types: ${st(n)}\nGot these types instead: ${st(e)}`)}function St(t){return"u_var_"+t}nt["get"]={getReturnType:function(t){if(2===t.length){const e=t[1];return et(e)}return tt.ANY},toGlsl:function(t,e,n){Tt(e,1),yt(e,2),pt(e[0]);const r=n&nt["get"].getReturnType(e);wt(["get",...e],r,"");const i=e[0].toString(),s=t.attributes.find((t=>t.name===i));if(s){if(r!==s.type)throw new Error(`The following attribute was used in different places with incompatible types: ${i}\nTypes were: ${st(s.type)} and ${st(r)}`)}else t.attributes.push({name:i,type:r});const o=t.inFragmentShader?"v_":"a_";return o+i}},nt["var"]={getReturnType:function(){return tt.ANY},toGlsl:function(t,e,n){_t(e,1),pt(e[0]);const r=e[0].toString();if(!t.style.variables||void 0===t.style.variables[r])throw new Error(`The following variable is missing from the style: ${r}`);const i=t.style.variables[r],s=n&rt(i);wt(["var",...e],s,"");const o=t.variables.find((t=>t.name===r));if(o){if(s!==o.type)throw new Error(`The following variable was used in different places with incompatible types: ${r}\nTypes were: ${st(o.type)} and ${st(s)}`)}else t.variables.push({name:r,type:s});return St(r)}};const bt="u_paletteTextures";nt["palette"]={getReturnType:function(){return tt.COLOR},toGlsl:function(t,e){_t(e,2),gt(e[0]);const n=dt(t,e[0]),r=e[1];if(!Array.isArray(r))throw new Error("The second argument of palette must be an array");const i=r.length,s=new Uint8Array(4*i);for(let l=0;l<i;l++){const t=r[l];let e;if("string"===typeof t)e=(0,Q.mL)(t);else{if(!Array.isArray(t))throw new Error("The second argument of palette must be an array of strings or colors");const n=t.length;if(4===n)e=t;else{if(3!==n)throw new Error(`Expected palette color to have 3 or 4 values, got ${n}`);e=[t[0],t[1],t[2],1]}}const n=4*l;s[n]=e[0],s[n+1]=e[1],s[n+2]=e[2],s[n+3]=255*e[3]}t.paletteTextures||(t.paletteTextures=[]);const o=`${bt}[${t.paletteTextures.length}]`,a=new J(o,s);return t.paletteTextures.push(a),`texture2D(${o}, vec2((${n} + 0.5) / ${i}.0, 0.5))`}};const Dt="getBandValue";function Nt(t){return{getReturnType:function(){return tt.BOOLEAN},toGlsl:function(e,n){_t(n,2);let r=tt.ANY;for(let t=0;t<n.length;t++)r&=rt(n[t]);if(r===tt.NONE)throw new Error(`All arguments should be of compatible type, got ${JSON.stringify(n)} instead`);return r&=~tt.COLOR,`(${dt(e,n[0],r)} ${t} ${dt(e,n[1],r)})`}}}function Ct(t){return{getReturnType:function(){return tt.BOOLEAN},toGlsl:function(e,n){Tt(n,2);for(let t=0;t<n.length;t++)mt(n[t]);let r=n.map((t=>dt(e,t,tt.BOOLEAN))).join(` ${t} `);return r=`(${r})`,r}}}function At(t,e){const n=`\n    attribute vec2 ${H.TEXTURE_COORD};\n    uniform mat4 ${q.TILE_TRANSFORM};\n    uniform float ${q.TEXTURE_PIXEL_WIDTH};\n    uniform float ${q.TEXTURE_PIXEL_HEIGHT};\n    uniform float ${q.TEXTURE_RESOLUTION};\n    uniform float ${q.TEXTURE_ORIGIN_X};\n    uniform float ${q.TEXTURE_ORIGIN_Y};\n    uniform float ${q.DEPTH};\n\n    varying vec2 v_textureCoord;\n    varying vec2 v_mapCoord;\n\n    void main() {\n      v_textureCoord = ${H.TEXTURE_COORD};\n      v_mapCoord = vec2(\n        ${q.TEXTURE_ORIGIN_X} + ${q.TEXTURE_RESOLUTION} * ${q.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],\n        ${q.TEXTURE_ORIGIN_Y} - ${q.TEXTURE_RESOLUTION} * ${q.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]\n      );\n      gl_Position = ${q.TILE_TRANSFORM} * vec4(${H.TEXTURE_COORD}, ${q.DEPTH}, 1.0);\n    }\n  `,r={inFragmentShader:!0,variables:[],attributes:[],stringLiteralsMap:{},functions:{},bandCount:e,style:t},i=[];if(void 0!==t.color){const e=dt(r,t.color,tt.COLOR);i.push(`color = ${e};`)}if(void 0!==t.contrast){const e=dt(r,t.contrast,tt.NUMBER);i.push(`color.rgb = clamp((${e} + 1.0) * color.rgb - (${e} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(void 0!==t.exposure){const e=dt(r,t.exposure,tt.NUMBER);i.push(`color.rgb = clamp((${e} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(void 0!==t.saturation){const e=dt(r,t.saturation,tt.NUMBER);i.push(`\n      float saturation = ${e} + 1.0;\n      float sr = (1.0 - saturation) * 0.2126;\n      float sg = (1.0 - saturation) * 0.7152;\n      float sb = (1.0 - saturation) * 0.0722;\n      mat3 saturationMatrix = mat3(\n        sr + saturation, sr, sr,\n        sg, sg + saturation, sg,\n        sb, sb, sb + saturation\n      );\n      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));\n    `)}if(void 0!==t.gamma){const e=dt(r,t.gamma,tt.NUMBER);i.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${e}));`)}if(void 0!==t.brightness){const e=dt(r,t.brightness,tt.NUMBER);i.push(`color.rgb = clamp(color.rgb + ${e}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const s={},o=r.variables.length;if(o>1&&!t.variables)throw new Error(`Missing variables in style (expected ${r.variables})`);for(let h=0;h<o;++h){const e=r.variables[h];if(!(e.name in t.variables))throw new Error(`Missing '${e.name}' in style variables`);const n=St(e.name);s[n]=function(){let n=t.variables[e.name];return"string"===typeof n&&(n=ut(r,n)),void 0!==n?n:-9999999}}const a=Object.keys(s).map((function(t){return`uniform float ${t};`})),l=Math.ceil(e/4);a.push(`uniform sampler2D ${q.TILE_TEXTURE_ARRAY}[${l}];`),r.paletteTextures&&a.push(`uniform sampler2D ${bt}[${r.paletteTextures.length}];`);const c=Object.keys(r.functions).map((function(t){return r.functions[t]})),u=`\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    #else\n    precision mediump float;\n    #endif\n\n    varying vec2 v_textureCoord;\n    varying vec2 v_mapCoord;\n    uniform vec4 ${q.RENDER_EXTENT};\n    uniform float ${q.TRANSITION_ALPHA};\n    uniform float ${q.TEXTURE_PIXEL_WIDTH};\n    uniform float ${q.TEXTURE_PIXEL_HEIGHT};\n    uniform float ${q.RESOLUTION};\n    uniform float ${q.ZOOM};\n\n    ${a.join("\n")}\n\n    ${c.join("\n")}\n\n    void main() {\n      if (\n        v_mapCoord[0] < ${q.RENDER_EXTENT}[0] ||\n        v_mapCoord[1] < ${q.RENDER_EXTENT}[1] ||\n        v_mapCoord[0] > ${q.RENDER_EXTENT}[2] ||\n        v_mapCoord[1] > ${q.RENDER_EXTENT}[3]\n      ) {\n        discard;\n      }\n\n      vec4 color = texture2D(${q.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);\n\n      ${i.join("\n")}\n\n      gl_FragColor = color;\n      gl_FragColor.rgb *= gl_FragColor.a;\n      gl_FragColor *= ${q.TRANSITION_ALPHA};\n    }`;return{vertexShader:n,fragmentShader:u,uniforms:s,paletteTextures:r.paletteTextures}}nt["band"]={getReturnType:function(){return tt.NUMBER},toGlsl:function(t,e){Tt(e,1),yt(e,3);const n=e[0];if(!(Dt in t.functions)){let e="";const n=t.bandCount||1;for(let t=0;t<n;t++){const r=Math.floor(t/4);let i=t%4;t===n-1&&1===i&&(i=3);const s=`${q.TILE_TEXTURE_ARRAY}[${r}]`;e+=`\n          if (band == ${t+1}.0) {\n            return texture2D(${s}, v_textureCoord + vec2(dx, dy))[${i}];\n          }\n        `}t.functions[Dt]=`\n        float getBandValue(float band, float xOffset, float yOffset) {\n          float dx = xOffset / ${q.TEXTURE_PIXEL_WIDTH};\n          float dy = yOffset / ${q.TEXTURE_PIXEL_HEIGHT};\n          ${e}\n        }\n      `}const r=dt(t,n),i=dt(t,e[1]||0),s=dt(t,e[2]||0);return`${Dt}(${r}, ${i}, ${s})`}},nt["time"]={getReturnType:function(){return tt.NUMBER},toGlsl:function(t,e){return _t(e,0),"u_time"}},nt["zoom"]={getReturnType:function(){return tt.NUMBER},toGlsl:function(t,e){return _t(e,0),"u_zoom"}},nt["resolution"]={getReturnType:function(){return tt.NUMBER},toGlsl:function(t,e){return _t(e,0),"u_resolution"}},nt["geometry-type"]={getReturnType:function(){return tt.STRING},toGlsl:function(t,e){_t(e,0);const n="geometryType",r=t=>{const e=t.getType();switch(e){case"Point":case"LineString":case"Polygon":return e;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return e.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return r(t.getGeometries()[0]);default:}},i=t.attributes.find((t=>t.name===n));i||t.attributes.push({name:n,type:tt.STRING,callback:t=>r(t.getGeometry())});const s=t.inFragmentShader?"v_":"a_";return s+n}},nt["*"]={getReturnType:function(t){let e=tt.NUMBER|tt.COLOR;for(let n=0;n<t.length;n++)e&=rt(t[n]);return e},toGlsl:function(t,e,n){Tt(e,2);let r=n;for(let i=0;i<e.length;i++)r&=rt(e[i]);return xt(e,r,tt.NUMBER|tt.COLOR,"output"),`(${e.map((e=>dt(t,e,r))).join(" * ")})`}},nt["/"]={getReturnType:function(){return tt.NUMBER},toGlsl:function(t,e){return _t(e,2),ft(e),`(${dt(t,e[0])} / ${dt(t,e[1])})`}},nt["+"]={getReturnType:function(){return tt.NUMBER},toGlsl:function(t,e){return Tt(e,2),ft(e),`(${e.map((e=>dt(t,e))).join(" + ")})`}},nt["-"]={getReturnType:function(){return tt.NUMBER},toGlsl:function(t,e){return _t(e,2),ft(e),`(${dt(t,e[0])} - ${dt(t,e[1])})`}},nt["clamp"]={getReturnType:function(){return tt.NUMBER},toGlsl:function(t,e){_t(e,3),ft(e);const n=dt(t,e[1]),r=dt(t,e[2]);return`clamp(${dt(t,e[0])}, ${n}, ${r})`}},nt["%"]={getReturnType:function(){return tt.NUMBER},toGlsl:function(t,e){return _t(e,2),ft(e),`mod(${dt(t,e[0])}, ${dt(t,e[1])})`}},nt["^"]={getReturnType:function(){return tt.NUMBER},toGlsl:function(t,e){return _t(e,2),ft(e),`pow(${dt(t,e[0])}, ${dt(t,e[1])})`}},nt["abs"]={getReturnType:function(){return tt.NUMBER},toGlsl:function(t,e){return _t(e,1),ft(e),`abs(${dt(t,e[0])})`}},nt["floor"]={getReturnType:function(){return tt.NUMBER},toGlsl:function(t,e){return _t(e,1),ft(e),`floor(${dt(t,e[0])})`}},nt["round"]={getReturnType:function(){return tt.NUMBER},toGlsl:function(t,e){return _t(e,1),ft(e),`floor(${dt(t,e[0])} + 0.5)`}},nt["ceil"]={getReturnType:function(){return tt.NUMBER},toGlsl:function(t,e){return _t(e,1),ft(e),`ceil(${dt(t,e[0])})`}},nt["sin"]={getReturnType:function(){return tt.NUMBER},toGlsl:function(t,e){return _t(e,1),ft(e),`sin(${dt(t,e[0])})`}},nt["cos"]={getReturnType:function(){return tt.NUMBER},toGlsl:function(t,e){return _t(e,1),ft(e),`cos(${dt(t,e[0])})`}},nt["atan"]={getReturnType:function(){return tt.NUMBER},toGlsl:function(t,e){return Tt(e,1),yt(e,2),ft(e),2===e.length?`atan(${dt(t,e[0])}, ${dt(t,e[1])})`:`atan(${dt(t,e[0])})`}},nt["sqrt"]={getReturnType:function(){return tt.NUMBER},toGlsl:function(t,e){return _t(e,1),ft(e),`sqrt(${dt(t,e[0])})`}},nt[">"]={getReturnType:function(){return tt.BOOLEAN},toGlsl:function(t,e){return _t(e,2),ft(e),`(${dt(t,e[0])} > ${dt(t,e[1])})`}},nt[">="]={getReturnType:function(){return tt.BOOLEAN},toGlsl:function(t,e){return _t(e,2),ft(e),`(${dt(t,e[0])} >= ${dt(t,e[1])})`}},nt["<"]={getReturnType:function(){return tt.BOOLEAN},toGlsl:function(t,e){return _t(e,2),ft(e),`(${dt(t,e[0])} < ${dt(t,e[1])})`}},nt["<="]={getReturnType:function(){return tt.BOOLEAN},toGlsl:function(t,e){return _t(e,2),ft(e),`(${dt(t,e[0])} <= ${dt(t,e[1])})`}},nt["=="]=Nt("=="),nt["!="]=Nt("!="),nt["!"]={getReturnType:function(){return tt.BOOLEAN},toGlsl:function(t,e){return _t(e,1),mt(e[0]),`(!${dt(t,e[0],tt.BOOLEAN)})`}},nt["all"]=Ct("&&"),nt["any"]=Ct("||"),nt["between"]={getReturnType:function(){return tt.BOOLEAN},toGlsl:function(t,e){_t(e,3),ft(e);const n=dt(t,e[1]),r=dt(t,e[2]),i=dt(t,e[0]);return`(${i} >= ${n} && ${i} <= ${r})`}},nt["array"]={getReturnType:function(){return tt.NUMBER_ARRAY},toGlsl:function(t,e){Tt(e,2),yt(e,4),ft(e);const n=e.map((function(e){return dt(t,e)}));return`vec${e.length}(${n.join(", ")})`}},nt["color"]={getReturnType:function(){return tt.COLOR},toGlsl:function(t,e){Tt(e,3),yt(e,4),ft(e);const n=e.slice(0,3).map((e=>`${dt(t,e)} / 255.0`));if(3===e.length)return`vec4(${n.join(", ")}, 1.0)`;const r=dt(t,e[3]);return`(${r} * vec4(${n.join(", ")}, 1.0))`}},nt["interpolate"]={getReturnType:function(t){let e=tt.COLOR|tt.NUMBER;for(let n=3;n<t.length;n+=2)e&=rt(t[n]);return e},toGlsl:function(t,e,n){Et(e),Tt(e,6);const r=e[0];let i;switch(r[0]){case"linear":i=1;break;case"exponential":i=r[1];break;default:i=null}if(!i)throw new Error(`Invalid interpolation type for "interpolate" operator, received: ${JSON.stringify(r)}`);const s=tt.NUMBER,o=nt["interpolate"].getReturnType(e)&n;wt(["interpolate",...e],o,"output");const a=dt(t,e[1],s),l=at(i);let c="";for(let u=2;u<e.length-2;u+=2){const n=dt(t,e[u],s),r=c||dt(t,e[u+1],o),h=dt(t,e[u+2],s),d=dt(t,e[u+3],o);let g;g=1===i?`(${a} - ${n}) / (${h} - ${n})`:`(pow(${l}, (${a} - ${n})) - 1.0) / (pow(${l}, (${h} - ${n})) - 1.0)`,c=`mix(${r}, ${d}, clamp(${g}, 0.0, 1.0))`}return c}},nt["match"]={getReturnType:function(t){let e=tt.ANY;for(let n=2;n<t.length;n+=2)e&=rt(t[n]);return e&=rt(t[t.length-1]),e},toGlsl:function(t,e,n){Et(e),Tt(e,4);let r=rt(e[0]);for(let l=1;l<e.length-1;l+=2)r&=rt(e[l]);xt(["match",...e],r,tt.STRING|tt.NUMBER|tt.BOOLEAN,"input"),r=(tt.STRING|tt.NUMBER|tt.BOOLEAN)&r;const i=nt["match"].getReturnType(e)&n;wt(["match",...e],i,"output");const s=dt(t,e[0],r),o=dt(t,e[e.length-1],i);let a=null;for(let l=e.length-3;l>=1;l-=2){const n=dt(t,e[l],r),c=dt(t,e[l+1],i);a=`(${s} == ${n} ? ${c} : ${a||o})`}return a}},nt["case"]={getReturnType:function(t){let e=tt.ANY;for(let n=1;n<t.length;n+=2)e&=rt(t[n]);return e&=rt(t[t.length-1]),e},toGlsl:function(t,e,n){Rt(e),Tt(e,3);const r=nt["case"].getReturnType(e)&n;wt(["case",...e],r,"output");for(let o=0;o<e.length-1;o+=2)mt(e[o]);const i=dt(t,e[e.length-1],r);let s=null;for(let o=e.length-3;o>=0;o-=2){const n=dt(t,e[o],tt.BOOLEAN),a=dt(t,e[o+1],r);s=`(${n} ? ${a} : ${s||i})`}return s}},nt["in"]={getReturnType:function(t){return tt.BOOLEAN},toGlsl:function(t,e){_t(e,2);const n=e[0];let r=e[1];if(!Array.isArray(r))throw new Error('The "in" operator expects an array literal as its second argument.');if("string"===typeof r[0]){if("literal"!==r[0])throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(r[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');r=r[1]}let i=rt(n);for(let a=0;a<r.length-1;a+=1)i&=rt(r[a]);xt(["match",...e],i,tt.STRING|tt.NUMBER|tt.BOOLEAN,"input"),i=(tt.STRING|tt.NUMBER|tt.BOOLEAN)&i;const s=ot("in",t),o=[];for(let a=0;a<r.length;a+=1)o.push(`  if (inputValue == ${dt(t,r[a],i)}) { return true; }`);return t.functions[s]=`bool ${s}(float inputValue) {\n${o.join("\n")}\n  return false;\n}`,`${s}(${dt(t,n,i)})`}};class Lt extends r.Z{constructor(t){t=t?Object.assign({},t):{};const e=t.style||{};delete t.style;const n=t.cacheSize;delete t.cacheSize,super(t),this.sources_=t.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=e,this.cacheSize_=n,this.styleVariables_=this.style_.variables||{},this.addChangeListener(i.Z.SOURCE,this.handleSourceUpdate_)}getSources(t,e){const n=this.getSource();return this.sources_?"function"===typeof this.sources_?this.sources_(t,e):this.sources_:n?[n]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const t=this.getRenderSource();return t?t.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache(),this.getSource()&&this.setStyle(this.style_)}getSourceBandCount_(){const t=Number.MAX_SAFE_INTEGER,e=this.getSources([-t,-t,t,t],t);return e&&e.length&&"bandCount"in e[0]?e[0].bandCount:4}createRenderer(){const t=At(this.style_,this.getSourceBandCount_());return new K(this,{vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,cacheSize:this.cacheSize_,paletteTextures:t.paletteTextures})}renderSources(t,e){const n=this.getRenderer();let r;for(let i=0,s=e.length;i<s;++i)this.renderedSource_=e[i],n.prepareFrame(t)&&(r=n.renderFrame(t));return r}render(t,e){this.rendered=!0;const n=t.viewState,r=this.getSources(t.extent,n.resolution);let i=!0;for(let o=0,a=r.length;o<a;++o){const t=r[o],e=t.getState();if("loading"==e){const e=()=>{"ready"==t.getState()&&(t.removeEventListener("change",e),this.changed())};t.addEventListener("change",e)}i=i&&"ready"==e}const s=this.renderSources(t,r);if(this.getRenderer().renderComplete&&i)return this.renderedResolution_=n.resolution,s;if(this.renderedResolution_>.5*n.resolution){const e=this.getSources(t.extent,this.renderedResolution_).filter((t=>!r.includes(t)));if(e.length>0)return this.renderSources(t,e)}return s}setStyle(t){this.styleVariables_=t.variables||{},this.style_=t;const e=At(this.style_,this.getSourceBandCount_()),n=this.getRenderer();n.reset({vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms}),this.changed()}updateStyleVariables(t){Object.assign(this.styleVariables_,t),this.changed()}}Lt.prototype.dispose;const It=Lt},63130:(t,e,n)=>{"use strict";n.d(e,{Z:()=>f});var r=n(4773),i=n(80349),s=n(85487),o=n(37195),a=n(55476),l=n(87161),c=n(33983),u=n(68326),h=n(28641),d=n(65818);class g extends i.ZP{constructor(t){super({tileCoord:t.tileCoord,loader:()=>Promise.resolve(new Uint8Array(4)),interpolate:t.interpolate,transition:t.transition}),this.pixelRatio_=t.pixelRatio,this.gutter_=t.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=t.sourceTileGrid,this.targetTileGrid_=t.targetTileGrid,this.wrappedTileCoord_=t.wrappedTileCoord||t.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const e=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),n=this.targetTileGrid_.getExtent();let i=this.sourceTileGrid_.getExtent();const s=n?(0,h.Ed)(e,n):e;if(0===(0,h.bg)(s))return void(this.state=o.Z.EMPTY);const u=t.sourceProj,d=u.getExtent();d&&(i=i?(0,h.Ed)(i,d):d);const g=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),f=t.targetProj,p=(0,l.Co)(u,f,s,g);if(!isFinite(p)||p<=0)return void(this.state=o.Z.EMPTY);const m=void 0!==t.errorThreshold?t.errorThreshold:r.m;if(this.triangulation_=new a.Z(u,f,s,i,p*m,g),0===this.triangulation_.getTriangles().length)return void(this.state=o.Z.EMPTY);this.sourceZ_=this.sourceTileGrid_.getZForResolution(p);let _=this.triangulation_.calculateSourceExtent();if(i&&(u.canWrapX()?(_[1]=(0,c.uZ)(_[1],i[1],i[3]),_[3]=(0,c.uZ)(_[3],i[1],i[3])):_=(0,h.Ed)(_,i)),(0,h.bg)(_)){const e=this.sourceTileGrid_.getTileRangeForExtentAndZ(_,this.sourceZ_),n=t.getTileFunction;for(let t=e.minX;t<=e.maxX;t++)for(let r=e.minY;r<=e.maxY;r++){const e=n(this.sourceZ_,t,r,this.pixelRatio_);e&&this.sourceTiles_.push(e)}0===this.sourceTiles_.length&&(this.state=o.Z.EMPTY)}else this.state=o.Z.EMPTY}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const t=[];if(this.sourceTiles_.forEach((e=>{if(!e||e.getState()!==o.Z.LOADED)return;const n=e.getSize(),r=this.gutter_;let s;const a=(0,i.px)(e.getData());s=a||(0,i.qo)((0,i.G0)(e.getData()));const l=[n[0]+2*r,n[1]+2*r],c=s instanceof Float32Array,u=l[0]*l[1],h=c?Float32Array:Uint8Array,d=new h(s.buffer),g=h.BYTES_PER_ELEMENT,f=g*d.length/u,p=d.byteLength/l[1],m=Math.floor(p/g/l[0]),_=u*m;let T=d;if(d.length!==_){T=new h(_);let t=0,e=0;const n=l[0]*m;for(let r=0;r<l[1];++r){for(let r=0;r<n;++r)T[t++]=d[e+r];e+=p/g}}t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),data:new Uint8Array(T.buffer),dataType:h,bytesPerPixel:f,pixelSize:l})})),this.sourceTiles_.length=0,0===t.length)this.state=o.Z.ERROR;else{const e=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(e),r="number"===typeof n?n:n[0],i="number"===typeof n?n:n[1],s=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),c=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);let h,d;const g=t[0].bytesPerPixel,f=Math.ceil(g/3);for(let o=f-1;o>=0;--o){const e=[];for(let r=0,i=t.length;r<i;++r){const n=t[r],i=n.data,s=n.pixelSize,a=s[0],c=s[1],h=(0,u.E4)(a,c,l.rX),d=h.createImageData(a,c),f=d.data;let p=3*o;for(let t=0,e=f.length;t<e;t+=4)f[t]=i[p],f[t+1]=i[p+1],f[t+2]=i[p+2],f[t+3]=255,p+=g;h.putImageData(d,0,0),e.push({extent:n.extent,image:h.canvas})}const n=(0,l.sY)(r,i,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),s,c,this.triangulation_,e,this.gutter_,!1,!1);for(let t=0,r=e.length;t<r;++t){const n=e[t].image,r=n.getContext("2d");(0,u.jy)(r),l.rX.push(r.canvas)}const f=n.getContext("2d"),p=f.getImageData(0,0,n.width,n.height);(0,u.jy)(f),l.rX.push(n),h||(d=new Uint8Array(g*p.width*p.height),h=new t[0].dataType(d.buffer));const m=p.data;let _=3*o;for(let t=0,r=m.length;t<r;t+=4)255===m[t+3]?(d[_]=m[t],d[_+1]=m[t+1],d[_+2]=m[t+2]):(d[_]=0,d[_+1]=0,d[_+2]=0),_+=g}this.reprojData_=h,this.reprojSize_=[Math.round(r*this.pixelRatio_),Math.round(i*this.pixelRatio_)],this.state=o.Z.LOADED}this.changed()}load(){if(this.state!==o.Z.IDLE&&this.state!==o.Z.ERROR)return;this.state=o.Z.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach((e=>{const n=e.getState();if(n!==o.Z.IDLE&&n!==o.Z.LOADING)return;t++;const r=(0,d.oL)(e,s.Z.CHANGE,(function(){const n=e.getState();n!=o.Z.LOADED&&n!=o.Z.ERROR&&n!=o.Z.EMPTY||((0,d.bN)(r),t--,0===t&&(this.unlistenSources_(),this.reproject_()))}),this);this.sourcesListenerKeys_.push(r)})),0===t?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach((function(t){const e=t.getState();e==o.Z.IDLE&&t.load()}))}unlistenSources_(){this.sourcesListenerKeys_.forEach(d.bN),this.sourcesListenerKeys_=null}}const f=g},74665:(t,e,n)=>{"use strict";n.d(e,{Z:()=>q});var r=n(80349),i=n(85487),s=n(63130),o=n(11702),a=n(88815),l=n(57302),c=n(37195),u=n(21641),h=n(63432),d=n(98634),g=n(74187),f=n(36885),p=n(4307);class m extends l.Z{constructor(t){const e=void 0===t.projection?"EPSG:3857":t.projection;let n=t.tileGrid;void 0===n&&e&&(n=(0,u.dl)({extent:(0,u.Tl)(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize})),super({cacheSize:.1,attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:e,tileGrid:n,opaque:t.opaque,state:t.state,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate}),this.gutter_=void 0!==t.gutter?t.gutter:0,this.tileSize_=t.tileSize?(0,p.Pq)(t.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=t.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=void 0===t.bandCount?4:t.bandCount,this.tileGridForProjection_={},this.tileCacheForProjection_={}}setTileSizes(t){this.tileSizes_=t}getTileSize(t){if(this.tileSizes_)return this.tileSizes_[t];if(this.tileSize_)return this.tileSize_;const e=this.getTileGrid();return e?(0,p.Pq)(e.getTileSize(t)):[256,256]}getGutterForProjection(t){const e=this.getProjection();return!e||(0,h.equivalent)(e,t)?this.gutter_:0}setLoader(t){this.loader_=t}getReprojTile_(t,e,n,r,i){const o=this.getTileCacheForProjection(r),a=(0,d.lg)(t,e,n);if(o.containsKey(a)){const t=o.get(a);if(t&&t.key==this.getKey())return t}const l=this.getTileGrid(),c=Math.max.apply(null,l.getResolutions().map(((t,e)=>{const n=(0,p.Pq)(l.getTileSize(e)),r=this.getTileSize(e);return Math.max(r[0]/n[0],r[1]/n[1])}))),u=this.getTileGridForProjection(i),h=this.getTileGridForProjection(r),g=[t,e,n],f=this.getTileCoordForTileUrlFunction(g,r),m=Object.assign({sourceProj:i,sourceTileGrid:u,targetProj:r,targetTileGrid:h,tileCoord:g,wrappedTileCoord:f,pixelRatio:c,gutter:this.getGutterForProjection(i),getTileFunction:(t,e,n,r)=>this.getTile(t,e,n,r,i)},this.tileOptions),_=new s.Z(m);return _.key=this.getKey(),_}getTile(t,e,n,s,o){const a=this.getProjection();if(a&&o&&!(0,h.equivalent)(a,o))return this.getReprojTile_(t,e,n,o,a);const l=this.getTileSize(t),c=(0,d.lg)(t,e,n);if(this.tileCache.containsKey(c))return this.tileCache.get(c);const u=this.loader_;function g(){return(0,f.Vi)((function(){return u(t,e,n)}))}const p=Object.assign({tileCoord:[t,e,n],loader:g,size:l},this.tileOptions),m=new r.ZP(p);return m.key=this.getKey(),m.addEventListener(i.Z.CHANGE,this.handleTileChange_),this.tileCache.set(c,m),m}handleTileChange_(t){const e=t.target,n=(0,g.sq)(e),r=e.getState();let i;r==c.Z.LOADING?(this.tileLoadingKeys_[n]=!0,i=a.Z.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],i=r==c.Z.ERROR?a.Z.TILELOADERROR:r==c.Z.LOADED?a.Z.TILELOADEND:void 0),i&&this.dispatchEvent(new l.s(i,e))}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||(0,h.equivalent)(e,t)))return this.tileGrid;const n=(0,g.sq)(t);return n in this.tileGridForProjection_||(this.tileGridForProjection_[n]=(0,u.X$)(t)),this.tileGridForProjection_[n]}setTileGridForProjection(t,e){const n=(0,h.get)(t);if(n){const t=(0,g.sq)(n);t in this.tileGridForProjection_||(this.tileGridForProjection_[t]=e)}}getTileCacheForProjection(t){const e=this.getProjection();if(!e||(0,h.equivalent)(e,t))return this.tileCache;const n=(0,g.sq)(t);return n in this.tileCacheForProjection_||(this.tileCacheForProjection_[n]=new o.Z(.1)),this.tileCacheForProjection_[n]}expireCache(t,e){const n=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==n?e:{});for(const r in this.tileCacheForProjection_){const t=this.tileCacheForProjection_[r];t.expireCache(t==n?e:{})}}clear(){super.clear();for(const t in this.tileCacheForProjection_)this.tileCacheForProjection_[t].clear()}}const _=m;var T=n(8738),y=n(82499),E=n(14812);const R="undefined"!==typeof navigator&&navigator.hardwareConcurrency||2;class v{constructor(t=R,e){this.workers=null,this._awaitingDecoder=null,this.size=t,this.messageId=0,t&&(this._awaitingDecoder=e?Promise.resolve(e):new Promise((t=>{n.e(8831).then(n.bind(n,28831)).then((e=>{t(e.create)}))})),this._awaitingDecoder.then((e=>{this._awaitingDecoder=null,this.workers=[];for(let n=0;n<t;n++)this.workers.push({worker:e(),idle:!0})})))}async decode(t,e){return this._awaitingDecoder&&await this._awaitingDecoder,0===this.size?(0,E.X)(t).then((n=>n.decode(t,e))):new Promise((n=>{const r=this.workers.find((t=>t.idle))||this.workers[Math.floor(Math.random()*this.size)];r.idle=!1;const i=this.messageId++,s=t=>{t.data.id===i&&(r.idle=!0,n(t.data.decoded),r.worker.removeEventListener("message",s))};r.worker.addEventListener("message",s),r.worker.postMessage({fileDirectory:t,buffer:e,id:i},[e])}))}destroy(){this.workers&&(this.workers.forEach((t=>{t.worker.terminate()})),this.workers=null)}}const w=v;var x=n(38193),S=n(33983),b=n(28641),D=n(70044),N=n(58375);function C(t){const e=t.fileDirectory,n=e.NewSubfileType||0;return 4===(4&n)}function A(t,e){if(!t)return!1;if(!0===t)return!0;if(3!==e.getSamplesPerPixel())return!1;const n=e.fileDirectory.PhotometricInterpretation,r=y.Ie;return n===r.CMYK||n===r.YCbCr||n===r.CIELab||n===r.ICCLab}const L="STATISTICS_MAXIMUM",I="STATISTICS_MINIMUM",M=256;let $;function O(){return $||($=new w),$}function P(t){try{return t.getBoundingBox()}catch(e){return[0,0,t.getWidth(),t.getHeight()]}}function G(t){try{return t.getOrigin().slice(0,2)}catch(e){return[0,t.getHeight()]}}function U(t,e){try{return t.getResolution(e)}catch(n){return[e.getWidth()/t.getWidth(),e.getHeight()/t.getHeight()]}}function F(t){const e=t.geoKeys;if(!e)return null;if(e.ProjectedCSTypeGeoKey&&32767!==e.ProjectedCSTypeGeoKey){const t="EPSG:"+e.ProjectedCSTypeGeoKey;let n=(0,h.get)(t);if(!n){const r=(0,N.N)(e.ProjLinearUnitsGeoKey);r&&(n=new h.Projection({code:t,units:r}))}return n}if(e.GeographicTypeGeoKey&&32767!==e.GeographicTypeGeoKey){const t="EPSG:"+e.GeographicTypeGeoKey;let n=(0,h.get)(t);if(!n){const r=(0,N.N)(e.GeogAngularUnitsGeoKey);r&&(n=new h.Projection({code:t,units:r}))}return n}return null}function j(t){return t.getImageCount().then((function(e){const n=new Array(e);for(let r=0;r<e;++r)n[r]=t.getImage(r);return Promise.all(n)}))}function Z(t,e){let n;return n=t.blob?(0,x.mK)(t.blob):t.overviews?(0,x.MS)(t.url,t.overviews,e):(0,x.W0)(t.url,e),n.then(j)}function B(t,e,n,r,i){if(Array.isArray(t)){const s=t.length;if(!Array.isArray(e)||s!=e.length){const t=new Error(r);throw i(t),t}for(let o=0;o<s;++o)B(t[o],e[o],n,r,i)}else if(Math.abs(t-e)>n*t)throw new Error(r)}function k(t){return t instanceof Int8Array?-128:t instanceof Int16Array?-32768:t instanceof Int32Array?-2147483648:t instanceof Float32Array?12e-39:0}function X(t){return t instanceof Int8Array?127:t instanceof Uint8Array||t instanceof Uint8ClampedArray?255:t instanceof Int16Array?32767:t instanceof Uint16Array?65535:t instanceof Int32Array?2147483647:t instanceof Uint32Array?4294967295:t instanceof Float32Array?34e37:255}class z extends _{constructor(t){super({state:"loading",tileGrid:null,projection:null,opaque:t.opaque,transition:t.transition,interpolate:!1!==t.interpolate,wrapX:t.wrapX}),this.sourceInfo_=t.sources;const e=this.sourceInfo_.length;this.sourceOptions_=t.sourceOptions,this.sourceImagery_=new Array(e),this.sourceMasks_=new Array(e),this.resolutionFactors_=new Array(e),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=!1!==t.normalize,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=t.convertToRGB||!1,this.setKey(this.sourceInfo_.map((t=>t.url)).join(","));const n=this,r=new Array(e);for(let i=0;i<e;++i)r[i]=Z(this.sourceInfo_[i],this.sourceOptions_);Promise.all(r).then((function(t){n.configure_(t)})).catch((function(t){(0,D.vU)(t),n.error_=t,n.setState("error")}))}getError(){return this.error_}determineProjection(t){const e=t[0];for(let n=e.length-1;n>=0;--n){const t=e[n],r=F(t);if(r){this.projection=r;break}}}configure_(t){let e,n,r,i,s;const o=new Array(t.length),a=new Array(t.length),l=new Array(t.length);let c=0;const u=t.length;for(let h=0;h<u;++h){const u=[],d=[];t[h].forEach((t=>{C(t)?d.push(t):u.push(t)}));const g=u.length;if(d.length>0&&d.length!==g)throw new Error(`Expected one mask per image found ${d.length} masks and ${g} images`);let f,p;const m=new Array(g),_=new Array(g),T=new Array(g);a[h]=new Array(g),l[h]=new Array(g);for(let t=0;t<g;++t){const e=u[t],n=e.getGDALNoData();l[h][t]=e.getGDALMetadata(0),a[h][t]=n;const r=this.sourceInfo_[h].bands;o[h]=r?r.length:e.getSamplesPerPixel();const i=g-(t+1);f||(f=P(e)),p||(p=G(e));const s=U(e,u[0]);T[i]=s[0];const c=[e.getTileWidth(),e.getTileHeight()];c[0]!==c[1]&&c[1]<M&&(c[0]=M,c[1]=M),m[i]=c;const d=s[0]/Math.abs(s[1]);_[i]=[c[0],c[1]/d]}if(e?(0,b.Ed)(e,f,e):e=f,n){const t=`Origin mismatch for source ${h}, got [${p}] but expected [${n}]`;B(n,p,0,t,this.viewRejector)}else n=p;if(s){s.length-c>T.length&&(c=s.length-T.length);const t=s[s.length-1]/T[T.length-1];this.resolutionFactors_[h]=t;const e=T.map((e=>e*t)),n=`Resolution mismatch for source ${h}, got [${e}] but expected [${s}]`;B(s.slice(c,s.length),e,.02,n,this.viewRejector)}else s=T,this.resolutionFactors_[h]=1;r?B(r.slice(c,r.length),_,.01,`Tile size mismatch for source ${h}`,this.viewRejector):r=_,i?B(i.slice(c,i.length),m,0,`Tile size mismatch for source ${h}`,this.viewRejector):i=m,this.sourceImagery_[h]=u.reverse(),this.sourceMasks_[h]=d.reverse()}for(let h=0,p=this.sourceImagery_.length;h<p;++h){const t=this.sourceImagery_[h];while(t.length<s.length)t.unshift(void 0)}this.getProjection()||this.determineProjection(t),this.samplesPerPixel_=o,this.nodataValues_=a,this.metadata_=l;t:for(let h=0;h<u;++h){if(void 0!==this.sourceInfo_[h].nodata){this.addAlpha_=!0;break}if(this.sourceMasks_[h].length){this.addAlpha_=!0;break}const t=a[h],e=this.sourceInfo_[h].bands;if(e){for(let n=0;n<e.length;++n)if(null!==t[e[n]-1]){this.addAlpha_=!0;break t}}else for(let n=0;n<t.length;++n)if(null!==t[n]){this.addAlpha_=!0;break t}}let d=this.addAlpha_?1:0;for(let h=0;h<u;++h)d+=o[h];this.bandCount=d;const g=new T.Z({extent:e,minZoom:c,origin:n,resolutions:s,tileSizes:r});this.tileGrid=g,this.setTileSizes(i),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");const f=1;2===s.length?s=[s[0],s[1],s[1]/2]:1===s.length&&(s=[2*s[0],s[0],s[0]/2]),this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:s,center:(0,h.toUserCoordinate)((0,b.qg)(e),this.projection),extent:(0,h.toUserExtent)(e,this.projection),zoom:f})}loadTile_(t,e,n){const r=this.getTileSize(t),i=this.sourceImagery_.length,s=new Array(2*i),o=this.nodataValues_,a=this.sourceInfo_,l=O();for(let c=0;c<i;++c){const u=a[c],h=this.resolutionFactors_[c],d=[Math.round(e*(r[0]*h)),Math.round(n*(r[1]*h)),Math.round((e+1)*(r[0]*h)),Math.round((n+1)*(r[1]*h))],g=this.sourceImagery_[c][t];let f,p;u.bands&&(f=u.bands.map((function(t){return t-1}))),p="nodata"in u&&null!==u.nodata?u.nodata:f?f.map((function(t){return o[c][t]})):o[c];const m={window:d,width:r[0],height:r[1],samples:f,fillValue:p,pool:l,interleave:!1};A(this.convertToRGB_,g)?s[c]=g.readRGB(m):s[c]=g.readRasters(m);const _=i+c,T=this.sourceMasks_[c][t];T?s[_]=T.readRasters({window:d,width:r[0],height:r[1],samples:[0],pool:l,interleave:!1}):s[_]=Promise.resolve(null)}return Promise.all(s).then(this.composeTile_.bind(this,r)).catch((function(t){throw(0,D.vU)(t),t}))}composeTile_(t,e){const n=this.metadata_,r=this.sourceInfo_,i=this.sourceImagery_.length,s=this.bandCount,o=this.samplesPerPixel_,a=this.nodataValues_,l=this.normalize_,c=this.addAlpha_,u=t[0]*t[1],h=u*s;let d;d=l?new Uint8Array(h):new Float32Array(h);let g=0;for(let f=0;f<u;++f){let t=c;for(let s=0;s<i;++s){const u=r[s];let h,p,m=u.min,_=u.max;if(l){const t=n[s][0];void 0===m&&(m=t&&I in t?parseFloat(t[I]):k(e[s][0])),void 0===_&&(_=t&&L in t?parseFloat(t[L]):X(e[s][0])),h=255/(_-m),p=-m*h}for(let n=0;n<o[s];++n){const r=e[s][n][f];let i;if(i=l?(0,S.uZ)(h*r+p,0,255):r,c){let e=u.nodata;if(void 0===e){let t;t=u.bands?u.bands[n]-1:n,e=a[s][t]}const o=isNaN(e);(!o&&r!==e||o&&!isNaN(r))&&(t=!1,d[g]=i)}else d[g]=i;g++}if(!t){const n=i+s,r=e[n];r&&!r[0][f]&&(t=!0)}}c&&(t||(d[g]=255),g++)}return d}}z.prototype.getView;const q=z},62237:(t,e,n)=>{"use strict";n.d(e,{Z:()=>d,B:()=>g});var r=n(88799);function i(t,e){const n=[];Object.keys(e).forEach((function(t){null!==e[t]&&void 0!==e[t]&&n.push(t+"="+encodeURIComponent(e[t]))}));const r=n.join("&");return t=t.replace(/[?&]$/,""),t+=t.includes("?")?"&":"?",t+r}var s=n(28641),o=n(8738),a=n(63432);class l extends o.Z{constructor(t){super({extent:t.extent,origin:t.origin,origins:t.origins,resolutions:t.resolutions,tileSize:t.tileSize,tileSizes:t.tileSizes,sizes:t.sizes}),this.matrixIds_=t.matrixIds}getMatrixId(t){return this.matrixIds_[t]}getMatrixIds(){return this.matrixIds_}}function c(t,e,n){const r=[],i=[],s=[],o=[],c=[];n=void 0!==n?n:[];const u="SupportedCRS",h="TileMatrix",d="Identifier",g="ScaleDenominator",f="TopLeftCorner",p="TileWidth",m="TileHeight",_=t[u],T=(0,a.get)(_),y=T.getMetersPerUnit(),E="ne"==T.getAxisOrientation().substr(0,2);return t[h].sort((function(t,e){return e[g]-t[g]})),t[h].forEach((function(e){let a;if(a=!(n.length>0)||n.find((function(n){return e[d]==n[h]||!e[d].includes(":")&&t[d]+":"+e[d]===n[h]})),a){i.push(e[d]);const t=28e-5*e[g]/y,n=e[p],a=e[m];E?s.push([e[f][1],e[f][0]]):s.push(e[f]),r.push(t),o.push(n==a?n:[n,a]),c.push([e["MatrixWidth"],e["MatrixHeight"]])}})),new l({extent:e,origins:s,resolutions:r,matrixIds:i,tileSizes:o,sizes:c})}var u=n(67848);class h extends r.Z{constructor(t){const e=void 0!==t.requestEncoding?t.requestEncoding:"KVP",n=t.tileGrid;let r=t.urls;void 0===r&&void 0!==t.url&&(r=(0,u.Gk)(t.url)),super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:n,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,urls:r,wrapX:void 0!==t.wrapX&&t.wrapX,transition:t.transition,zDirection:t.zDirection}),this.version_=void 0!==t.version?t.version:"1.0.0",this.format_=void 0!==t.format?t.format:"image/jpeg",this.dimensions_=void 0!==t.dimensions?t.dimensions:{},this.layer_=t.layer,this.matrixSet_=t.matrixSet,this.style_=t.style,this.requestEncoding_=e,this.setKey(this.getKeyForDimensions_()),r&&r.length>0&&(this.tileUrlFunction=(0,u.Un)(r.map(this.createFromWMTSTemplate.bind(this))))}setUrls(t){this.urls=t;const e=t.join("\n");this.setTileUrlFunction((0,u.Un)(t.map(this.createFromWMTSTemplate.bind(this))),e)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const t=this.urls?this.urls.slice(0):[];for(const e in this.dimensions_)t.push(e+"-"+this.dimensions_[e]);return t.join("/")}updateDimensions(t){Object.assign(this.dimensions_,t),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(t){const e=this.requestEncoding_,n={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};"KVP"==e&&Object.assign(n,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),t="KVP"==e?i(t,n):t.replace(/\{(\w+?)\}/g,(function(t,e){return e.toLowerCase()in n?n[e.toLowerCase()]:t}));const r=this.tileGrid,s=this.dimensions_;return function(n,o,a){if(!n)return;const l={TileMatrix:r.getMatrixId(n[0]),TileCol:n[1],TileRow:n[2]};Object.assign(l,s);let c=t;return c="KVP"==e?i(c,l):c.replace(/\{(\w+?)\}/g,(function(t,e){return l[e]})),c}}}const d=h;function g(t,e){const n=t["Contents"]["Layer"],r=n.find((function(t){return t["Identifier"]==e["layer"]}));if(!r)return null;const i=t["Contents"]["TileMatrixSet"];let o;o=r["TileMatrixSetLink"].length>1?"projection"in e?r["TileMatrixSetLink"].findIndex((function(t){const n=i.find((function(e){return e["Identifier"]==t["TileMatrixSet"]})),r=n["SupportedCRS"],s=(0,a.get)(r),o=(0,a.get)(e["projection"]);return s&&o?(0,a.equivalent)(s,o):r==e["projection"]})):r["TileMatrixSetLink"].findIndex((function(t){return t["TileMatrixSet"]==e["matrixSet"]})):0,o<0&&(o=0);const l=r["TileMatrixSetLink"][o]["TileMatrixSet"],u=r["TileMatrixSetLink"][o]["TileMatrixSetLimits"];let h=r["Format"][0];"format"in e&&(h=e["format"]),o=r["Style"].findIndex((function(t){return"style"in e?t["Title"]==e["style"]:t["isDefault"]})),o<0&&(o=0);const d=r["Style"][o]["Identifier"],g={};"Dimension"in r&&r["Dimension"].forEach((function(t,e,n){const r=t["Identifier"];let i=t["Default"];void 0===i&&(i=t["Value"][0]),g[r]=i}));const f=t["Contents"]["TileMatrixSet"],p=f.find((function(t){return t["Identifier"]==l}));let m;const _=p["SupportedCRS"];if(_&&(m=(0,a.get)(_)),"projection"in e){const t=(0,a.get)(e["projection"]);t&&(m&&!(0,a.equivalent)(t,m)||(m=t))}let T=!1;const y="ne"==m.getAxisOrientation().substr(0,2);let E=p.TileMatrix[0],R={MinTileCol:0,MinTileRow:0,MaxTileCol:E.MatrixWidth-1,MaxTileRow:E.MatrixHeight-1};if(u){R=u[u.length-1];const t=p.TileMatrix.find((t=>t.Identifier===R.TileMatrix||p.Identifier+":"+t.Identifier===R.TileMatrix));t&&(E=t)}const v=28e-5*E.ScaleDenominator/m.getMetersPerUnit(),w=y?[E.TopLeftCorner[1],E.TopLeftCorner[0]]:E.TopLeftCorner,x=E.TileWidth*v,S=E.TileHeight*v;let b=p["BoundingBox"];b&&y&&(b=[b[1],b[0],b[3],b[2]]);let D=[w[0]+x*R.MinTileCol,w[1]-S*(1+R.MaxTileRow),w[0]+x*(1+R.MaxTileCol),w[1]-S*R.MinTileRow];if(void 0!==b&&!(0,s.r4)(b,D)){const t=r["WGS84BoundingBox"],e=(0,a.get)("EPSG:4326").getExtent();if(D=b,t)T=t[0]===e[0]&&t[2]===e[2];else{const t=(0,a.transformExtent)(b,p["SupportedCRS"],"EPSG:4326");T=t[0]-1e-10<=e[0]&&t[2]+1e-10>=e[2]}}const N=c(p,D,u),C=[];let A=e["requestEncoding"];if(A=void 0!==A?A:"","OperationsMetadata"in t&&"GetTile"in t["OperationsMetadata"]){const e=t["OperationsMetadata"]["GetTile"]["DCP"]["HTTP"]["Get"];for(let t=0,n=e.length;t<n;++t)if(e[t]["Constraint"]){const n=e[t]["Constraint"].find((function(t){return"GetEncoding"==t["name"]})),r=n["AllowedValues"]["Value"];if(""===A&&(A=r[0]),"KVP"!==A)break;r.includes("KVP")&&C.push(e[t]["href"])}else e[t]["href"]&&(A="KVP",C.push(e[t]["href"]))}return 0===C.length&&(A="REST",r["ResourceURL"].forEach((function(t){"tile"===t["resourceType"]&&(h=t["format"],C.push(t["template"]))}))),{urls:C,layer:e["layer"],matrixSet:l,format:h,projection:m,requestEncoding:A,tileGrid:N,style:d,dimensions:g,wrapX:T,crossOrigin:e["crossOrigin"]}}}}]);
//# sourceMappingURL=4138.3112a9ce.js.map