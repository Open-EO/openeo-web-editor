(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c8785be4","chunk-796e9818","chunk-59e66f91"],{"01e3":function(e,t,s){"use strict";s("7737")},"091e":function(e,t,s){var i=s("9b7c"),a=s("14ad");e.exports=function(e,t,s,r,n,o){var l=n.length;if(i(n,e,t,o))return!0;for(var c=0;c<l;c+=2){var u=(c+2)%l;if(a(e,t,s,r,n[c],n[c+1],n[u],n[u+1]))return!0}return!1}},"0d1f":function(e,t,s){},"0dd6":function(e,t,s){"use strict";e.exports=function(e,t,s,i,a,r,n,o){return e<a+n&&e+s>a&&t<r+o&&t+i>r}},"14ad":function(e,t,s){"use strict";e.exports=function(e,t,s,i,a,r,n,o){var l=s-e,c=i-t,u=n-a,d=o-r,h=(-c*(e-a)+l*(t-r))/(-u*c+l*d),p=(u*(t-r)-d*(e-a))/(-u*c+l*d);return h>=0&&h<=1&&p>=0&&p<=1}},"1af9d":function(e,t,s){"use strict";s("ea8f")},"1d9a":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"div",class:e.classes,attrs:{id:e.id,tabindex:"0"},on:{mousemove:e.onMouseMove,mousedown:e.onMouseDown,wheel:e.onMouseWheel,keydown:e.onKeyDown,focus:function(t){e.hasFocus=!0},blur:function(t){e.hasFocus=!1}}},[s("svg",{staticClass:"canvas",attrs:{xmlns:"http://www.w3.org/2000/svg",version:"1.1"}},[e._l(e.edges,(function(t){return s("Edge",{key:t.id,attrs:{id:t.id,parameter1:t.parameter1,parameter2:t.parameter2,selected:t.selected,inactive:t.inactive,issues:t.issues,state:e.state},on:{mounted:function(s){return e.mount(t,s)},unmounted:function(){return e.mount(t)},position:function(s){return e.updateEdgePos(t,arguments)}}})})),e._l(e.hiddenParameterRefEdges,(function(t){return s("Edge",{key:t.id,attrs:{id:t.id,parameter1:t.parameter1,parameter2:t.parameter2,inactive:!0,lineColor:[200,200,200,1],lineWidth:2,state:e.state},on:{mounted:function(s){return e.mount(t,s)},unmounted:function(){return e.mount(t)}}})})),e.linkingLine?s("line",e._b({},"line",e.linkingLine,!1)):e._e(),e.selectRect?s("rect",e._b({},"rect",e.selectRect,!1)):e._e()],2),s("div",{staticClass:"blocks"},e._l(e.blocks,(function(t){return s("Block",{key:t.id,attrs:{id:t.id,type:t.type,spec:t.spec,state:e.state,selected:t.selected,position:t.position,origin:t.origin,process_id:t.process_id,namespace:t.namespace,result:t.result,args:t.arguments,description:t.description},on:{update:function(){var s=[],i=arguments.length;while(i--)s[i]=arguments[i];return e.updateBlock.apply(void 0,[t].concat(s))},mounted:function(s){return e.mount(t,s)},unmounted:function(){return e.mount(t)},move:e.startDragBlock}})})),1),e.state.scale<.7||e.showZoomInfo?s("div",{staticClass:"zoomInfo"},[e.state.scale<.7?s("div",[e._v(" Zoom in for more details. ")]):e._e(),e.showZoomInfo?s("div",[e._v(" Zoom with "),s("kbd",[e._v("STRG")]),e._v(" or "),s("kbd",[e._v("Meta")]),e._v(" key and the mouse wheel. ")]):e._e()]):e._e(),e.parameterViewer?s("ParameterViewer",e._b({on:{close:function(t){e.parameterViewer=null}}},"ParameterViewer",e.parameterViewer,!1)):e._e()],1)},a=[],r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"div",class:e.containerClasses,style:e.styles,attrs:{id:"block"+this.id},on:{mousedown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"left",37,t.key,["Left","ArrowLeft"])?null:(t.preventDefault(),t.stopPropagation(),"button"in t&&0!==t.button?null:e.onMouseDown.apply(null,arguments))}}},[s("div",{staticClass:"blockTitle",on:{mousedown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"left",37,t.key,["Left","ArrowLeft"])?null:(t.preventDefault(),t.stopPropagation(),"button"in t&&0!==t.button?null:e.emitDrag.apply(null,arguments))}}},[s("span",{staticClass:"titleText",attrs:{title:e.plainTitle}},[s("span",{directives:[{name:"show",rawName:"v-show",value:e.invalid,expression:"invalid"}],staticClass:"invalid",attrs:{title:"Process or Collection not supported!"}},[s("i",{staticClass:"fas fa-exclamation-triangle"})]),e._v(" "+e._s(e.name)+" "),e.showId?s("span",{staticClass:"blockId"},[e._v(e._s(e.id))]):e._e()]),s("div",{staticClass:"blockicon",on:{mousedown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"left",37,t.key,["Left","ArrowLeft"])?null:(t.preventDefault(),t.stopPropagation(),"button"in t&&0!==t.button?null:e.focus())}}},[s("span",{directives:[{name:"show",rawName:"v-show",value:e.allowsDescription&&!e.showDescriptionField,expression:"allowsDescription && !showDescriptionField"}],staticClass:"addDescription",attrs:{title:"Add description"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.addDescription()}}},[s("i",{staticClass:"fas fa-comment-medical"})]),s("span",{directives:[{name:"show",rawName:"v-show",value:e.allowsDelete,expression:"allowsDelete"}],staticClass:"delete",attrs:{title:"Remove (DEL)"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.remove()}}},[s("i",{staticClass:"fas fa-trash"})]),s("span",{directives:[{name:"show",rawName:"v-show",value:e.allowsInfo,expression:"allowsInfo"}],staticClass:"info",attrs:{title:"Details"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.showInfo()}}},[s("i",{staticClass:"fas fa-info"})]),s("span",{directives:[{name:"show",rawName:"v-show",value:e.allowsParameterChange,expression:"allowsParameterChange"}],staticClass:"settings",attrs:{title:e.isParameter?"Edit parameter":"Change parameter values"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.edit.apply(null,arguments)}}},[s("i",{staticClass:"fas fa-edit"})])])]),s("div",{staticClass:"inout"},[s("div",{staticClass:"inputs"},e._l(e.parameters,(function(t,i){return s("BlockParameter",{key:i,ref:"parameters",refInFor:!0,attrs:{state:e.state,value:e.args[t.name],name:t.name,description:t.description,optional:t.optional,deprecated:t.deprecated,experimental:t.experimental,default:t.default,schema:t.schema},on:{input:function(s){return e.updateArgument(t.name,s)},edgesChanged:function(s){return e.edgesChanged(t,s)}}})})),1),s("div",{staticClass:"outputs"},[s("BlockParameter",e._b({ref:"output",attrs:{state:e.state,label:e.outputLabel},on:{input:e.updateResult}},"BlockParameter",e.output,!1))],1)]),e.showDescriptionField?s("textarea",{ref:"descriptionField",staticClass:"editDescription",attrs:{readonly:!e.state.editable,placeholder:"Type description here..."},domProps:{value:e.description},on:{blur:e.updateDescription,mousedown:function(e){e.stopPropagation()}}}):e._e()])},n=[],o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{class:e.classes},[e.output?e._e():s("div",e._g({ref:"circle",class:e.circleClasses},e.circleListeners)),s("span",e._g({staticClass:"text"},e.textListeners),[s("span",{directives:[{name:"show",rawName:"v-show",value:e.unspecified,expression:"unspecified"}],staticClass:"unspecified",attrs:{title:"Parameter is likely unsupported!"}},[s("i",{staticClass:"fas fa-exclamation-triangle"})]),s("span",{staticClass:"label"},[e._v(e._s(e.displayLabel))]),e.displayValue.length?[e._v(": ")]:e._e(),s("span",{staticClass:"value",domProps:{innerHTML:e._s(e.displayValue)}})],2),e.output?s("div",e._g({ref:"circle",class:e.circleClasses,attrs:{title:"Output of the process"}},e.circleListeners)):e._e()])},l=[],c=s("fbda"),u=s("a76e"),d=s("60a2"),h={name:"BlockParameter",props:{name:{type:String,default:"output"},description:{type:String,default:""},optional:{type:Boolean,default:!1},deprecated:{type:Boolean,default:!1},experimental:{type:Boolean,default:!1},default:{},value:{},schema:{type:[Object,Array],default:null},label:{type:String},output:{type:Boolean,default:!1},state:{type:Object,required:!0}},data(){return{edges:[]}},computed:{schemas(){return this.schema instanceof c["ProcessSchema"]?this.schema:new c["ProcessSchema"](this.schema)},hasValue(){return void 0!==this.value},textListeners(){return this.allowsArgumentChange?{click:this.openEditorForArguments}:{}},circleListeners(){var e={};return this.state.editable&&(e.mousedown=e=>{1==e.which&&(this.state.root.link(this),e.preventDefault(),e.stopPropagation())},this.output&&(e.dblclick=e=>{1==e.which&&this.$emit("input",!0)}),e.mouseover=()=>this.state.linkFrom&&this.state.root.link(this),e.mouseout=()=>this.state.linkTo&&this.state.root.unlink(this)),e},classes(){let e=[this.output?"output":"input","connector","field_"+this.name,this.hasValue||this.optional||this.output||this.getEdgeCount()>0?"hasValue":"noValue"];return this.allowsArgumentChange&&e.push("editable"),e},unspecified(){return!this.$parent.invalid&&this.state.root.hasProcesses&&this.schemas.unspecified},circleClasses(){var e=["circle"];for(var t of(this.getEdgeCount()>0&&e.push("io_active"),this.edges))t.selected?e.push("io_selected"):t.issues.length>0&&e.push("io_issues");return this.state.linkFrom!=this&&this.state.linkTo!=this||e.push("io_selected"),e},displayValue(){var e=38-this.displayLabel.length,t=null;if(this.isEditable&&!this.state.compactMode&&!d["a"].isRef(this.value)){let s="undefined"!==typeof this.value?this.value:this.default;"undefined"!==typeof s&&(t=this.formatValue(s,e,!0))}return"string"===typeof t?0===t.length&&(t="<em>Empty</em>"):t="",t},displayLabel(){return this.output&&this.state.compactMode?"":"string"===typeof this.label&&(this.label.length>0||this.output)?this.label:this.name},isArrayType(){return"array"===this.schemas.nativeDataType()},isObjectType(){return"object"===this.schemas.nativeDataType()},isEditable(){return!this.output&&this.schemas.isEditable()},allowsArgumentChange(){return!this.output&&this.schemas.isEditable()},allowsMultipleInputs(){return this.isArrayType||this.isObjectType||"any"===this.schemas.nativeDataType()}},watch:{edges(){this.updateEdgeStatus(),this.$emit("edgesChanged",this.edges,this)},value:{immediate:!0,handler(){this.updateEdgeStatus()}}},methods:{updateEdgeStatus(){if(!this.output)for(var e of this.edges)e.inactive=!this.isEdgeUsed(e)},getCirclePosition(){try{var e=this.state.root.domBoundingBox(this.$refs.circle),t=this.state.root.getDimensions(),s=e.offsetLeft-t.offsetLeft+e.width/2,i=e.offsetTop-t.offsetTop+e.height/2;return[s,i]}catch(a){return console.warn(a),null}},openEditorForArguments(){this.allowsArgumentChange&&this.$parent.showArguments(this.name)},jsonSchema(){return this.schemas.toJSON()},setValue(e){"boolean"!=this.schemas.nativeDataType()||d["a"].isRef(e)||(e=!!e),this.$emit("input",e)},resetValue(){if("undefined"===typeof this.default){var e;if(this.schemas.nullable())e=null;else{var t=this.schemas.nativeDataType();switch(t){case"object":e={};break;case"array":e=[];break;case"string":e="";break;case"integer":case"number":e=0;break;case"boolean":e=!1;break;default:e=void 0}}this.setValue(e)}else this.setValue(this.default)},getEdgeRef(e){return this.output?this.value:e.parameter1.value},addRefToValue(e){var t=this.getEdgeRef(e);if(t)if(this.allowsMultipleInputs)if(this.isArrayType)if(d["a"].isRef(this.value))this.setValue([this.value,t]);else if(Array.isArray(this.value)&&this.value.length>0){var s=this.value;s.push(t),this.setValue(s)}else this.setValue(t);else if(this.isObjectType){var i=d["a"].size(this.value);1!==this.getEdgeCount()||this.hasValue&&i?i||this.resetValue():this.setValue(t)}else this.setValue(t);else this.setValue(t)},removeRefFromValue(e){if(!this.output){var t=this.getEdgeRef(e);d["a"].isRefEqual(t,this.value)?this.resetValue():(this.isArrayType||this.isObjectType)&&this.setValue(this.removeRefFromValueDeep(this.value,t))}},removeRefFromValueDeep(e,t){if(Array.isArray(e)){var s=e.length;while(--s>=0)null!==e[s]&&"object"===typeof e[s]&&(d["a"].isRefEqual(t,e[s])?e.splice(s,1):e[s]=this.removeRefFromValueDeep(e[s],t))}else if(d["a"].isObject(e))for(var i in e)e.hasOwnProperty(i)&&null!==e[i]&&"object"===typeof e[i]&&(d["a"].isRefEqual(t,e[i])?delete e[i]:e[s]=this.removeRefFromValueDeep(e[i],t));return e},addEdge(e){this.edges.push(e),this.isEdgeUsed(e)||this.output||this.addRefToValue(e)},eraseEdge(e){for(var t in this.edges)if(this.edges[t]==e)return this.removeRefFromValue(e),this.$delete(this.edges,t),!0;return!1},isEdgeUsed(e){var t=this.getEdgeRef(e);return!!d["a"].isRefEqual(t,this.value)||this.hasRefInValue(t,this.value)},hasRefInValue(e,t){if(!t||"object"!==typeof t)return!1;if(d["a"].isRefEqual(e,t))return!0;for(let s in t)if(this.hasRefInValue(e,t[s]))return!0;return!1},getEdgeCount(){return this.edges.length},formatProcess(e,t){if(e instanceof u["ProcessGraph"]&&1===e.getNodeCount())return this.formatValue(e.getResultNode().process_id,t);var s=Object.values(e.process_graph);return 1===s.length?this.formatValue(s[0].process_id,t):"Process"},formatValue(e,t,s=!0){if("object"===typeof e)return null===e?"n/a":Array.isArray(e)?this.formatArray(e,t,s):this.formatObject(e,t,s);if("string"===typeof e){if(e.length>t){var i=d["a"].htmlentities(e.substr(0,t));return s?i+'<span title="'+d["a"].htmlentities(e)+'">…</span>':i}return d["a"].htmlentities(e)}return"boolean"===typeof e?e?"✔️":"❌":"number"===typeof e?e.toString():d["a"].htmlentities(JSON.stringify(e))},formatArray(e,t,s=!0){let i=[];for(let a in e){let r=e[a],n=this.formatValue(r,10,s),o=d["a"].htmlentities_decode(this.formatValue(r,10,!1));if(o.length>t){if(0===i.length)return this.formatArraySimple(e,"List("+e.length+")");i.push(this.formatArraySimple(e,"…"));break}i.push(n),t-=o.length+2}return i.join(", ")},formatArraySimple(e,t,s=!0){if(s&&e.length<10){let s=e.map(e=>this.formatValue(e,25,!1)).join(", ");return'<span title="'+s+'">'+t+"</span>"}return t},formatObject(e,t,s=!0){return 0===Object.keys(e).length?"None":e instanceof u["ProcessGraph"]||d["a"].isObject(e.process_graph)?this.formatProcess(e,t):d["a"].isRef(e)?this.formatValue(d["a"].formatRef(e),t):"undefined"!==typeof e.west&&"undefined"!==typeof e.east&&"undefined"!==typeof e.south&&"undefined"!==typeof e.north?t>=12?"Bounding Box":"BBox":d["a"].detectGeoJson(e)?this.formatValue(e.type,t):s?'<span title="'+d["a"].htmlentities(JSON.stringify(e))+'">Object</span>':"Object"}}},p=h,m=(s("e4ec"),s("2877")),f=Object(m["a"])(p,o,l,!1,null,null,null),g=f.exports,y={defaultScale:1.3,blockWidth:{compactParams:110,compact:60,normalParams:220,normal:110}};const b=10;var v={name:"Block",components:{BlockParameter:g},props:{id:{type:String,required:!0},type:{type:String,required:!0},selected:{type:Boolean,default:!1},position:{type:Array,required:!0},process_id:{type:String},namespace:{type:String,default:null},description:{type:String,default:null},args:{type:Object,default:()=>({})},result:{type:Boolean,default:!1},origin:{type:String,default:null},spec:{type:Object,default:()=>null},state:{type:Object,required:!0}},data(){return{showDescriptionField:!1,drag:null}},watch:{"state.compactMode"(){this.$emit("moved",this.position)},description:{immediate:!0,handler(){this.showDescriptionField=null!==this.description}}},computed:{width(){let e=y.blockWidth;return this.parameters.length>0?this.state.compactMode?e.compactParams:e.normalParams:this.state.compactMode?e.compact:e.normal},styles(){return{marginLeft:Math.round(this.state.center[0]+this.position[0]*this.state.scale)+"px",marginTop:Math.round(this.state.center[1]+this.position[1]*this.state.scale)+"px",fontSize:Math.round(this.state.scale*b)+"px",width:Math.round(this.state.scale*this.width)+"px"}},plainTitle(){let e=[];return e.push(this.name),this.namespace&&e.push("@"+this.namespace),this.showId&&e.push(" "+this.id),e.join("")},name(){switch(this.type){case"process":return this.collectionId?this.collectionId:this.processId;case"parameter":return this.spec.name;default:return this.id.substr(1)}},outputLabel(){return this.result?"Result":this.isParameter?"Process Parameter":""},containerClasses(){var e=["block"];return this.collectionId?e.push("block_collection"):this.isParameter&&e.push("block_argument"),this.result&&e.push("block_result"),this.selected&&e.push("block_selected"),this.invalid&&e.push("block_invalid"),e},invalid(){if("process"!==this.type||!this.$parent.hasProcesses)return!1;if(this.namespace&&d["a"].isUrl(this.namespace))return!1;if(!this.processId)return!0;if(!this.spec)return!0;if("load_collection"===this.processId&&!d["a"].isRef(this.args.id)){for(let e of this.$parent.collections)if(this.args.id===e.id)return!1;return!0}return!1},processId(){if("process"===this.type){if(this.process_id)return this.process_id;if(d["a"].isObject(this.spec)&&this.spec.id)return this.spec.id}return null},collectionId(){return"process"!==this.type||"load_collection"!==this.processId||d["a"].isRef(this.args.id)?null:this.args.id},isParameter(){return"parameter"===this.type},allowsParameterChange(){return this.isParameter?this.state.editable&&!!this.$parent.supports("editParameter"):this.parameters.filter(e=>e.isEditable()).length>0},allowsDelete(){return this.state.editable&&(!this.spec||d["a"].isObject(this.spec)&&"schema"!==this.origin)},allowsInfo(){return this.collectionId?this.$parent.supports("showCollection"):this.isParameter?d["a"].isObject(this.spec)&&this.$parent.supports("showParameter"):this.$parent.supports("showProcess")},allowsDescription(){return this.state.editable&&"process"===this.type},showId(){return"parameter"!==this.type},hasParametersDefined(){return Boolean(d["a"].isObject(this.spec)&&Array.isArray(this.spec.parameters)&&this.spec.parameters.length>0)},parameters(){let e=[],t=[];if(this.hasParametersDefined&&(t=this.spec.parameters.map(e=>new c["ProcessParameter"](e)),e=t.map(e=>e.name)),d["a"].size(this.args)>0)for(var s in this.args)e.includes(s)||t.push(new c["ProcessParameter"]({name:s,description:""}));return t},fields(){var e={};for(var t of this.parameters)e[t.name]=t;return e.output=this.output,e},output(){var e={};d["a"].isObject(this.spec)&&(this.isParameter?e=this.spec:d["a"].isObject(this.spec.returns)&&(e=this.spec.returns));var t={name:"output",schema:e.schema||{},description:e.description||"",optional:!0,output:!0,value:{}};return this.isParameter?t.value.from_parameter=this.id.substr(1):t.value.from_node=this.id.substr(1),t}},mounted(){this.draggingFn=this.dragging.bind(this),document.addEventListener("mousemove",this.draggingFn),this.stopDragFn=this.stopDrag.bind(this),document.addEventListener("mouseup",this.stopDragFn),this.$emit("mounted",this)},beforeDestroy(){document.removeEventListener("mousemove",this.draggingFn),document.removeEventListener("mouseup",this.stopDragFn),this.$emit("unmounted",this)},methods:{edit(){this.isParameter?this.editParameter():this.showArguments()},hasParameter(e){return this.hasParametersDefined&&!!this.spec.parameters.find(t=>t.name===e)},updateDescription(e){let t;t="string"===typeof e.target.value&&e.target.value.length>0?e.target.value:null,this.showDescriptionField=null!==t,this.description!==t&&this.$emit("update","description",t)},updatePosition(e,t=!0){e=d["a"].ensurePoint(e),this.position[0]===e[0]&&this.position[1]===e[1]||this.$emit("update","position",e,t)},updateArguments(e){let t=Object.keys(this.args).filter(t=>"undefined"===typeof e[t]&&(!this.hasParametersDefined||this.hasParameter(t)));for(let s of this.parameters)"undefined"!==typeof e[s.name]&&s.optional&&"undefined"!==typeof s.default&&d["a"].equals(s.default,e[s.name])&&delete e[s.name];this.$emit("update","arguments",e,t)},updateArgument(e,t){let s=d["a"].deepClone(this.args);s[e]=t,this.updateArguments(s)},updateResult(e){this.hasOutputEdges()?this.state.root.$emit("error","A result node can't have outgoing edges."):e!==this.result&&this.$emit("update","result",e)},focus(){this.$parent.focus()},onMouseDown(e){this.select(!this.selected,!e.shiftKey)},select(e=!0,t=!0){this.$emit("update","selected",e,t),this.focus()},getDimensions(){let e=this.$parent.domBoundingBox(this.$refs.div);var t=this.$parent.getDimensions();return e.x=e.offsetLeft-t.offsetLeft,e.y=e.offsetTop-t.offsetTop,e},edgesChanged(e,t){e.refs=t.map(e=>e.parameter1.value)},editParameter(){this.$parent.$emit("editParameter",this.spec,"Edit Parameter: "+this.plainTitle,e=>this.$emit("update","spec",e))},showArguments(e=null){this.$parent.$emit("editArguments",this.parameters.filter(e=>e.isEditable()),this.args,this.plainTitle,this.state.editable,e,e=>this.updateArguments(e),this)},showInfo(){this.collectionId?this.$parent.$emit("showCollection",this.collectionId):this.isParameter?this.$parent.$emit("showParameter",this.spec):this.$parent.$emit("showProcess",this.processId,this.namespace)},async addDescription(){this.select(),this.showDescriptionField=!0,await this.$nextTick(),this.$refs.descriptionField.focus()},async emitDrag(e){this.select(!0,!e.shiftKey),this.focus(),await this.$nextTick(),this.$emit("move",e)},getDragPos(e,t){return[t[0]/this.state.scale-e[0],t[1]/this.state.scale-e[1]]},startDrag(e){if(!this.selected)return;let t=this.$parent.getMousePos(e);this.drag={origin:this.position,mouse:this.getDragPos(this.position,t)}},stopDrag(){if(this.drag){var e=5/this.state.scale;(Math.abs(this.drag.origin[0]-this.position[0])>e||Math.abs(this.drag.origin[1]-this.position[1])>e)&&this.updatePosition(this.position),this.drag=null}},dragging(e){if(!this.drag)return;let t=this.$parent.getMousePos(e),s=this.getDragPos(this.drag.mouse,t);this.updatePosition(s,!1)},hasOutputEdges(){return this.$refs.output&&this.$refs.output.getEdgeCount()>0},async remove(){await this.$parent.removeBlock(this)},getBlockParameter(e){if("output"===e&&this.$refs.output)return this.$refs.output;if(Array.isArray(this.$refs.parameters)){var t=this.$refs.parameters.filter(t=>t.name===e);if(t.length>0)return t[0]}return null},isParameterScoped(e,t){let s=this.getBlockParameter(e),i=c["ProcessUtils"].getCallbackParameters(s).map(e=>e.name);return i.includes(t)},hiddenParameterRef(e){if("process"!==this.type)return null;let t=e.id.substr(1);for(let s in this.args){let e=this.args[s];if(d["a"].isObject(e)&&d["a"].isObject(e.process_graph)){let i=u["Utils"].getRefs(e,!0,!0);if(i.find(e=>e.from_parameter===t&&!this.isParameterScoped(s,e.from_parameter)))return s}}return null}}},w=v,k=(s("ccb1"),Object(m["a"])(w,r,n,!1,null,null,null)),P=k.exports,_=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("g",e._l(e.lines,(function(t,i){return s("line",e._b({key:i},"line",t,!1))})),0)},x=[];class C{constructor(e,t,s,i){this.x=e,this.y=t,this.dx=s,this.dy=i}distance(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}distanceP(e){var t=this.normal();t.x=e.x,t.y=e.y;var s=this.intersection(t);return[s[0],this.distance(t.alpha(s[1]),e)]}normal(){return new C(this.x,this.y,this.dy,-this.dx)}intersection(e){var t=this.dx,s=-e.dx,i=this.dy,a=-e.dy,r=e.x-this.x,n=e.y-this.y,o=t*a-s*i;if(0==o)return null;var l=(a*r-s*n)/o,c=(-i*r+t*n)/o;return[l,c]}alpha(e){var t={};return t.x=this.x+this.dx*e,t.y=this.y+this.dy*e,t}}var $={name:"Edge",props:{id:{},parameter1:{type:Object,required:!0},parameter2:{type:Object,required:!0},selected:{type:Boolean,default:!1},inactive:{type:Boolean,default:!1},issues:{type:Array,default:()=>[]},lineWidth:{type:Number,default:3},lineColor:{type:Array,default:()=>[255,200,0,1]},state:{type:Object,required:!0}},data(){return{position1:null,position2:null}},computed:{segment(){return new C(this.position1[0],this.position1[1],this.position2[0]-this.position1[0],this.position2[1]-this.position1[1])},scaledLineWidth(){return this.lineWidth*this.state.scale},lines(){var e=(this.position1[0]+this.position2[0])/2,t=(this.position1[1]+this.position2[1])/2,s=35*Math.PI/180,i=Math.cos(s),a=Math.sin(s),r=Math.cos(-s),n=Math.sin(-s),o=Math.sqrt(Math.pow(this.position1[0]-this.position2[0],2)+Math.pow(this.position1[1]-this.position2[1],2)),l=10*this.state.scale/(o/1.5),c=(this.position1[0]-e)*l,u=(this.position1[1]-t)*l,d=this.getLineStyle(this.scaledLineWidth,this.selected,this.inactive),h=this.getLineStyle(this.scaledLineWidth/1.5,this.selected),p=this.getLine(this.position1[0],this.position1[1],this.position2[0],this.position2[1],d);return this.inactive||o/this.state.scale<25?[p]:[p,this.getLine(e,t,e+(c*i-u*a),t+(u*i+c*a),h),this.getLine(e,t,e+(c*r-u*n),t+(u*r+c*n),h)]}},watch:{"state.center"(){this.updatePositions()},"state.scale"(){this.updatePositions()},"state.moving"(){this.updatePositions()}},created(){this.updatePositions()},mounted(){this.$emit("mounted",this)},beforeDestroy(){this.$emit("unmounted",this)},methods:{updatePositions(){let e=this.parameter1.getCirclePosition(),t=this.parameter2.getCirclePosition();e&&t&&(this.position1&&this.position2&&e[0]===this.position1[0]&&e[1]===this.position1[1]&&t[0]===this.position2[0]&&t[1]===this.position2[1]||(this.position1=Object.freeze(e),this.position2=Object.freeze(t),this.$emit("position",this.position1,this.position2)))},getLineStyle(e,t=!1,s=!1){let i=2*this.state.scale,a=this.lineColor;return t?a=[0,200,0,1]:this.issues.length>0&&(a=[255,0,0,1]),{stroke:`rgba(${a.join(", ")})`,"stroke-width":e,"stroke-dasharray":s?3*i+" "+2*i:"none"}},getLine(e,t,s,i,a={}){return Object.assign({x1:e,y1:t,x2:s,y2:i},a)},collide(e,t){if(!this.segment)return!1;var s=this.segment.distanceP({x:e,y:t});return s[0]>=0&&s[0]<=1&&s[1]<this.lineWidth*this.state.scale*2&&s[0]},equals(e){return this.parameter1==e.parameter1&&this.parameter2==e.parameter2||this.parameter1==e.parameter2&&this.parameter2==e.parameter1}}},S=$,E=Object(m["a"])(S,_,x,!1,null,null,null),D=E.exports,T=s("2b0e"),O=s("0dd6"),A=s.n(O),B=s("a13e"),M=s.n(B);const F=function(e){return T["a"].observable({root:e,editable:!1,compactMode:!1,moving:null,selecting:null,center:[0,0],mouse:[0,0],scale:y.defaultScale,linkFrom:null,linkTo:null})},j=20,R=function(e,t){Array.isArray(e)&&Array.isArray(t)&&e.length===t.length&&e.every((e,s)=>e.id===t[s].id)||this.$emit("selectionChanged",this.selectedBlocks,this.selectedEdges)};var N={name:"ModelBuilder",components:{Block:P,Edge:D,ParameterViewer:()=>s.e("chunk-7d8d4f77").then(s.bind(null,"a459"))},props:{id:{type:String,required:!0},editable:{type:Boolean,default:!1},value:{type:Object,default:()=>({})},collections:{type:Array,default:()=>[]},processes:{type:[Array,Object],default:()=>[]},parent:{type:Object,default:null},parentSchema:{type:Object,default:null},historySize:{type:Number,default:30},explicitZoom:{type:Boolean,default:!1}},data(){return{isMounted:!1,allMounted:!1,newBlockOffset:0,history:[],historyPointer:null,process:Object.freeze(this.value),blocks:[],edges:[],hiddenParameterRefEdges:{},processGraph:null,nextBlockId:1,nextEdgeId:1,clipboard:null,activeTransactions:0,hasFocus:!1,linkingLine:null,parameterViewer:null,showZoomInfo:this.explicitZoom,state:F(this)}},computed:{classes(){let e=["vue-component","model-builder"];return this.hasFocus&&e.push("focus"),this.editable&&e.push("editable"),this.state.compactMode&&e.push("compact"),this.state.scale<.5?e.push("scale_xs"):this.state.scale<.7?e.push("scale_s"):this.state.scale<.9?e.push("scale_m"):this.state.scale<1.1?e.push("scale_l"):e.push("scale_xl"),e},selectRect(){return this.state.selecting?{x:Math.min(this.state.selecting.current[0],this.state.selecting.start[0]),y:Math.min(this.state.selecting.current[1],this.state.selecting.start[1]),width:Math.abs(this.state.selecting.current[0]-this.state.selecting.start[0]),height:Math.abs(this.state.selecting.current[1]-this.state.selecting.start[1]),stroke:"rgba(0,0,0,0.8)","stroke-width":1,fill:"rgba(0,0,0,0.05)"}:null},processRegistry(){if(this.processes instanceof c["ProcessRegistry"]||"function"===typeof this.processes.count&&"function"===typeof this.processes.get)return this.processes;if(Array.isArray(this.processes))return new c["ProcessRegistry"](this.processes);throw new Error("Invalid processes specified, must be ProcessRegistry or Array")},hasProcesses(){return this.processRegistry.count()>0},processBlocks(){return this.blocks.filter(e=>"process"===e.type)},selectedBlocks(){return this.blocks.filter(e=>e.selected)},selectedEdges(){return this.edges.filter(e=>e.selected)},selectedSideEdge(){return 1===this.selectedEdges.length&&this.selectedEdges[0].selectedParameter?this.selectedEdges[0]:null},hasSelection(){return this.selectedBlocks.length>0||this.selectedEdges.length>0},processParametersFromSchemas(){let e=[];this.parent&&this.parent.$parent&&"function"===typeof this.parent.$parent.getPgParameters&&(e=this.parent.$parent.getPgParameters().map(e=>e.spec));let t=[];this.parentSchema&&(t=this.parentSchema.getCallbackParameters());let s=e.filter(e=>!t.find(t=>e.name===t.name));return t.concat(s)}},watch:{parentSchema(){this.importPgParameters(this.processParametersFromSchemas,"schema")},async value(e){this.allMounted&&(e instanceof I||(this.process=e,await this.import(e,{propagate:!1,undoOnError:!1})))},editable:{immediate:!0,handler(e){this.state.editable=e}},selectedEdges:R,selectedBlocks:R,allMounted(){this.updateHiddenParameterRefEdges()},isMounted(){this.checkAllMounted()}},beforeCreate(){d["a"].enableHtmlProps(this)},async created(){this.supports("error")||this.$on("error",(e,t=null)=>console.error(e,t)),this.supports("editArguments")||this.$on("editArguments",(...e)=>this.showParameterViewer(...e))},async mounted(){d["a"].loadFontAwesome(this),this.moveCenter(0,0,!0),this.onDocumentMouseUpFn=this.onDocumentMouseUp.bind(this),document.addEventListener("mouseup",this.onDocumentMouseUpFn),await this.importPgParameters(this.processParametersFromSchemas,"schema"),await this.import(this.value,{propagate:!1,undoOnError:!1})||this.perfectScale(),R.bind(this)(),this.isMounted=!0},beforeDestroy(){document.removeEventListener("mouseup",this.onDocumentMouseUpFn)},methods:{updateEdgePos(e,t){e.position1=t[0],e.position2=t[1]},mount(e,t=null){e.$el=t,this.checkAllMounted()},checkAllMounted(){this.isMounted?this.allMounted=!this.blocks.find(e=>!e.$el)||!this.edges.find(e=>!e.$el):this.allMounted=!1},updateBlockArguments(e,t,s){s.length>0&&this.parameterRemoved(e,s),this.$set(e,"arguments",t),this.commit(),s.length>0&&this.$nextTick(()=>this.refreshEdges())},updateBlockDescription(e,t){this.$set(e,"description",t),this.commit()},updateBlockPos(e,t,s=!0){this.$set(e,"position",t),this.commit(null,s,!1)},updateBlockResult(e,t){this.$set(e,"result",t),this.commit()},updateBlockSelected(e,t,s=!0){s&&this.unselectAll(),this.$set(e,"selected",t),this.commit(null,!1,!1)},updateBlockSpec(e,t){let s=["name","schema","description","optional","deprecated","experimental","default"],i=d["a"].omitFromObject(e.spec,s);Object.assign(i,t),i.optional||(delete i.optional,delete i.default),i.deprecated||delete i.deprecated,i.experimental||delete i.experimental,this.$set(e,"spec",i),this.commit()},updateBlock(e,t,s,i){switch(t){case"arguments":this.updateBlockArguments(e,s,i);break;case"description":this.updateBlockDescription(e,s);break;case"position":this.updateBlockPos(e,s,i);break;case"result":this.setResultNode(e,s);break;case"selected":this.updateBlockSelected(e,s,i);break;case"spec":this.updateBlockSpec(e,s);break}},updateHiddenParameterRefEdges(){if(!this.hasProcesses||!this.allMounted||!this.blocks.find(e=>"parameter"===e.type))return void(this.hiddenParameterRefEdges={});let e={};for(let s of this.processBlocks)for(let i in s.arguments){let a=s.arguments[i];if(!d["a"].isObject(a)||!d["a"].isObject(a.process_graph))continue;let r=u["Utils"].getRefs(a,!0,!0).filter(e=>"undefined"!==typeof e.from_parameter);for(let n of r)try{if(s.$el.isParameterScoped(i,n.from_parameter))continue;let t=this.getPgParameterById("$"+n.from_parameter);if(!t)continue;let a=t.$el.getBlockParameter("output"),r=s.$el.getBlockParameter(i),o=`${t.id}->${s.id}:${i}`;a&&r&&(this.hiddenParameterRefEdges[o]?e[o]=this.hiddenParameterRefEdges[o]:e[o]={$el:null,id:o,parameter1:a,parameter2:r})}catch(t){console.warn(t)}}this.hiddenParameterRefEdges=e},parameterRemoved(e,t){for(let s of this.edges.slice(0))s.parameter2.$parent.id===e.id&&t.includes(s.parameter2.name)&&this.removeEdge(s)},startDragBlock(e){for(let t of this.blocks)t.$el&&t.$el.startDrag(e)},refreshEdges(){this.refreshEdgesFor(this.edges),this.refreshEdgesFor(Object.values(this.hiddenParameterRefEdges))},refreshEdgesFor(e){for(let t of e)t.$el&&t.$el.updatePositions()},supports(e){return Boolean(this.$listeners&&this.$listeners[e])},focus(){this.$refs.div.focus()},link(e){this.state.linkFrom?this.state.linkTo=e:this.state.linkFrom=e},unlink(e=null){e?this.state.linkTo==e?this.state.linkTo=null:this.state.linkFrom==e&&(this.state.linkFrom=null,this.linkingLine=null):(this.state.linkTo=null,this.state.linkFrom=null,this.linkingLine=null)},multiSelect(){let e=this.selectRect;this.blocks.filter(t=>{if(Array.isArray(t.position)&&t.$el){let s=t.$el.getDimensions();return A()(e.x,e.y,e.width,e.height,s.x,s.y,s.width,s.height)}return!1}).map(e=>e.selected=!0),this.edges.filter(t=>Array.isArray(t.position1)&&Array.isArray(t.position2)&&M()(e.x,e.y,e.width,e.height,t.position1[0],t.position1[1],t.position2[0],t.position2[1])).map(e=>e.selected=!0)},toJSON(){let e=this.export();return JSON.stringify(e,null,2)},async onDocumentMouseUp(e){if(!this.parameterViewer&&(this.selectedSideEdge&&this.selectEdge(this.selectedSideEdge,null),this.state.selecting&&(this.multiSelect(),this.state.selecting=null),this.state.moving&&(this.state.moving=null),this.state.editable&&this.state.linkFrom)){if(1==e.which&&this.state.linkTo)try{await this.addEdge(this.state.linkFrom,this.state.linkTo)}catch(t){this.$emit("error",t)}this.unlink()}},async onKeyDown(e){if(this.parameterViewer)return;var t=document.querySelectorAll("input, textarea, button, select, datalist");for(let a of t)if(a===document.activeElement)return;let s=!1;if(this.state.editable)if("Delete"===e.code)this.deleteSelected(),s=!0;else if(e.ctrlKey||e.metaKey)if("KeyV"===e.code){if(this.hasSelection&&this.clipboard)return;try{const e=await navigator.clipboard.readText();let t=JSON.parse(e);await this.import(t)}catch(i){this.$emit("error",i,"Paste Error")}s=!0}else if("KeyC"===e.code){if(this.hasSelection)this.clipboard={blocks:this.selectedBlocks.slice(0),edges:this.selectedEdges.slice(0)};else try{let e=this.toJSON();await navigator.clipboard.writeText(e),s=!0}catch(i){this.$emit("error",i,"Copy Error")}s=!0}s&&(e.preventDefault(),e.stopPropagation())},onMouseWheel(e){if(!this.parameterViewer&&(!this.explicitZoom||this.hasFocus||e.ctrlKey||e.metaKey)){let a=this.getMousePos(e);var t=a[0]-this.state.center[0],s=a[1]-this.state.center[1],i=Math.pow(1.1,-1*Math.sign(e.deltaY));this.moveCenter(-t*(i-1),-s*(i-1)),this.state.scale*=i,e.preventDefault(),this.showZoomInfo=!1}},domBoundingBox(e){var t=e.getBoundingClientRect();return t.offsetTop=t.top+Math.max(document.documentElement.scrollTop,document.body.scrollTop),t.offsetLeft=t.left+Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),t},getMousePos(e){let t=this.$refs.div.getBoundingClientRect();return[e.clientX-t.left,e.clientY-t.top]},onMouseMove(e){if(!this.parameterViewer)try{let a=this.getMousePos(e);if(this.state.editable&&this.selectedSideEdge){var t=this.selectedSideEdge.selectedParameter.getCirclePosition();if(t){var s=Math.sqrt(Math.pow(a[0]-t[0],2)+Math.pow(a[1]-t[1],2));s>10&&(this.link(this.selectedSideEdge.selectedParameter),this.removeEdge(this.selectedSideEdge),this.commit())}}if(this.state.selecting&&(this.state.selecting.current=a),this.state.moving&&(this.moveCenter(a[0]-this.state.moving[0],a[1]-this.state.moving[1]),this.state.moving=a),this.state.linkFrom){var i=this.state.linkFrom.getCirclePosition();i&&(this.linkingLine={x1:i[0],y1:i[1],x2:a[0],y2:a[1],stroke:"rgba(0,0,0,0.4)","stroke-width":3*this.state.scale})}}catch(a){this.$emit("error",a)}},onMouseDown(e){if(this.parameterViewer)return;let t=null,s=this.getMousePos(e);if(1==e.which)for(var i of(e.shiftKey?this.state.selecting={start:s,current:s}:this.unselectAll(),this.edges))if(i.$el){var a=i.$el.collide(s[0],s[1]);if(0!=a){if(0!==this.selectedEdges.length||e.shiftKey||(a<.3?t=i.parameter2:a>.7&&(t=i.parameter1)),this.selectEdge(i,!0,t),i.issues.length>0)for(let e of i.issues)this.$emit("error",e);e.preventDefault();break}}2!=e.which&&(1!=e.which||t||e.shiftKey)||(this.state.moving=s),this.focus()},getDimensions(){return this.domBoundingBox(this.$refs.div)},async clear(){return await this.startTransaction(async()=>(this.edges=[],this.blocks=this.blocks.filter(e=>"parameter"===e.type&&d["a"].isObject(e.spec)&&"schema"===e.origin),this.nextBlockId=1,this.nextEdgeId=1,this.process={},this.updateHiddenParameterRefEdges(),!0))},commit(e=null,t=!0,s=!0){this.activeTransactions>0||(!1!==t&&this.saveHistory(),!1!==s?(this.$emit("input",null===e?this.export():e),this.updateHiddenParameterRefEdges()):this.refreshEdges())},saveHistory(){var e=this.export(!0);this.history.splice(this.historyPointer+1,this.historySize,Object.freeze(e)),this.history.length>this.historySize&&this.history.shift(),this.historyPointer=this.history.length-1,this.$emit("historyChanged",this.history,this.historyPointer)},async undo(){await this.historyStep(-1)},async redo(){await this.historyStep(1)},async historyStep(e){var t=this.historyPointer+e,s=this.history[t];s&&(this.historyPointer=t,this.import(s,{saveHistory:!1,undoOnError:!1,perfectScale:!1}),this.$emit("historyChanged",this.history,this.historyPointer))},setResultNode(e,t=!0){if(e=this.getBlockById(e.id),e&&e.result!==t){this.updateBlockResult(e,t);var s=!1,i=!1;for(var a of this.processBlocks)if(!e||a.id!==e.id)if(i=!0,t)this.updateBlockResult(a,!1);else if(a.$el&&!a.$el.hasOutputEdges()){this.updateBlockResult(a,!0),s=!0;break}!i||t||s||this.$emit("error","No result node available, please specify one.")}},getPositionForPageXY(e,t){var s=this.getDimensions();return null!==e&&(e=(e-s.offsetLeft-this.state.center[0])/this.state.scale),null!==t&&(t=(t-s.offsetTop-this.state.center[1])/this.state.scale),[e,t]},addProcess(e,t={},s=[],i=null){return this.addBlock({process_id:e,namespace:i,arguments:t,position:s})},addBlock(e,t=null){let s=String(this.incrementId(t));null===t&&d["a"].hasText(e.process_id)?(t=e.process_id.replace(/^([a-z]*).*$/i,"$1")+s,this.getBlockById("#"+t)&&(t=s)):t=s,"function"===typeof e.toJSON&&(e=e.toJSON());var i={id:"#"+t,type:"process",selected:!1,position:e.position,process_id:e.process_id,namespace:e.namespace,arguments:e.arguments,description:e.description||null,result:e.result||!1};this.processRegistry&&(i.spec=this.processRegistry.get(e.process_id,e.namespace));var a=this.getBlockSize(i);return i.position=d["a"].ensurePoint(i.position,()=>this.getNewBlockDefaultPosition(a)),i.result&&this.blocks.filter(e=>!0===e.result).length?delete i.result:0===this.processBlocks.length&&(i.result=!0),this.blocks.push(T["a"].observable(i)),this.commit(),i},getNewBlockDefaultPosition(e){var t=this.getDimensions(),s=[(-this.state.center[0]+t.width/2)/this.state.scale-e[0]/2+this.newBlockOffset,(-this.state.center[1]+t.height/2)/this.state.scale-e[1]/2+this.newBlockOffset];return this.newBlockOffset<150&&(this.newBlockOffset+=10),s},getBlockSize(e){if(e.$el){let t=e.$el.getDimensions();return[t.width/this.state.scale,t.height/this.state.scale]}let t,s=Math.max(d["a"].size(e.arguments),d["a"].isObject(e.spec)?d["a"].size(e.spec.parameters):0),i=y.blockWidth;t=s>0?this.state.compactMode?i.compactParams:i.normalParams:this.state.compactMode?i.compact:i.normal;let a="string"===typeof e.description?40:0,r=j+15*s+a;return[t,r]},moveCenter(e,t,s=!1){var i=this.getDimensions();this.state.center=[(s?i.width/2:this.state.center[0])+e,(s?i.height/2:this.state.center[1])+t],this.newBlockOffset=0},unselectAll(){for(var e of this.blocks)this.updateBlockSelected(e,!1,!1);for(var t of this.edges)this.selectEdge(t,!1)},selectEdge(e,t=!0,s=null){return d["a"].isObject(e)||(e=this.edges[e]),e.selected!==t&&(null!==t&&this.$set(e,"selected",t),this.$set(e,"selectedParameter",s),!0)},removeEdge(e){e.parameter1.eraseEdge(e),e.parameter2.eraseEdge(e),this.$delete(this.edges,this.edges.indexOf(e))},async removeBlock(e){if("parameter"===e.type){let t=null,s=this.blocks.find(s=>(t=s.$el.hiddenParameterRef(e),null!==t));if(s)throw new Error(`Parameter is still used in '${s.id}', parameter '${t}'. Only unused parameters can be deleted.`)}return await this.startTransaction(async()=>{var t=this.blocks.findIndex(t=>t.id==e.id);if(t<0)return!1;for(var s of this.edges.slice(0))s.parameter1.$parent.id!==e.id&&s.parameter2.$parent.id!==e.id||this.removeEdge(s);return e.result&&this.setResultNode(e,!1),this.$delete(this.blocks,t),!0})},getBlockById(e){var t=this.blocks.filter(t=>t.id===e);return t.length>0?t[0]:null},async deleteSelected(){return!!this.hasSelection&&await this.startTransaction(async()=>{for(var e of this.selectedBlocks.slice(0))e.$el.allowsDelete&&await this.removeBlock(e);for(var t of this.selectedEdges.slice(0))this.removeEdge(t);return!0})},async addEdgeByNames(e,t,s,i){var a=[];for(var r of[e,s]){var n=this.getBlockById(r);if(!n)throw"Can't find block: "+r;if(!n.$el)throw"Block not mounted yet: "+r;a.push(n.$el)}await this.addEdge(a[0].getBlockParameter(t),a[1].getBlockParameter(i))},async addEdge(e,t){if(!e||!t)throw"One of the parameters is invalid.";if(e!=t){if(e.$parent==t.$parent)throw"You can't link a block to itself";var s=this.nextEdgeId++,i={id:s,selected:!1,inactive:!1,issues:[],$el:null};if(e.output?(i.parameter1=e,i.parameter2=t):(i.parameter1=t,i.parameter2=e),i.parameter1.output===i.parameter2.output)throw"You have to link an input with an output";if(-1!==this.allSuccessors(i.parameter1).indexOf(i.parameter2.id))throw"You can not create a loop";if(i.parameter2.getEdgeCount()>0&&!i.parameter2.allowsMultipleInputs)throw"Parameter accepts only one input";for(var a of this.edges)if(a.$el&&a.$el.equals(i))throw"This connection exists already";if(!u["JsonSchemaValidator"].isSchemaCompatible(i.parameter2.schema||{},i.parameter1.schema||{},!1,!0)){let e='Incoming data type is not compatible for parameter "'+i.parameter2.name+'"';i.issues.push(e),this.$emit("error",e)}return await this.startTransaction(async()=>(this.unlink(),this.edges.push(T["a"].observable(i)),i.parameter1.addEdge(i),i.parameter2.addEdge(i),this.setResultNode(i.parameter1.$parent,!1),!0))}},allSuccessors(e){var t=e.$parent,s={},i=[t];s[t.id]=!0;while(i.length>0){var a=i.pop();for(var r in a.edges)for(var n in a.edges[r]){var o=a.edges[r][n];if(o.block1==a){var l=o.block2;l.id in s||(s[l.id]=!0,i.push(l))}}}return Object.values(s)},async toggleCompact(){this.state.compactMode=!this.state.compactMode,this.$emit("compactMode",this.state.compactMode),await this.$nextTick(),this.refreshEdges()},export(e=!1){let t={process_graph:{}};for(let s of this.processBlocks){let i=["process_id","namespace","arguments","description","result"];e&&i.push("position");let a=d["a"].pickFromObject(s,i);null===a.description&&delete a.description,!0!==a.result&&delete a.result,a.namespace||delete a.namespace;let r=s.id.substr(1);t.process_graph[r]=a}if(!this.parent){t.parameters=[];let e=this.getPgParameters();for(let s of e)t.parameters.push(s.spec)}return new I(Object.assign({},this.process,t))},async startTransaction(e,t={},...s){let i;this.activeTransactions++;try{i=await e(s)}catch(a){if(this.$emit("error",a,"Model is invalid"),!1!==t.undoOnError)try{await this.undo()}catch(r){this.$emit("error",a,"Revert failed")}i=!1}return this.activeTransactions--,this.commit(null,t.saveHistory,t.propagate),i},async import(e,t={}){return await this.startTransaction(async()=>{if(!1!==t.clear&&(await this.clear(),this.process=e instanceof u["ProcessGraph"]?e.toJSON():e),!d["a"].isObject(e))return!1;let s;return e instanceof u["ProcessGraph"]?(s=new u["ProcessGraph"](e.toJSON(),this.processRegistry),s.setParent(e.parentProcessId,e.parentParameterName)):s=new u["ProcessGraph"](e,this.processRegistry),s.allowEmpty(),s.parse(),this.processGraph=Object.freeze(s),await this.importPgParameters(this.processGraph.getProcessParameters(!0),"user",!1!==t.clear),await this.importNodes(this.processGraph.getStartNodes()),await this.importEdges(this.processGraph),!1!==t.perfectScale&&this.perfectScale(),this.$nextTick(()=>this.updateHiddenParameterRefEdges()),!0},t)},async importPgParameters(e,t,s=!0){if(!Array.isArray(e))return;let i={undoOnError:!1,saveHistory:!1,propagate:!1};return await this.startTransaction(async()=>{s&&(this.blocks=this.blocks.filter(e=>"parameter"!==e.type||e.origin!==t));let i=this.getBlockSize({}),a=[0,0];for(var r in e)a=[-i[0]-j,r*(i[1]+j)],await this.addPgParameter(e[r],t,a)},i)},async addPgParameter(e,t="user",s=null){return await this.startTransaction(async()=>{let i="$"+e.name;return!(this.blocks.findIndex(e=>"parameter"===e.type&&e.id==i)>=0)&&(e=d["a"].deepClone(e),"undefined"===typeof e.schema&&(e.schema={}),this.blocks.push(T["a"].observable({id:i,type:"parameter",origin:t,position:d["a"].ensurePoint(s,()=>this.getNewBlockDefaultPosition(this.getBlockSize({}))),spec:Object.freeze(e)})),!0)})},getPgParameters(){return this.blocks.filter(e=>"parameter"===e.type)},getPgParameterById(e){return this.blocks.find(t=>"parameter"===t.type&&t.id===e)},async importEdges(e){var t=e.getNodes();for(var s of Object.values(t)){var i=s.getArgumentNames();for(let t in i){var a=s.getRawArgument(i[t]);switch(s.getArgumentType(i[t])){case"result":await this.addEdgeByNames("#"+e.getNode(a.from_node).id,"output","#"+s.id,i[t],!1);break;case"parameter":await this.addEdgeByNames("$"+a.from_parameter,"output","#"+s.id,i[t],!1);break;case"object":case"array":await this.importEdgeDeep(a,e,s,i,t);break}}}},async importEdgeDeep(e,t,s,i,a){for(let r in e)if(e[r]&&"object"===typeof e[r]&&"process_graph"!==r)await this.importEdgeDeep(e[r],t,s,i,a);else{if(!d["a"].isRef(e))continue;e.from_node?await this.addEdgeByNames("#"+t.getNode(e.from_node).id,"output","#"+s.id,i[a],!1):e.from_parameter&&await this.addEdgeByNames("$"+e.from_parameter,"output","#"+s.id,i[a],!1)}},async importNodes(e,t=0,s=0,i=[]){let a=[],r=0;for(let n of e){if(i.includes(n.id)||void 0!==n.getPreviousNodes().find(e=>!i.includes(e.id))){s+=j/2;continue}let e="function"===typeof n.toJSON?n.toJSON():n;e.position=d["a"].ensurePoint(e.position,()=>[t,s]);let o=this.addBlock(e,n.id);i.push(n.id);let l=this.getBlockSize(o);r=Math.max(r,e.position[0]+l[0]),s=e.position[1]+l[1]+j,a=a.concat(n.getNextNodes())}a.length&&await this.importNodes(a,r+j,0,i)},incrementId(e=null){"number"===typeof e||"string"===typeof e&&0!==e.length||(e=this.nextBlockId,this.nextBlockId++);let t=Number.parseInt(e,10);return Number.isNaN(t)||(this.nextBlockId=Math.max(this.nextBlockId,t+1)),e},perfectScale(){if(this.$refs.div&&0!==this.blocks.length){var e=null,t=null,s=null,i=null;for(let a of this.blocks){let r=this.getBlockSize(a),n=d["a"].ensurePoint(a.position);null==e?(e=n[0]-15,t=n[0]+r[0]+15,s=n[1]-15,i=n[1]+r[1]+15):(e=Math.min(e,n[0]-15),t=Math.max(t,n[0]+r[0]+15),s=Math.min(s,n[1]-15),i=Math.max(i,n[1]+r[1]+15))}var a=this.$refs.div.getBoundingClientRect(),r=a.width/(t-e),n=a.height/(i-s);this.state.scale=Math.min(r,n,1.5),this.state.center=[a.width/2-this.state.scale*(e+t)/2,a.height/2-this.state.scale*(s+i)/2],this.newBlockOffset=0}},showParameterViewer(e,t,s,i,a,r,n){this.parameterViewer={parameters:e,values:t,title:s,selectParameterName:a,parent:n}}}};class I{constructor(e){Object.assign(this,e)}}var V=N,L=(s("1af9d"),Object(m["a"])(V,i,a,!1,null,null,null));t["default"]=L.exports},2979:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"vue-component search-box",class:{compact:e.compact}},[s("span",{staticClass:"icon"},[e._v("🔎")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.searchTerm,expression:"searchTerm"}],attrs:{type:"search",placeholder:e.placeholder,minlength:e.minLength,title:e.searchHint},domProps:{value:e.searchTerm},on:{input:function(t){t.target.composing||(e.searchTerm=t.target.value)}}})])},a=[],r={name:"SearchBox",props:{value:{type:String,default:""},placeholder:{type:String,default:"Search"},minLength:{type:Number,default:1},compact:{type:Boolean,default:!1}},data(){return{searchTerm:this.value}},watch:{searchTerm(e,t){e.length<this.minLength&&(e=""),this.$emit("input",e)}},computed:{searchHint(){return this.minLength>1?`Searching requires at least ${this.minLength} characters.`:null}}},n=r,o=(s("7ff9"),s("2877")),l=Object(o["a"])(n,i,a,!1,null,null,null);t["default"]=l.exports},3986:function(e,t,s){},4719:function(e,t,s){"use strict";s("e794")},"4d98":function(e,t,s){"use strict";s("c98e")},5565:function(e,t,s){"use strict";s("0d1f")},"58d3":function(e,t,s){"use strict";s("f08e")},"5aef":function(e,t,s){"use strict";e.exports=function(e,t,s,i,a){const r=Math.atan2(i-t,s-e)-Math.PI/2,n=a/2,o=Math.cos(r)*n,l=Math.sin(r)*n;return[e-o,t-l,s-o,i-l,s+o,i+l,e+o,t+l]}},6219:function(e,t,s){},"661d":function(e,t,s){"use strict";var i=s("f173"),a=s("d859");e.exports=function(e,t,s,r,n,o,l,c){return!(!i(n,o,l,c,e,t)&&!i(n,o,l,c,s,r))||(a(e,t,s,r,n,o,n+l,o)||a(e,t,s,r,n+l,o,n+l,o+c)||a(e,t,s,r,n,o+c,n+l,o+c)||a(e,t,s,r,n,o,n,o+c))}},"69d2":function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"vue-component collections"},[s("SearchableList",{attrs:{data:e.collections,identifierKey:"id",summaryKey:"title",keywordsKey:"keywords",showKeywords:e.showKeywords,showSummaryOnExpand:!1,externalSearchTerm:e.searchTerm,sort:e.sort,offerDetails:e.offerDetails,heading:e.heading,collapsed:e.collapsed,loadAdditionalData:e.loadAdditionalData},on:{detailsToggled:e.detailsToggled},scopedSlots:e._u([{key:"heading",fn:function(t){return[e._t("heading",null,null,t)]}},e.missing?{key:"content-start",fn:function(){return[s("FederationMissingNotice",{attrs:{missing:e.missing,federation:e.federation}})]},proxy:!0}:null,{key:"summary",fn:function(t){return[e._t("summary",null,null,t)]}},{key:"details",fn:function(t){return[s("Collection",{attrs:{data:t.item,mapOptions:e.mapOptions,federation:e.federation},scopedSlots:e._u([{key:"title",fn:function(){return[s("span",{staticClass:"hidden"})]},proxy:!0},{key:"before-description",fn:function(t){return[e._t("collection-before-description",null,null,t)]}},{key:"end",fn:function(t){return[e._t("collection-end",null,null,t)]}},{key:"spatial-extents",fn:function(t){return[e._t("collection-spatial-extents",null,null,t)]}},{key:"temporal-extents",fn:function(t){return[e._t("collection-temporal-extents",null,null,t)]}}],null,!0)})]}}],null,!0)})],1)},a=[],r=s("60a2"),n=s("e71d"),o={name:"Collections",components:{Collection:()=>r["a"].loadAsyncComponent(s.e("chunk-5377a15c").then(s.bind(null,"47ed"))),SearchableList:()=>r["a"].loadAsyncComponent(s.e("chunk-4f7707c2").then(s.bind(null,"d79f")))},mixins:[n["a"]],props:{collections:{type:Array,default:()=>[]},mapOptions:{type:Object,default:()=>({})},searchTerm:{type:String,default:null},sort:{type:Boolean,default:!0},offerDetails:{type:Boolean,default:!0},heading:{type:String,default:"Collections"},collapsed:{type:Boolean,default:null},loadAdditionalData:{type:Function,default:null},showKeywords:{type:Boolean,default:!1},missing:{type:Array,default:null},...n["a"].props},beforeCreate(){r["a"].enableHtmlProps(this)},methods:{detailsToggled(...e){this.$emit("detailsToggled",...e)}}},l=o,c=(s("5565"),s("2877")),u=Object(c["a"])(l,i,a,!1,null,null,null);t["a"]=u.exports},7737:function(e,t,s){},"79f4":function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var i=s("a76e"),a=s("025e");class r extends i["BaseProcess"]{constructor(e,t){super(e),this.exporter=t}async execute(e){await this.exporter.generateFunction(e)}}class n extends i["ProcessGraph"]{constructor(e,t,s){super(a["a"].isObject(e)?e:{},t),this.connection=s,this.code=[],this.fnCounter=1,this.allowEmpty(),this.fillUndefinedParameters()}createProcessGraphInstance(e){let t=new n(e,this.processRegistry,this.getJsonSchemaValidator());return this.copyProcessGraphInstanceProperties(t)}copyProcessGraphInstanceProperties(e){return e=super.copyProcessGraphInstanceProperties(e),e.connection=this.connection,e}createProcessInstance(e){return new r(e,this)}isKeyword(e){return this.getKeywords().includes(e.toLowerCase())}getKeywords(){return[]}comment(){}generateImports(){}generateConnection(){}generateAuthentication(){}generateBuilder(){}generateMetadata(){}generateMissingParameter(){}async generateFunction(){}generateFunctionParams(e){return e.map(e=>"undefined"!==typeof e.default?`${e.name} = ${this.e(e.default)}`:e.name)}async generateCallback(){}generateResult(){}makeNull(){return"null"}makeBoolean(e){return e?"true":"false"}makeArray(e){return`[${e.join(", ")}]`}makeObject(e){let t=a["a"].mapObject(e,(e,t)=>`${this.makeString(t)}: ${e}`);return`{${t.join(", ")}}`}makeString(e){return JSON.stringify(e)}makeNumber(e){return e}e(e){return null===e?this.makeNull():"boolean"===typeof e?this.makeBoolean(e):"number"===typeof e?this.makeNumber(e):"string"===typeof e?this.makeString(e):Array.isArray(e)?this.makeArray(e.map(e=>this.e(e))):a["a"].isObject(e)?this.makeObject(a["a"].mapObjectValues(e,e=>this.e(e))):"function"===typeof e?e():this.makeNull()}generateMetadata(){let e=!1;for(let t in this.process){if("process_graph"===t)continue;let s=this.process[t];Array.isArray(s)&&0===s.length||("string"===typeof s&&0===s.length||("boolean"!==typeof s||s)&&(e||(this.newLine(),this.comment("Set the metadata for the process"),e=!0),this.generateMetadataEntry(t,s)))}}async resolveArguments(e,t,s){let i=Array.isArray(e)?[]:{};for(let r in e){let o=e[r];if(!s||!s(r,o))if(a["a"].isObject(o)){if(o.from_node){i[r]=()=>this.var(o.from_node,this.varPrefix());continue}if(o.from_parameter){i[r]=()=>this.var(o.from_parameter);continue}if(o instanceof n){let e=await t(r);i[r]=()=>e;continue}i[r]=await this.resolveArguments(o,t,s)}else Array.isArray(o)?i[r]=await this.resolveArguments(o,t,s):i[r]=o}return i}async resolveCallback(e,t){let s;if("load_collection"===e.process_id){let i=e.getArgument("properties");s=i[t]}else s=e.getArgument(t);let i=s.getCallbackParameters();await s.execute(i);let a=this.var(`${t}${this.fnCounter++}`,"fn_"),r=await this.generateCallback(s,i,a);return r||a}async generateArguments(e,t=!1,s=null){let i=await this.resolveArguments(e.arguments,async t=>await this.resolveCallback(e,t),s);return t&&(i=this.orderArguments(e,i)),i}orderArguments(e,t){let s=e.getProcessGraph().getProcess(e);if(s&&Array.isArray(s.parameters)){let e=s.parameters.map(e=>"undefined"!==typeof t[e.name]?t[e.name]:e.optional?void 0:null),i=!1;for(let t=e.length-1;t>=0;t--)"undefined"===typeof e[t]?i?e[t]=null:e.pop():i=!0;return e}}varPrefix(){return this.getParent()?"data":"datacube"}var(e,t="var"){return e=String(e),this.isKeyword(e)?e+"_":e.match(/^[a-z_]\w*$/)?e:t+e.replace(/[^\w]+/g,"_")}getTab(){return"\t"}addCode(e,t="",s=0){if("string"!==typeof e)return;let i=this.getTab().repeat(s),a=e.trim().split(/\r\n|\r|\n/g);for(let r of a)this.code.push(`${i}${t}${r}\n`)}newLine(e=1){for(let t=0;t<e;t++)this.addCode("")}getServerUrl(){return this.connection.getUrl()}async toCode(e=!1){this.code=[],e||(this.comment("Import required packages"),this.generateImports(),this.newLine(),this.comment("Connect to the back-end"),this.generateConnection(),this.generateAuthentication(),this.newLine(),this.generateBuilder(),this.generateMetadata(),this.newLine());let t=this.getProcessParameters();if(t.length>0){this.comment("ToDo: Here you need to set values for the parameters");for(let e of t)this.generateMissingParameter(e);this.newLine()}return await this.execute(),e||(this.newLine(),this.comment("The process can be executed synchronously (see below), as batch job or as web service now")),this.generateResult(this.getResultNode(),e),this.code.join("").trim()}async execute(){return await this.validate(),this.reset(),await this.executeNodes(this.getStartNodes()),this.getResultNode()}isMath(){return"undefined"===typeof this._isMath&&(this._isMath=this.processRegistry.isMath(this)),this._isMath}}},"7b86":function(e,t,s){"use strict";s("3986")},"7ff9":function(e,t,s){"use strict";s("d997")},8302:function(e,t,s){},"876b":function(e,t,s){"use strict";e.exports=function(e,t){for(var s,i,a,r,n,o,l=e,c=t,u=[l,c],d=0;d<u.length;d++)for(var h=u[d],p=0;p<h.length;p+=2){var m=(p+2)%h.length,f={x:h[m+1]-h[p+1],y:h[p]-h[m]};for(s=i=null,o=0;o<l.length;o+=2)a=f.x*l[o]+f.y*l[o+1],(null===s||a<s)&&(s=a),(null===i||a>i)&&(i=a);for(r=n=null,o=0;o<c.length;o+=2)a=f.x*c[o]+f.y*c[o+1],(null===r||a<r)&&(r=a),(null===n||a>n)&&(n=a);if(i<r||n<s)return!1}return!0}},"877a":function(e,t,s){"use strict";s("6219")},"8c66":function(e,t,s){"use strict";var i=function(){var e=this,t=this,s=t.$createElement,i=t._self._c||s;return i("div",{ref:"visualEditor",staticClass:"visualEditor"},[i("div",{staticClass:"sourceHeader"},[t.title?i("strong",[t._v(t._s(t.title))]):t._e(),i("div",{staticClass:"sourceToolbar"},[t.editable?i("span",{staticClass:"sepr"},[i("button",{attrs:{type:"button",title:"New script / Clear current script"},on:{click:t.confirmClear}},[i("i",{staticClass:"fas fa-file"})]),t._t("file-toolbar")],2):t._e(),t.editable?i("span",{staticClass:"sepr"},[i("button",{attrs:{type:"button",disabled:!t.canUndo,title:"Revert last change"},on:{click:function(e){return t.$refs.blocks.undo()}}},[i("i",{staticClass:"fas fa-undo-alt"})]),i("button",{attrs:{type:"button",disabled:!t.canRedo,title:"Redo last reverted change"},on:{click:function(e){return t.$refs.blocks.redo()}}},[i("i",{staticClass:"fas fa-redo-alt"})]),i("button",{attrs:{type:"button",disabled:!t.hasSelection,title:"Delete selected elements"},on:{click:function(e){return t.$refs.blocks.deleteSelected()}}},[i("i",{staticClass:"fas fa-trash"})])]):t._e(),t.editable?i("span",{staticClass:"sepr"},[t.parent?t._e():i("button",{attrs:{type:"button",title:"Edit Process Metadata"},on:{click:function(){return t.editProcess(t.value)}}},[i("i",{staticClass:"fas fa-edit"})]),i("button",{attrs:{type:"button",title:"Add Parameter"},on:{click:t.addParameter}},[i("i",{staticClass:"fas fa-parking"})]),t.supportsMath?i("button",{class:{highlightFormula:t.isMath},attrs:{type:"button",title:"Insert/Edit formula"},on:{click:t.showExpressionModal}},[i("i",{staticClass:"fas fa-square-root-alt"})]):t._e()]):t._e(),i("button",{class:{compactMode:t.compactMode},attrs:{type:"button",title:"Compact Mode"},on:{click:function(e){return t.$refs.blocks.toggleCompact()}}},[i("i",{staticClass:"fas fa-compress-arrows-alt"})]),i("button",{attrs:{type:"button",title:"Scale to perfect size"},on:{click:function(e){return t.$refs.blocks.perfectScale()}}},[i("i",{staticClass:"fas fa-arrows-alt"})]),i("FullscreenButton",{attrs:{element:function(){return e.$refs.visualEditor}},on:{changed:function(s){e.$refs.blocks.perfectScale(),t.isFullScreen=s}}}),t._t("toolbar")],2)]),i("div",{staticClass:"editorSplitter"},[(t.showDiscoveryToolbar||t.isFullScreen)&&t.editable?i("DiscoveryToolbar",{staticClass:"discoveryToolbar",attrs:{onAddProcess:t.insertProcess}}):t._e(),i("div",{staticClass:"graphBuilder",on:{drop:t.onDrop,dragover:t.allowDrop}},[i("ModelBuilder",{ref:"blocks",attrs:{editable:t.editable,id:t.id,processes:t.processes,collections:t.collections,parent:t.parent,parentSchema:t.parentSchema,value:t.value},on:{input:t.commit,error:t.errorHandler,showProcess:function(e,s){return t.emit("showProcess",{id:e,namespace:s})},showCollection:function(e){return t.emit("showCollection",e)},showParameter:function(e){return t.emit("showProcessParameter",e)},editParameter:t.editParameter,editArguments:t.openArgumentEditor,compactMode:function(t){return e.compactMode=t},selectionChanged:t.selectionChanged,historyChanged:t.historyChanged}})],1)],1)])},a=[],r=s("1d9a"),n=s("025e"),o=s("cbd9"),l=s("3115"),c=s("5472"),u=s("fbda"),d=s("db05"),h={name:"VisualEditor",mixins:[l["a"]],components:{ModelBuilder:r["default"],DiscoveryToolbar:o["a"],FullscreenButton:c["a"]},props:{id:String,editable:{type:Boolean,default:!0},value:{type:Object,default:()=>null},parent:{type:Object,default:null},parentSchema:{type:Object,default:null},showDiscoveryToolbar:{type:Boolean,default:!1},title:{type:String},defaultValue:{}},computed:{...n["a"].mapState(["connection","collections"]),...n["a"].mapGetters(["processes","supportsMath"]),...n["a"].mapState("editor",["initialNode"]),isMath(){return this.supportsMath&&this.processes.isMath(this.value)}},data(){return{canUndo:!1,canRedo:!1,compactMode:!1,hasSelection:!1,formula:null,isFullScreen:!1}},watch:{value:{immediate:!0,handler(e){if(this.initialNode&&n["a"].isObject(e)&&n["a"].isObject(e.process_graph))try{let t=this.initialNode;"1"==t&&n["a"].size(e.process_graph)&&(t=Object.keys(e.process_graph)[0]),this.openArgumentEditorForNode(t)}catch(t){n["a"].exception(this,t)}finally{this.setInitialNode(null)}}}},methods:{...n["a"].mapMutations("editor",["setInitialNode"]),commit(e){"undefined"!==typeof this.defaultValue&&n["a"].isObject(e)&&0===n["a"].size(e.process_graph)&&(e=this.defaultValue),this.$emit("input",e)},errorHandler(e,t=null){n["a"].exception(this,e,t)},selectionChanged(e,t){this.hasSelection=Boolean(e.filter(e=>e.$el.allowsDelete).length||t.length)},historyChanged(e,t){this.canUndo=!!e[t-1],this.canRedo=!!e[t+1]},allowDrop(e){e.preventDefault()},onDrop(e){var t=e.dataTransfer.getData("application/vnd.openeo-node");if(t){let s=JSON.parse(t);return this.insertProcess(s,e.pageX,e.pageY),e.preventDefault()}let s=e.dataTransfer.files;if(1===s.length){let t=e.dataTransfer.files[0];if("application/json"===t.type){var i=new FileReader;return i.onload=async e=>{try{let t=JSON.parse(e.target.result);await this.$refs.blocks.import(t)}catch(t){n["a"].exception(this,t,"Parsing JSON file failed")}},i.onerror=e=>n["a"].exception(this,e,"Reading JSON file failed"),i.readAsText(t,"UTF-8"),e.preventDefault()}}},getNameField(e,t="name"){return{value:e,name:t,description:"A unique identifier. Must contain only letters (`a`-`z`), digits (`0`-`9`) and underscores (`_`). `snake_case` is recommended.",label:"Name",schema:{type:"string",pattern:"^\\w+$"},default:null}},getDescriptionField(e,t=!1,s="description",i="Description"){return{value:e,name:s,description:"Provides a detailed description. CommonMark (Markdown) syntax can be used for rich text formatting.",label:i,optional:t,schema:{type:"string",subtype:"commonmark"}}},getOptionalField(e){return{value:e,name:"optional",label:"Optional",description:"Parameters by default are required. CHeck this option to make the parameter optional. For optional parameters a default value should be specified.",optional:!0,schema:{type:"boolean"},default:!1}},getDefaultField(e){return{value:e,name:"default",label:"Default Value",description:"This value is used whenever the user of this process did not specify a value for this parameter.",toggledBy:"optional",optional:!0,schema:{}}},getExperimentalField(e){return{value:e,name:"experimental",label:"Experimental",description:"Declares that this is experimental, which means that it is unstable and likely to change.",optional:!0,schema:{type:"boolean"},default:!1}},getDeprecatedField(e){return{value:e,name:"deprecated",label:"Deprecated",description:"Declares that this is deprecated with the potential to be removed in any of the next versions. It should be transitioned out of usage.",optional:!0,schema:{type:"boolean"},default:!1}},getSchemaField(e,t="schema",s="Data Types"){let i=e?"json-schema":"openeo-datatype";return{value:e,name:t,label:s,description:"Allowed data type(s) as JSON Schema.",schema:[{title:"Single data type",type:"object",subtype:i},{title:"Multiple data types",type:"array",minItems:2,items:{type:"object",subtype:i}}]}},editProcess(e){e=n["a"].isObject(e)?e:{};let t=n["a"].isObject(e.returns)?e.returns:{};var s=[this.getNameField(e.id,"id"),{value:e.summary,name:"summary",description:"A very short description of the process with usually less than 60 characters.",label:"Summary",optional:!0,schema:{type:"string"}},this.getDescriptionField(e.description,!0),{value:e.categories,name:"categories",label:"Categories",optional:!0,schema:{type:"array",items:{type:"string"}}},this.getExperimentalField(e.experimental),this.getDeprecatedField(e.deprecated),{label:"Parameters",description:'The parameters can be edited directly in the "Visual Model" interface.',info:!0},this.getDescriptionField(t.description,!0,"returns_description","Return Value > Description"),this.getSchemaField(t.schema,"returns_schema","Return Value > Data Type"),{value:e.exceptions,name:"exceptions",description:"Declares exceptions (errors) that might occur during execution of this process. This list is just for informative purposes.\n\nThe keys of the object are the error codes, which should only consist of alphanumerical characters. `PascalCase` is recommended.",label:"Errors",optional:!0,schema:{type:"object",additionalProperties:{type:"object",required:["message"],properties:{message:{title:"Error Message",type:"string"},description:{title:"Description",type:"string",subtype:"commonmark"},http:{title:"HTTP Status Code",type:"integer",enum:[400,500,501]}}}}},{value:e.examples,name:"examples",label:"Examples",description:"Example calls for this process with specific values for the parameters (arguments) and the result (return value).",optional:!0,schema:{type:"array",items:{type:"object",required:["arguments"],properties:{title:{title:"Title",type:"string"},title:{title:"Description",type:"string",subtype:"commonmark"},arguments:{title:"Arguments",type:"object",default:{}},returns:{title:"Return Value"}}}}},{value:e.links,name:"links",label:"Links",description:"Links related to this process, e.g. additional documentation.",optional:!0,schema:{type:"array",items:{type:"object",required:["href","rel"],properties:{href:{title:"URL",type:"string"},rel:{title:"Relation",description:"For examples see [IANA relation types](https://www.iana.org/assignments/link-relations/link-relations.xhtml)",type:"string",default:"about"},title:{title:"Title",type:"string"},type:{title:"Media Type",description:"For examples see [IANA media types](https://www.iana.org/assignments/media-types/media-types.xhtml)",type:"string"}}}}}];this.emit("showDataForm","Edit Process",s,async e=>{let t=n["a"].pickFromObject(e,["id","summary","description","categories","experimental","deprecated","exception","examples","links"]);("string"===typeof t.description||n["a"].isObject(t.schema))&&(t.returns={description:e.returns_description,schema:e.returns_schema});let s=this.$refs.blocks.export(!0),i=Object.assign({},s,t);const a={id:"",summary:"",description:"",categories:[],experimental:!1,deprecated:!1,examples:[],links:[],process_graph:{}};for(let r in a)n["a"].equals(a[r],i[r])&&delete i[r];this.commit(i)})},addParameter(){var e=[this.getNameField(),this.getDescriptionField(),this.getOptionalField(),this.getDefaultField(),this.getExperimentalField(),this.getDeprecatedField(),this.getSchemaField()];this.emit("showDataForm","Add Parameter",e,async e=>{"string"===typeof e.name&&e.name.length>0&&await this.$refs.blocks.addPgParameter(e)})},editParameter(e,t="Edit Parameter",s=null){var i=[this.getNameField(e.name),this.getDescriptionField(e.description),this.getOptionalField(e.optional),this.getDefaultField(e.default),this.getExperimentalField(e.experimental),this.getDeprecatedField(e.deprecated),this.getSchemaField(e.schema)];this.emit("showDataForm",t,i,s)},showExpressionModal(){let e=new d["a"](this.value,this.processes,this.connection,!0);e.setCallbackParameters(this.$refs.blocks.getPgParameters().map(e=>e.spec));try{e.parse();let t={process:e},s={save:this.insertNodes};this.emit("showModal","ExpressionModal",t,s)}catch(t){n["a"].exception(this,t)}},openArgumentEditorForNode(e){let t=n["a"].deepClone(this.value),s=t.process_graph[e],i=this.processes.get(s.process_id,s.namespace);Array.isArray(i.parameters)&&i.parameters.length>0&&this.openArgumentEditor(i.parameters.map(e=>new u["ProcessParameter"](e)).filter(e=>e.isEditable()),s.arguments,i.id,!0,null,e=>{Object.assign(s,{arguments:e}),this.commit(t)})},openArgumentEditor(e,t,s="Edit",i=!0,a=null,r=null,n=null){let o={title:s,parameters:e,data:t,editable:i,selectParameterName:a,parent:n},l={};"function"===typeof r&&(l.save=r),this.emit("showModal","ParameterModal",o,l)},confirmClear(){var e=confirm("Do you really want to clear the existing model?");e&&this.clear()},clear(){this.$refs.blocks&&this.$refs.blocks.clear(),this.commit(null)},insertProcess(e,t=null,s=null){try{var i=this.$refs.blocks.getPositionForPageXY(t,s);let a=e.namespace;"backend"!==a&&"user"!==a||(a=null),this.$refs.blocks.addProcess(e.process_id,e.arguments,i,a)}catch(a){n["a"].exception(this,a)}},async insertNodes(e,t=!1){return await this.$refs.blocks.import({process_graph:e},{clear:t})}}},p=h,m=(s("4d98"),s("2877")),f=Object(m["a"])(p,i,a,!1,null,null,null);t["a"]=f.exports},"8e77":function(e,t,s){"use strict";function i(e,t,s,i){return Math.sqrt(Math.pow(e-s,2)+Math.pow(t-i,2))}e.exports=function(e,t,s,a,r,n,o){return o=o||1,Math.abs(i(e,t,s,a)-(i(e,t,r,n)+i(s,a,r,n)))<=o}},"9b5d":function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"vue-component processes"},[s("SearchableList",{attrs:{data:e.processes,keywordsKey:"categories",showKeywords:e.showCategories,showSummaryOnExpand:!1,externalSearchTerm:e.searchTerm,sort:e.sort,offerDetails:e.offerDetails,heading:e.heading,collapsed:e.collapsed,loadAdditionalData:e.loadAdditionalData},on:{detailsToggled:e.detailsToggled},scopedSlots:e._u([{key:"heading",fn:function(t){return[e._t("heading",null,null,t)]}},e.missing?{key:"content-start",fn:function(){return[s("FederationMissingNotice",{attrs:{missing:e.missing,federation:e.federation}})]},proxy:!0}:null,{key:"summary",fn:function(t){return[e._t("summary",null,null,t)]}},{key:"details",fn:function(t){return[s("Process",{attrs:{process:t.item,provideDownload:e.provideDownload,processUrl:e.processUrl,showGraph:e.showGraph,federation:e.federation},scopedSlots:e._u([{key:"title",fn:function(){return[s("span",{staticClass:"hidden"})]},proxy:!0},{key:"before-description",fn:function(t){return[e._t("process-before-description",null,null,t)]}},{key:"end",fn:function(t){return[e._t("process-end",null,null,t)]}}],null,!0)})]}}],null,!0)})],1)},a=[],r=s("60a2"),n=s("e71d"),o={name:"Processes",components:{Process:()=>r["a"].loadAsyncComponent(s.e("chunk-79c3f3f1").then(s.bind(null,"2b37"))),SearchableList:()=>r["a"].loadAsyncComponent(s.e("chunk-4f7707c2").then(s.bind(null,"d79f")))},mixins:[n["a"]],props:{processes:{type:Array,default:()=>[]},provideDownload:{type:Boolean,default:!0},processUrl:String,searchTerm:{type:String,default:null},sort:{type:Boolean,default:!0},offerDetails:{type:Boolean,default:!0},heading:{type:String,default:"Processes"},collapsed:{type:Boolean,default:null},showCategories:{type:Boolean,default:!1},showGraph:{type:Boolean,default:!1},loadAdditionalData:{type:Function,default:null},missing:{type:Array,default:null},...n["a"].props},beforeCreate(){r["a"].enableHtmlProps(this)},methods:{detailsToggled(...e){this.$emit("detailsToggled",...e)}}},l=o,c=(s("01e3"),s("2877")),u=Object(c["a"])(l,i,a,!1,null,null,null);t["a"]=u.exports},"9b7c":function(e,t,s){"use strict";const i=s("8e77");e.exports=function(e,t,s,a){var r,n,o=e.length,l=!1;for(r=0,n=o-2;r<o;r+=2)e[r+1]>s!==e[n+1]>s&&t<(e[n]-e[r])*(s-e[r+1])/(e[n+1]-e[r+1])+e[r]&&(l=!l),n=r;if(l)return!0;for(r=0;r<o;r+=2){var c,u,d=e[r],h=e[r+1];if(r===o-2?(c=e[0],u=e[1]):(c=e[r+2],u=e[r+3]),i(d,h,c,u,t,s,a))return!0}return!1}},a0e2:function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"vue-component file-formats"},[s("SearchableList",{attrs:{data:e.fileFormats,summaryKey:"title",keywordsKey:"gis_data_types",showSummaryOnExpand:!1,externalSearchTerm:e.searchTerm,sort:e.sort,offerDetails:e.offerDetails,heading:e.heading,collapsed:e.collapsed},on:{detailsToggled:e.detailsToggled},scopedSlots:e._u([{key:"heading",fn:function(t){return[e._t("heading",null,null,t)]}},e.missing?{key:"content-start",fn:function(){return[s("FederationMissingNotice",{attrs:{missing:e.missing,federation:e.federation}})]},proxy:!0}:null,{key:"summary",fn:function(t){return[e._t("summary",(function(){return[s("strong",{staticClass:"inline"},[e._v(e._s(t.item.name))]),s("ul",{staticClass:"badges small inline"},[e.showAll&&"input"===t.item.type?s("li",{staticClass:"badge option1"},[e._v("Import")]):e._e(),e.showAll&&"output"===t.item.type?s("li",{staticClass:"badge option2"},[e._v("Export")]):e._e(),Array.isArray(t.item.gis_data_types)?e._l(t.item.gis_data_types,(function(t){return s("li",{key:t,staticClass:"badge gis"},[e._v(e._s(t))])})):e._e()],2),s("br"),s("small",[e._v(e._s(t.summary.summary))])]}),null,t)]}},{key:"details",fn:function(t){return[s("FileFormat",{attrs:{id:t.summary.identifier,format:t.item,type:t.item.type,federation:e.federation},scopedSlots:e._u([{key:"title",fn:function(){return[s("span",{staticClass:"hidden"})]},proxy:!0},{key:"badges",fn:function(){return[s("span",{staticClass:"hidden"})]},proxy:!0},{key:"before-description",fn:function(t){return[e._t("file-format-before-description",null,null,t)]}},{key:"end",fn:function(t){return[e._t("file-format-end",null,null,t)]}}],null,!0)})]}}],null,!0)})],1)},a=[],r=s("60a2"),n=s("e71d"),o={name:"FileFormats",components:{SearchableList:()=>r["a"].loadAsyncComponent(s.e("chunk-4f7707c2").then(s.bind(null,"d79f"))),FileFormat:()=>r["a"].loadAsyncComponent(s.e("chunk-ef9b6c7c").then(s.bind(null,"b896")))},mixins:[n["a"]],props:{formats:{type:Object,default:()=>({})},showInput:{type:Boolean,default:!0},showOutput:{type:Boolean,default:!0},searchTerm:{type:String,default:null},sort:{type:Boolean,default:!0},offerDetails:{type:Boolean,default:!0},heading:{type:String,default:"File Formats"},collapsed:{type:Boolean,default:null},missing:{type:Array,default:null},...n["a"].props},computed:{showAll(){return this.showInput&&this.showOutput},typesToShow(){let e=[];return this.showInput&&e.push("input"),this.showOutput&&e.push("output"),e},fileFormats(){let e=[];for(let s of this.typesToShow)for(var t in this.formats[s]){let i=Object.assign({id:`${t}-${s}`,name:t,type:s},this.formats[s][t]);e.push(i)}return e}},beforeCreate(){r["a"].enableHtmlProps(this)},methods:{detailsToggled(...e){this.$emit("detailsToggled",...e)}}},l=o,c=(s("4719"),s("2877")),u=Object(c["a"])(l,i,a,!1,null,null,null);t["a"]=u.exports},a13e:function(e,t,s){"use strict";var i=s("661d");e.exports=function(e,t,s,a,r,n,o,l){return i(r,n,o,l,e,t,s,a)}},c4e8:function(e,t,s){},c98e:function(e,t,s){},cbd9:function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"discovery-toolbar"},[s("SearchBox",{model:{value:e.searchTerm,callback:function(t){e.searchTerm=t},expression:"searchTerm"}}),s("div",{staticClass:"search-results"},[s("Collections",{staticClass:"category",attrs:{collections:e.collections,searchTerm:e.searchTerm,offerDetails:!1,collapsed:e.collapsed},scopedSlots:e._u([{key:"summary",fn:function(t){var i=t.item;return[s("div",{staticClass:"discovery-entity",attrs:{draggable:e.supportsLoadCollection},on:{dragstart:function(t){return e.onDrag(t,"collection",i)}}},[s("div",{staticClass:"discovery-info",on:{click:function(t){return e.showCollectionInfo(i.id)}}},[s("strong",{attrs:{title:i.id}},[e._v(e._s(i.id))]),i.title?s("small",{attrs:{title:i.title}},[e._v(e._s(i.title))]):e._e()]),e.hasCollectionPreview(i)?s("button",{staticClass:"discovery-button",attrs:{type:"button",title:"View on map"},on:{click:function(t){return e.showCollectionPreview(i)}}},[s("i",{staticClass:"fas fa-map"})]):e._e()])]}}])}),s("Processes",{staticClass:"category",attrs:{processes:e.allProcesses,searchTerm:e.searchTerm,offerDetails:!1,collapsed:e.collapsed},scopedSlots:e._u([{key:"summary",fn:function(t){var i=t.item;return[s("div",{staticClass:"discovery-entity",attrs:{draggable:"true"},on:{dragstart:function(t){return e.onDrag(t,"process",i)}}},[s("div",{staticClass:"discovery-info",on:{click:function(t){return e.showProcess(i)}}},["user"===i.namespace?s("i",{staticClass:"custom-process fas fa-xs fa-sitemap",attrs:{title:"Custom Process"}}):"backend"!==i.namespace?s("i",{staticClass:"custom-process fas fa-xs fa-tag",attrs:{title:"Process from namespace '"+i.namespace+"'"}}):e._e(),s("strong",{attrs:{title:i.id}},[e._v(e._s(i.id))]),i.summary?s("small",{attrs:{title:i.summary}},[e._v(e._s(i.summary))]):e._e()])])]}}])}),e.hasUdfRuntimes?s("UdfRuntimes",{staticClass:"category",attrs:{runtimes:e.udfRuntimes,searchTerm:e.searchTerm,offerDetails:!1,collapsed:e.collapsed},scopedSlots:e._u([{key:"summary",fn:function(t){var i=t.summary,a=t.item;return[s("div",{staticClass:"discovery-entity",attrs:{draggable:e.supportsRunUdf},on:{dragstart:function(t){return e.onDrag(t,"udf",{runtime:i.identifier,version:a.default})}}},[s("div",{staticClass:"discovery-info",on:{click:function(t){return e.showUdfInfo(i.identifier,a)}}},[s("strong",{attrs:{title:i.identifier}},[e._v(e._s(i.identifier)+" ("+e._s(a.default)+")")]),i.summary?s("small",{attrs:{title:i.summary}},[e._v(e._s(i.summary))]):e._e()])])]}}],null,!1,92063951)}):e._e(),s("FileFormats",{staticClass:"category",attrs:{formats:e.fileFormats,showInput:!1,heading:"Export File Formats",searchTerm:e.searchTerm,offerDetails:!1,collapsed:e.collapsed},scopedSlots:e._u([{key:"summary",fn:function(t){var i=t.item;return[s("div",{staticClass:"discovery-entity",attrs:{draggable:e.supportsSaveResult},on:{dragstart:function(t){return e.onDrag(t,"fileformat",i)}}},[s("div",{staticClass:"discovery-info",on:{click:function(t){return e.showFileFormatInfo(i)}}},[s("strong",{attrs:{title:i.name}},[e._v(e._s(i.name))]),i.title?s("small",{attrs:{title:i.title}},[e._v(e._s(i.title))]):e._e()])])]}}])})],1)],1)},a=[],r=s("3115"),n=s("025e"),o=s("69d2"),l=s("a0e2"),c=s("9b5d"),u=s("2979"),d=s("d235"),h={name:"DiscoveryToolbar",mixins:[r["a"]],components:{Collections:o["a"],FileFormats:l["a"],Processes:c["a"],SearchBox:u["default"],UdfRuntimes:d["a"]},props:{onAddProcess:{type:Function,required:!0},collectionPreview:{type:Boolean,default:!1},persist:{type:Boolean,default:!1}},data(){return{internalSearchTerm:"",collapsed:!0}},computed:{...n["a"].mapState(["collections","udfRuntimes"]),...n["a"].mapState("editor",["discoverySearchTerm"]),...n["a"].mapGetters(["supports","collectionDefaults","fileFormats","processes"]),supportsLoadCollection(){return this.processes.has("load_collection")},supportsRunUdf(){return this.processes.has("run_udf")},supportsSaveResult(){return this.processes.has("save_result")},hasUdfRuntimes(){return n["a"].size(this.udfRuntimes)},allProcesses(){return this.processes.all()},searchTerm:{get(){return this.persist?this.discoverySearchTerm:this.internalSearchTerm},set(e){this.persist?this.setDiscoverySearchTerm(e):this.internalSearchTerm=e}}},watch:{searchTerm:{immediate:!0,handler(e,t){!e&&t?this.collapsed=!0:e&&!t&&(this.collapsed=!1)}}},methods:{...n["a"].mapMutations("editor",["setDiscoverySearchTerm"]),onDrag(e,t,s){let i=this.getNode(t,s);e.dataTransfer.setData("application/vnd.openeo-node",JSON.stringify(i)),e.dataTransfer.setData("text/plain",JSON.stringify(i,null,2))},showCollectionInfo(e){this.emit("showCollection",e)},hasCollectionPreview(e){return Boolean(this.collectionPreview&&n["a"].getPreviewLinkFromSTAC(e))},showCollectionPreview(e){this.emit("showCollectionPreview",e)},showProcess(e){this.emit("showProcess",e)},showUdfInfo(e,t){this.emit("showModal","UdfRuntimeModal",{id:e,data:t,version:t.default})},showFileFormatInfo(e){let t={id:e.name,format:this.fileFormats.output[e.name],type:"output"};this.emit("showModal","FileFormatModal",t)},getNode(e,t){switch(e){case"collection":return{process_id:"load_collection",arguments:this.collectionDefaults(t.id)};case"process":return{process_id:t.id,namespace:t.namespace,arguments:{}};case"udf":return{process_id:"run_udf",arguments:t};case"fileformat":return{process_id:"save_result",arguments:{format:t.name,options:{}}}}}}},p=h,m=(s("7b86"),s("877a"),s("2877")),f=Object(m["a"])(p,i,a,!1,null,"e5b627b0",null);t["a"]=f.exports},ccb1:function(e,t,s){"use strict";s("f717")},ceb0:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Tabs",{ref:"tabs",staticClass:"editor",attrs:{id:"customProcessContent",position:"bottom"}},[s("Tab",{attrs:{id:"visual",name:"Visual Model",icon:"fa-project-diagram",selected:!0,allowShow:e.canSwitchView},on:{show:e.showModel}},[s("VisualEditor",{ref:"graphBuilder",staticClass:"visualEditorTab",attrs:{editable:e.editable,parent:e.parent,parentSchema:e.parentSchema,value:e.modelValue,title:e.title,id:e.id+"_visual",showDiscoveryToolbar:e.showDiscoveryToolbar,defaultValue:e.defaultValue},on:{input:e.commit,error:e.onError},scopedSlots:e._u([{key:"file-toolbar",fn:function(){return[e._t("file-toolbar")]},proxy:!0},{key:"toolbar",fn:function(){return[e._t("toolbar")]},proxy:!0}],null,!0)})],1),s("Tab",{attrs:{id:"source",name:"Code",icon:"fa-code",allowShow:e.canSwitchView},on:{show:e.showCode}},[s("TextEditor",{ref:"sourceEditor",staticClass:"textEditorTab",attrs:{editable:e.editable,value:e.codeValue,title:e.title,id:e.id+"_text",language:"processgraph"},on:{input:e.commit,error:e.onError},scopedSlots:e._u([{key:"file-toolbar",fn:function(){return[e._t("file-toolbar")]},proxy:!0},{key:"toolbar",fn:function(){return[e._t("toolbar")]},proxy:!0}],null,!0)})],1)],1)},a=[],r=s("025e"),n=s("e7ea"),o=s("bdb2"),l=s("8c66"),c=s("0f29"),u={name:"Editor",components:{VisualEditor:l["a"],TextEditor:c["a"],Tabs:n["default"],Tab:o["default"]},props:{id:{type:String,default:()=>"editor_"+Date.now()},editable:{type:Boolean,default:!0},value:{type:Object,default:()=>null},title:{type:String},parent:{type:Object,default:null},parentSchema:{type:Object,default:null},showDiscoveryToolbar:{type:Boolean,default:!1},defaultValue:{}},watch:{value(){this.updateTab()}},data(){return{modelValue:null,codeValue:null,error:null}},mounted(){this.updateTab()},methods:{...r["a"].mapActions(["loadProcess"]),showModel(){this.error=null,this.modelValue=this.value},showCode(){this.error=null,this.codeValue=this.value,this.$refs.sourceEditor.updateState()},updateTab(){"source"===this.$refs.tabs.getActiveTabId()?this.showCode():this.showModel()},commit(e){this.error=null,this.$emit("input",e)},onError(e){this.error=e},activeEditor(){return"source"===this.$refs.tabs.getActiveTabId()?this.$refs.sourceEditor:this.$refs.graphBuilder},async insertProcess(e){try{await this.loadProcess({id:e.process_id,namespace:e.namespace}),this.activeEditor().insertProcess(e)}catch(t){r["a"].exception(this,t)}},canSwitchView(){return!this.editable||null===this.error||(r["a"].exception(this,this.error,"Process Invalid Error"),!1)}}},d=u,h=(s("58d3"),s("2877")),p=Object(h["a"])(d,i,a,!1,null,null,null);t["default"]=p.exports},d235:function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"vue-component udf-runtimes"},[s("SearchableList",{attrs:{data:e.runtimes,summaryKey:"title",showSummaryOnExpand:!1,externalSearchTerm:e.searchTerm,sort:e.sort,offerDetails:e.offerDetails,heading:e.heading,collapsed:e.collapsed},on:{detailsToggled:e.detailsToggled},scopedSlots:e._u([{key:"heading",fn:function(t){return[e._t("heading",null,null,t)]}},{key:"summary",fn:function(t){return[e._t("summary",(function(){return[s("strong",{staticClass:"inline"},[e._v(e._s(t.summary.identifier))]),s("ul",{staticClass:"badges small inline"},["docker"===t.item.type||t.item.docker&&t.item.tags?[s("li",{staticClass:"badge docker"},[e._v("Docker")]),e._l(t.item.tags,(function(i){return s("li",{key:i,staticClass:"badge version",class:{default:i===t.item.default}},[e._v(e._s(i))])}))]:e._l(t.item.versions,(function(i,a){return s("li",{key:a,staticClass:"badge version",class:{default:a===t.item.default}},[e._v(e._s(a))])}))],2),s("br"),s("small",[e._v(e._s(t.summary.summary))])]}),null,t)]}},{key:"details",fn:function(t){return[s("UdfRuntime",{attrs:{id:t.summary.identifier,runtime:t.item,federation:e.federation},scopedSlots:e._u([{key:"title",fn:function(){return[s("span",{staticClass:"hidden"})]},proxy:!0},{key:"badges",fn:function(t){return[e._t("udf-runtime-badges",null,null,t)]}},{key:"before-description",fn:function(t){return[e._t("udf-runtime-before-description",null,null,t)]}}],null,!0)})]}}],null,!0)})],1)},a=[],r=s("60a2"),n=s("e71d"),o={name:"UdfRuntimes",components:{SearchableList:()=>r["a"].loadAsyncComponent(s.e("chunk-4f7707c2").then(s.bind(null,"d79f"))),UdfRuntime:()=>r["a"].loadAsyncComponent(s.e("chunk-39c40125").then(s.bind(null,"c462")))},mixins:[n["a"]],props:{runtimes:{type:Object,default:()=>({})},searchTerm:{type:String,default:null},sort:{type:Boolean,default:!0},offerDetails:{type:Boolean,default:!0},heading:{type:String,default:"UDF Runtimes"},collapsed:{type:Boolean,default:null},...n["a"].props},beforeCreate(){r["a"].enableHtmlProps(this)},methods:{detailsToggled(...e){this.$emit("detailsToggled",...e)}}},l=o,c=(s("db18"),s("2877")),u=Object(c["a"])(l,i,a,!1,null,null,null);t["a"]=u.exports},d859:function(e,t,s){"use strict";const i=s("5aef"),a=s("876b"),r=s("091e"),n=s("14ad");function o(e,t,s,n,o,l,c,u,d,h){return d&&h?a(i(e,t,s,n,d),i(o,l,c,u,h)):d?r(o,l,c,u,i(e,t,s,n,d)):h?r(e,t,s,n,i(o,l,c,u,d)):void 0}e.exports=function(e,t,s,i,a,r,l,c,u,d){return u||d?o(e,t,s,i,a,r,l,c,u,d):n(e,t,s,i,a,r,l,c)}},d997:function(e,t,s){},db05:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var i=s("025e"),a=s("79f4"),r=s("2b70");const n=["abstract","arguments","await","boolean","break","byte","case","catch","char","class","const","continue","debugger","default","delete","do","double","else","enum","eval","export","extends","false","final","finally","float","for","function","goto","if","implements","import","in","instanceof","int","interface","let","long","native","new","null","package","private","protected","public","return","short","static","super","switch","synchronized","this","throw","throws","transient","true","try","typeof","var","void","volatile","while","with","yield","builder","connection","formula","openeo","result"];class o extends a["a"]{constructor(e,t,s,i=!1){super(e,t,s),this.generateFormula=i}createProcessGraphInstance(e){let t=new o(e,this.processRegistry,this.getJsonSchemaValidator(),this.generateFormula);return this.copyProcessGraphInstanceProperties(t)}parse(){this.parsed||super.parse()}getKeywords(){return n}comment(e){this.addCode(e,"// ")}generateImports(){this.addCode("import { OpenEO, Formula } from '@openeo/js-client';")}generateConnection(){this.addCode(`let connection = await OpenEO.connect('${this.getServerUrl()}');`)}generateAuthentication(){this.comment("ToDo: Here you need to add your authentication steps")}generateBuilder(){this.addCode("let builder = await connection.buildProcess();")}generateMetadataEntry(e,t){this.addCode(`builder.${e} = ${this.e(t)};`)}async generateFunction(e){let t=e.getParent()?"this":"builder",s=this.var(e.id,this.varPrefix()),a=await this.generateArguments(e,!e.namespace);if(this.comment(e.description),i["a"].isObject(a)){let i=e.namespace?`${e.process_id}@${e.namespace}`:e.process_id;this.addCode(`let ${s} = ${t}.process("${i}", ${this.e(a)});`)}else this.addCode(`let ${s} = ${t}.${e.process_id}(${a.map(e=>this.e(e)).join(", ")});`)}generateMissingParameter(e){this.comment(e.description);let t=this.var(e.name,"param"),s="undefined"!==typeof e.default?e.default:null;this.addCode(`let ${t} = ${this.e(s)};`)}async generateCallback(e,t,s){if(this.generateFormula&&e&&e.isMath()){let t=e.toFormulaString(),s=JSON.stringify(t);return`new Formula(${s})`}{let i=this.generateFunctionParams(t);this.newLine(),this.addCode(`let ${s} = function(${i.join(", ")}) {`),this.addCode(await e.toCode(!0),"",1),this.addCode("}")}}generateResult(e,t){if(!e)return;let s=this.var(e.id,this.varPrefix());t?this.addCode(`return ${s};`):this.addCode(`let result = await connection.computeResult(${s});`)}toFormulaString(){return this.isMath()?this.nodeToFormula(this.getResultNode()):""}getArrayElementPlaceholder(e){if("array_element"===e.process_id&&"parameter"===e.getArgumentType("data")){let t=e.getRawArgument("data").from_parameter,s=this.getCallbackParameters().findIndex(e=>e.name===t);if(s>=0)return"$".repeat(s+1)+(e.getArgument("label")||e.getArgument("index"))}return null}nodeToFormula(e,t=null){if("array_element"===e.process_id){let t=this.getArrayElementPlaceholder(e);if(t)return t}let s=r["Formula"].reverseOperatorMapping[e.process_id],a=this.processRegistry.get(e.process_id),n="undefined"!==typeof r["Formula"].arrayOperatorMapping[e.process_id],o=t=>{if(i["a"].isObject(t))if(t.from_node){let i=e.getProcessGraph().getNode(t.from_node);t=i?this.nodeToFormula(i,s):"#"+t.from_node}else{if(!t.from_parameter)throw new Error("Objects not allowed");t=t.from_parameter}return t},l=[],c=Array.isArray(a.parameters)?a.parameters:[];for(let i of c){let t=o(e.getRawArgument(i.name));if(n&&Array.isArray(t)&&"data"===i.name){l=t.map(e=>o(e));break}if("undefined"!==typeof t)l.push(t);else{if("undefined"===typeof i.default)throw new Error('Argument for parameter "'+i.name+'" missing');l.push(i.default)}}if(n&&(l=l.filter(e=>null!==e)),s){let e=["/","*"],i=["-","+"],a=l.map(e=>e<0?"("+e+")":e).join(s);return!t||i.includes(t)&&i.includes(s)||"^"===s||i.includes(t)&&e.includes(s)?a:"("+a+")"}return e.process_id+"("+l.join(", ")+")"}}},db18:function(e,t,s){"use strict";s("8302")},e4ec:function(e,t,s){"use strict";s("c4e8")},e71d:function(e,t,s){"use strict";t["a"]={components:{FederationNotice:()=>s.e("chunk-76884b3e").then(s.bind(null,"7482")),FederationMissingNotice:()=>s.e("chunk-9c0d14c8").then(s.bind(null,"c8b2"))},props:{federation:{type:Object,default:()=>({})}}}},e794:function(e,t,s){},ea8f:function(e,t,s){},f08e:function(e,t,s){},f173:function(e,t,s){"use strict";e.exports=function(e,t,s,i,a,r){return a>=e&&a<=e+s&&r>=t&&r<=t+i}},f717:function(e,t,s){}}]);
//# sourceMappingURL=chunk-c8785be4.14236718.js.map