{"version":3,"sources":["webpack:///./node_modules/ol/renderer/canvas/common.js","webpack:///./node_modules/ol/renderer/canvas/Layer.js","webpack:///./node_modules/ol/renderer/Map.js","webpack:///./node_modules/ol/renderer/Composite.js","webpack:///./node_modules/ol/renderer/canvas/ImageLayer.js","webpack:///./node_modules/ol/renderer/canvas/VectorTileLayer.js","webpack:///./node_modules/ol/renderer/canvas/TileLayer.js","webpack:///./node_modules/ol/renderer/canvas/VectorLayer.js","webpack:///./node_modules/ol/renderer/Layer.js"],"names":["IMAGE_SMOOTHING_DISABLED","imageSmoothingEnabled","msImageSmoothingEnabled","__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","this","constructor","create","CanvasLayerRenderer","_super","layer","_this","container","renderedResolution","tempTransform","pixelTransform","inversePixelTransform","context","containerReused","pixelContext_","getBackground","frameState","getLayer","background","viewState","resolution","undefined","useContainer","target","transform","opacity","opt_backgroundColor","layerClassName","getClassName","className","style","backgroundColor","canvas","firstElementChild","HTMLCanvasElement","getContext","document","createElement","position","width","height","appendChild","left","transformOrigin","clipUnrotated","extent","topLeft","topRight","bottomRight","bottomLeft","coordinateToPixelTransform","inverted","save","beginPath","moveTo","Math","round","lineTo","clip","dispatchRenderEvent_","type","hasListener","event_1","dispatchEvent","preRender","PRERENDER","postRender","POSTRENDER","getRenderTransform","center","rotation","pixelRatio","offsetX","dx1","dy1","sx","sy","dx2","dy2","getDataAtPixel","pixel","hitTolerance","renderPixel","slice","layerExtent","getExtent","renderCoordinate","pixelToCoordinateTransform","data","x","y","pixelContext","pixelCanvas","clearRect","drawImage","getImageData","err","name","Uint8Array","MapRenderer","map","map_","dispatchRenderEvent","calculateMatrices2D","size","forEachFeatureAtCoordinate","coordinate","checkWrapped","callback","thisArg","layerFilter","thisArg2","result","managed","feature","geometry","projection","translatedCoordinate","offsets","canWrapX","projectionExtent","worldWidth","push","layerStates","layerStatesArray","numLayers","length","matches","tmpCoord","i","j","layerState","hasRenderer","layerRenderer","getRenderer","source","getSource","coordinates","getWrapX","callback_1","bind","order","forEach","m","distanceSq","sort","a","some","forEachLayerAtPixel","hasFeatureAtCoordinate","hasFeature","getMap","renderFrame","scheduleExpireIconCache","canExpireCache","postRenderFunctions","expireIconCache","Disposable","expire","Map","CompositeMapRenderer","fontChangeListenerKey_","ObjectEventType","PROPERTYCHANGE","redrawText","element_","zIndex","getViewport","insertBefore","firstChild","children_","renderedVisible_","disposeInternal","parentNode","removeChild","PRECOMPOSE","declutterLayers","previousElement","ii","layerIndex","sourceState","READY","UNDEFINED","element","render","renderDeclutter","POSTCOMPOSE","display","CanvasImageLayerRenderer","imageLayer","image_","getImage","prepareFrame","viewResolution","imageSource","hints","viewHints","renderedExtent","ANIMATING","INTERACTING","sourceProjection","getProjection","image","loadImage","imageExtent","imageResolution","getResolution","imagePixelRatio","getPixelRatio","viewCenter","scale","size_1","sqrt","canvasTransform","clipped","img","dw","dh","getInterpolate","dx","dy","previousAlpha","globalAlpha","restore","IMAGE_REPLAYS","POLYGON","CIRCLE","LINE_STRING","IMAGE","TEXT","VECTOR_REPLAYS","DEFAULT","CanvasVectorTileLayerRenderer","boundHandleStyleImageChange_","handleStyleImageChange_","dirty_","renderedLayerRevision_","renderedPixelToCoordinateTransform_","renderedRotation_","tmpTransform_","prepareTile","tile","state","getState","LOADED","ERROR","updateExecutorGroup_","tileImageNeedsRender_","getTile","z","hifi","wantedResolution","Date","now","time","getRenderMode","VECTOR","renderTileImage_","isDrawableTile","executorGroups","hasContext","getTileImage","layerRevision","getRevision","renderedTiles","revision","renderOrder","getRenderOrder","builderState","getReplayState","dirty","renderedRevision","renderedRenderOrder","declutter","getDeclutter","sourceTileGrid","getTileGrid","tileGrid","getTileGridForProjection","tileExtent","getTileCoordExtent","wrappedTileCoord","sourceTiles","getSourceTiles","layerUid","hitDetectionImageData","declutterExecutorGroups","_loop_1","t","tt","sourceTile","sourceTileCoord","tileCoord","sourceTileExtent","sharedExtent","builderExtent","getRenderBuffer","this_1","tmpExtent","bufferedExtent","builderGroup","declutterBuilderGroup","squaredTolerance","styles","styleFunction","getStyleFunction","renderFeature","features","getFeatures","getGeometry","executorGroupInstructions","finish","replayExtent","renderingReplayGroup","getOverlaps","declutterExecutorGroup","hitExtent","found","featureCallback","key","getId","match","splice","lastIndexOf","_loop_2","declutteredFeatures","declutterTree","all","item","value","executorGroup","Promise","resolve","reject","renderedProjection","getTileCoordForCoordAndResolution","toString","extent_1","loadingSourceTiles","corner","tilePixel","reduce","accumulator","concat","animatingOrInteracting_","tileSize","getTileSize","getZForResolution","transforms","getTileCoordCenter","handleFontsChanged","getVisible","changed","event","renderIfReadyAndVisible","alpha","getOpacity","tiles","execute","getTileRenderTransform","worldOffset","renderMode","replayTypes","clips","clipZs","hasExecutors","currentZ","currentClip","getClipCoords","jj","opt_declutterBuilderGroup","loading","isArray","replayState","renderedTileResolution","renderedTileRevision","tileResolution","renderPixelRatio","max","getTilePixelSize","renderScale","setTransform","apply","pixelScale","CanvasTileLayerRenderer","tileLayer","extentChanged","renderedExtent_","renderedPixelRatio","newTiles_","tmpTileRange_","tileState","useInterimTilesOnError","getUseInterimTilesOnError","EMPTY","tileSource","getPreload","setState","getInterimTile","loadedTileCallback","zoom","sourceRevision","zDirection","tilePixelRatio","getTilePixelRatio","canvasExtent","tileRange","getTileRangeForExtentAndZ","tilesToDrawByZ","findLoadedTiles","createLoadedTileFinder","tmpTileRange","minX","maxX","minY","maxY","uid","inTransition","indexOf","getAlpha","childTileRange","getTileCoordChildTileRange","covered","forEachTileCoordParentTileRange","canvasScale","zs","keys","Number","getOpaque","reverse","currentTilePixelSize","currentResolution","currentScale","dx_1","dy_1","originTileCoord","getTileCoordForCoordAndZ","originTileExtent","origin_1","tileGutter","getGutterForProjection","tilesToDraw","tileCoordKey","xIndex","nextX","yIndex","nextY","w","h","transition","i_1","drawTileImage","unshift","updateUsedTiles","usedTiles","manageTilePyramid","scheduleExpireCache","gutter","alphaChanged","animate","endTransition","postRenderFunction","tileSourceKey","expireCache","getKey","preload","opt_tileCallback","wantedTiles","tileQueue","minZoom","getMinZoom","tileCount","IDLE","isKeyQueued","enqueue","useTile","updateCacheSize","CanvasVectorLayerRenderer","vectorLayer","hitDetectionImageData_","renderedFeatures_","renderedRevision_","renderedResolution_","NaN","wrappedRenderedExtent_","renderedCenter_","renderedProjection_","renderedRenderOrder_","replayGroup_","replayGroupChanged","clipping","renderWorlds","opt_declutterTree","vectorSource","snapToPixel","multiWorld","endWorld","ceil","world","floor","replayGroup","isEmpty","startX","animating","interacting","updateWhileAnimating","getUpdateWhileAnimating","updateWhileInteracting","getUpdateWhileInteracting","frameStateExtent","vectorLayerRevision","vectorLayerRenderBuffer","vectorLayerRenderOrder","loadExtents","loadExtent","userTransform","userProjection","userExtent_1","loadFeatures","userExtent","getFeaturesInExtent","replayGroupInstructions","opt_transform","LayerRenderer","boundHandleImageChange_","handleImageChange_","layer_","forEachLoadedTile","imageState","addEventListener","CHANGE","load","getSourceState"],"mappings":"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","file":"js/chunk-58c5f8f8.58fe04f6.js","sourcesContent":["/**\n * @module ol/renderer/canvas/common\n */\n/**\n * Context options to disable image smoothing.\n * @type {Object}\n */\nexport var IMAGE_SMOOTHING_DISABLED = {\n    imageSmoothingEnabled: false,\n    msImageSmoothingEnabled: false,\n};\n//# sourceMappingURL=common.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n/**\n * @module ol/renderer/canvas/Layer\n */\nimport LayerRenderer from '../Layer.js';\nimport RenderEvent from '../../render/Event.js';\nimport RenderEventType from '../../render/EventType.js';\nimport { apply as applyTransform, compose as composeTransform, create as createTransform, } from '../../transform.js';\nimport { asArray } from '../../color.js';\nimport { containsCoordinate, getBottomLeft, getBottomRight, getTopLeft, getTopRight, } from '../../extent.js';\nimport { createCanvasContext2D } from '../../dom.js';\nimport { equals } from '../../array.js';\n/**\n * @abstract\n * @template {import(\"../../layer/Layer.js\").default} LayerType\n * @extends {LayerRenderer<LayerType>}\n */\nvar CanvasLayerRenderer = /** @class */ (function (_super) {\n    __extends(CanvasLayerRenderer, _super);\n    /**\n     * @param {LayerType} layer Layer.\n     */\n    function CanvasLayerRenderer(layer) {\n        var _this = _super.call(this, layer) || this;\n        /**\n         * @protected\n         * @type {HTMLElement}\n         */\n        _this.container = null;\n        /**\n         * @protected\n         * @type {number}\n         */\n        _this.renderedResolution;\n        /**\n         * A temporary transform.  The values in this transform should only be used in a\n         * function that sets the values.\n         * @protected\n         * @type {import(\"../../transform.js\").Transform}\n         */\n        _this.tempTransform = createTransform();\n        /**\n         * The transform for rendered pixels to viewport CSS pixels.  This transform must\n         * be set when rendering a frame and may be used by other functions after rendering.\n         * @protected\n         * @type {import(\"../../transform.js\").Transform}\n         */\n        _this.pixelTransform = createTransform();\n        /**\n         * The transform for viewport CSS pixels to rendered pixels.  This transform must\n         * be set when rendering a frame and may be used by other functions after rendering.\n         * @protected\n         * @type {import(\"../../transform.js\").Transform}\n         */\n        _this.inversePixelTransform = createTransform();\n        /**\n         * @type {CanvasRenderingContext2D}\n         */\n        _this.context = null;\n        /**\n         * @type {boolean}\n         */\n        _this.containerReused = false;\n        /**\n         * @private\n         * @type {CanvasRenderingContext2D}\n         */\n        _this.pixelContext_ = null;\n        return _this;\n    }\n    /**\n     * @param {import('../../PluggableMap.js').FrameState} frameState Frame state.\n     * @return {string} Background color.\n     */\n    CanvasLayerRenderer.prototype.getBackground = function (frameState) {\n        var layer = this.getLayer();\n        var background = layer.getBackground();\n        if (typeof background === 'function') {\n            background = background(frameState.viewState.resolution);\n        }\n        return background || undefined;\n    };\n    /**\n     * Get a rendering container from an existing target, if compatible.\n     * @param {HTMLElement} target Potential render target.\n     * @param {string} transform CSS Transform.\n     * @param {number} opacity Opacity.\n     * @param {string} [opt_backgroundColor] Background color.\n     */\n    CanvasLayerRenderer.prototype.useContainer = function (target, transform, opacity, opt_backgroundColor) {\n        var layerClassName = this.getLayer().getClassName();\n        var container, context;\n        if (target &&\n            target.className === layerClassName &&\n            target.style.opacity === '' &&\n            opacity === 1 &&\n            (!opt_backgroundColor ||\n                (target.style.backgroundColor &&\n                    equals(asArray(target.style.backgroundColor), asArray(opt_backgroundColor))))) {\n            var canvas = target.firstElementChild;\n            if (canvas instanceof HTMLCanvasElement) {\n                context = canvas.getContext('2d');\n            }\n        }\n        if (context && context.canvas.style.transform === transform) {\n            // Container of the previous layer renderer can be used.\n            this.container = target;\n            this.context = context;\n            this.containerReused = true;\n        }\n        else if (this.containerReused) {\n            // Previously reused container cannot be used any more.\n            this.container = null;\n            this.context = null;\n            this.containerReused = false;\n        }\n        if (!this.container) {\n            container = document.createElement('div');\n            container.className = layerClassName;\n            var style = container.style;\n            style.position = 'absolute';\n            style.width = '100%';\n            style.height = '100%';\n            if (opt_backgroundColor) {\n                style.backgroundColor = opt_backgroundColor;\n            }\n            context = createCanvasContext2D();\n            var canvas = context.canvas;\n            container.appendChild(canvas);\n            style = canvas.style;\n            style.position = 'absolute';\n            style.left = '0';\n            style.transformOrigin = 'top left';\n            this.container = container;\n            this.context = context;\n        }\n    };\n    /**\n     * @param {CanvasRenderingContext2D} context Context.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @param {import(\"../../extent.js\").Extent} extent Clip extent.\n     * @protected\n     */\n    CanvasLayerRenderer.prototype.clipUnrotated = function (context, frameState, extent) {\n        var topLeft = getTopLeft(extent);\n        var topRight = getTopRight(extent);\n        var bottomRight = getBottomRight(extent);\n        var bottomLeft = getBottomLeft(extent);\n        applyTransform(frameState.coordinateToPixelTransform, topLeft);\n        applyTransform(frameState.coordinateToPixelTransform, topRight);\n        applyTransform(frameState.coordinateToPixelTransform, bottomRight);\n        applyTransform(frameState.coordinateToPixelTransform, bottomLeft);\n        var inverted = this.inversePixelTransform;\n        applyTransform(inverted, topLeft);\n        applyTransform(inverted, topRight);\n        applyTransform(inverted, bottomRight);\n        applyTransform(inverted, bottomLeft);\n        context.save();\n        context.beginPath();\n        context.moveTo(Math.round(topLeft[0]), Math.round(topLeft[1]));\n        context.lineTo(Math.round(topRight[0]), Math.round(topRight[1]));\n        context.lineTo(Math.round(bottomRight[0]), Math.round(bottomRight[1]));\n        context.lineTo(Math.round(bottomLeft[0]), Math.round(bottomLeft[1]));\n        context.clip();\n    };\n    /**\n     * @param {import(\"../../render/EventType.js\").default} type Event type.\n     * @param {CanvasRenderingContext2D} context Context.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @private\n     */\n    CanvasLayerRenderer.prototype.dispatchRenderEvent_ = function (type, context, frameState) {\n        var layer = this.getLayer();\n        if (layer.hasListener(type)) {\n            var event_1 = new RenderEvent(type, this.inversePixelTransform, frameState, context);\n            layer.dispatchEvent(event_1);\n        }\n    };\n    /**\n     * @param {CanvasRenderingContext2D} context Context.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @protected\n     */\n    CanvasLayerRenderer.prototype.preRender = function (context, frameState) {\n        this.dispatchRenderEvent_(RenderEventType.PRERENDER, context, frameState);\n    };\n    /**\n     * @param {CanvasRenderingContext2D} context Context.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @protected\n     */\n    CanvasLayerRenderer.prototype.postRender = function (context, frameState) {\n        this.dispatchRenderEvent_(RenderEventType.POSTRENDER, context, frameState);\n    };\n    /**\n     * Creates a transform for rendering to an element that will be rotated after rendering.\n     * @param {import(\"../../coordinate.js\").Coordinate} center Center.\n     * @param {number} resolution Resolution.\n     * @param {number} rotation Rotation.\n     * @param {number} pixelRatio Pixel ratio.\n     * @param {number} width Width of the rendered element (in pixels).\n     * @param {number} height Height of the rendered element (in pixels).\n     * @param {number} offsetX Offset on the x-axis in view coordinates.\n     * @protected\n     * @return {!import(\"../../transform.js\").Transform} Transform.\n     */\n    CanvasLayerRenderer.prototype.getRenderTransform = function (center, resolution, rotation, pixelRatio, width, height, offsetX) {\n        var dx1 = width / 2;\n        var dy1 = height / 2;\n        var sx = pixelRatio / resolution;\n        var sy = -sx;\n        var dx2 = -center[0] + offsetX;\n        var dy2 = -center[1];\n        return composeTransform(this.tempTransform, dx1, dy1, sx, sy, -rotation, dx2, dy2);\n    };\n    /**\n     * @param {import(\"../../pixel.js\").Pixel} pixel Pixel.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState FrameState.\n     * @param {number} hitTolerance Hit tolerance in pixels.\n     * @return {Uint8ClampedArray|Uint8Array} The result.  If there is no data at the pixel\n     *    location, null will be returned.  If there is data, but pixel values cannot be\n     *    returned, and empty array will be returned.\n     */\n    CanvasLayerRenderer.prototype.getDataAtPixel = function (pixel, frameState, hitTolerance) {\n        var renderPixel = applyTransform(this.inversePixelTransform, pixel.slice());\n        var context = this.context;\n        var layer = this.getLayer();\n        var layerExtent = layer.getExtent();\n        if (layerExtent) {\n            var renderCoordinate = applyTransform(frameState.pixelToCoordinateTransform, pixel.slice());\n            /** get only data inside of the layer extent */\n            if (!containsCoordinate(layerExtent, renderCoordinate)) {\n                return null;\n            }\n        }\n        var x = Math.round(renderPixel[0]);\n        var y = Math.round(renderPixel[1]);\n        var pixelContext = this.pixelContext_;\n        if (!pixelContext) {\n            var pixelCanvas = document.createElement('canvas');\n            pixelCanvas.width = 1;\n            pixelCanvas.height = 1;\n            pixelContext = pixelCanvas.getContext('2d');\n            this.pixelContext_ = pixelContext;\n        }\n        pixelContext.clearRect(0, 0, 1, 1);\n        var data;\n        try {\n            pixelContext.drawImage(context.canvas, x, y, 1, 1, 0, 0, 1, 1);\n            data = pixelContext.getImageData(0, 0, 1, 1).data;\n        }\n        catch (err) {\n            if (err.name === 'SecurityError') {\n                // tainted canvas, we assume there is data at the given pixel (although there might not be)\n                this.pixelContext_ = null;\n                return new Uint8Array();\n            }\n            return data;\n        }\n        if (data[3] === 0) {\n            return null;\n        }\n        return data;\n    };\n    return CanvasLayerRenderer;\n}(LayerRenderer));\nexport default CanvasLayerRenderer;\n//# sourceMappingURL=Layer.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n/**\n * @module ol/renderer/Map\n */\nimport Disposable from '../Disposable.js';\nimport { TRUE } from '../functions.js';\nimport { abstract } from '../util.js';\nimport { compose as composeTransform, makeInverse } from '../transform.js';\nimport { getWidth } from '../extent.js';\nimport { shared as iconImageCache } from '../style/IconImageCache.js';\nimport { inView } from '../layer/Layer.js';\nimport { wrapX } from '../coordinate.js';\n/**\n * @typedef HitMatch\n * @property {import(\"../Feature.js\").FeatureLike} feature Feature.\n * @property {import(\"../layer/Layer.js\").default} layer Layer.\n * @property {import(\"../geom/SimpleGeometry.js\").default} geometry Geometry.\n * @property {number} distanceSq Squared distance.\n * @property {import(\"./vector.js\").FeatureCallback<T>} callback Callback.\n * @template T\n */\n/**\n * @abstract\n */\nvar MapRenderer = /** @class */ (function (_super) {\n    __extends(MapRenderer, _super);\n    /**\n     * @param {import(\"../PluggableMap.js\").default} map Map.\n     */\n    function MapRenderer(map) {\n        var _this = _super.call(this) || this;\n        /**\n         * @private\n         * @type {import(\"../PluggableMap.js\").default}\n         */\n        _this.map_ = map;\n        return _this;\n    }\n    /**\n     * @abstract\n     * @param {import(\"../render/EventType.js\").default} type Event type.\n     * @param {import(\"../PluggableMap.js\").FrameState} frameState Frame state.\n     */\n    MapRenderer.prototype.dispatchRenderEvent = function (type, frameState) {\n        abstract();\n    };\n    /**\n     * @param {import(\"../PluggableMap.js\").FrameState} frameState FrameState.\n     * @protected\n     */\n    MapRenderer.prototype.calculateMatrices2D = function (frameState) {\n        var viewState = frameState.viewState;\n        var coordinateToPixelTransform = frameState.coordinateToPixelTransform;\n        var pixelToCoordinateTransform = frameState.pixelToCoordinateTransform;\n        composeTransform(coordinateToPixelTransform, frameState.size[0] / 2, frameState.size[1] / 2, 1 / viewState.resolution, -1 / viewState.resolution, -viewState.rotation, -viewState.center[0], -viewState.center[1]);\n        makeInverse(pixelToCoordinateTransform, coordinateToPixelTransform);\n    };\n    /**\n     * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n     * @param {import(\"../PluggableMap.js\").FrameState} frameState FrameState.\n     * @param {number} hitTolerance Hit tolerance in pixels.\n     * @param {boolean} checkWrapped Check for wrapped geometries.\n     * @param {import(\"./vector.js\").FeatureCallback<T>} callback Feature callback.\n     * @param {S} thisArg Value to use as `this` when executing `callback`.\n     * @param {function(this: U, import(\"../layer/Layer.js\").default): boolean} layerFilter Layer filter\n     *     function, only layers which are visible and for which this function\n     *     returns `true` will be tested for features.  By default, all visible\n     *     layers will be tested.\n     * @param {U} thisArg2 Value to use as `this` when executing `layerFilter`.\n     * @return {T|undefined} Callback result.\n     * @template S,T,U\n     */\n    MapRenderer.prototype.forEachFeatureAtCoordinate = function (coordinate, frameState, hitTolerance, checkWrapped, callback, thisArg, layerFilter, thisArg2) {\n        var result;\n        var viewState = frameState.viewState;\n        /**\n         * @param {boolean} managed Managed layer.\n         * @param {import(\"../Feature.js\").FeatureLike} feature Feature.\n         * @param {import(\"../layer/Layer.js\").default} layer Layer.\n         * @param {import(\"../geom/Geometry.js\").default} geometry Geometry.\n         * @return {T|undefined} Callback result.\n         */\n        function forEachFeatureAtCoordinate(managed, feature, layer, geometry) {\n            return callback.call(thisArg, feature, managed ? layer : null, geometry);\n        }\n        var projection = viewState.projection;\n        var translatedCoordinate = wrapX(coordinate.slice(), projection);\n        var offsets = [[0, 0]];\n        if (projection.canWrapX() && checkWrapped) {\n            var projectionExtent = projection.getExtent();\n            var worldWidth = getWidth(projectionExtent);\n            offsets.push([-worldWidth, 0], [worldWidth, 0]);\n        }\n        var layerStates = frameState.layerStatesArray;\n        var numLayers = layerStates.length;\n        var matches = /** @type {Array<HitMatch<T>>} */ ([]);\n        var tmpCoord = [];\n        for (var i = 0; i < offsets.length; i++) {\n            for (var j = numLayers - 1; j >= 0; --j) {\n                var layerState = layerStates[j];\n                var layer = layerState.layer;\n                if (layer.hasRenderer() &&\n                    inView(layerState, viewState) &&\n                    layerFilter.call(thisArg2, layer)) {\n                    var layerRenderer = layer.getRenderer();\n                    var source = layer.getSource();\n                    if (layerRenderer && source) {\n                        var coordinates = source.getWrapX()\n                            ? translatedCoordinate\n                            : coordinate;\n                        var callback_1 = forEachFeatureAtCoordinate.bind(null, layerState.managed);\n                        tmpCoord[0] = coordinates[0] + offsets[i][0];\n                        tmpCoord[1] = coordinates[1] + offsets[i][1];\n                        result = layerRenderer.forEachFeatureAtCoordinate(tmpCoord, frameState, hitTolerance, callback_1, matches);\n                    }\n                    if (result) {\n                        return result;\n                    }\n                }\n            }\n        }\n        if (matches.length === 0) {\n            return undefined;\n        }\n        var order = 1 / matches.length;\n        matches.forEach(function (m, i) { return (m.distanceSq += i * order); });\n        matches.sort(function (a, b) { return a.distanceSq - b.distanceSq; });\n        matches.some(function (m) {\n            return (result = m.callback(m.feature, m.layer, m.geometry));\n        });\n        return result;\n    };\n    /**\n     * @abstract\n     * @param {import(\"../pixel.js\").Pixel} pixel Pixel.\n     * @param {import(\"../PluggableMap.js\").FrameState} frameState FrameState.\n     * @param {number} hitTolerance Hit tolerance in pixels.\n     * @param {function(import(\"../layer/Layer.js\").default<import(\"../source/Source\").default>, (Uint8ClampedArray|Uint8Array)): T} callback Layer\n     *     callback.\n     * @param {function(import(\"../layer/Layer.js\").default<import(\"../source/Source\").default>): boolean} layerFilter Layer filter\n     *     function, only layers which are visible and for which this function\n     *     returns `true` will be tested for features.  By default, all visible\n     *     layers will be tested.\n     * @return {T|undefined} Callback result.\n     * @template T\n     */\n    MapRenderer.prototype.forEachLayerAtPixel = function (pixel, frameState, hitTolerance, callback, layerFilter) {\n        return abstract();\n    };\n    /**\n     * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n     * @param {import(\"../PluggableMap.js\").FrameState} frameState FrameState.\n     * @param {number} hitTolerance Hit tolerance in pixels.\n     * @param {boolean} checkWrapped Check for wrapped geometries.\n     * @param {function(this: U, import(\"../layer/Layer.js\").default): boolean} layerFilter Layer filter\n     *     function, only layers which are visible and for which this function\n     *     returns `true` will be tested for features.  By default, all visible\n     *     layers will be tested.\n     * @param {U} thisArg Value to use as `this` when executing `layerFilter`.\n     * @return {boolean} Is there a feature at the given coordinate?\n     * @template U\n     */\n    MapRenderer.prototype.hasFeatureAtCoordinate = function (coordinate, frameState, hitTolerance, checkWrapped, layerFilter, thisArg) {\n        var hasFeature = this.forEachFeatureAtCoordinate(coordinate, frameState, hitTolerance, checkWrapped, TRUE, this, layerFilter, thisArg);\n        return hasFeature !== undefined;\n    };\n    /**\n     * @return {import(\"../PluggableMap.js\").default} Map.\n     */\n    MapRenderer.prototype.getMap = function () {\n        return this.map_;\n    };\n    /**\n     * Render.\n     * @abstract\n     * @param {?import(\"../PluggableMap.js\").FrameState} frameState Frame state.\n     */\n    MapRenderer.prototype.renderFrame = function (frameState) {\n        abstract();\n    };\n    /**\n     * @param {import(\"../PluggableMap.js\").FrameState} frameState Frame state.\n     * @protected\n     */\n    MapRenderer.prototype.scheduleExpireIconCache = function (frameState) {\n        if (iconImageCache.canExpireCache()) {\n            frameState.postRenderFunctions.push(expireIconCache);\n        }\n    };\n    return MapRenderer;\n}(Disposable));\n/**\n * @param {import(\"../PluggableMap.js\").default} map Map.\n * @param {import(\"../PluggableMap.js\").FrameState} frameState Frame state.\n */\nfunction expireIconCache(map, frameState) {\n    iconImageCache.expire();\n}\nexport default MapRenderer;\n//# sourceMappingURL=Map.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n/**\n * @module ol/renderer/Composite\n */\nimport MapRenderer from './Map.js';\nimport ObjectEventType from '../ObjectEventType.js';\nimport RenderEvent from '../render/Event.js';\nimport RenderEventType from '../render/EventType.js';\nimport SourceState from '../source/State.js';\nimport { CLASS_UNSELECTABLE } from '../css.js';\nimport { checkedFonts } from '../render/canvas.js';\nimport { inView } from '../layer/Layer.js';\nimport { listen, unlistenByKey } from '../events.js';\nimport { replaceChildren } from '../dom.js';\n/**\n * @classdesc\n * Canvas map renderer.\n * @api\n */\nvar CompositeMapRenderer = /** @class */ (function (_super) {\n    __extends(CompositeMapRenderer, _super);\n    /**\n     * @param {import(\"../PluggableMap.js\").default} map Map.\n     */\n    function CompositeMapRenderer(map) {\n        var _this = _super.call(this, map) || this;\n        /**\n         * @type {import(\"../events.js\").EventsKey}\n         */\n        _this.fontChangeListenerKey_ = listen(checkedFonts, ObjectEventType.PROPERTYCHANGE, map.redrawText.bind(map));\n        /**\n         * @private\n         * @type {HTMLDivElement}\n         */\n        _this.element_ = document.createElement('div');\n        var style = _this.element_.style;\n        style.position = 'absolute';\n        style.width = '100%';\n        style.height = '100%';\n        style.zIndex = '0';\n        _this.element_.className = CLASS_UNSELECTABLE + ' ol-layers';\n        var container = map.getViewport();\n        container.insertBefore(_this.element_, container.firstChild || null);\n        /**\n         * @private\n         * @type {Array<HTMLElement>}\n         */\n        _this.children_ = [];\n        /**\n         * @private\n         * @type {boolean}\n         */\n        _this.renderedVisible_ = true;\n        return _this;\n    }\n    /**\n     * @param {import(\"../render/EventType.js\").default} type Event type.\n     * @param {import(\"../PluggableMap.js\").FrameState} frameState Frame state.\n     */\n    CompositeMapRenderer.prototype.dispatchRenderEvent = function (type, frameState) {\n        var map = this.getMap();\n        if (map.hasListener(type)) {\n            var event_1 = new RenderEvent(type, undefined, frameState);\n            map.dispatchEvent(event_1);\n        }\n    };\n    CompositeMapRenderer.prototype.disposeInternal = function () {\n        unlistenByKey(this.fontChangeListenerKey_);\n        this.element_.parentNode.removeChild(this.element_);\n        _super.prototype.disposeInternal.call(this);\n    };\n    /**\n     * Render.\n     * @param {?import(\"../PluggableMap.js\").FrameState} frameState Frame state.\n     */\n    CompositeMapRenderer.prototype.renderFrame = function (frameState) {\n        if (!frameState) {\n            if (this.renderedVisible_) {\n                this.element_.style.display = 'none';\n                this.renderedVisible_ = false;\n            }\n            return;\n        }\n        this.calculateMatrices2D(frameState);\n        this.dispatchRenderEvent(RenderEventType.PRECOMPOSE, frameState);\n        var layerStatesArray = frameState.layerStatesArray.sort(function (a, b) {\n            return a.zIndex - b.zIndex;\n        });\n        var viewState = frameState.viewState;\n        this.children_.length = 0;\n        /**\n         * @type {Array<import(\"../layer/BaseVector.js\").default>}\n         */\n        var declutterLayers = [];\n        var previousElement = null;\n        for (var i = 0, ii = layerStatesArray.length; i < ii; ++i) {\n            var layerState = layerStatesArray[i];\n            frameState.layerIndex = i;\n            if (!inView(layerState, viewState) ||\n                (layerState.sourceState != SourceState.READY &&\n                    layerState.sourceState != SourceState.UNDEFINED)) {\n                continue;\n            }\n            var layer = layerState.layer;\n            var element = layer.render(frameState, previousElement);\n            if (!element) {\n                continue;\n            }\n            if (element !== previousElement) {\n                this.children_.push(element);\n                previousElement = element;\n            }\n            if ('getDeclutter' in layer) {\n                declutterLayers.push(\n                /** @type {import(\"../layer/BaseVector.js\").default} */ (layer));\n            }\n        }\n        for (var i = declutterLayers.length - 1; i >= 0; --i) {\n            declutterLayers[i].renderDeclutter(frameState);\n        }\n        replaceChildren(this.element_, this.children_);\n        this.dispatchRenderEvent(RenderEventType.POSTCOMPOSE, frameState);\n        if (!this.renderedVisible_) {\n            this.element_.style.display = '';\n            this.renderedVisible_ = true;\n        }\n        this.scheduleExpireIconCache(frameState);\n    };\n    /**\n     * @param {import(\"../pixel.js\").Pixel} pixel Pixel.\n     * @param {import(\"../PluggableMap.js\").FrameState} frameState FrameState.\n     * @param {number} hitTolerance Hit tolerance in pixels.\n     * @param {function(import(\"../layer/Layer.js\").default<import(\"../source/Source\").default>, (Uint8ClampedArray|Uint8Array)): T} callback Layer\n     *     callback.\n     * @param {function(import(\"../layer/Layer.js\").default<import(\"../source/Source\").default>): boolean} layerFilter Layer filter\n     *     function, only layers which are visible and for which this function\n     *     returns `true` will be tested for features.  By default, all visible\n     *     layers will be tested.\n     * @return {T|undefined} Callback result.\n     * @template T\n     */\n    CompositeMapRenderer.prototype.forEachLayerAtPixel = function (pixel, frameState, hitTolerance, callback, layerFilter) {\n        var viewState = frameState.viewState;\n        var layerStates = frameState.layerStatesArray;\n        var numLayers = layerStates.length;\n        for (var i = numLayers - 1; i >= 0; --i) {\n            var layerState = layerStates[i];\n            var layer = layerState.layer;\n            if (layer.hasRenderer() &&\n                inView(layerState, viewState) &&\n                layerFilter(layer)) {\n                var layerRenderer = layer.getRenderer();\n                var data = layerRenderer.getDataAtPixel(pixel, frameState, hitTolerance);\n                if (data) {\n                    var result = callback(layer, data);\n                    if (result) {\n                        return result;\n                    }\n                }\n            }\n        }\n        return undefined;\n    };\n    return CompositeMapRenderer;\n}(MapRenderer));\nexport default CompositeMapRenderer;\n//# sourceMappingURL=Composite.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n/**\n * @module ol/renderer/canvas/ImageLayer\n */\nimport CanvasLayerRenderer from './Layer.js';\nimport ViewHint from '../../ViewHint.js';\nimport { ENABLE_RASTER_REPROJECTION } from '../../reproj/common.js';\nimport { IMAGE_SMOOTHING_DISABLED } from './common.js';\nimport { assign } from '../../obj.js';\nimport { compose as composeTransform, makeInverse } from '../../transform.js';\nimport { containsExtent, intersects as intersectsExtent } from '../../extent.js';\nimport { fromUserExtent } from '../../proj.js';\nimport { getIntersection, isEmpty } from '../../extent.js';\nimport { toString as toTransformString } from '../../transform.js';\n/**\n * @classdesc\n * Canvas renderer for image layers.\n * @api\n */\nvar CanvasImageLayerRenderer = /** @class */ (function (_super) {\n    __extends(CanvasImageLayerRenderer, _super);\n    /**\n     * @param {import(\"../../layer/Image.js\").default} imageLayer Image layer.\n     */\n    function CanvasImageLayerRenderer(imageLayer) {\n        var _this = _super.call(this, imageLayer) || this;\n        /**\n         * @protected\n         * @type {?import(\"../../ImageBase.js\").default}\n         */\n        _this.image_ = null;\n        return _this;\n    }\n    /**\n     * @return {HTMLCanvasElement|HTMLImageElement|HTMLVideoElement} Image.\n     */\n    CanvasImageLayerRenderer.prototype.getImage = function () {\n        return !this.image_ ? null : this.image_.getImage();\n    };\n    /**\n     * Determine whether render should be called.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @return {boolean} Layer is ready to be rendered.\n     */\n    CanvasImageLayerRenderer.prototype.prepareFrame = function (frameState) {\n        var layerState = frameState.layerStatesArray[frameState.layerIndex];\n        var pixelRatio = frameState.pixelRatio;\n        var viewState = frameState.viewState;\n        var viewResolution = viewState.resolution;\n        var imageSource = this.getLayer().getSource();\n        var hints = frameState.viewHints;\n        var renderedExtent = frameState.extent;\n        if (layerState.extent !== undefined) {\n            renderedExtent = getIntersection(renderedExtent, fromUserExtent(layerState.extent, viewState.projection));\n        }\n        if (!hints[ViewHint.ANIMATING] &&\n            !hints[ViewHint.INTERACTING] &&\n            !isEmpty(renderedExtent)) {\n            if (imageSource) {\n                var projection = viewState.projection;\n                if (!ENABLE_RASTER_REPROJECTION) {\n                    var sourceProjection = imageSource.getProjection();\n                    if (sourceProjection) {\n                        projection = sourceProjection;\n                    }\n                }\n                var image = imageSource.getImage(renderedExtent, viewResolution, pixelRatio, projection);\n                if (image && this.loadImage(image)) {\n                    this.image_ = image;\n                }\n            }\n            else {\n                this.image_ = null;\n            }\n        }\n        return !!this.image_;\n    };\n    /**\n     * Render the layer.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @param {HTMLElement} target Target that may be used to render content to.\n     * @return {HTMLElement} The rendered element.\n     */\n    CanvasImageLayerRenderer.prototype.renderFrame = function (frameState, target) {\n        var image = this.image_;\n        var imageExtent = image.getExtent();\n        var imageResolution = image.getResolution();\n        var imagePixelRatio = image.getPixelRatio();\n        var layerState = frameState.layerStatesArray[frameState.layerIndex];\n        var pixelRatio = frameState.pixelRatio;\n        var viewState = frameState.viewState;\n        var viewCenter = viewState.center;\n        var viewResolution = viewState.resolution;\n        var size = frameState.size;\n        var scale = (pixelRatio * imageResolution) / (viewResolution * imagePixelRatio);\n        var width = Math.round(size[0] * pixelRatio);\n        var height = Math.round(size[1] * pixelRatio);\n        var rotation = viewState.rotation;\n        if (rotation) {\n            var size_1 = Math.round(Math.sqrt(width * width + height * height));\n            width = size_1;\n            height = size_1;\n        }\n        // set forward and inverse pixel transforms\n        composeTransform(this.pixelTransform, frameState.size[0] / 2, frameState.size[1] / 2, 1 / pixelRatio, 1 / pixelRatio, rotation, -width / 2, -height / 2);\n        makeInverse(this.inversePixelTransform, this.pixelTransform);\n        var canvasTransform = toTransformString(this.pixelTransform);\n        this.useContainer(target, canvasTransform, layerState.opacity, this.getBackground(frameState));\n        var context = this.context;\n        var canvas = context.canvas;\n        if (canvas.width != width || canvas.height != height) {\n            canvas.width = width;\n            canvas.height = height;\n        }\n        else if (!this.containerReused) {\n            context.clearRect(0, 0, width, height);\n        }\n        // clipped rendering if layer extent is set\n        var clipped = false;\n        var render = true;\n        if (layerState.extent) {\n            var layerExtent = fromUserExtent(layerState.extent, viewState.projection);\n            render = intersectsExtent(layerExtent, frameState.extent);\n            clipped = render && !containsExtent(layerExtent, frameState.extent);\n            if (clipped) {\n                this.clipUnrotated(context, frameState, layerExtent);\n            }\n        }\n        var img = image.getImage();\n        var transform = composeTransform(this.tempTransform, width / 2, height / 2, scale, scale, 0, (imagePixelRatio * (imageExtent[0] - viewCenter[0])) / imageResolution, (imagePixelRatio * (viewCenter[1] - imageExtent[3])) / imageResolution);\n        this.renderedResolution = (imageResolution * pixelRatio) / imagePixelRatio;\n        var dw = img.width * transform[0];\n        var dh = img.height * transform[3];\n        if (!this.getLayer().getSource().getInterpolate()) {\n            assign(context, IMAGE_SMOOTHING_DISABLED);\n        }\n        this.preRender(context, frameState);\n        if (render && dw >= 0.5 && dh >= 0.5) {\n            var dx = transform[4];\n            var dy = transform[5];\n            var opacity = layerState.opacity;\n            var previousAlpha = void 0;\n            if (opacity !== 1) {\n                previousAlpha = context.globalAlpha;\n                context.globalAlpha = opacity;\n            }\n            context.drawImage(img, 0, 0, +img.width, +img.height, Math.round(dx), Math.round(dy), Math.round(dw), Math.round(dh));\n            if (opacity !== 1) {\n                context.globalAlpha = previousAlpha;\n            }\n        }\n        this.postRender(context, frameState);\n        if (clipped) {\n            context.restore();\n        }\n        if (canvasTransform !== canvas.style.transform) {\n            canvas.style.transform = canvasTransform;\n        }\n        return this.container;\n    };\n    return CanvasImageLayerRenderer;\n}(CanvasLayerRenderer));\nexport default CanvasImageLayerRenderer;\n//# sourceMappingURL=ImageLayer.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n/**\n * @module ol/renderer/canvas/VectorTileLayer\n */\nimport CanvasBuilderGroup from '../../render/canvas/BuilderGroup.js';\nimport CanvasExecutorGroup from '../../render/canvas/ExecutorGroup.js';\nimport CanvasTileLayerRenderer from './TileLayer.js';\nimport ReplayType from '../../render/canvas/BuilderType.js';\nimport TileState from '../../TileState.js';\nimport VectorTileRenderType from '../../layer/VectorTileRenderType.js';\nimport ViewHint from '../../ViewHint.js';\nimport { HIT_DETECT_RESOLUTION, createHitDetectionImageData, hitDetect, } from '../../render/canvas/hitdetect.js';\nimport { apply as applyTransform, create as createTransform, multiply, reset as resetTransform, scale, scale as scaleTransform, translate as translateTransform, } from '../../transform.js';\nimport { boundingExtent, buffer, containsExtent, equals, getIntersection, getTopLeft, intersects, } from '../../extent.js';\nimport { getSquaredTolerance as getSquaredRenderTolerance, renderFeature, } from '../vector.js';\nimport { getUid } from '../../util.js';\nimport { toSize } from '../../size.js';\nimport { wrapX } from '../../coordinate.js';\n/**\n * @type {!Object<string, Array<import(\"../../render/canvas/BuilderType.js\").default>>}\n */\nvar IMAGE_REPLAYS = {\n    'image': [\n        ReplayType.POLYGON,\n        ReplayType.CIRCLE,\n        ReplayType.LINE_STRING,\n        ReplayType.IMAGE,\n        ReplayType.TEXT,\n    ],\n    'hybrid': [ReplayType.POLYGON, ReplayType.LINE_STRING],\n    'vector': [],\n};\n/**\n * @type {!Object<string, Array<import(\"../../render/canvas/BuilderType.js\").default>>}\n */\nvar VECTOR_REPLAYS = {\n    'hybrid': [ReplayType.IMAGE, ReplayType.TEXT, ReplayType.DEFAULT],\n    'vector': [\n        ReplayType.POLYGON,\n        ReplayType.CIRCLE,\n        ReplayType.LINE_STRING,\n        ReplayType.IMAGE,\n        ReplayType.TEXT,\n        ReplayType.DEFAULT,\n    ],\n};\n/**\n * @classdesc\n * Canvas renderer for vector tile layers.\n * @api\n */\nvar CanvasVectorTileLayerRenderer = /** @class */ (function (_super) {\n    __extends(CanvasVectorTileLayerRenderer, _super);\n    /**\n     * @param {import(\"../../layer/VectorTile.js\").default} layer VectorTile layer.\n     */\n    function CanvasVectorTileLayerRenderer(layer) {\n        var _this = _super.call(this, layer) || this;\n        /** @private */\n        _this.boundHandleStyleImageChange_ = _this.handleStyleImageChange_.bind(_this);\n        /**\n         * @private\n         * @type {boolean}\n         */\n        _this.dirty_ = false;\n        /**\n         * @private\n         * @type {number}\n         */\n        _this.renderedLayerRevision_;\n        /**\n         * @private\n         * @type {import(\"../../transform\").Transform}\n         */\n        _this.renderedPixelToCoordinateTransform_ = null;\n        /**\n         * @private\n         * @type {number}\n         */\n        _this.renderedRotation_;\n        /**\n         * @private\n         * @type {import(\"../../transform.js\").Transform}\n         */\n        _this.tmpTransform_ = createTransform();\n        return _this;\n    }\n    /**\n     * @param {import(\"../../VectorRenderTile.js\").default} tile Tile.\n     * @param {number} pixelRatio Pixel ratio.\n     * @param {import(\"../../proj/Projection\").default} projection Projection.\n     * @return {boolean|undefined} Tile needs to be rendered.\n     */\n    CanvasVectorTileLayerRenderer.prototype.prepareTile = function (tile, pixelRatio, projection) {\n        var render;\n        var state = tile.getState();\n        if (state === TileState.LOADED || state === TileState.ERROR) {\n            this.updateExecutorGroup_(tile, pixelRatio, projection);\n            if (this.tileImageNeedsRender_(tile)) {\n                render = true;\n            }\n        }\n        return render;\n    };\n    /**\n     * @param {number} z Tile coordinate z.\n     * @param {number} x Tile coordinate x.\n     * @param {number} y Tile coordinate y.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @return {!import(\"../../Tile.js\").default} Tile.\n     */\n    CanvasVectorTileLayerRenderer.prototype.getTile = function (z, x, y, frameState) {\n        var pixelRatio = frameState.pixelRatio;\n        var viewState = frameState.viewState;\n        var resolution = viewState.resolution;\n        var projection = viewState.projection;\n        var layer = this.getLayer();\n        var tile = layer.getSource().getTile(z, x, y, pixelRatio, projection);\n        var viewHints = frameState.viewHints;\n        var hifi = !(viewHints[ViewHint.ANIMATING] || viewHints[ViewHint.INTERACTING]);\n        if (hifi || !tile.wantedResolution) {\n            tile.wantedResolution = resolution;\n        }\n        var render = this.prepareTile(tile, pixelRatio, projection);\n        if (render &&\n            (hifi || Date.now() - frameState.time < 8) &&\n            layer.getRenderMode() !== VectorTileRenderType.VECTOR) {\n            this.renderTileImage_(tile, frameState);\n        }\n        return _super.prototype.getTile.call(this, z, x, y, frameState);\n    };\n    /**\n     * @param {import(\"../../VectorRenderTile.js\").default} tile Tile.\n     * @return {boolean} Tile is drawable.\n     */\n    CanvasVectorTileLayerRenderer.prototype.isDrawableTile = function (tile) {\n        var layer = this.getLayer();\n        return (_super.prototype.isDrawableTile.call(this, tile) &&\n            (layer.getRenderMode() === VectorTileRenderType.VECTOR\n                ? getUid(layer) in tile.executorGroups\n                : tile.hasContext(layer)));\n    };\n    /**\n     * @inheritDoc\n     */\n    CanvasVectorTileLayerRenderer.prototype.getTileImage = function (tile) {\n        return tile.getImage(this.getLayer());\n    };\n    /**\n     * Determine whether render should be called.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @return {boolean} Layer is ready to be rendered.\n     */\n    CanvasVectorTileLayerRenderer.prototype.prepareFrame = function (frameState) {\n        var layerRevision = this.getLayer().getRevision();\n        if (this.renderedLayerRevision_ != layerRevision) {\n            this.renderedTiles.length = 0;\n        }\n        this.renderedLayerRevision_ = layerRevision;\n        return _super.prototype.prepareFrame.call(this, frameState);\n    };\n    /**\n     * @param {import(\"../../VectorRenderTile.js\").default} tile Tile.\n     * @param {number} pixelRatio Pixel ratio.\n     * @param {import(\"../../proj/Projection.js\").default} projection Projection.\n     * @private\n     */\n    CanvasVectorTileLayerRenderer.prototype.updateExecutorGroup_ = function (tile, pixelRatio, projection) {\n        var layer = /** @type {import(\"../../layer/VectorTile.js\").default} */ (this.getLayer());\n        var revision = layer.getRevision();\n        var renderOrder = layer.getRenderOrder() || null;\n        var resolution = tile.wantedResolution;\n        var builderState = tile.getReplayState(layer);\n        if (!builderState.dirty &&\n            builderState.renderedResolution === resolution &&\n            builderState.renderedRevision == revision &&\n            builderState.renderedRenderOrder == renderOrder) {\n            return;\n        }\n        var source = layer.getSource();\n        var declutter = layer.getDeclutter();\n        var sourceTileGrid = source.getTileGrid();\n        var tileGrid = source.getTileGridForProjection(projection);\n        var tileExtent = tileGrid.getTileCoordExtent(tile.wrappedTileCoord);\n        var sourceTiles = source.getSourceTiles(pixelRatio, projection, tile);\n        var layerUid = getUid(layer);\n        delete tile.hitDetectionImageData[layerUid];\n        tile.executorGroups[layerUid] = [];\n        if (declutter) {\n            tile.declutterExecutorGroups[layerUid] = [];\n        }\n        var _loop_1 = function (t, tt) {\n            var sourceTile = sourceTiles[t];\n            if (sourceTile.getState() != TileState.LOADED) {\n                return \"continue\";\n            }\n            var sourceTileCoord = sourceTile.tileCoord;\n            var sourceTileExtent = sourceTileGrid.getTileCoordExtent(sourceTileCoord);\n            var sharedExtent = getIntersection(tileExtent, sourceTileExtent);\n            var builderExtent = buffer(sharedExtent, layer.getRenderBuffer() * resolution, this_1.tmpExtent);\n            var bufferedExtent = equals(sourceTileExtent, sharedExtent)\n                ? null\n                : builderExtent;\n            builderState.dirty = false;\n            var builderGroup = new CanvasBuilderGroup(0, builderExtent, resolution, pixelRatio);\n            var declutterBuilderGroup = declutter\n                ? new CanvasBuilderGroup(0, sharedExtent, resolution, pixelRatio)\n                : undefined;\n            var squaredTolerance = getSquaredRenderTolerance(resolution, pixelRatio);\n            /**\n             * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n             * @this {CanvasVectorTileLayerRenderer}\n             */\n            var render = function (feature) {\n                var styles;\n                var styleFunction = feature.getStyleFunction() || layer.getStyleFunction();\n                if (styleFunction) {\n                    styles = styleFunction(feature, resolution);\n                }\n                if (styles) {\n                    var dirty = this.renderFeature(feature, squaredTolerance, styles, builderGroup, declutterBuilderGroup);\n                    this.dirty_ = this.dirty_ || dirty;\n                    builderState.dirty = builderState.dirty || dirty;\n                }\n            };\n            var features = sourceTile.getFeatures();\n            if (renderOrder && renderOrder !== builderState.renderedRenderOrder) {\n                features.sort(renderOrder);\n            }\n            for (var i = 0, ii = features.length; i < ii; ++i) {\n                var feature = features[i];\n                if (!bufferedExtent ||\n                    intersects(bufferedExtent, feature.getGeometry().getExtent())) {\n                    render.call(this_1, feature);\n                }\n            }\n            var executorGroupInstructions = builderGroup.finish();\n            // no need to clip when the render tile is covered by a single source tile\n            var replayExtent = layer.getRenderMode() !== VectorTileRenderType.VECTOR &&\n                declutter &&\n                sourceTiles.length === 1\n                ? null\n                : sharedExtent;\n            var renderingReplayGroup = new CanvasExecutorGroup(replayExtent, resolution, pixelRatio, source.getOverlaps(), executorGroupInstructions, layer.getRenderBuffer());\n            tile.executorGroups[layerUid].push(renderingReplayGroup);\n            if (declutterBuilderGroup) {\n                var declutterExecutorGroup = new CanvasExecutorGroup(null, resolution, pixelRatio, source.getOverlaps(), declutterBuilderGroup.finish(), layer.getRenderBuffer());\n                tile.declutterExecutorGroups[layerUid].push(declutterExecutorGroup);\n            }\n        };\n        var this_1 = this;\n        for (var t = 0, tt = sourceTiles.length; t < tt; ++t) {\n            _loop_1(t, tt);\n        }\n        builderState.renderedRevision = revision;\n        builderState.renderedRenderOrder = renderOrder;\n        builderState.renderedResolution = resolution;\n    };\n    /**\n     * @param {import(\"../../coordinate.js\").Coordinate} coordinate Coordinate.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @param {number} hitTolerance Hit tolerance in pixels.\n     * @param {import(\"../vector.js\").FeatureCallback<T>} callback Feature callback.\n     * @param {Array<import(\"../Map.js\").HitMatch<T>>} matches The hit detected matches with tolerance.\n     * @return {T|undefined} Callback result.\n     * @template T\n     */\n    CanvasVectorTileLayerRenderer.prototype.forEachFeatureAtCoordinate = function (coordinate, frameState, hitTolerance, callback, matches) {\n        var resolution = frameState.viewState.resolution;\n        var rotation = frameState.viewState.rotation;\n        hitTolerance = hitTolerance == undefined ? 0 : hitTolerance;\n        var layer = this.getLayer();\n        var source = layer.getSource();\n        var tileGrid = source.getTileGridForProjection(frameState.viewState.projection);\n        var hitExtent = boundingExtent([coordinate]);\n        buffer(hitExtent, resolution * hitTolerance, hitExtent);\n        /** @type {!Object<string, import(\"../Map.js\").HitMatch<T>|true>} */\n        var features = {};\n        /**\n         * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n         * @param {import(\"../../geom/SimpleGeometry.js\").default} geometry Geometry.\n         * @param {number} distanceSq The squared distance to the click position.\n         * @return {T|undefined} Callback result.\n         */\n        var featureCallback = function (feature, geometry, distanceSq) {\n            var key = feature.getId();\n            if (key === undefined) {\n                key = getUid(feature);\n            }\n            var match = features[key];\n            if (!match) {\n                if (distanceSq === 0) {\n                    features[key] = true;\n                    return callback(feature, layer, geometry);\n                }\n                matches.push((features[key] = {\n                    feature: feature,\n                    layer: layer,\n                    geometry: geometry,\n                    distanceSq: distanceSq,\n                    callback: callback,\n                }));\n            }\n            else if (match !== true && distanceSq < match.distanceSq) {\n                if (distanceSq === 0) {\n                    features[key] = true;\n                    matches.splice(matches.lastIndexOf(match), 1);\n                    return callback(feature, layer, geometry);\n                }\n                match.geometry = geometry;\n                match.distanceSq = distanceSq;\n            }\n            return undefined;\n        };\n        var renderedTiles = \n        /** @type {Array<import(\"../../VectorRenderTile.js\").default>} */ (this.renderedTiles);\n        var found;\n        var _loop_2 = function (i, ii) {\n            var tile = renderedTiles[i];\n            var tileExtent = tileGrid.getTileCoordExtent(tile.wrappedTileCoord);\n            if (!intersects(tileExtent, hitExtent)) {\n                return \"continue\";\n            }\n            var layerUid = getUid(layer);\n            var executorGroups = [tile.executorGroups[layerUid]];\n            var declutterExecutorGroups = tile.declutterExecutorGroups[layerUid];\n            if (declutterExecutorGroups) {\n                executorGroups.push(declutterExecutorGroups);\n            }\n            executorGroups.some(function (executorGroups) {\n                var declutteredFeatures = executorGroups === declutterExecutorGroups\n                    ? frameState.declutterTree.all().map(function (item) { return item.value; })\n                    : null;\n                for (var t = 0, tt = executorGroups.length; t < tt; ++t) {\n                    var executorGroup = executorGroups[t];\n                    found = executorGroup.forEachFeatureAtCoordinate(coordinate, resolution, rotation, hitTolerance, featureCallback, declutteredFeatures);\n                    if (found) {\n                        return true;\n                    }\n                }\n            });\n        };\n        for (var i = 0, ii = renderedTiles.length; !found && i < ii; ++i) {\n            _loop_2(i, ii);\n        }\n        return found;\n    };\n    /**\n     * Asynchronous layer level hit detection.\n     * @param {import(\"../../pixel.js\").Pixel} pixel Pixel.\n     * @return {Promise<Array<import(\"../../Feature\").default>>} Promise that resolves with an array of features.\n     */\n    CanvasVectorTileLayerRenderer.prototype.getFeatures = function (pixel) {\n        return new Promise(function (resolve, reject) {\n            var layer = \n            /** @type {import(\"../../layer/VectorTile.js\").default} */ (this.getLayer());\n            var layerUid = getUid(layer);\n            var source = layer.getSource();\n            var projection = this.renderedProjection;\n            var projectionExtent = projection.getExtent();\n            var resolution = this.renderedResolution;\n            var tileGrid = source.getTileGridForProjection(projection);\n            var coordinate = applyTransform(this.renderedPixelToCoordinateTransform_, pixel.slice());\n            var tileCoord = tileGrid.getTileCoordForCoordAndResolution(coordinate, resolution);\n            var tile;\n            for (var i = 0, ii = this.renderedTiles.length; i < ii; ++i) {\n                if (tileCoord.toString() === this.renderedTiles[i].tileCoord.toString()) {\n                    tile = this.renderedTiles[i];\n                    if (tile.getState() === TileState.LOADED) {\n                        var extent_1 = tileGrid.getTileCoordExtent(tile.tileCoord);\n                        if (source.getWrapX() &&\n                            projection.canWrapX() &&\n                            !containsExtent(projectionExtent, extent_1)) {\n                            wrapX(coordinate, projection);\n                        }\n                        break;\n                    }\n                    tile = undefined;\n                }\n            }\n            if (!tile || tile.loadingSourceTiles > 0) {\n                resolve([]);\n                return;\n            }\n            var extent = tileGrid.getTileCoordExtent(tile.wrappedTileCoord);\n            var corner = getTopLeft(extent);\n            var tilePixel = [\n                (coordinate[0] - corner[0]) / resolution,\n                (corner[1] - coordinate[1]) / resolution,\n            ];\n            var features = tile\n                .getSourceTiles()\n                .reduce(function (accumulator, sourceTile) {\n                return accumulator.concat(sourceTile.getFeatures());\n            }, []);\n            var hitDetectionImageData = tile.hitDetectionImageData[layerUid];\n            if (!hitDetectionImageData && !this.animatingOrInteracting_) {\n                var tileSize = toSize(tileGrid.getTileSize(tileGrid.getZForResolution(resolution)));\n                var rotation = this.renderedRotation_;\n                var transforms = [\n                    this.getRenderTransform(tileGrid.getTileCoordCenter(tile.wrappedTileCoord), resolution, 0, HIT_DETECT_RESOLUTION, tileSize[0] * HIT_DETECT_RESOLUTION, tileSize[1] * HIT_DETECT_RESOLUTION, 0),\n                ];\n                hitDetectionImageData = createHitDetectionImageData(tileSize, transforms, features, layer.getStyleFunction(), tileGrid.getTileCoordExtent(tile.wrappedTileCoord), tile.getReplayState(layer).renderedResolution, rotation);\n                tile.hitDetectionImageData[layerUid] = hitDetectionImageData;\n            }\n            resolve(hitDetect(tilePixel, features, hitDetectionImageData));\n        }.bind(this));\n    };\n    /**\n     * Perform action necessary to get the layer rendered after new fonts have loaded\n     */\n    CanvasVectorTileLayerRenderer.prototype.handleFontsChanged = function () {\n        var layer = this.getLayer();\n        if (layer.getVisible() && this.renderedLayerRevision_ !== undefined) {\n            layer.changed();\n        }\n    };\n    /**\n     * Handle changes in image style state.\n     * @param {import(\"../../events/Event.js\").default} event Image style change event.\n     * @private\n     */\n    CanvasVectorTileLayerRenderer.prototype.handleStyleImageChange_ = function (event) {\n        this.renderIfReadyAndVisible();\n    };\n    /**\n     * Render declutter items for this layer\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     */\n    CanvasVectorTileLayerRenderer.prototype.renderDeclutter = function (frameState) {\n        var context = this.context;\n        var alpha = context.globalAlpha;\n        context.globalAlpha = this.getLayer().getOpacity();\n        var viewHints = frameState.viewHints;\n        var hifi = !(viewHints[ViewHint.ANIMATING] || viewHints[ViewHint.INTERACTING]);\n        var tiles = \n        /** @type {Array<import(\"../../VectorRenderTile.js\").default>} */ (this.renderedTiles);\n        for (var i = 0, ii = tiles.length; i < ii; ++i) {\n            var tile = tiles[i];\n            var declutterExecutorGroups = tile.declutterExecutorGroups[getUid(this.getLayer())];\n            if (declutterExecutorGroups) {\n                for (var j = declutterExecutorGroups.length - 1; j >= 0; --j) {\n                    declutterExecutorGroups[j].execute(this.context, 1, this.getTileRenderTransform(tile, frameState), frameState.viewState.rotation, hifi, undefined, frameState.declutterTree);\n                }\n            }\n        }\n        context.globalAlpha = alpha;\n    };\n    CanvasVectorTileLayerRenderer.prototype.getTileRenderTransform = function (tile, frameState) {\n        var pixelRatio = frameState.pixelRatio;\n        var viewState = frameState.viewState;\n        var center = viewState.center;\n        var resolution = viewState.resolution;\n        var rotation = viewState.rotation;\n        var size = frameState.size;\n        var width = Math.round(size[0] * pixelRatio);\n        var height = Math.round(size[1] * pixelRatio);\n        var source = this.getLayer().getSource();\n        var tileGrid = source.getTileGridForProjection(frameState.viewState.projection);\n        var tileCoord = tile.tileCoord;\n        var tileExtent = tileGrid.getTileCoordExtent(tile.wrappedTileCoord);\n        var worldOffset = tileGrid.getTileCoordExtent(tileCoord, this.tmpExtent)[0] - tileExtent[0];\n        var transform = multiply(scale(this.inversePixelTransform.slice(), 1 / pixelRatio, 1 / pixelRatio), this.getRenderTransform(center, resolution, rotation, pixelRatio, width, height, worldOffset));\n        return transform;\n    };\n    /**\n     * Render the layer.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @param {HTMLElement} target Target that may be used to render content to.\n     * @return {HTMLElement} The rendered element.\n     */\n    CanvasVectorTileLayerRenderer.prototype.renderFrame = function (frameState, target) {\n        var viewHints = frameState.viewHints;\n        var hifi = !(viewHints[ViewHint.ANIMATING] || viewHints[ViewHint.INTERACTING]);\n        _super.prototype.renderFrame.call(this, frameState, target);\n        this.renderedPixelToCoordinateTransform_ =\n            frameState.pixelToCoordinateTransform.slice();\n        this.renderedRotation_ = frameState.viewState.rotation;\n        var layer = /** @type {import(\"../../layer/VectorTile.js\").default} */ (this.getLayer());\n        var renderMode = layer.getRenderMode();\n        var context = this.context;\n        var alpha = context.globalAlpha;\n        context.globalAlpha = layer.getOpacity();\n        var replayTypes = VECTOR_REPLAYS[renderMode];\n        var viewState = frameState.viewState;\n        var rotation = viewState.rotation;\n        var tiles = this.renderedTiles;\n        var clips = [];\n        var clipZs = [];\n        for (var i = tiles.length - 1; i >= 0; --i) {\n            var tile = /** @type {import(\"../../VectorRenderTile.js\").default} */ (tiles[i]);\n            var transform = this.getTileRenderTransform(tile, frameState);\n            var executorGroups = tile.executorGroups[getUid(layer)];\n            var clipped = false;\n            for (var t = 0, tt = executorGroups.length; t < tt; ++t) {\n                var executorGroup = executorGroups[t];\n                if (!executorGroup.hasExecutors(replayTypes)) {\n                    // sourceTile has no instructions of the types we want to render\n                    continue;\n                }\n                var currentZ = tile.tileCoord[0];\n                var currentClip = void 0;\n                if (!clipped) {\n                    currentClip = executorGroup.getClipCoords(transform);\n                    if (currentClip) {\n                        context.save();\n                        // Create a clip mask for regions in this low resolution tile that are\n                        // already filled by a higher resolution tile\n                        for (var j = 0, jj = clips.length; j < jj; ++j) {\n                            var clip = clips[j];\n                            if (currentZ < clipZs[j]) {\n                                context.beginPath();\n                                // counter-clockwise (outer ring) for current tile\n                                context.moveTo(currentClip[0], currentClip[1]);\n                                context.lineTo(currentClip[2], currentClip[3]);\n                                context.lineTo(currentClip[4], currentClip[5]);\n                                context.lineTo(currentClip[6], currentClip[7]);\n                                // clockwise (inner ring) for higher resolution tile\n                                context.moveTo(clip[6], clip[7]);\n                                context.lineTo(clip[4], clip[5]);\n                                context.lineTo(clip[2], clip[3]);\n                                context.lineTo(clip[0], clip[1]);\n                                context.clip();\n                            }\n                        }\n                    }\n                }\n                executorGroup.execute(context, 1, transform, rotation, hifi, replayTypes);\n                if (!clipped && currentClip) {\n                    context.restore();\n                    clips.push(currentClip);\n                    clipZs.push(currentZ);\n                    clipped = true;\n                }\n            }\n        }\n        context.globalAlpha = alpha;\n        return this.container;\n    };\n    /**\n     * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n     * @param {number} squaredTolerance Squared tolerance.\n     * @param {import(\"../../style/Style.js\").default|Array<import(\"../../style/Style.js\").default>} styles The style or array of styles.\n     * @param {import(\"../../render/canvas/BuilderGroup.js\").default} builderGroup Replay group.\n     * @param {import(\"../../render/canvas/BuilderGroup.js\").default} [opt_declutterBuilderGroup] Builder group for decluttering.\n     * @return {boolean} `true` if an image is loading.\n     */\n    CanvasVectorTileLayerRenderer.prototype.renderFeature = function (feature, squaredTolerance, styles, builderGroup, opt_declutterBuilderGroup) {\n        if (!styles) {\n            return false;\n        }\n        var loading = false;\n        if (Array.isArray(styles)) {\n            for (var i = 0, ii = styles.length; i < ii; ++i) {\n                loading =\n                    renderFeature(builderGroup, feature, styles[i], squaredTolerance, this.boundHandleStyleImageChange_, undefined, opt_declutterBuilderGroup) || loading;\n            }\n        }\n        else {\n            loading = renderFeature(builderGroup, feature, styles, squaredTolerance, this.boundHandleStyleImageChange_, undefined, opt_declutterBuilderGroup);\n        }\n        return loading;\n    };\n    /**\n     * @param {import(\"../../VectorRenderTile.js\").default} tile Tile.\n     * @return {boolean} A new tile image was rendered.\n     * @private\n     */\n    CanvasVectorTileLayerRenderer.prototype.tileImageNeedsRender_ = function (tile) {\n        var layer = /** @type {import(\"../../layer/VectorTile.js\").default} */ (this.getLayer());\n        if (layer.getRenderMode() === VectorTileRenderType.VECTOR) {\n            return false;\n        }\n        var replayState = tile.getReplayState(layer);\n        var revision = layer.getRevision();\n        var resolution = tile.wantedResolution;\n        return (replayState.renderedTileResolution !== resolution ||\n            replayState.renderedTileRevision !== revision);\n    };\n    /**\n     * @param {import(\"../../VectorRenderTile.js\").default} tile Tile.\n     * @param {import(\"../../PluggableMap\").FrameState} frameState Frame state.\n     * @private\n     */\n    CanvasVectorTileLayerRenderer.prototype.renderTileImage_ = function (tile, frameState) {\n        var layer = /** @type {import(\"../../layer/VectorTile.js\").default} */ (this.getLayer());\n        var replayState = tile.getReplayState(layer);\n        var revision = layer.getRevision();\n        var executorGroups = tile.executorGroups[getUid(layer)];\n        replayState.renderedTileRevision = revision;\n        var tileCoord = tile.wrappedTileCoord;\n        var z = tileCoord[0];\n        var source = layer.getSource();\n        var pixelRatio = frameState.pixelRatio;\n        var viewState = frameState.viewState;\n        var projection = viewState.projection;\n        var tileGrid = source.getTileGridForProjection(projection);\n        var tileResolution = tileGrid.getResolution(tile.tileCoord[0]);\n        var renderPixelRatio = (frameState.pixelRatio / tile.wantedResolution) * tileResolution;\n        var resolution = tileGrid.getResolution(z);\n        var context = tile.getContext(layer);\n        // Increase tile size when overzooming for low pixel ratio, to avoid blurry tiles\n        pixelRatio = Math.round(Math.max(pixelRatio, renderPixelRatio / pixelRatio));\n        var size = source.getTilePixelSize(z, pixelRatio, projection);\n        context.canvas.width = size[0];\n        context.canvas.height = size[1];\n        var renderScale = pixelRatio / renderPixelRatio;\n        if (renderScale !== 1) {\n            var canvasTransform = resetTransform(this.tmpTransform_);\n            scaleTransform(canvasTransform, renderScale, renderScale);\n            context.setTransform.apply(context, canvasTransform);\n        }\n        var tileExtent = tileGrid.getTileCoordExtent(tileCoord, this.tmpExtent);\n        var pixelScale = renderPixelRatio / resolution;\n        var transform = resetTransform(this.tmpTransform_);\n        scaleTransform(transform, pixelScale, -pixelScale);\n        translateTransform(transform, -tileExtent[0], -tileExtent[3]);\n        for (var i = 0, ii = executorGroups.length; i < ii; ++i) {\n            var executorGroup = executorGroups[i];\n            executorGroup.execute(context, renderScale, transform, 0, true, IMAGE_REPLAYS[layer.getRenderMode()]);\n        }\n        replayState.renderedTileResolution = tile.wantedResolution;\n    };\n    return CanvasVectorTileLayerRenderer;\n}(CanvasTileLayerRenderer));\nexport default CanvasVectorTileLayerRenderer;\n//# sourceMappingURL=VectorTileLayer.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n/**\n * @module ol/renderer/canvas/TileLayer\n */\nimport CanvasLayerRenderer from './Layer.js';\nimport TileRange from '../../TileRange.js';\nimport TileState from '../../TileState.js';\nimport { IMAGE_SMOOTHING_DISABLED } from './common.js';\nimport { apply as applyTransform, compose as composeTransform, makeInverse, } from '../../transform.js';\nimport { assign } from '../../obj.js';\nimport { createEmpty, equals, getIntersection, getTopLeft, } from '../../extent.js';\nimport { cssOpacity } from '../../css.js';\nimport { fromUserExtent } from '../../proj.js';\nimport { getUid } from '../../util.js';\nimport { numberSafeCompareFunction } from '../../array.js';\nimport { toString as toTransformString } from '../../transform.js';\n/**\n * @classdesc\n * Canvas renderer for tile layers.\n * @api\n */\nvar CanvasTileLayerRenderer = /** @class */ (function (_super) {\n    __extends(CanvasTileLayerRenderer, _super);\n    /**\n     * @param {import(\"../../layer/Tile.js\").default|import(\"../../layer/VectorTile.js\").default} tileLayer Tile layer.\n     */\n    function CanvasTileLayerRenderer(tileLayer) {\n        var _this = _super.call(this, tileLayer) || this;\n        /**\n         * Rendered extent has changed since the previous `renderFrame()` call\n         * @type {boolean}\n         */\n        _this.extentChanged = true;\n        /**\n         * @private\n         * @type {?import(\"../../extent.js\").Extent}\n         */\n        _this.renderedExtent_ = null;\n        /**\n         * @protected\n         * @type {number}\n         */\n        _this.renderedPixelRatio;\n        /**\n         * @protected\n         * @type {import(\"../../proj/Projection.js\").default}\n         */\n        _this.renderedProjection = null;\n        /**\n         * @protected\n         * @type {number}\n         */\n        _this.renderedRevision;\n        /**\n         * @protected\n         * @type {!Array<import(\"../../Tile.js\").default>}\n         */\n        _this.renderedTiles = [];\n        /**\n         * @private\n         * @type {boolean}\n         */\n        _this.newTiles_ = false;\n        /**\n         * @protected\n         * @type {import(\"../../extent.js\").Extent}\n         */\n        _this.tmpExtent = createEmpty();\n        /**\n         * @private\n         * @type {import(\"../../TileRange.js\").default}\n         */\n        _this.tmpTileRange_ = new TileRange(0, 0, 0, 0);\n        return _this;\n    }\n    /**\n     * @protected\n     * @param {import(\"../../Tile.js\").default} tile Tile.\n     * @return {boolean} Tile is drawable.\n     */\n    CanvasTileLayerRenderer.prototype.isDrawableTile = function (tile) {\n        var tileLayer = this.getLayer();\n        var tileState = tile.getState();\n        var useInterimTilesOnError = tileLayer.getUseInterimTilesOnError();\n        return (tileState == TileState.LOADED ||\n            tileState == TileState.EMPTY ||\n            (tileState == TileState.ERROR && !useInterimTilesOnError));\n    };\n    /**\n     * @param {number} z Tile coordinate z.\n     * @param {number} x Tile coordinate x.\n     * @param {number} y Tile coordinate y.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @return {!import(\"../../Tile.js\").default} Tile.\n     */\n    CanvasTileLayerRenderer.prototype.getTile = function (z, x, y, frameState) {\n        var pixelRatio = frameState.pixelRatio;\n        var projection = frameState.viewState.projection;\n        var tileLayer = this.getLayer();\n        var tileSource = tileLayer.getSource();\n        var tile = tileSource.getTile(z, x, y, pixelRatio, projection);\n        if (tile.getState() == TileState.ERROR) {\n            if (!tileLayer.getUseInterimTilesOnError()) {\n                // When useInterimTilesOnError is false, we consider the error tile as loaded.\n                tile.setState(TileState.LOADED);\n            }\n            else if (tileLayer.getPreload() > 0) {\n                // Preloaded tiles for lower resolutions might have finished loading.\n                this.newTiles_ = true;\n            }\n        }\n        if (!this.isDrawableTile(tile)) {\n            tile = tile.getInterimTile();\n        }\n        return tile;\n    };\n    /**\n     * @param {Object<number, Object<string, import(\"../../Tile.js\").default>>} tiles Lookup of loaded tiles by zoom level.\n     * @param {number} zoom Zoom level.\n     * @param {import(\"../../Tile.js\").default} tile Tile.\n     * @return {boolean|void} If `false`, the tile will not be considered loaded.\n     */\n    CanvasTileLayerRenderer.prototype.loadedTileCallback = function (tiles, zoom, tile) {\n        if (this.isDrawableTile(tile)) {\n            return _super.prototype.loadedTileCallback.call(this, tiles, zoom, tile);\n        }\n        return false;\n    };\n    /**\n     * Determine whether render should be called.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @return {boolean} Layer is ready to be rendered.\n     */\n    CanvasTileLayerRenderer.prototype.prepareFrame = function (frameState) {\n        return !!this.getLayer().getSource();\n    };\n    /**\n     * Render the layer.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @param {HTMLElement} target Target that may be used to render content to.\n     * @return {HTMLElement} The rendered element.\n     */\n    CanvasTileLayerRenderer.prototype.renderFrame = function (frameState, target) {\n        var layerState = frameState.layerStatesArray[frameState.layerIndex];\n        var viewState = frameState.viewState;\n        var projection = viewState.projection;\n        var viewResolution = viewState.resolution;\n        var viewCenter = viewState.center;\n        var rotation = viewState.rotation;\n        var pixelRatio = frameState.pixelRatio;\n        var tileLayer = this.getLayer();\n        var tileSource = tileLayer.getSource();\n        var sourceRevision = tileSource.getRevision();\n        var tileGrid = tileSource.getTileGridForProjection(projection);\n        var z = tileGrid.getZForResolution(viewResolution, tileSource.zDirection);\n        var tileResolution = tileGrid.getResolution(z);\n        var extent = frameState.extent;\n        var layerExtent = layerState.extent && fromUserExtent(layerState.extent, projection);\n        if (layerExtent) {\n            extent = getIntersection(extent, fromUserExtent(layerState.extent, projection));\n        }\n        var tilePixelRatio = tileSource.getTilePixelRatio(pixelRatio);\n        // desired dimensions of the canvas in pixels\n        var width = Math.round(frameState.size[0] * tilePixelRatio);\n        var height = Math.round(frameState.size[1] * tilePixelRatio);\n        if (rotation) {\n            var size = Math.round(Math.sqrt(width * width + height * height));\n            width = size;\n            height = size;\n        }\n        var dx = (tileResolution * width) / 2 / tilePixelRatio;\n        var dy = (tileResolution * height) / 2 / tilePixelRatio;\n        var canvasExtent = [\n            viewCenter[0] - dx,\n            viewCenter[1] - dy,\n            viewCenter[0] + dx,\n            viewCenter[1] + dy,\n        ];\n        var tileRange = tileGrid.getTileRangeForExtentAndZ(extent, z);\n        /**\n         * @type {Object<number, Object<string, import(\"../../Tile.js\").default>>}\n         */\n        var tilesToDrawByZ = {};\n        tilesToDrawByZ[z] = {};\n        var findLoadedTiles = this.createLoadedTileFinder(tileSource, projection, tilesToDrawByZ);\n        var tmpExtent = this.tmpExtent;\n        var tmpTileRange = this.tmpTileRange_;\n        this.newTiles_ = false;\n        for (var x = tileRange.minX; x <= tileRange.maxX; ++x) {\n            for (var y = tileRange.minY; y <= tileRange.maxY; ++y) {\n                var tile = this.getTile(z, x, y, frameState);\n                if (this.isDrawableTile(tile)) {\n                    var uid = getUid(this);\n                    if (tile.getState() == TileState.LOADED) {\n                        tilesToDrawByZ[z][tile.tileCoord.toString()] = tile;\n                        var inTransition = tile.inTransition(uid);\n                        if (!this.newTiles_ &&\n                            (inTransition || this.renderedTiles.indexOf(tile) === -1)) {\n                            this.newTiles_ = true;\n                        }\n                    }\n                    if (tile.getAlpha(uid, frameState.time) === 1) {\n                        // don't look for alt tiles if alpha is 1\n                        continue;\n                    }\n                }\n                var childTileRange = tileGrid.getTileCoordChildTileRange(tile.tileCoord, tmpTileRange, tmpExtent);\n                var covered = false;\n                if (childTileRange) {\n                    covered = findLoadedTiles(z + 1, childTileRange);\n                }\n                if (!covered) {\n                    tileGrid.forEachTileCoordParentTileRange(tile.tileCoord, findLoadedTiles, tmpTileRange, tmpExtent);\n                }\n            }\n        }\n        var canvasScale = tileResolution / viewResolution;\n        // set forward and inverse pixel transforms\n        composeTransform(this.pixelTransform, frameState.size[0] / 2, frameState.size[1] / 2, 1 / tilePixelRatio, 1 / tilePixelRatio, rotation, -width / 2, -height / 2);\n        var canvasTransform = toTransformString(this.pixelTransform);\n        this.useContainer(target, canvasTransform, layerState.opacity, this.getBackground(frameState));\n        var context = this.context;\n        var canvas = context.canvas;\n        makeInverse(this.inversePixelTransform, this.pixelTransform);\n        // set scale transform for calculating tile positions on the canvas\n        composeTransform(this.tempTransform, width / 2, height / 2, canvasScale, canvasScale, 0, -width / 2, -height / 2);\n        if (canvas.width != width || canvas.height != height) {\n            canvas.width = width;\n            canvas.height = height;\n        }\n        else if (!this.containerReused) {\n            context.clearRect(0, 0, width, height);\n        }\n        if (layerExtent) {\n            this.clipUnrotated(context, frameState, layerExtent);\n        }\n        if (!tileSource.getInterpolate()) {\n            assign(context, IMAGE_SMOOTHING_DISABLED);\n        }\n        this.preRender(context, frameState);\n        this.renderedTiles.length = 0;\n        /** @type {Array<number>} */\n        var zs = Object.keys(tilesToDrawByZ).map(Number);\n        zs.sort(numberSafeCompareFunction);\n        var clips, clipZs, currentClip;\n        if (layerState.opacity === 1 &&\n            (!this.containerReused ||\n                tileSource.getOpaque(frameState.viewState.projection))) {\n            zs = zs.reverse();\n        }\n        else {\n            clips = [];\n            clipZs = [];\n        }\n        for (var i = zs.length - 1; i >= 0; --i) {\n            var currentZ = zs[i];\n            var currentTilePixelSize = tileSource.getTilePixelSize(currentZ, pixelRatio, projection);\n            var currentResolution = tileGrid.getResolution(currentZ);\n            var currentScale = currentResolution / tileResolution;\n            var dx_1 = currentTilePixelSize[0] * currentScale * canvasScale;\n            var dy_1 = currentTilePixelSize[1] * currentScale * canvasScale;\n            var originTileCoord = tileGrid.getTileCoordForCoordAndZ(getTopLeft(canvasExtent), currentZ);\n            var originTileExtent = tileGrid.getTileCoordExtent(originTileCoord);\n            var origin_1 = applyTransform(this.tempTransform, [\n                (tilePixelRatio * (originTileExtent[0] - canvasExtent[0])) /\n                    tileResolution,\n                (tilePixelRatio * (canvasExtent[3] - originTileExtent[3])) /\n                    tileResolution,\n            ]);\n            var tileGutter = tilePixelRatio * tileSource.getGutterForProjection(projection);\n            var tilesToDraw = tilesToDrawByZ[currentZ];\n            for (var tileCoordKey in tilesToDraw) {\n                var tile = /** @type {import(\"../../ImageTile.js\").default} */ (tilesToDraw[tileCoordKey]);\n                var tileCoord = tile.tileCoord;\n                // Calculate integer positions and sizes so that tiles align\n                var xIndex = originTileCoord[1] - tileCoord[1];\n                var nextX = Math.round(origin_1[0] - (xIndex - 1) * dx_1);\n                var yIndex = originTileCoord[2] - tileCoord[2];\n                var nextY = Math.round(origin_1[1] - (yIndex - 1) * dy_1);\n                var x = Math.round(origin_1[0] - xIndex * dx_1);\n                var y = Math.round(origin_1[1] - yIndex * dy_1);\n                var w = nextX - x;\n                var h = nextY - y;\n                var transition = z === currentZ;\n                var inTransition = transition && tile.getAlpha(getUid(this), frameState.time) !== 1;\n                if (!inTransition) {\n                    if (clips) {\n                        // Clip mask for regions in this tile that already filled by a higher z tile\n                        context.save();\n                        currentClip = [x, y, x + w, y, x + w, y + h, x, y + h];\n                        for (var i_1 = 0, ii = clips.length; i_1 < ii; ++i_1) {\n                            if (z !== currentZ && currentZ < clipZs[i_1]) {\n                                var clip = clips[i_1];\n                                context.beginPath();\n                                // counter-clockwise (outer ring) for current tile\n                                context.moveTo(currentClip[0], currentClip[1]);\n                                context.lineTo(currentClip[2], currentClip[3]);\n                                context.lineTo(currentClip[4], currentClip[5]);\n                                context.lineTo(currentClip[6], currentClip[7]);\n                                // clockwise (inner ring) for higher z tile\n                                context.moveTo(clip[6], clip[7]);\n                                context.lineTo(clip[4], clip[5]);\n                                context.lineTo(clip[2], clip[3]);\n                                context.lineTo(clip[0], clip[1]);\n                                context.clip();\n                            }\n                        }\n                        clips.push(currentClip);\n                        clipZs.push(currentZ);\n                    }\n                    else {\n                        context.clearRect(x, y, w, h);\n                    }\n                }\n                this.drawTileImage(tile, frameState, x, y, w, h, tileGutter, transition);\n                if (clips && !inTransition) {\n                    context.restore();\n                    this.renderedTiles.unshift(tile);\n                }\n                else {\n                    this.renderedTiles.push(tile);\n                }\n                this.updateUsedTiles(frameState.usedTiles, tileSource, tile);\n            }\n        }\n        this.renderedRevision = sourceRevision;\n        this.renderedResolution = tileResolution;\n        this.extentChanged =\n            !this.renderedExtent_ || !equals(this.renderedExtent_, canvasExtent);\n        this.renderedExtent_ = canvasExtent;\n        this.renderedPixelRatio = pixelRatio;\n        this.renderedProjection = projection;\n        this.manageTilePyramid(frameState, tileSource, tileGrid, pixelRatio, projection, extent, z, tileLayer.getPreload());\n        this.scheduleExpireCache(frameState, tileSource);\n        this.postRender(context, frameState);\n        if (layerState.extent) {\n            context.restore();\n        }\n        if (canvasTransform !== canvas.style.transform) {\n            canvas.style.transform = canvasTransform;\n        }\n        var opacity = cssOpacity(layerState.opacity);\n        var container = this.container;\n        if (opacity !== container.style.opacity) {\n            container.style.opacity = opacity;\n        }\n        return this.container;\n    };\n    /**\n     * @param {import(\"../../ImageTile.js\").default} tile Tile.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @param {number} x Left of the tile.\n     * @param {number} y Top of the tile.\n     * @param {number} w Width of the tile.\n     * @param {number} h Height of the tile.\n     * @param {number} gutter Tile gutter.\n     * @param {boolean} transition Apply an alpha transition.\n     */\n    CanvasTileLayerRenderer.prototype.drawTileImage = function (tile, frameState, x, y, w, h, gutter, transition) {\n        var image = this.getTileImage(tile);\n        if (!image) {\n            return;\n        }\n        var uid = getUid(this);\n        var alpha = transition ? tile.getAlpha(uid, frameState.time) : 1;\n        var alphaChanged = alpha !== this.context.globalAlpha;\n        if (alphaChanged) {\n            this.context.save();\n            this.context.globalAlpha = alpha;\n        }\n        this.context.drawImage(image, gutter, gutter, image.width - 2 * gutter, image.height - 2 * gutter, x, y, w, h);\n        if (alphaChanged) {\n            this.context.restore();\n        }\n        if (alpha !== 1) {\n            frameState.animate = true;\n        }\n        else if (transition) {\n            tile.endTransition(uid);\n        }\n    };\n    /**\n     * @return {HTMLCanvasElement} Image\n     */\n    CanvasTileLayerRenderer.prototype.getImage = function () {\n        var context = this.context;\n        return context ? context.canvas : null;\n    };\n    /**\n     * Get the image from a tile.\n     * @param {import(\"../../ImageTile.js\").default} tile Tile.\n     * @return {HTMLCanvasElement|HTMLImageElement|HTMLVideoElement} Image.\n     * @protected\n     */\n    CanvasTileLayerRenderer.prototype.getTileImage = function (tile) {\n        return tile.getImage();\n    };\n    /**\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @param {import(\"../../source/Tile.js\").default} tileSource Tile source.\n     * @protected\n     */\n    CanvasTileLayerRenderer.prototype.scheduleExpireCache = function (frameState, tileSource) {\n        if (tileSource.canExpireCache()) {\n            /**\n             * @param {import(\"../../source/Tile.js\").default} tileSource Tile source.\n             * @param {import(\"../../PluggableMap.js\").default} map Map.\n             * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n             */\n            var postRenderFunction = function (tileSource, map, frameState) {\n                var tileSourceKey = getUid(tileSource);\n                if (tileSourceKey in frameState.usedTiles) {\n                    tileSource.expireCache(frameState.viewState.projection, frameState.usedTiles[tileSourceKey]);\n                }\n            }.bind(null, tileSource);\n            frameState.postRenderFunctions.push(\n            /** @type {import(\"../../PluggableMap.js\").PostRenderFunction} */ (postRenderFunction));\n        }\n    };\n    /**\n     * @param {!Object<string, !Object<string, boolean>>} usedTiles Used tiles.\n     * @param {import(\"../../source/Tile.js\").default} tileSource Tile source.\n     * @param {import('../../Tile.js').default} tile Tile.\n     * @protected\n     */\n    CanvasTileLayerRenderer.prototype.updateUsedTiles = function (usedTiles, tileSource, tile) {\n        // FIXME should we use tilesToDrawByZ instead?\n        var tileSourceKey = getUid(tileSource);\n        if (!(tileSourceKey in usedTiles)) {\n            usedTiles[tileSourceKey] = {};\n        }\n        usedTiles[tileSourceKey][tile.getKey()] = true;\n    };\n    /**\n     * Manage tile pyramid.\n     * This function performs a number of functions related to the tiles at the\n     * current zoom and lower zoom levels:\n     * - registers idle tiles in frameState.wantedTiles so that they are not\n     *   discarded by the tile queue\n     * - enqueues missing tiles\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @param {import(\"../../source/Tile.js\").default} tileSource Tile source.\n     * @param {import(\"../../tilegrid/TileGrid.js\").default} tileGrid Tile grid.\n     * @param {number} pixelRatio Pixel ratio.\n     * @param {import(\"../../proj/Projection.js\").default} projection Projection.\n     * @param {import(\"../../extent.js\").Extent} extent Extent.\n     * @param {number} currentZ Current Z.\n     * @param {number} preload Load low resolution tiles up to 'preload' levels.\n     * @param {function(import(\"../../Tile.js\").default):void} [opt_tileCallback] Tile callback.\n     * @protected\n     */\n    CanvasTileLayerRenderer.prototype.manageTilePyramid = function (frameState, tileSource, tileGrid, pixelRatio, projection, extent, currentZ, preload, opt_tileCallback) {\n        var tileSourceKey = getUid(tileSource);\n        if (!(tileSourceKey in frameState.wantedTiles)) {\n            frameState.wantedTiles[tileSourceKey] = {};\n        }\n        var wantedTiles = frameState.wantedTiles[tileSourceKey];\n        var tileQueue = frameState.tileQueue;\n        var minZoom = tileGrid.getMinZoom();\n        var tileCount = 0;\n        var tile, tileRange, tileResolution, x, y, z;\n        for (z = minZoom; z <= currentZ; ++z) {\n            tileRange = tileGrid.getTileRangeForExtentAndZ(extent, z, tileRange);\n            tileResolution = tileGrid.getResolution(z);\n            for (x = tileRange.minX; x <= tileRange.maxX; ++x) {\n                for (y = tileRange.minY; y <= tileRange.maxY; ++y) {\n                    if (currentZ - z <= preload) {\n                        ++tileCount;\n                        tile = tileSource.getTile(z, x, y, pixelRatio, projection);\n                        if (tile.getState() == TileState.IDLE) {\n                            wantedTiles[tile.getKey()] = true;\n                            if (!tileQueue.isKeyQueued(tile.getKey())) {\n                                tileQueue.enqueue([\n                                    tile,\n                                    tileSourceKey,\n                                    tileGrid.getTileCoordCenter(tile.tileCoord),\n                                    tileResolution,\n                                ]);\n                            }\n                        }\n                        if (opt_tileCallback !== undefined) {\n                            opt_tileCallback(tile);\n                        }\n                    }\n                    else {\n                        tileSource.useTile(z, x, y, projection);\n                    }\n                }\n            }\n        }\n        tileSource.updateCacheSize(tileCount, projection);\n    };\n    return CanvasTileLayerRenderer;\n}(CanvasLayerRenderer));\n/**\n * @function\n * @return {import(\"../../layer/Tile.js\").default|import(\"../../layer/VectorTile.js\").default}\n */\nCanvasTileLayerRenderer.prototype.getLayer;\nexport default CanvasTileLayerRenderer;\n//# sourceMappingURL=TileLayer.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n/**\n * @module ol/renderer/canvas/VectorLayer\n */\nimport CanvasBuilderGroup from '../../render/canvas/BuilderGroup.js';\nimport CanvasLayerRenderer from './Layer.js';\nimport ExecutorGroup from '../../render/canvas/ExecutorGroup.js';\nimport ViewHint from '../../ViewHint.js';\nimport { HIT_DETECT_RESOLUTION, createHitDetectionImageData, hitDetect, } from '../../render/canvas/hitdetect.js';\nimport { apply, makeInverse, makeScale, toString as transformToString, } from '../../transform.js';\nimport { buffer, containsExtent, createEmpty, getWidth, intersects as intersectsExtent, wrapX as wrapExtentX, } from '../../extent.js';\nimport { cssOpacity } from '../../css.js';\nimport { defaultOrder as defaultRenderOrder, getTolerance as getRenderTolerance, getSquaredTolerance as getSquaredRenderTolerance, renderFeature, } from '../vector.js';\nimport { equals } from '../../array.js';\nimport { fromUserExtent, getTransformFromProjections, getUserProjection, toUserExtent, toUserResolution, } from '../../proj.js';\nimport { getUid } from '../../util.js';\nimport { wrapX as wrapCoordinateX } from '../../coordinate.js';\n/**\n * @classdesc\n * Canvas renderer for vector layers.\n * @api\n */\nvar CanvasVectorLayerRenderer = /** @class */ (function (_super) {\n    __extends(CanvasVectorLayerRenderer, _super);\n    /**\n     * @param {import(\"../../layer/BaseVector.js\").default} vectorLayer Vector layer.\n     */\n    function CanvasVectorLayerRenderer(vectorLayer) {\n        var _this = _super.call(this, vectorLayer) || this;\n        /** @private */\n        _this.boundHandleStyleImageChange_ = _this.handleStyleImageChange_.bind(_this);\n        /**\n         * @type {boolean}\n         */\n        _this.animatingOrInteracting_;\n        /**\n         * @private\n         * @type {boolean}\n         */\n        _this.dirty_ = false;\n        /**\n         * @type {ImageData}\n         */\n        _this.hitDetectionImageData_ = null;\n        /**\n         * @type {Array<import(\"../../Feature.js\").default>}\n         */\n        _this.renderedFeatures_ = null;\n        /**\n         * @private\n         * @type {number}\n         */\n        _this.renderedRevision_ = -1;\n        /**\n         * @private\n         * @type {number}\n         */\n        _this.renderedResolution_ = NaN;\n        /**\n         * @private\n         * @type {import(\"../../extent.js\").Extent}\n         */\n        _this.renderedExtent_ = createEmpty();\n        /**\n         * @private\n         * @type {import(\"../../extent.js\").Extent}\n         */\n        _this.wrappedRenderedExtent_ = createEmpty();\n        /**\n         * @private\n         * @type {number}\n         */\n        _this.renderedRotation_;\n        /**\n         * @private\n         * @type {import(\"../../coordinate\").Coordinate}\n         */\n        _this.renderedCenter_ = null;\n        /**\n         * @private\n         * @type {import(\"../../proj/Projection\").default}\n         */\n        _this.renderedProjection_ = null;\n        /**\n         * @private\n         * @type {function(import(\"../../Feature.js\").default, import(\"../../Feature.js\").default): number|null}\n         */\n        _this.renderedRenderOrder_ = null;\n        /**\n         * @private\n         * @type {import(\"../../render/canvas/ExecutorGroup\").default}\n         */\n        _this.replayGroup_ = null;\n        /**\n         * A new replay group had to be created by `prepareFrame()`\n         * @type {boolean}\n         */\n        _this.replayGroupChanged = true;\n        /**\n         * @type {import(\"../../render/canvas/ExecutorGroup\").default}\n         */\n        _this.declutterExecutorGroup = null;\n        /**\n         * Clipping to be performed by `renderFrame()`\n         * @type {boolean}\n         */\n        _this.clipping = true;\n        return _this;\n    }\n    /**\n     * @param {ExecutorGroup} executorGroup Executor group.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @param {import(\"rbush\").default} [opt_declutterTree] Declutter tree.\n     */\n    CanvasVectorLayerRenderer.prototype.renderWorlds = function (executorGroup, frameState, opt_declutterTree) {\n        var extent = frameState.extent;\n        var viewState = frameState.viewState;\n        var center = viewState.center;\n        var resolution = viewState.resolution;\n        var projection = viewState.projection;\n        var rotation = viewState.rotation;\n        var projectionExtent = projection.getExtent();\n        var vectorSource = this.getLayer().getSource();\n        var pixelRatio = frameState.pixelRatio;\n        var viewHints = frameState.viewHints;\n        var snapToPixel = !(viewHints[ViewHint.ANIMATING] || viewHints[ViewHint.INTERACTING]);\n        var context = this.context;\n        var width = Math.round(frameState.size[0] * pixelRatio);\n        var height = Math.round(frameState.size[1] * pixelRatio);\n        var multiWorld = vectorSource.getWrapX() && projection.canWrapX();\n        var worldWidth = multiWorld ? getWidth(projectionExtent) : null;\n        var endWorld = multiWorld\n            ? Math.ceil((extent[2] - projectionExtent[2]) / worldWidth) + 1\n            : 1;\n        var world = multiWorld\n            ? Math.floor((extent[0] - projectionExtent[0]) / worldWidth)\n            : 0;\n        do {\n            var transform = this.getRenderTransform(center, resolution, rotation, pixelRatio, width, height, world * worldWidth);\n            executorGroup.execute(context, 1, transform, rotation, snapToPixel, undefined, opt_declutterTree);\n        } while (++world < endWorld);\n    };\n    /**\n     * Render declutter items for this layer\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     */\n    CanvasVectorLayerRenderer.prototype.renderDeclutter = function (frameState) {\n        if (this.declutterExecutorGroup) {\n            this.renderWorlds(this.declutterExecutorGroup, frameState, frameState.declutterTree);\n        }\n    };\n    /**\n     * Render the layer.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @param {HTMLElement} target Target that may be used to render content to.\n     * @return {HTMLElement} The rendered element.\n     */\n    CanvasVectorLayerRenderer.prototype.renderFrame = function (frameState, target) {\n        var pixelRatio = frameState.pixelRatio;\n        var layerState = frameState.layerStatesArray[frameState.layerIndex];\n        // set forward and inverse pixel transforms\n        makeScale(this.pixelTransform, 1 / pixelRatio, 1 / pixelRatio);\n        makeInverse(this.inversePixelTransform, this.pixelTransform);\n        var canvasTransform = transformToString(this.pixelTransform);\n        this.useContainer(target, canvasTransform, layerState.opacity, this.getBackground(frameState));\n        var context = this.context;\n        var canvas = context.canvas;\n        var replayGroup = this.replayGroup_;\n        var declutterExecutorGroup = this.declutterExecutorGroup;\n        if ((!replayGroup || replayGroup.isEmpty()) &&\n            (!declutterExecutorGroup || declutterExecutorGroup.isEmpty())) {\n            return null;\n        }\n        // resize and clear\n        var width = Math.round(frameState.size[0] * pixelRatio);\n        var height = Math.round(frameState.size[1] * pixelRatio);\n        if (canvas.width != width || canvas.height != height) {\n            canvas.width = width;\n            canvas.height = height;\n            if (canvas.style.transform !== canvasTransform) {\n                canvas.style.transform = canvasTransform;\n            }\n        }\n        else if (!this.containerReused) {\n            context.clearRect(0, 0, width, height);\n        }\n        this.preRender(context, frameState);\n        var viewState = frameState.viewState;\n        var projection = viewState.projection;\n        // clipped rendering if layer extent is set\n        var clipped = false;\n        var render = true;\n        if (layerState.extent && this.clipping) {\n            var layerExtent = fromUserExtent(layerState.extent, projection);\n            render = intersectsExtent(layerExtent, frameState.extent);\n            clipped = render && !containsExtent(layerExtent, frameState.extent);\n            if (clipped) {\n                this.clipUnrotated(context, frameState, layerExtent);\n            }\n        }\n        if (render) {\n            this.renderWorlds(replayGroup, frameState);\n        }\n        if (clipped) {\n            context.restore();\n        }\n        this.postRender(context, frameState);\n        var opacity = cssOpacity(layerState.opacity);\n        var container = this.container;\n        if (opacity !== container.style.opacity) {\n            container.style.opacity = opacity;\n        }\n        if (this.renderedRotation_ !== viewState.rotation) {\n            this.renderedRotation_ = viewState.rotation;\n            this.hitDetectionImageData_ = null;\n        }\n        return this.container;\n    };\n    /**\n     * Asynchronous layer level hit detection.\n     * @param {import(\"../../pixel.js\").Pixel} pixel Pixel.\n     * @return {Promise<Array<import(\"../../Feature\").default>>} Promise that resolves with an array of features.\n     */\n    CanvasVectorLayerRenderer.prototype.getFeatures = function (pixel) {\n        return new Promise(\n        /**\n         * @param {function(Array<import(\"../../Feature\").default|import(\"../../render/Feature\").default>): void} resolve Resolver function.\n         * @this {CanvasVectorLayerRenderer}\n         */\n        function (resolve) {\n            if (!this.hitDetectionImageData_ && !this.animatingOrInteracting_) {\n                var size = [this.context.canvas.width, this.context.canvas.height];\n                apply(this.pixelTransform, size);\n                var center = this.renderedCenter_;\n                var resolution = this.renderedResolution_;\n                var rotation = this.renderedRotation_;\n                var projection = this.renderedProjection_;\n                var extent = this.wrappedRenderedExtent_;\n                var layer = this.getLayer();\n                var transforms = [];\n                var width = size[0] * HIT_DETECT_RESOLUTION;\n                var height = size[1] * HIT_DETECT_RESOLUTION;\n                transforms.push(this.getRenderTransform(center, resolution, rotation, HIT_DETECT_RESOLUTION, width, height, 0).slice());\n                var source = layer.getSource();\n                var projectionExtent = projection.getExtent();\n                if (source.getWrapX() &&\n                    projection.canWrapX() &&\n                    !containsExtent(projectionExtent, extent)) {\n                    var startX = extent[0];\n                    var worldWidth = getWidth(projectionExtent);\n                    var world = 0;\n                    var offsetX = void 0;\n                    while (startX < projectionExtent[0]) {\n                        --world;\n                        offsetX = worldWidth * world;\n                        transforms.push(this.getRenderTransform(center, resolution, rotation, HIT_DETECT_RESOLUTION, width, height, offsetX).slice());\n                        startX += worldWidth;\n                    }\n                    world = 0;\n                    startX = extent[2];\n                    while (startX > projectionExtent[2]) {\n                        ++world;\n                        offsetX = worldWidth * world;\n                        transforms.push(this.getRenderTransform(center, resolution, rotation, HIT_DETECT_RESOLUTION, width, height, offsetX).slice());\n                        startX -= worldWidth;\n                    }\n                }\n                this.hitDetectionImageData_ = createHitDetectionImageData(size, transforms, this.renderedFeatures_, layer.getStyleFunction(), extent, resolution, rotation);\n            }\n            resolve(hitDetect(pixel, this.renderedFeatures_, this.hitDetectionImageData_));\n        }.bind(this));\n    };\n    /**\n     * @param {import(\"../../coordinate.js\").Coordinate} coordinate Coordinate.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @param {number} hitTolerance Hit tolerance in pixels.\n     * @param {import(\"../vector.js\").FeatureCallback<T>} callback Feature callback.\n     * @param {Array<import(\"../Map.js\").HitMatch<T>>} matches The hit detected matches with tolerance.\n     * @return {T|undefined} Callback result.\n     * @template T\n     */\n    CanvasVectorLayerRenderer.prototype.forEachFeatureAtCoordinate = function (coordinate, frameState, hitTolerance, callback, matches) {\n        var _this = this;\n        if (!this.replayGroup_) {\n            return undefined;\n        }\n        var resolution = frameState.viewState.resolution;\n        var rotation = frameState.viewState.rotation;\n        var layer = this.getLayer();\n        /** @type {!Object<string, import(\"../Map.js\").HitMatch<T>|true>} */\n        var features = {};\n        /**\n         * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n         * @param {import(\"../../geom/SimpleGeometry.js\").default} geometry Geometry.\n         * @param {number} distanceSq The squared distance to the click position\n         * @return {T|undefined} Callback result.\n         */\n        var featureCallback = function (feature, geometry, distanceSq) {\n            var key = getUid(feature);\n            var match = features[key];\n            if (!match) {\n                if (distanceSq === 0) {\n                    features[key] = true;\n                    return callback(feature, layer, geometry);\n                }\n                matches.push((features[key] = {\n                    feature: feature,\n                    layer: layer,\n                    geometry: geometry,\n                    distanceSq: distanceSq,\n                    callback: callback,\n                }));\n            }\n            else if (match !== true && distanceSq < match.distanceSq) {\n                if (distanceSq === 0) {\n                    features[key] = true;\n                    matches.splice(matches.lastIndexOf(match), 1);\n                    return callback(feature, layer, geometry);\n                }\n                match.geometry = geometry;\n                match.distanceSq = distanceSq;\n            }\n            return undefined;\n        };\n        var result;\n        var executorGroups = [this.replayGroup_];\n        if (this.declutterExecutorGroup) {\n            executorGroups.push(this.declutterExecutorGroup);\n        }\n        executorGroups.some(function (executorGroup) {\n            return (result = executorGroup.forEachFeatureAtCoordinate(coordinate, resolution, rotation, hitTolerance, featureCallback, executorGroup === _this.declutterExecutorGroup &&\n                frameState.declutterTree\n                ? frameState.declutterTree.all().map(function (item) { return item.value; })\n                : null));\n        });\n        return result;\n    };\n    /**\n     * Perform action necessary to get the layer rendered after new fonts have loaded\n     */\n    CanvasVectorLayerRenderer.prototype.handleFontsChanged = function () {\n        var layer = this.getLayer();\n        if (layer.getVisible() && this.replayGroup_) {\n            layer.changed();\n        }\n    };\n    /**\n     * Handle changes in image style state.\n     * @param {import(\"../../events/Event.js\").default} event Image style change event.\n     * @private\n     */\n    CanvasVectorLayerRenderer.prototype.handleStyleImageChange_ = function (event) {\n        this.renderIfReadyAndVisible();\n    };\n    /**\n     * Determine whether render should be called.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @return {boolean} Layer is ready to be rendered.\n     */\n    CanvasVectorLayerRenderer.prototype.prepareFrame = function (frameState) {\n        var vectorLayer = this.getLayer();\n        var vectorSource = vectorLayer.getSource();\n        if (!vectorSource) {\n            return false;\n        }\n        var animating = frameState.viewHints[ViewHint.ANIMATING];\n        var interacting = frameState.viewHints[ViewHint.INTERACTING];\n        var updateWhileAnimating = vectorLayer.getUpdateWhileAnimating();\n        var updateWhileInteracting = vectorLayer.getUpdateWhileInteracting();\n        if ((!this.dirty_ && !updateWhileAnimating && animating) ||\n            (!updateWhileInteracting && interacting)) {\n            this.animatingOrInteracting_ = true;\n            return true;\n        }\n        this.animatingOrInteracting_ = false;\n        var frameStateExtent = frameState.extent;\n        var viewState = frameState.viewState;\n        var projection = viewState.projection;\n        var resolution = viewState.resolution;\n        var pixelRatio = frameState.pixelRatio;\n        var vectorLayerRevision = vectorLayer.getRevision();\n        var vectorLayerRenderBuffer = vectorLayer.getRenderBuffer();\n        var vectorLayerRenderOrder = vectorLayer.getRenderOrder();\n        if (vectorLayerRenderOrder === undefined) {\n            vectorLayerRenderOrder = defaultRenderOrder;\n        }\n        var center = viewState.center.slice();\n        var extent = buffer(frameStateExtent, vectorLayerRenderBuffer * resolution);\n        var renderedExtent = extent.slice();\n        var loadExtents = [extent.slice()];\n        var projectionExtent = projection.getExtent();\n        if (vectorSource.getWrapX() &&\n            projection.canWrapX() &&\n            !containsExtent(projectionExtent, frameState.extent)) {\n            // For the replay group, we need an extent that intersects the real world\n            // (-180 to +180). To support geometries in a coordinate range from -540\n            // to +540, we add at least 1 world width on each side of the projection\n            // extent. If the viewport is wider than the world, we need to add half of\n            // the viewport width to make sure we cover the whole viewport.\n            var worldWidth = getWidth(projectionExtent);\n            var gutter = Math.max(getWidth(extent) / 2, worldWidth);\n            extent[0] = projectionExtent[0] - gutter;\n            extent[2] = projectionExtent[2] + gutter;\n            wrapCoordinateX(center, projection);\n            var loadExtent = wrapExtentX(loadExtents[0], projection);\n            // If the extent crosses the date line, we load data for both edges of the worlds\n            if (loadExtent[0] < projectionExtent[0] &&\n                loadExtent[2] < projectionExtent[2]) {\n                loadExtents.push([\n                    loadExtent[0] + worldWidth,\n                    loadExtent[1],\n                    loadExtent[2] + worldWidth,\n                    loadExtent[3],\n                ]);\n            }\n            else if (loadExtent[0] > projectionExtent[0] &&\n                loadExtent[2] > projectionExtent[2]) {\n                loadExtents.push([\n                    loadExtent[0] - worldWidth,\n                    loadExtent[1],\n                    loadExtent[2] - worldWidth,\n                    loadExtent[3],\n                ]);\n            }\n        }\n        if (!this.dirty_ &&\n            this.renderedResolution_ == resolution &&\n            this.renderedRevision_ == vectorLayerRevision &&\n            this.renderedRenderOrder_ == vectorLayerRenderOrder &&\n            containsExtent(this.wrappedRenderedExtent_, extent)) {\n            if (!equals(this.renderedExtent_, renderedExtent)) {\n                this.hitDetectionImageData_ = null;\n                this.renderedExtent_ = renderedExtent;\n            }\n            this.renderedCenter_ = center;\n            this.replayGroupChanged = false;\n            return true;\n        }\n        this.replayGroup_ = null;\n        this.dirty_ = false;\n        var replayGroup = new CanvasBuilderGroup(getRenderTolerance(resolution, pixelRatio), extent, resolution, pixelRatio);\n        var declutterBuilderGroup;\n        if (this.getLayer().getDeclutter()) {\n            declutterBuilderGroup = new CanvasBuilderGroup(getRenderTolerance(resolution, pixelRatio), extent, resolution, pixelRatio);\n        }\n        var userProjection = getUserProjection();\n        var userTransform;\n        if (userProjection) {\n            for (var i = 0, ii = loadExtents.length; i < ii; ++i) {\n                var extent_1 = loadExtents[i];\n                var userExtent_1 = toUserExtent(extent_1, projection);\n                vectorSource.loadFeatures(userExtent_1, toUserResolution(resolution, projection), userProjection);\n            }\n            userTransform = getTransformFromProjections(userProjection, projection);\n        }\n        else {\n            for (var i = 0, ii = loadExtents.length; i < ii; ++i) {\n                vectorSource.loadFeatures(loadExtents[i], resolution, projection);\n            }\n        }\n        var squaredTolerance = getSquaredRenderTolerance(resolution, pixelRatio);\n        var render = \n        /**\n         * @param {import(\"../../Feature.js\").default} feature Feature.\n         * @this {CanvasVectorLayerRenderer}\n         */\n        function (feature) {\n            var styles;\n            var styleFunction = feature.getStyleFunction() || vectorLayer.getStyleFunction();\n            if (styleFunction) {\n                styles = styleFunction(feature, resolution);\n            }\n            if (styles) {\n                var dirty = this.renderFeature(feature, squaredTolerance, styles, replayGroup, userTransform, declutterBuilderGroup);\n                this.dirty_ = this.dirty_ || dirty;\n            }\n        }.bind(this);\n        var userExtent = toUserExtent(extent, projection);\n        /** @type {Array<import(\"../../Feature.js\").default>} */\n        var features = vectorSource.getFeaturesInExtent(userExtent);\n        if (vectorLayerRenderOrder) {\n            features.sort(vectorLayerRenderOrder);\n        }\n        for (var i = 0, ii = features.length; i < ii; ++i) {\n            render(features[i]);\n        }\n        this.renderedFeatures_ = features;\n        var replayGroupInstructions = replayGroup.finish();\n        var executorGroup = new ExecutorGroup(extent, resolution, pixelRatio, vectorSource.getOverlaps(), replayGroupInstructions, vectorLayer.getRenderBuffer());\n        if (declutterBuilderGroup) {\n            this.declutterExecutorGroup = new ExecutorGroup(extent, resolution, pixelRatio, vectorSource.getOverlaps(), declutterBuilderGroup.finish(), vectorLayer.getRenderBuffer());\n        }\n        this.renderedResolution_ = resolution;\n        this.renderedRevision_ = vectorLayerRevision;\n        this.renderedRenderOrder_ = vectorLayerRenderOrder;\n        this.renderedExtent_ = renderedExtent;\n        this.wrappedRenderedExtent_ = extent;\n        this.renderedCenter_ = center;\n        this.renderedProjection_ = projection;\n        this.replayGroup_ = executorGroup;\n        this.hitDetectionImageData_ = null;\n        this.replayGroupChanged = true;\n        return true;\n    };\n    /**\n     * @param {import(\"../../Feature.js\").default} feature Feature.\n     * @param {number} squaredTolerance Squared render tolerance.\n     * @param {import(\"../../style/Style.js\").default|Array<import(\"../../style/Style.js\").default>} styles The style or array of styles.\n     * @param {import(\"../../render/canvas/BuilderGroup.js\").default} builderGroup Builder group.\n     * @param {import(\"../../proj.js\").TransformFunction} [opt_transform] Transform from user to view projection.\n     * @param {import(\"../../render/canvas/BuilderGroup.js\").default} [opt_declutterBuilderGroup] Builder for decluttering.\n     * @return {boolean} `true` if an image is loading.\n     */\n    CanvasVectorLayerRenderer.prototype.renderFeature = function (feature, squaredTolerance, styles, builderGroup, opt_transform, opt_declutterBuilderGroup) {\n        if (!styles) {\n            return false;\n        }\n        var loading = false;\n        if (Array.isArray(styles)) {\n            for (var i = 0, ii = styles.length; i < ii; ++i) {\n                loading =\n                    renderFeature(builderGroup, feature, styles[i], squaredTolerance, this.boundHandleStyleImageChange_, opt_transform, opt_declutterBuilderGroup) || loading;\n            }\n        }\n        else {\n            loading = renderFeature(builderGroup, feature, styles, squaredTolerance, this.boundHandleStyleImageChange_, opt_transform, opt_declutterBuilderGroup);\n        }\n        return loading;\n    };\n    return CanvasVectorLayerRenderer;\n}(CanvasLayerRenderer));\nexport default CanvasVectorLayerRenderer;\n//# sourceMappingURL=VectorLayer.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n/**\n * @module ol/renderer/Layer\n */\nimport EventType from '../events/EventType.js';\nimport ImageState from '../ImageState.js';\nimport Observable from '../Observable.js';\nimport SourceState from '../source/State.js';\nimport { abstract } from '../util.js';\n/**\n * @template {import(\"../layer/Layer.js\").default} LayerType\n */\nvar LayerRenderer = /** @class */ (function (_super) {\n    __extends(LayerRenderer, _super);\n    /**\n     * @param {LayerType} layer Layer.\n     */\n    function LayerRenderer(layer) {\n        var _this = _super.call(this) || this;\n        /** @private */\n        _this.boundHandleImageChange_ = _this.handleImageChange_.bind(_this);\n        /**\n         * @protected\n         * @type {LayerType}\n         */\n        _this.layer_ = layer;\n        /**\n         * @type {import(\"../render/canvas/ExecutorGroup\").default}\n         */\n        _this.declutterExecutorGroup = null;\n        return _this;\n    }\n    /**\n     * Asynchronous layer level hit detection.\n     * @param {import(\"../pixel.js\").Pixel} pixel Pixel.\n     * @return {Promise<Array<import(\"../Feature\").default>>} Promise that resolves with\n     * an array of features.\n     */\n    LayerRenderer.prototype.getFeatures = function (pixel) {\n        return abstract();\n    };\n    /**\n     * Determine whether render should be called.\n     * @abstract\n     * @param {import(\"../PluggableMap.js\").FrameState} frameState Frame state.\n     * @return {boolean} Layer is ready to be rendered.\n     */\n    LayerRenderer.prototype.prepareFrame = function (frameState) {\n        return abstract();\n    };\n    /**\n     * Render the layer.\n     * @abstract\n     * @param {import(\"../PluggableMap.js\").FrameState} frameState Frame state.\n     * @param {HTMLElement} target Target that may be used to render content to.\n     * @return {HTMLElement} The rendered element.\n     */\n    LayerRenderer.prototype.renderFrame = function (frameState, target) {\n        return abstract();\n    };\n    /**\n     * @param {Object<number, Object<string, import(\"../Tile.js\").default>>} tiles Lookup of loaded tiles by zoom level.\n     * @param {number} zoom Zoom level.\n     * @param {import(\"../Tile.js\").default} tile Tile.\n     * @return {boolean|void} If `false`, the tile will not be considered loaded.\n     */\n    LayerRenderer.prototype.loadedTileCallback = function (tiles, zoom, tile) {\n        if (!tiles[zoom]) {\n            tiles[zoom] = {};\n        }\n        tiles[zoom][tile.tileCoord.toString()] = tile;\n        return undefined;\n    };\n    /**\n     * Create a function that adds loaded tiles to the tile lookup.\n     * @param {import(\"../source/Tile.js\").default} source Tile source.\n     * @param {import(\"../proj/Projection.js\").default} projection Projection of the tiles.\n     * @param {Object<number, Object<string, import(\"../Tile.js\").default>>} tiles Lookup of loaded tiles by zoom level.\n     * @return {function(number, import(\"../TileRange.js\").default):boolean} A function that can be\n     *     called with a zoom level and a tile range to add loaded tiles to the lookup.\n     * @protected\n     */\n    LayerRenderer.prototype.createLoadedTileFinder = function (source, projection, tiles) {\n        return (\n        /**\n         * @param {number} zoom Zoom level.\n         * @param {import(\"../TileRange.js\").default} tileRange Tile range.\n         * @return {boolean} The tile range is fully loaded.\n         * @this {LayerRenderer}\n         */\n        function (zoom, tileRange) {\n            var callback = this.loadedTileCallback.bind(this, tiles, zoom);\n            return source.forEachLoadedTile(projection, zoom, tileRange, callback);\n        }.bind(this));\n    };\n    /**\n     * @abstract\n     * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n     * @param {import(\"../PluggableMap.js\").FrameState} frameState Frame state.\n     * @param {number} hitTolerance Hit tolerance in pixels.\n     * @param {import(\"./vector.js\").FeatureCallback<T>} callback Feature callback.\n     * @param {Array<import(\"./Map.js\").HitMatch<T>>} matches The hit detected matches with tolerance.\n     * @return {T|undefined} Callback result.\n     * @template T\n     */\n    LayerRenderer.prototype.forEachFeatureAtCoordinate = function (coordinate, frameState, hitTolerance, callback, matches) {\n        return undefined;\n    };\n    /**\n     * @abstract\n     * @param {import(\"../pixel.js\").Pixel} pixel Pixel.\n     * @param {import(\"../PluggableMap.js\").FrameState} frameState FrameState.\n     * @param {number} hitTolerance Hit tolerance in pixels.\n     * @return {Uint8ClampedArray|Uint8Array} The result.  If there is no data at the pixel\n     *    location, null will be returned.  If there is data, but pixel values cannot be\n     *    returned, and empty array will be returned.\n     */\n    LayerRenderer.prototype.getDataAtPixel = function (pixel, frameState, hitTolerance) {\n        return null;\n    };\n    /**\n     * @return {LayerType} Layer.\n     */\n    LayerRenderer.prototype.getLayer = function () {\n        return this.layer_;\n    };\n    /**\n     * Perform action necessary to get the layer rendered after new fonts have loaded\n     * @abstract\n     */\n    LayerRenderer.prototype.handleFontsChanged = function () { };\n    /**\n     * Handle changes in image state.\n     * @param {import(\"../events/Event.js\").default} event Image change event.\n     * @private\n     */\n    LayerRenderer.prototype.handleImageChange_ = function (event) {\n        var image = /** @type {import(\"../Image.js\").default} */ (event.target);\n        if (image.getState() === ImageState.LOADED) {\n            this.renderIfReadyAndVisible();\n        }\n    };\n    /**\n     * Load the image if not already loaded, and register the image change\n     * listener if needed.\n     * @param {import(\"../ImageBase.js\").default} image Image.\n     * @return {boolean} `true` if the image is already loaded, `false` otherwise.\n     * @protected\n     */\n    LayerRenderer.prototype.loadImage = function (image) {\n        var imageState = image.getState();\n        if (imageState != ImageState.LOADED && imageState != ImageState.ERROR) {\n            image.addEventListener(EventType.CHANGE, this.boundHandleImageChange_);\n        }\n        if (imageState == ImageState.IDLE) {\n            image.load();\n            imageState = image.getState();\n        }\n        return imageState == ImageState.LOADED;\n    };\n    /**\n     * @protected\n     */\n    LayerRenderer.prototype.renderIfReadyAndVisible = function () {\n        var layer = this.getLayer();\n        if (layer.getVisible() && layer.getSourceState() == SourceState.READY) {\n            layer.changed();\n        }\n    };\n    return LayerRenderer;\n}(Observable));\nexport default LayerRenderer;\n//# sourceMappingURL=Layer.js.map"],"sourceRoot":""}