(globalThis["webpackChunk_openeo_web_editor"]=globalThis["webpackChunk_openeo_web_editor"]||[]).push([[164],{66684:function(e,t,i){var s=i(96763);
/*!
 * @kirtandesai/ol-geocoder - v5.0.3
 * A geocoder extension compatible with OpenLayers v7.
 * https://github.com/kirtan-desai/ol-geocoder
 * Built: Thu Nov 17 2022 14:58:35 GMT-0500 (Eastern Standard Time)
 */!function(t,s){e.exports=s(i(10972),i(29276),i(49700),i(82986),i(54602),i(44294),i(86717),i(89718))}(0,(function(e,t,i,n,r,o,a,l){"use strict";function c(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var u=c(e),h=c(t),d=c(i),p=c(n),m=c(r),g=c(o),f=c(a),y=c(l),v="gcd-container",_="gcd-button-control",w="gcd-input-query",S="gcd-input-reset",T={namespace:"ol-geocoder",spin:"gcd-pseudo-rotate",hidden:"gcd-hidden",address:"gcd-address",country:"gcd-country",city:"gcd-city",road:"gcd-road",olControl:"ol-control",glass:{container:"gcd-gl-container",control:"gcd-gl-control",button:"gcd-gl-btn",input:"gcd-gl-input",expanded:"gcd-gl-expanded",reset:"gcd-gl-reset",result:"gcd-gl-result"},inputText:{container:"gcd-txt-container",control:"gcd-txt-control",input:"gcd-txt-input",reset:"gcd-txt-reset",icon:"gcd-txt-glass",result:"gcd-txt-result"}},b={containerId:v,buttonControlId:_,inputQueryId:w,inputResetId:S,cssClasses:T};const x=Object.freeze({__proto__:null,containerId:v,buttonControlId:_,inputQueryId:w,inputResetId:S,cssClasses:T,default:b}),D="addresschosen",C="nominatim",A="reverse",E="glass-button",F="text-input",L="osm",M="mapquest",P="photon",R="bing",I="opencage",j={provider:L,placeholder:"Search for an address",featureStyle:null,targetType:E,lang:"en-US",limit:5,keepOpen:!1,preventDefault:!1,autoComplete:!1,autoCompleteMinLength:2,autoCompleteTimeout:200,debug:!1};function $(e,t="Assertion failed"){if(!e){if("undefined"!=typeof Error)throw new Error(t);throw t}}function N(e){const t=function(){if("performance"in window==0&&(window.performance={}),"now"in window.performance==0){let e=Date.now();performance.timing&&performance.timing.navigationStart&&(e=performance.timing.navigationStart),window.performance.now=()=>Date.now()-e}return window.performance.now()}().toString(36);return e?e+t:t}function G(e){return/^\d+$/u.test(e)}function k(e,t,i){if(Array.isArray(e))return void e.forEach((e=>k(e,t)));const s=Array.isArray(t)?t:t.split(/\s+/u);let n=s.length;for(;n--;)V(e,s[n])||B(e,s[n],i)}function O(e,t,i){if(Array.isArray(e))return void e.forEach((e=>O(e,t,i)));const s=Array.isArray(t)?t:t.split(/\s+/u);let n=s.length;for(;n--;)V(e,s[n])&&W(e,s[n],i)}function V(e,t){return e.classList?e.classList.contains(t):q(t).test(e.className)}function z(e,t){return e.replace(/\{\s*([\w-]+)\s*\}/gu,((e,i)=>{const s=void 0===t[i]?"":t[i];return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}))}function U(e,t){let i;if(Array.isArray(e)){if(i=document.createElement(e[0]),e[1].id&&(i.id=e[1].id),e[1].classname&&(i.className=e[1].classname),e[1].attr){const{attr:t}=e[1];if(Array.isArray(t)){let e=-1;for(;++e<t.length;)i.setAttribute(t[e].name,t[e].value)}else i.setAttribute(t.name,t.value)}}else i=document.createElement(e);i.innerHTML=t;const s=document.createDocumentFragment();for(;i.childNodes[0];)s.append(i.childNodes[0]);return i.append(s),i}function q(e){return new RegExp(`(^|\\s+) ${e} (\\s+|$)`,"u")}function B(e,t,i){e.classList?e.classList.add(t):e.className=`${e.className} ${t}`.trim(),i&&G(i)&&window.setTimeout((()=>W(e,t)),i)}function W(e,t,i){e.classList?e.classList.remove(t):e.className=e.className.replace(q(t)," ").trim(),i&&G(i)&&window.setTimeout((()=>B(e,t)),i)}const X=x.cssClasses;class H{constructor(e){this.options=e,this.els=this.createControl()}createControl(){let e,t,i;return this.options.targetType===F?(t=`${X.namespace} ${X.inputText.container}`,e=U(["div",{id:x.containerId,classname:t}],H.input),i={container:e,control:e.querySelector(`.${X.inputText.control}`),input:e.querySelector(`.${X.inputText.input}`),reset:e.querySelector(`.${X.inputText.reset}`),result:e.querySelector(`.${X.inputText.result}`)}):(t=`${X.namespace} ${X.glass.container}`,e=U(["div",{id:x.containerId,classname:t}],H.glass),i={container:e,control:e.querySelector(`.${X.glass.control}`),button:e.querySelector(`.${X.glass.button}`),input:e.querySelector(`.${X.glass.input}`),reset:e.querySelector(`.${X.glass.reset}`),result:e.querySelector(`.${X.glass.result}`)}),i.input.placeholder=this.options.placeholder,i}}H.glass=`\n  <div class="${X.glass.control} ${X.olControl}">\n    <button type="button" id="${x.buttonControlId}" class="${X.glass.button}"></button>\n    <input type="text" id="${x.inputQueryId}" class="${X.glass.input}" autocomplete="off" placeholder="Search ...">\n    <a id="${x.inputResetId}" class="${X.glass.reset} ${X.hidden}"></a>\n  </div>\n  <ul class="${X.glass.result}"></ul>\n`,H.input=`\n  <div class="${X.inputText.control}">\n    <input type="text" id="${x.inputQueryId}" class="${X.inputText.input}" autocomplete="off" placeholder="Search ...">\n    <span class="${X.inputText.icon}"></span>\n    <button type="button" id="${x.inputResetId}" class="${X.inputText.reset} ${X.hidden}"></button>\n  </div>\n  <ul class="${X.inputText.result}"></ul>\n`;class K{constructor(){this.settings={url:"https://photon.komoot.io/api/",params:{q:"",limit:10,lang:"en"},langs:["de","it","fr","en"]}}getParameters(e){return e.lang=e.lang.toLowerCase(),{url:this.settings.url,params:{q:e.query,limit:e.limit||this.settings.params.limit,lang:this.settings.langs.includes(e.lang)?e.lang:this.settings.params.lang}}}handleResponse(e){return 0===e.features.length?[]:e.features.map((e=>({lon:e.geometry.coordinates[0],lat:e.geometry.coordinates[1],address:{name:e.properties.name,postcode:e.properties.postcode,city:e.properties.city,state:e.properties.state,country:e.properties.country},original:{formatted:e.properties.name,details:e.properties}})))}}class Y{constructor(){this.settings={url:"https://nominatim.openstreetmap.org/search/",params:{q:"",format:"json",addressdetails:1,limit:10,countrycodes:"","accept-language":"en-US"}}}getParameters(e){return{url:this.settings.url,params:{q:e.query,format:this.settings.params.format,addressdetails:this.settings.params.addressdetails,limit:e.limit||this.settings.params.limit,countrycodes:e.countrycodes||this.settings.params.countrycodes,"accept-language":e.lang||this.settings.params["accept-language"]}}}handleResponse(e){return 0===e.length?[]:e.map((e=>({lon:e.lon,lat:e.lat,bbox:e.boundingbox,address:{name:e.display_name,road:e.address.road||"",houseNumber:e.address.house_number||"",postcode:e.address.postcode,city:e.address.city||e.address.town,state:e.address.state,country:e.address.country},original:{formatted:e.display_name,details:e.address}})))}}class Z{constructor(){this.settings={url:"https://open.mapquestapi.com/nominatim/v1/search.php",params:{q:"",key:"",format:"json",addressdetails:1,limit:10,countrycodes:"","accept-language":"en-US"}}}getParameters(e){return{url:this.settings.url,params:{q:e.query,key:e.key,format:"json",addressdetails:1,limit:e.limit||this.settings.params.limit,countrycodes:e.countrycodes||this.settings.params.countrycodes,"accept-language":e.lang||this.settings.params["accept-language"]}}}handleResponse(e){return 0===e.length?[]:e.map((e=>({lon:e.lon,lat:e.lat,address:{name:e.address.neighbourhood||"",road:e.address.road||"",postcode:e.address.postcode,city:e.address.city||e.address.town,state:e.address.state,country:e.address.country},original:{formatted:e.display_name,details:e.address}})))}}class Q{constructor(){this.settings={url:"https://dev.virtualearth.net/REST/v1/Locations",callbackName:"jsonp",params:{query:"",key:"",includeNeighborhood:0,maxResults:10}}}getParameters(e){return{url:this.settings.url,callbackName:this.settings.callbackName,params:{query:e.query,key:e.key,includeNeighborhood:e.includeNeighborhood||this.settings.params.includeNeighborhood,maxResults:e.maxResults||this.settings.params.maxResults}}}handleResponse(e){const{resources:t}=e.resourceSets[0];return 0===t.length?[]:t.map((e=>({lon:e.point.coordinates[1],lat:e.point.coordinates[0],address:{name:e.name},original:{formatted:e.address.formattedAddress,details:e.address}})))}}class J{constructor(){this.settings={url:"https://api.opencagedata.com/geocode/v1/json?",params:{q:"",key:"",limit:10,countrycode:"",pretty:1,no_annotations:1}}}getParameters(e){return{url:this.settings.url,params:{q:e.query,key:e.key,limit:e.limit||this.settings.params.limit,countrycode:e.countrycodes||this.settings.params.countrycodes}}}handleResponse(e){return 0===e.results.length?[]:e.results.map((e=>({lon:e.geometry.lng,lat:e.geometry.lat,address:{name:e.components.house_number||"",road:e.components.road||"",postcode:e.components.postcode,city:e.components.city||e.components.town,state:e.components.state,country:e.components.country},original:{formatted:e.formatted,details:e.components}})))}}function ee(e){return new Promise(((t,i)=>{const s=function(e,t){return t&&"object"==typeof t&&(e+=(/\?/u.test(e)?"&":"?")+te(t)),e}(e.url,e.data),n={method:"GET",mode:"cors",credentials:"same-origin"};e.jsonp?function(e,t,i){const{head:s}=document,n=document.createElement("script"),r=`f${Math.round(Math.random()*Date.now())}`;n.setAttribute("src",`${e+(e.indexOf("?")>0?"&":"?")+t}=${r}`),window[r]=e=>{window[r]=void 0,setTimeout((()=>s.removeChild(n)),0),i(e)},s.append(n)}(s,e.callbackName,t):fetch(s,n).then((e=>e.json())).then(t).catch(i)}))}function te(e){return Object.keys(e).reduce(((t,i)=>(t.push("object"==typeof e[i]?te(e[i]):`${encodeURIComponent(i)}=${encodeURIComponent(e[i])}`),t)),[]).join("&")}const ie=x.cssClasses;class se{constructor(e,t){this.Base=e,this.layerName=N("geocoder-layer-"),this.layer=new p.default({name:this.layerName,source:new m.default}),this.options=e.options,this.options.provider="string"==typeof this.options.provider?this.options.provider.toLowerCase():this.options.provider,this.provider=this.newProvider(),this.els=t,this.lastQuery="",this.container=this.els.container,this.registeredListeners={mapClick:!1},this.setListeners()}setListeners(){let e,t;const i=e=>{e.stopPropagation(),V(this.els.control,ie.glass.expanded)?this.collapse():this.expand()};this.els.input.addEventListener("keypress",(e=>{const t=e.target.value.trim();(e.key?"Enter"===e.key:e.which?13===e.which:e.keyCode&&13===e.keyCode)&&(e.preventDefault(),this.query(t))}),!1),this.els.input.addEventListener("click",(e=>e.stopPropagation()),!1),this.els.input.addEventListener("input",(i=>{const s=i.target.value.trim();0!==s.length?O(this.els.reset,ie.hidden):k(this.els.reset,ie.hidden),this.options.autoComplete&&s!==t&&(t=s,e&&clearTimeout(e),e=setTimeout((()=>{s.length>=this.options.autoCompleteMinLength&&this.query(s)}),this.options.autoCompleteTimeout))}),!1),this.els.reset.addEventListener("click",(e=>{this.els.input.focus(),this.els.input.value="",this.lastQuery="",k(this.els.reset,ie.hidden),this.clearResults()}),!1),this.options.targetType===E&&this.els.button.addEventListener("click",i,!1)}query(e){this.provider||(this.provider=this.newProvider());const t=this.provider.getParameters({query:e,key:this.options.key,lang:this.options.lang,countrycodes:this.options.countrycodes,limit:this.options.limit});if(this.lastQuery===e&&this.els.result.firstChild)return;this.lastQuery=e,this.clearResults(),k(this.els.reset,ie.spin);const i={url:t.url,data:t.params};t.callbackName&&(i.jsonp=!0,i.callbackName=t.callbackName),ee(i).then((e=>{this.options.debug&&s.info(e),O(this.els.reset,ie.spin);const t=this.provider.handleResponse(e);t&&(this.createList(t),this.listenMapClick())})).catch((e=>{O(this.els.reset,ie.spin);const t=U("li","<h5>Error! No internet connection?</h5>");this.els.result.append(t)}))}createList(e){const t=this.els.result;e.forEach((e=>{let i;i=this.options.provider===L?`<span class="${ie.road}">${e.address.name}</span>`:this.addressTemplate(e.address);const s=U("li",`<a href="#">${i}</a>`);s.addEventListener("click",(t=>{t.preventDefault(),this.chosen(e,i,e.address,e.original)}),!1),t.append(s)}))}chosen(e,t,i,s){const n=this.Base.getMap(),r=[Number.parseFloat(e.lon),Number.parseFloat(e.lat)],o=n.getView().getProjection(),a=y.default.transform(r,"EPSG:4326",o);let{bbox:l}=e;l&&(l=y.default.transformExtent([l[2],l[1],l[3],l[0]],"EPSG:4326",o));const c={formatted:t,details:i,original:s};if(!1===this.options.keepOpen&&this.clearResults(!0),!0===this.options.preventDefault)this.Base.dispatchEvent({type:D,address:c,coordinate:a,bbox:l,place:e});else{l?n.getView().fit(l,{duration:500}):function(e,t,i=500,s=2.388657133911758){e.getView().animate({duration:i,resolution:s},{duration:i,center:t})}(n,a);const t=this.createFeature(a,c);this.Base.dispatchEvent({type:D,address:c,feature:t,coordinate:a,bbox:l,place:e})}}createFeature(e){const t=new f.default(new g.default(e));return this.addLayer(),t.setStyle(this.options.featureStyle),t.setId(N("geocoder-ft-")),this.getSource().addFeature(t),t}addressTemplate(e){const t=[];return e.name&&t.push(['<span class="',ie.road,'">{name}</span>'].join("")),(e.road||e.building||e.house_number)&&t.push(['<span class="',ie.road,'">{building} {road} {house_number}</span>'].join("")),(e.city||e.town||e.village)&&t.push(['<span class="',ie.city,'">{postcode} {city} {town} {village}</span>'].join("")),(e.state||e.country)&&t.push(['<span class="',ie.country,'">{state} {country}</span>'].join("")),z(t.join("<br>"),e)}newProvider(){switch(this.options.provider){case L:return new Y;case M:return new Z;case P:return new K;case R:return new Q;case I:return new J;default:return this.options.provider}}expand(){O(this.els.input,ie.spin),k(this.els.control,ie.glass.expanded),window.setTimeout((()=>this.els.input.focus()),100),this.listenMapClick()}collapse(){this.els.input.value="",this.els.input.blur(),k(this.els.reset,ie.hidden),O(this.els.control,ie.glass.expanded),this.clearResults()}listenMapClick(){if(this.registeredListeners.mapClick)return;const e=this,t=this.Base.getMap().getTargetElement();this.registeredListeners.mapClick=!0,t.addEventListener("click",{handleEvent(i){e.clearResults(!0),t.removeEventListener(i.type,this,!1),e.registeredListeners.mapClick=!1}},!1)}clearResults(e){e&&this.options.targetType===E?this.collapse():function(e){for(;e.firstChild;)e.firstChild.remove()}(this.els.result)}getSource(){return this.layer.getSource()}addLayer(){let e=!1;const t=this.Base.getMap();t.getLayers().forEach((t=>{t===this.layer&&(e=!0)})),e||t.addLayer(this.layer)}}class ne extends u.default{constructor(e=C,t={}){let i,s;$("string"==typeof e,"@param `type` should be string!"),$(e===C||e===A,`@param 'type' should be '${C}'\n      or '${A}'!`),$("object"==typeof t,"@param `options` should be object!"),j.featureStyle=[new h.default({image:new d.default({scale:.7,src:"//cdn.rawgit.com/jonataswalker/map-utils/master/images/marker.png"})})];const n=new H(t);if(e===C&&(i=n.els.container),super({element:i}),!(this instanceof ne))return new ne;this.options=function(e,t){const i={};return Object.keys(e).forEach((t=>{Object.prototype.hasOwnProperty.call(e,t)&&(i[t]=e[t])})),Object.keys(t).forEach((e=>{Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e])})),i}(j,t),this.container=i,e===C&&(s=new se(this,n.els),this.layer=s.layer)}getLayer(){return this.layer}getSource(){return this.getLayer().getSource()}setProvider(e){this.options.provider=e}setProviderKey(e){this.options.key=e}}return ne}))},31660:(e,t,i)=>{"use strict";i.d(t,{A:()=>d});var s=i(66684),n=i.n(s);class r{constructor(e,t=!1){this.url=e,this.geojson=t}getParameters(e){return{url:this.url,params:{q:e.query,format:"json",limit:10,"accept-language":"en",polygon_geojson:this.geojson?1:0,polygon_threshold:.001}}}handleResponse(e){return 0===e.length?[]:e.filter((e=>["boundary","geological","leisure","natural","place","water","waterway"].includes(e.class))).map((e=>({lon:e.lon,lat:e.lat,bbox:e.boundingbox,address:{name:e.display_name},original:{formatted:e.display_name,details:e.address,geojson:e.geojson}})))}}const o={methods:{addGeocoder(e,t=!1){if(!this.$config.geocoder)return;const i={provider:new r(this.$config.geocoder,t),placeholder:"Search for ...",keepOpen:!0,preventDefault:!0},s=new(n())("nominatim",i);s.on("addresschosen",(i=>{if(t)e(i.place?.original?.geojson,i);else if(i.place.bbox){let t=i.place.bbox.map((e=>parseFloat(e))),s={west:t[2],east:t[3],north:t[1],south:t[0]};e(s,i)}else e(null,i)})),this.map.addControl(s)}}},a=o;var l,c,u=i(81656),h=(0,u.A)(a,l,c,!1,null,null,null);const d=h.exports},29129:(e,t,i)=>{"use strict";i.d(t,{A:()=>u});var s=function(){var e=this,t=e._self._c;return e.texts.length>0?t("div",{staticClass:"ol-unselectable ol-control value",class:{pointer:e.texts.length>1},on:{click:e.toggle}},[e._v(" "+e._s(e.current)+" ")]):e._e()},n=[],r=i(51029);const o={name:"TextControl",mixins:[r.A],data(){return{i:0}},computed:{texts(){return Array.isArray(this.text)?this.text:"string"===typeof this.text&&this.text.length>0?[this.text]:[]},current(){return 0===this.texts.length?"":this.texts[this.i%this.text.length]}},props:{text:{text:[String,Array],default:""}},methods:{toggle(){this.i++}}},a=o;var l=i(81656),c=(0,l.A)(a,s,n,!1,null,"6d7a0f06",null);const u=c.exports},66385:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ji});var s=function(){var e=this,t=e._self._c;return t("Splitpanes",{staticClass:"default-theme",attrs:{horizontal:""}},[t("Pane",{attrs:{id:"map"}},[t("div",{staticClass:"map-viewer",attrs:{id:e.id}},[t("ProgressControl",{ref:"progress",attrs:{map:e.map}}),t("UserLocationControl",{attrs:{map:e.map}}),e.isGeoTiff?t("TextControl",{attrs:{text:e.textControlText}}):e._e(),e.isGeoTiff&&!e.colorMap?t("ChannelControl",{attrs:{bands:e.bands,defaultChannels:e.defaultChannels},on:{update:e.updateGeoTiffStyle}}):e._e(),e.loading?t("div",{staticClass:"map-loading"},[t("i",{staticClass:"fas fa-spinner fa-spin"}),t("span",[e._v("Loading map...")])]):e._e()],1)]),e.chart?t("Pane",{attrs:{id:"chart",size:33}},[t("ScatterChart",e._b({attrs:{height:220}},"ScatterChart",e.chart,!1))],1):e._e()],1)},n=[],r=i(88022),o=i(2566),a=i(76130),l=i(75024),c=i(44304),u=i(66451),h=i(31660),d=i(29129),p=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"show",rawName:"v-show",value:e.channels.length>0,expression:"channels.length > 0"}],staticClass:"ol-unselectable ol-control channels"},[t("table",[t("thead",[t("tr",[e.isGray?e._e():t("th",[e._v("Channel")]),e.multiBand?t("th",[e._v("Band")]):e._e(),t("th",[e._v("Min")]),t("th",[e._v("Max")])])]),t("tbody",e._l(e.channels,(function(i,s){return t("tr",{key:s},[e.isGray?e._e():t("th",[e._v(e._s(e.labels[s]))]),e.multiBand?t("td",[t("select",{directives:[{name:"model",rawName:"v-model.number",value:i.id,expression:"channel.id",modifiers:{number:!0}}],on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(t){var i="_value"in t?t._value:t.value;return e._n(i)}));e.$set(i,"id",t.target.multiple?s:s[0])}}},e._l(e.bands,(function(i){return t("option",{key:i.id,domProps:{value:i.id}},[e._v(e._s(i.name||i.id))])})),0)]):e._e(),t("td",[t("input",{directives:[{name:"model",rawName:"v-model.number",value:i.min,expression:"channel.min",modifiers:{number:!0}}],attrs:{type:"number",required:""},domProps:{value:i.min},on:{input:function(t){t.target.composing||e.$set(i,"min",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})]),t("td",[t("input",{directives:[{name:"model",rawName:"v-model.number",value:i.max,expression:"channel.max",modifiers:{number:!0}}],attrs:{type:"number",required:""},domProps:{value:i.max},on:{input:function(t){t.target.composing||e.$set(i,"max",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])])})),0),e.multiBand?t("tfoot",[t("tr",[t("td",{attrs:{colspan:e.cols}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.isGray,expression:"isGray"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.isGray)?e._i(e.isGray,null)>-1:e.isGray},on:{change:function(t){var i=e.isGray,s=t.target,n=!!s.checked;if(Array.isArray(i)){var r=null,o=e._i(i,r);s.checked?o<0&&(e.isGray=i.concat([r])):o>-1&&(e.isGray=i.slice(0,o).concat(i.slice(o+1)))}else e.isGray=n}}}),e._v(" Grayscale ")])])]):e._e()])])},m=[],g=i(51029);const f={name:"ChannelControl",mixins:[g.A],props:{bands:{type:Array,default:()=>[]},defaultChannels:{type:Array,default:()=>[]}},computed:{multiBand(){return this.bands.length>1},cols(){return this.isGray?this.multiBand?3:2:4},labels(){return this.isGray?["Grayscale"]:["Red","Green","Blue"]}},data(){return{channels:this.defaultChannels,isGray:1===this.defaultChannels.length||1===this.bands.length}},watch:{bands:{immediate:!0,handler(){1===this.bands.length&&(this.isGray=!0),this.updateChannels()}},isGray(){this.updateChannels(),this.emit()},channels:{deep:!0,handler(){this.emit()}}},methods:{isValid(e){return"number"===typeof e},updateChannels(){this.defaultChannels.length>0?(this.channels=this.defaultChannels,1===this.defaultChannels.length&&(this.isGray=!0)):this.channels=this.bands.slice(0,this.isGray?1:3).map((e=>Object.assign({},e))),2===this.channels.length&&this.channels.push(Object.assign({},this.channels[1]))},emit(){this.channels.filter((e=>this.isValid(e.min)&&this.isValid(e.max))).length>0&&this.$emit("update","channels",this.channels)}}},y=f;var v=i(81656),_=(0,v.A)(y,p,m,!1,null,null,null);const w=_.exports;var S=i(22808),T=i(75332),b=i(566),x=i(49825),D=i(15477);function C(e,t,i){const s=(0,x.SR)();return s.style=e.style,(0,D.nR)(t,i,s,e)}function A(e,t){const i=`\n    attribute vec2 ${b.eS.TEXTURE_COORD};\n    uniform mat4 ${b.gF.TILE_TRANSFORM};\n    uniform float ${b.gF.TEXTURE_PIXEL_WIDTH};\n    uniform float ${b.gF.TEXTURE_PIXEL_HEIGHT};\n    uniform float ${b.gF.TEXTURE_RESOLUTION};\n    uniform float ${b.gF.TEXTURE_ORIGIN_X};\n    uniform float ${b.gF.TEXTURE_ORIGIN_Y};\n    uniform float ${b.gF.DEPTH};\n\n    varying vec2 v_textureCoord;\n    varying vec2 v_mapCoord;\n\n    void main() {\n      v_textureCoord = ${b.eS.TEXTURE_COORD};\n      v_mapCoord = vec2(\n        ${b.gF.TEXTURE_ORIGIN_X} + ${b.gF.TEXTURE_RESOLUTION} * ${b.gF.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],\n        ${b.gF.TEXTURE_ORIGIN_Y} - ${b.gF.TEXTURE_RESOLUTION} * ${b.gF.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]\n      );\n      gl_Position = ${b.gF.TILE_TRANSFORM} * vec4(${b.eS.TEXTURE_COORD}, ${b.gF.DEPTH}, 1.0);\n    }\n  `,s={...(0,D.z0)(),inFragmentShader:!0,bandCount:t,style:e},n=[];if(void 0!==e.color){const t=C(s,e.color,x.mE);n.push(`color = ${t};`)}if(void 0!==e.contrast){const t=C(s,e.contrast,x.wl);n.push(`color.rgb = clamp((${t} + 1.0) * color.rgb - (${t} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(void 0!==e.exposure){const t=C(s,e.exposure,x.wl);n.push(`color.rgb = clamp((${t} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(void 0!==e.saturation){const t=C(s,e.saturation,x.wl);n.push(`\n      float saturation = ${t} + 1.0;\n      float sr = (1.0 - saturation) * 0.2126;\n      float sg = (1.0 - saturation) * 0.7152;\n      float sb = (1.0 - saturation) * 0.0722;\n      mat3 saturationMatrix = mat3(\n        sr + saturation, sr, sr,\n        sg, sg + saturation, sg,\n        sb, sb, sb + saturation\n      );\n      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));\n    `)}if(void 0!==e.gamma){const t=C(s,e.gamma,x.wl);n.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${t}));`)}if(void 0!==e.brightness){const t=C(s,e.brightness,x.wl);n.push(`color.rgb = clamp(color.rgb + ${t}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const r={},o=Object.keys(s.variables).length;if(o>1&&!e.variables)throw new Error(`Missing variables in style (expected ${s.variables})`);for(let h=0;h<o;++h){const t=s.variables[Object.keys(s.variables)[h]];if(!(t.name in e.variables))throw new Error(`Missing '${t.name}' in style variables`);const i=(0,D.Sl)(t.name);r[i]=function(){let i=e.variables[t.name];return"string"===typeof i&&(i=(0,D.Lm)(i)),void 0!==i?i:-9999999}}const a=Object.keys(r).map((function(e){return`uniform float ${e};`})),l=Math.ceil(t/4);a.push(`uniform sampler2D ${b.gF.TILE_TEXTURE_ARRAY}[${l}];`),s.paletteTextures&&a.push(`uniform sampler2D ${D.uZ}[${s.paletteTextures.length}];`);const c=Object.keys(s.functions).map((function(e){return s.functions[e]})),u=`\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    #else\n    precision mediump float;\n    #endif\n\n    varying vec2 v_textureCoord;\n    varying vec2 v_mapCoord;\n    uniform vec4 ${b.gF.RENDER_EXTENT};\n    uniform float ${b.gF.TRANSITION_ALPHA};\n    uniform float ${b.gF.TEXTURE_PIXEL_WIDTH};\n    uniform float ${b.gF.TEXTURE_PIXEL_HEIGHT};\n    uniform float ${b.gF.RESOLUTION};\n    uniform float ${b.gF.ZOOM};\n\n    ${a.join("\n")}\n\n    ${c.join("\n")}\n\n    void main() {\n      if (\n        v_mapCoord[0] < ${b.gF.RENDER_EXTENT}[0] ||\n        v_mapCoord[1] < ${b.gF.RENDER_EXTENT}[1] ||\n        v_mapCoord[0] > ${b.gF.RENDER_EXTENT}[2] ||\n        v_mapCoord[1] > ${b.gF.RENDER_EXTENT}[3]\n      ) {\n        discard;\n      }\n\n      vec4 color = texture2D(${b.gF.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);\n\n      ${n.join("\n")}\n\n      gl_FragColor = color;\n      gl_FragColor.rgb *= gl_FragColor.a;\n      gl_FragColor *= ${b.gF.TRANSITION_ALPHA};\n    }`;return{vertexShader:i,fragmentShader:u,uniforms:r,paletteTextures:s.paletteTextures}}class E extends S.A{constructor(e){e=e?Object.assign({},e):{};const t=e.style||{};delete e.style;const i=e.cacheSize;delete e.cacheSize,super(e),this.sources_=e.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=t,this.cacheSize_=i,this.styleVariables_=this.style_.variables||{},this.addChangeListener(T.A.SOURCE,this.handleSourceUpdate_)}getSources(e,t){const i=this.getSource();return this.sources_?"function"===typeof this.sources_?this.sources_(e,t):this.sources_:i?[i]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const e=this.getRenderSource();return e?e.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache(),this.getSource()&&this.setStyle(this.style_)}getSourceBandCount_(){const e=Number.MAX_SAFE_INTEGER,t=this.getSources([-e,-e,e,e],e);return t&&t.length&&"bandCount"in t[0]?t[0].bandCount:4}createRenderer(){const e=A(this.style_,this.getSourceBandCount_());return new b.Ay(this,{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,cacheSize:this.cacheSize_,paletteTextures:e.paletteTextures})}renderSources(e,t){const i=this.getRenderer();let s;for(let n=0,r=t.length;n<r;++n)this.renderedSource_=t[n],i.prepareFrame(e)&&(s=i.renderFrame(e));return s}render(e,t){this.rendered=!0;const i=e.viewState,s=this.getSources(e.extent,i.resolution);let n=!0;for(let o=0,a=s.length;o<a;++o){const e=s[o],t=e.getState();if("loading"==t){const t=()=>{"ready"==e.getState()&&(e.removeEventListener("change",t),this.changed())};e.addEventListener("change",t)}n=n&&"ready"==t}const r=this.renderSources(e,s);if(this.getRenderer().renderComplete&&n)return this.renderedResolution_=i.resolution,r;if(this.renderedResolution_>.5*i.resolution){const t=this.getSources(e.extent,this.renderedResolution_).filter((e=>!s.includes(e)));if(t.length>0)return this.renderSources(e,t)}return r}setStyle(e){this.styleVariables_=e.variables||{},this.style_=e;const t=A(this.style_,this.getSourceBandCount_()),i=this.getRenderer();i.reset({vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,paletteTextures:t.paletteTextures}),this.changed()}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}E.prototype.dispose;const F=E;var L=i(27607),M=i(6837),P=i(98596),R=i(70061),I=i(18469),j=i(66017),$=i(11078),N=i(4863),G=i(89718),k=i(40186),O=i(4087),V=i(74238),z=i(6782);class U extends j.A{constructor(e){const t=void 0===e.projection?"EPSG:3857":e.projection;let i=e.tileGrid;void 0===i&&t&&(i=(0,N.EN)({extent:(0,N.kZ)(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize})),super({cacheSize:.1,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:t,tileGrid:i,opaque:e.opaque,state:e.state,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate}),this.gutter_=void 0!==e.gutter?e.gutter:0,this.tileSize_=e.tileSize?(0,z.xq)(e.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=e.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=void 0===e.bandCount?4:e.bandCount,this.tileGridForProjection_={},this.tileCacheForProjection_={}}setTileSizes(e){this.tileSizes_=e}getTileSize(e){if(this.tileSizes_)return this.tileSizes_[e];if(this.tileSize_)return this.tileSize_;const t=this.getTileGrid();return t?(0,z.xq)(t.getTileSize(e)):[256,256]}getGutterForProjection(e){const t=this.getProjection();return!t||(0,G.equivalent)(t,e)?this.gutter_:0}setLoader(e){this.loader_=e}getReprojTile_(e,t,i,s,n){const r=this.getTileCacheForProjection(s),o=(0,k.dp)(e,t,i);if(r.containsKey(o)){const e=r.get(o);if(e&&e.key==this.getKey())return e}const a=this.getTileGrid(),l=Math.max.apply(null,a.getResolutions().map(((e,t)=>{const i=(0,z.xq)(a.getTileSize(t)),s=this.getTileSize(t);return Math.max(s[0]/i[0],s[1]/i[1])}))),c=this.getTileGridForProjection(n),u=this.getTileGridForProjection(s),h=[e,t,i],d=this.getTileCoordForTileUrlFunction(h,s),p=Object.assign({sourceProj:n,sourceTileGrid:c,targetProj:s,targetTileGrid:u,tileCoord:h,wrappedTileCoord:d,pixelRatio:l,gutter:this.getGutterForProjection(n),getTileFunction:(e,t,i,s)=>this.getTile(e,t,i,s,n)},this.tileOptions),m=new P.A(p);return m.key=this.getKey(),m}getTile(e,t,i,s,n){const r=this.getProjection();if(r&&n&&!(0,G.equivalent)(r,n))return this.getReprojTile_(e,t,i,n,r);const o=this.getTileSize(e),a=(0,k.dp)(e,t,i);if(this.tileCache.containsKey(a))return this.tileCache.get(a);const l=this.loader_;function c(){return(0,V.hq)((function(){return l(e,t,i)}))}const u=Object.assign({tileCoord:[e,t,i],loader:c,size:o},this.tileOptions),h=new L.Ay(u);return h.key=this.getKey(),h.addEventListener(M.A.CHANGE,this.handleTileChange_),this.tileCache.set(a,h),h}handleTileChange_(e){const t=e.target,i=(0,O.v6)(t),s=t.getState();let n;s==$.A.LOADING?(this.tileLoadingKeys_[i]=!0,n=I.A.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],n=s==$.A.ERROR?I.A.TILELOADERROR:s==$.A.LOADED?I.A.TILELOADEND:void 0),n&&this.dispatchEvent(new j.c(n,t))}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||(0,G.equivalent)(t,e)))return this.tileGrid;const i=(0,O.v6)(e);return i in this.tileGridForProjection_||(this.tileGridForProjection_[i]=(0,N.pr)(e)),this.tileGridForProjection_[i]}setTileGridForProjection(e,t){const i=(0,G.get)(e);if(i){const e=(0,O.v6)(i);e in this.tileGridForProjection_||(this.tileGridForProjection_[e]=t)}}getTileCacheForProjection(e){const t=this.getProjection();if(!t||(0,G.equivalent)(t,e))return this.tileCache;const i=(0,O.v6)(e);return i in this.tileCacheForProjection_||(this.tileCacheForProjection_[i]=new R.A(.1)),this.tileCacheForProjection_[i]}expireCache(e,t){const i=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==i?t:{});for(const s in this.tileCacheForProjection_){const e=this.tileCacheForProjection_[s];e.expireCache(e==i?t:{})}}clear(){super.clear();for(const e in this.tileCacheForProjection_)this.tileCacheForProjection_[e].clear()}}const q=U;var B=i(56758),W=i(98622),X=i(70851);const H="undefined"!==typeof navigator&&navigator.hardwareConcurrency||2;class K{constructor(e=H,t){this.workers=null,this._awaitingDecoder=null,this.size=e,this.messageId=0,e&&(this._awaitingDecoder=t?Promise.resolve(t):new Promise((e=>{i.e(9989).then(i.bind(i,79989)).then((t=>{e(t.create)}))})),this._awaitingDecoder.then((t=>{this._awaitingDecoder=null,this.workers=[];for(let i=0;i<e;i++)this.workers.push({worker:t(),idle:!0})})))}async decode(e,t){return this._awaitingDecoder&&await this._awaitingDecoder,0===this.size?(0,X.f)(e).then((i=>i.decode(e,t))):new Promise((i=>{const s=this.workers.find((e=>e.idle))||this.workers[Math.floor(Math.random()*this.size)];s.idle=!1;const n=this.messageId++,r=e=>{e.data.id===n&&(s.idle=!0,i(e.data.decoded),s.worker.removeEventListener("message",r))};s.worker.addEventListener("message",r),s.worker.postMessage({fileDirectory:e,buffer:t,id:n},[t])}))}destroy(){this.workers&&(this.workers.forEach((e=>{e.worker.terminate()})),this.workers=null)}}const Y=K;var Z=i(34099),Q=i(61597),J=i(70915),ee=i(54422),te=i(8100);function ie(e){const t=e.fileDirectory,i=t.NewSubfileType||0;return 4===(4&i)}function se(e,t){if(!e)return!1;if(!0===e)return!0;if(3!==t.getSamplesPerPixel())return!1;const i=t.fileDirectory.PhotometricInterpretation,s=W.ub;return i===s.CMYK||i===s.YCbCr||i===s.CIELab||i===s.ICCLab}const ne="STATISTICS_MAXIMUM",re="STATISTICS_MINIMUM",oe=256;let ae;function le(){return ae||(ae=new Y),ae}function ce(e){try{return e.getBoundingBox()}catch(t){return[0,0,e.getWidth(),e.getHeight()]}}function ue(e){try{return e.getOrigin().slice(0,2)}catch(t){return[0,e.getHeight()]}}function he(e,t){try{return e.getResolution(t)}catch(i){return[t.getWidth()/e.getWidth(),t.getHeight()/e.getHeight()]}}function de(e){const t=e.geoKeys;if(!t)return null;if(t.ProjectedCSTypeGeoKey&&32767!==t.ProjectedCSTypeGeoKey){const e="EPSG:"+t.ProjectedCSTypeGeoKey;let i=(0,G.get)(e);if(!i){const s=(0,te.q)(t.ProjLinearUnitsGeoKey);s&&(i=new G.Projection({code:e,units:s}))}return i}if(t.GeographicTypeGeoKey&&32767!==t.GeographicTypeGeoKey){const e="EPSG:"+t.GeographicTypeGeoKey;let i=(0,G.get)(e);if(!i){const s=(0,te.q)(t.GeogAngularUnitsGeoKey);s&&(i=new G.Projection({code:e,units:s}))}return i}return null}function pe(e){return e.getImageCount().then((function(t){const i=new Array(t);for(let s=0;s<t;++s)i[s]=e.getImage(s);return Promise.all(i)}))}function me(e,t){let i;return i=e.blob?(0,Z._F)(e.blob):e.overviews?(0,Z.Vj)(e.url,e.overviews,t):(0,Z.uz)(e.url,t),i.then(pe)}function ge(e,t,i,s,n){if(Array.isArray(e)){const r=e.length;if(!Array.isArray(t)||r!=t.length){const e=new Error(s);throw n(e),e}for(let o=0;o<r;++o)ge(e[o],t[o],i,s,n)}else if(Math.abs(e-t)>i*e)throw new Error(s)}function fe(e){return e instanceof Int8Array?-128:e instanceof Int16Array?-32768:e instanceof Int32Array?-2147483648:e instanceof Float32Array?12e-39:0}function ye(e){return e instanceof Int8Array?127:e instanceof Uint8Array||e instanceof Uint8ClampedArray?255:e instanceof Int16Array?32767:e instanceof Uint16Array?65535:e instanceof Int32Array?2147483647:e instanceof Uint32Array?4294967295:e instanceof Float32Array?34e37:255}class ve extends q{constructor(e){super({state:"loading",tileGrid:null,projection:e.projection||null,opaque:e.opaque,transition:e.transition,interpolate:!1!==e.interpolate,wrapX:e.wrapX}),this.sourceInfo_=e.sources;const t=this.sourceInfo_.length;this.sourceOptions_=e.sourceOptions,this.sourceImagery_=new Array(t),this.sourceMasks_=new Array(t),this.resolutionFactors_=new Array(t),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=!1!==e.normalize,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=e.convertToRGB||!1,this.setKey(this.sourceInfo_.map((e=>e.url)).join(","));const i=this,s=new Array(t);for(let n=0;n<t;++n)s[n]=me(this.sourceInfo_[n],this.sourceOptions_);Promise.all(s).then((function(e){i.configure_(e)})).catch((function(e){(0,ee.z3)(e),i.error_=e,i.setState("error")}))}getError(){return this.error_}determineProjection(e){const t=e[0];for(let i=t.length-1;i>=0;--i){const e=t[i],s=de(e);if(s){this.projection=s;break}}}configure_(e){let t,i,s,n,r;const o=new Array(e.length),a=new Array(e.length),l=new Array(e.length);let c=0;const u=e.length;for(let m=0;m<u;++m){const u=[],h=[];e[m].forEach((e=>{ie(e)?h.push(e):u.push(e)}));const d=u.length;if(h.length>0&&h.length!==d)throw new Error(`Expected one mask per image found ${h.length} masks and ${d} images`);let p,g;const f=new Array(d),y=new Array(d),v=new Array(d);a[m]=new Array(d),l[m]=new Array(d);for(let e=0;e<d;++e){const t=u[e],i=t.getGDALNoData();l[m][e]=t.getGDALMetadata(0),a[m][e]=i;const s=this.sourceInfo_[m].bands;o[m]=s?s.length:t.getSamplesPerPixel();const n=d-(e+1);p||(p=ce(t)),g||(g=ue(t));const r=he(t,u[0]);v[n]=r[0];const c=[t.getTileWidth(),t.getTileHeight()];c[0]!==c[1]&&c[1]<oe&&(c[0]=oe,c[1]=oe),f[n]=c;const h=r[0]/Math.abs(r[1]);y[n]=[c[0],c[1]/h]}if(t?(0,J._N)(t,p,t):t=p,i){const e=`Origin mismatch for source ${m}, got [${g}] but expected [${i}]`;ge(i,g,0,e,this.viewRejector)}else i=g;if(r){r.length-c>v.length&&(c=r.length-v.length);const e=r[r.length-1]/v[v.length-1];this.resolutionFactors_[m]=e;const t=v.map((t=>t*e)),i=`Resolution mismatch for source ${m}, got [${t}] but expected [${r}]`;ge(r.slice(c,r.length),t,.02,i,this.viewRejector)}else r=v,this.resolutionFactors_[m]=1;s?ge(s.slice(c,s.length),y,.01,`Tile size mismatch for source ${m}`,this.viewRejector):s=y,n?ge(n.slice(c,n.length),f,0,`Tile size mismatch for source ${m}`,this.viewRejector):n=f,this.sourceImagery_[m]=u.reverse(),this.sourceMasks_[m]=h.reverse()}for(let m=0,g=this.sourceImagery_.length;m<g;++m){const e=this.sourceImagery_[m];while(e.length<r.length)e.unshift(void 0)}this.getProjection()||this.determineProjection(e),this.samplesPerPixel_=o,this.nodataValues_=a,this.metadata_=l;e:for(let m=0;m<u;++m){if(void 0!==this.sourceInfo_[m].nodata){this.addAlpha_=!0;break}if(this.sourceMasks_[m].length){this.addAlpha_=!0;break}const e=a[m],t=this.sourceInfo_[m].bands;if(t){for(let i=0;i<t.length;++i)if(null!==e[t[i]-1]){this.addAlpha_=!0;break e}}else for(let i=0;i<e.length;++i)if(null!==e[i]){this.addAlpha_=!0;break e}}let h=this.addAlpha_?1:0;for(let m=0;m<u;++m)h+=o[m];this.bandCount=h;const d=new B.A({extent:t,minZoom:c,origin:i,resolutions:r,tileSizes:s});this.tileGrid=d,this.setTileSizes(n),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");const p=1;2===r.length?r=[r[0],r[1],r[1]/2]:1===r.length&&(r=[2*r[0],r[0],r[0]/2]),this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:r,center:(0,G.toUserCoordinate)((0,J.q1)(t),this.projection),extent:(0,G.toUserExtent)(t,this.projection),zoom:p})}loadTile_(e,t,i){const s=this.getTileSize(e),n=this.sourceImagery_.length,r=new Array(2*n),o=this.nodataValues_,a=this.sourceInfo_,l=le();for(let c=0;c<n;++c){const u=a[c],h=this.resolutionFactors_[c],d=[Math.round(t*(s[0]*h)),Math.round(i*(s[1]*h)),Math.round((t+1)*(s[0]*h)),Math.round((i+1)*(s[1]*h))],p=this.sourceImagery_[c][e];let m,g;u.bands&&(m=u.bands.map((function(e){return e-1}))),g="nodata"in u&&null!==u.nodata?u.nodata:m?m.map((function(e){return o[c][e]})):o[c];const f={window:d,width:s[0],height:s[1],samples:m,fillValue:g,pool:l,interleave:!1};se(this.convertToRGB_,p)?r[c]=p.readRGB(f):r[c]=p.readRasters(f);const y=n+c,v=this.sourceMasks_[c][e];v?r[y]=v.readRasters({window:d,width:s[0],height:s[1],samples:[0],pool:l,interleave:!1}):r[y]=Promise.resolve(null)}return Promise.all(r).then(this.composeTile_.bind(this,s)).catch((function(e){throw(0,ee.z3)(e),e}))}composeTile_(e,t){const i=this.metadata_,s=this.sourceInfo_,n=this.sourceImagery_.length,r=this.bandCount,o=this.samplesPerPixel_,a=this.nodataValues_,l=this.normalize_,c=this.addAlpha_,u=e[0]*e[1],h=u*r;let d;d=l?new Uint8Array(h):new Float32Array(h);let p=0;for(let m=0;m<u;++m){let e=c;for(let r=0;r<n;++r){const u=s[r];let h,g,f=u.min,y=u.max;if(l){const e=i[r][0];void 0===f&&(f=e&&re in e?parseFloat(e[re]):fe(t[r][0])),void 0===y&&(y=e&&ne in e?parseFloat(e[ne]):ye(t[r][0])),h=255/(y-f),g=-f*h}for(let i=0;i<o[r];++i){const s=t[r][i][m];let n;if(n=l?(0,Q.qE)(h*s+g,0,255):s,c){let t=u.nodata;if(void 0===t){let e;e=u.bands?u.bands[i]-1:i,t=a[r][e]}const o=isNaN(t);(!o&&s!==t||o&&!isNaN(s))&&(e=!1,d[p]=n)}else d[p]=n;p++}if(!e){const i=n+r,s=t[i];s&&!s[0][m]&&(e=!0)}}c&&(e||(d[p]=255),p++)}return d}}ve.prototype.getView;const _e=ve,we={components:{ChannelControl:w,TextControl:d.A},data(){return{textControlText:"Pixel Value: -",layer:null,source:null,colorMap:null,noData:[],defaultChannels:[],channels:[],bands:[]}},computed:{...o.A.mapState("editor",["appMode"])},methods:{getBandVar(e){return["band",["var",`${e}band`]]},getFormula(e){let t=["var",`${e}min`],i=["var",`${e}max`],s=this.getBandVar(e),n=["*",["/",["-",s,t],["-",i,t]],255];return["clamp",n,0,255]},getNoDataFormula(){let e=this.getBandVar("alpha");return["case",["==",e,0],0,1]},async addGeoTiff(e,t="GeoTiff"){this.bands=e.getBands(),this.appMode&&this.appMode.channels&&(this.defaultChannels=this.appMode.channels),this.colorMap=e.getColorMap(),this.noData=e.getNoData();let i={nodata:this.noData[0]};e.getBlob()?i.blob=e.getBlob():i.url=e.getUrl(),this.source=new _e({interpolate:!1,normalize:!1,convertToRGB:e.convertToRGB,sources:[i]}),this.layer=new F({id:e.getUrl(),title:t,source:this.source,cacheSize:2048}),this.layer.set("events",{pointermove:e=>{let t=this.layer.getData(e.pixel),i=o.A.displayRGBA(t,this.noData,this.noData.length>0),s=`Pixel Value: ${i}`,n=this.formatCoords(e.coordinate);this.textControlText=[s,`${s} @ ${n}`]},click:e=>{let t=this.layer.getData(e.pixel);if(!t)return void(this.chart=null);if(t=Array.from(t).slice(0,this.bands.length),t.length<2||t.every((e=>!isFinite(e))))return void(this.chart=null);let i=this.formatCoords(e.coordinate),s=`Coordinate: ${i}`,n=[{label:s,data:t}];this.chart={labels:this.bands.map((e=>String(e.name||e.id))),datasets:n}}}),this.addLayerToMap(this.layer);let s=e.getExtent();return s&&this.map.getView().fit(s,this.getFitOptions(10)),await new Promise((e=>setTimeout(e,1250))),this.setStyle(),this.source},formatCoords(e){return e.map((e=>String(parseFloat(e.toFixed(6))))).join(", ")},updateGeoTiffStyle(e,t){switch(e){case"channels":this.channels=t,this.setOptions("channels",t);break}this.setStyle()},setStyle(){if(!this.layer)return;let e={};for(let i in this.channels){let t=this.channels[i];e[`${i}band`]=t.id,e[`${i}min`]=t.min,e[`${i}max`]=t.max}e.alphaband=this.bands.length+1;let t=[];if(this.colorMap)t.push("palette"),t.push(["band",1]),t.push(this.colorMap);else{if(0===this.channels.length)return null;if(1===this.channels.length){t.push("color");let e=this.getFormula(0);t.push(e),t.push(e),t.push(e),this.noData.length>0&&t.push(this.getNoDataFormula())}else t.push("color"),t.push(this.getFormula(0)),t.push(this.getFormula(1)),t.push(this.getFormula(2)),this.noData.length>0&&t.push(this.getNoDataFormula())}this.layer.setStyle({variables:e,color:t})}}},Se=we;var Te,be,xe=(0,v.A)(Se,Te,be,!1,null,null,null);const De=xe.exports;var Ce=i(74559),Ae=i(80494),Ee=i(50071),Fe=i(35598),Le=i(30945),Me=i(10702);function Pe(e,t){return Be().createElementNS(e,t)}function Re(e,t){return Ie(e,t,[]).join("")}function Ie(e,t,i){if(e.nodeType==Node.CDATA_SECTION_NODE||e.nodeType==Node.TEXT_NODE)t?i.push(String(e.nodeValue).replace(/(\r\n|\r|\n)/g,"")):i.push(e.nodeValue);else{let s;for(s=e.firstChild;s;s=s.nextSibling)Ie(s,t,i)}return i}function je(e){return"documentElement"in e}function $e(e){return(new DOMParser).parseFromString(e,"application/xml")}function Ne(e,t){return function(i,s){const n=e.call(void 0!==t?t:this,i,s);if(void 0!==n){const e=s[s.length-1];e.push(n)}}}function Ge(e,t,i){return function(s,n){const r=e.call(void 0!==i?i:this,s,n);if(void 0!==r){const e=n[n.length-1],i=void 0!==t?t:s.localName;let o;i in e?o=e[i]:(o=[],e[i]=o),o.push(r)}}}function ke(e,t,i){return function(s,n){const r=e.call(void 0!==i?i:this,s,n);if(void 0!==r){const e=n[n.length-1],i=void 0!==t?t:s.localName;e[i]=r}}}function Oe(e,t){return function(i,s,n){const r=s[s.length-1],o=r.node;let a=e;void 0===a&&(a=n);const l=void 0!==t?t:o.namespaceURI;return Pe(l,a)}}Oe();function Ve(e,t,i){let s,n;for(i=void 0!==i?i:{},s=0,n=e.length;s<n;++s)i[e[s]]=t;return i}function ze(e,t,i,s){let n;for(n=t.firstElementChild;n;n=n.nextElementSibling){const t=e[n.namespaceURI];if(void 0!==t){const e=t[n.localName];void 0!==e&&e.call(s,n,i)}}}function Ue(e,t,i,s,n){return s.push(e),ze(t,i,s,n),s.pop()}let qe;function Be(){return void 0===qe&&"undefined"!==typeof document&&(qe=document.implementation.createDocument("","",null)),qe}class We{read(e){if(!e)return null;if("string"===typeof e){const t=$e(e);return this.readFromDocument(t)}return je(e)?this.readFromDocument(e):this.readFromNode(e)}readFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null}readFromNode(e){(0,O.b0)()}}const Xe=We,He="http://www.w3.org/1999/xlink";function Ke(e){return e.getAttributeNS(He,"href")}function Ye(e){const t=Re(e,!1);return Ze(t)}function Ze(e){const t=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(e);if(t)return parseFloat(t[1])}function Qe(e){const t=Re(e,!1);return Je(t)}function Je(e){const t=/^\s*(\d+)\s*$/.exec(e);if(t)return parseInt(t[1],10)}function et(e){return Re(e,!1).trim()}const tt=[null,"http://www.opengis.net/ows/1.1"],it=Ve(tt,{ServiceIdentification:ke(At),ServiceProvider:ke(Ft),OperationsMetadata:ke(Dt)});class st extends Xe{constructor(){super()}readFromNode(e){const t=Ue({},it,e,[]);return t||null}}const nt=Ve(tt,{DeliveryPoint:ke(et),City:ke(et),AdministrativeArea:ke(et),PostalCode:ke(et),Country:ke(et),ElectronicMailAddress:ke(et)}),rt=Ve(tt,{Value:Ge(Lt)}),ot=Ve(tt,{AllowedValues:ke(vt)}),at=Ve(tt,{Phone:ke(Ct),Address:ke(yt)}),lt=Ve(tt,{HTTP:ke(bt)}),ct=Ve(tt,{Get:Ge(Tt),Post:void 0}),ut=Ve(tt,{DCP:ke(St)}),ht=Ve(tt,{Operation:xt}),dt=Ve(tt,{Voice:ke(et),Facsimile:ke(et)}),pt=Ve(tt,{Constraint:Ge(_t)}),mt=Ve(tt,{IndividualName:ke(et),PositionName:ke(et),ContactInfo:ke(wt)}),gt=Ve(tt,{Abstract:ke(et),AccessConstraints:ke(et),Fees:ke(et),Title:ke(et),ServiceTypeVersion:ke(et),ServiceType:ke(et)}),ft=Ve(tt,{ProviderName:ke(et),ProviderSite:ke(Ke),ServiceContact:ke(Et)});function yt(e,t){return Ue({},nt,e,t)}function vt(e,t){return Ue({},rt,e,t)}function _t(e,t){const i=e.getAttribute("name");if(i)return Ue({name:i},ot,e,t)}function wt(e,t){return Ue({},at,e,t)}function St(e,t){return Ue({},lt,e,t)}function Tt(e,t){const i=Ke(e);if(i)return Ue({href:i},pt,e,t)}function bt(e,t){return Ue({},ct,e,t)}function xt(e,t){const i=e.getAttribute("name"),s=Ue({},ut,e,t);if(!s)return;const n=t[t.length-1];n[i]=s}function Dt(e,t){return Ue({},ht,e,t)}function Ct(e,t){return Ue({},dt,e,t)}function At(e,t){return Ue({},gt,e,t)}function Et(e,t){return Ue({},mt,e,t)}function Ft(e,t){return Ue({},ft,e,t)}function Lt(e,t){return et(e)}const Mt=st,Pt=[null,"http://www.opengis.net/wmts/1.0"],Rt=[null,"http://www.opengis.net/ows/1.1"],It=Ve(Pt,{Contents:ke(Wt)});class jt extends Xe{constructor(){super(),this.owsParser_=new Mt}readFromNode(e){let t=e.getAttribute("version");t&&(t=t.trim());let i=this.owsParser_.readFromNode(e);return i?(i["version"]=t,i=Ue(i,It,e,[]),i||null):null}}const $t=Ve(Pt,{Layer:Ge(Xt),TileMatrixSet:Ge(Ht)}),Nt=Ve(Pt,{Style:Ge(Kt),Format:Ge(et),TileMatrixSetLink:Ge(Yt),Dimension:Ge(Zt),ResourceURL:Ge(Qt)},Ve(Rt,{Title:ke(et),Abstract:ke(et),WGS84BoundingBox:ke(Jt),BoundingBox:Ge(ei),Identifier:ke(et)})),Gt=Ve(Pt,{LegendURL:Ge(ti)},Ve(Rt,{Title:ke(et),Identifier:ke(et)})),kt=Ve(Pt,{TileMatrixSet:ke(et),TileMatrixSetLimits:ke(ni)}),Ot=Ve(Pt,{TileMatrixLimits:Ne(ri)}),Vt=Ve(Pt,{TileMatrix:ke(et),MinTileRow:ke(Qe),MaxTileRow:ke(Qe),MinTileCol:ke(Qe),MaxTileCol:ke(Qe)}),zt=Ve(Pt,{Default:ke(et),Value:Ge(et)},Ve(Rt,{Identifier:ke(et)})),Ut=Ve(Rt,{LowerCorner:Ne(ii),UpperCorner:Ne(ii)}),qt=Ve(Pt,{WellKnownScaleSet:ke(et),TileMatrix:Ge(si)},Ve(Rt,{SupportedCRS:ke(et),Identifier:ke(et),BoundingBox:ke(Jt)})),Bt=Ve(Pt,{TopLeftCorner:ke(ii),ScaleDenominator:ke(Ye),TileWidth:ke(Qe),TileHeight:ke(Qe),MatrixWidth:ke(Qe),MatrixHeight:ke(Qe)},Ve(Rt,{Identifier:ke(et)}));function Wt(e,t){return Ue({},$t,e,t)}function Xt(e,t){return Ue({},Nt,e,t)}function Ht(e,t){return Ue({},qt,e,t)}function Kt(e,t){const i=Ue({},Gt,e,t);if(!i)return;const s="true"===e.getAttribute("isDefault");return i["isDefault"]=s,i}function Yt(e,t){return Ue({},kt,e,t)}function Zt(e,t){return Ue({},zt,e,t)}function Qt(e,t){const i=e.getAttribute("format"),s=e.getAttribute("template"),n=e.getAttribute("resourceType"),r={};return i&&(r["format"]=i),s&&(r["template"]=s),n&&(r["resourceType"]=n),r}function Jt(e,t){const i=Ue([],Ut,e,t);if(2==i.length)return(0,J.Tr)(i)}function ei(e,t){const i=e.getAttribute("crs"),s=Ue([],Ut,e,t);if(2==s.length)return{extent:(0,J.Tr)(s),crs:i}}function ti(e,t){const i={};return i["format"]=e.getAttribute("format"),i["href"]=Ke(e),i}function ii(e,t){const i=et(e).split(/\s+/);if(!i||2!=i.length)return;const s=+i[0],n=+i[1];return isNaN(s)||isNaN(n)?void 0:[s,n]}function si(e,t){return Ue({},Bt,e,t)}function ni(e,t){return Ue([],Ot,e,t)}function ri(e,t){return Ue({},Vt,e,t)}const oi=jt;var ai=i(21483);function li(e,t){const i=[];Object.keys(t).forEach((function(e){null!==t[e]&&void 0!==t[e]&&i.push(e+"="+encodeURIComponent(t[e]))}));const s=i.join("&");return e=e.replace(/[?&]$/,""),e+=e.includes("?")?"&":"?",e+s}class ci extends B.A{constructor(e){super({extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes}),this.matrixIds_=e.matrixIds}getMatrixId(e){return this.matrixIds_[e]}getMatrixIds(){return this.matrixIds_}}function ui(e,t,i){const s=[],n=[],r=[],o=[],a=[];i=void 0!==i?i:[];const l="SupportedCRS",c="TileMatrix",u="Identifier",h="ScaleDenominator",d="TopLeftCorner",p="TileWidth",m="TileHeight",g=e[l],f=(0,G.get)(g),y=f.getMetersPerUnit(),v="ne"==f.getAxisOrientation().substr(0,2);return e[c].sort((function(e,t){return t[h]-e[h]})),e[c].forEach((function(t){let l;if(l=!(i.length>0)||i.find((function(i){return t[u]==i[c]||!t[u].includes(":")&&e[u]+":"+t[u]===i[c]})),l){n.push(t[u]);const e=28e-5*t[h]/y,i=t[p],l=t[m];v?r.push([t[d][1],t[d][0]]):r.push(t[d]),s.push(e),o.push(i==l?i:[i,l]),a.push([t["MatrixWidth"],t["MatrixHeight"]])}})),new ci({extent:t,origins:r,resolutions:s,matrixIds:n,tileSizes:o,sizes:a})}var hi=i(42654);class di extends ai.A{constructor(e){const t=void 0!==e.requestEncoding?e.requestEncoding:"KVP",i=e.tileGrid;let s=e.urls;void 0===s&&void 0!==e.url&&(s=(0,hi.Uu)(e.url)),super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,urls:s,wrapX:void 0!==e.wrapX&&e.wrapX,transition:e.transition,zDirection:e.zDirection}),this.version_=void 0!==e.version?e.version:"1.0.0",this.format_=void 0!==e.format?e.format:"image/jpeg",this.dimensions_=void 0!==e.dimensions?e.dimensions:{},this.layer_=e.layer,this.matrixSet_=e.matrixSet,this.style_=e.style,this.requestEncoding_=t,this.setKey(this.getKeyForDimensions_()),s&&s.length>0&&(this.tileUrlFunction=(0,hi.FD)(s.map(this.createFromWMTSTemplate.bind(this))))}setUrls(e){this.urls=e;const t=e.join("\n");this.setTileUrlFunction((0,hi.FD)(e.map(this.createFromWMTSTemplate.bind(this))),t)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const e=this.urls?this.urls.slice(0):[];for(const t in this.dimensions_)e.push(t+"-"+this.dimensions_[t]);return e.join("/")}updateDimensions(e){Object.assign(this.dimensions_,e),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(e){const t=this.requestEncoding_,i={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};"KVP"==t&&Object.assign(i,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e="KVP"==t?li(e,i):e.replace(/\{(\w+?)\}/g,(function(e,t){return t.toLowerCase()in i?i[t.toLowerCase()]:e}));const s=this.tileGrid,n=this.dimensions_;return function(i,r,o){if(!i)return;const a={TileMatrix:s.getMatrixId(i[0]),TileCol:i[1],TileRow:i[2]};Object.assign(a,n);let l=e;return l="KVP"==t?li(l,a):l.replace(/\{(\w+?)\}/g,(function(e,t){return a[t]})),l}}}const pi=di;function mi(e,t){const i=e["Contents"]["Layer"],s=i?.find((function(e){return e["Identifier"]==t["layer"]}));if(!s)return null;const n=e["Contents"]["TileMatrixSet"];let r;r=s["TileMatrixSetLink"].length>1?"projection"in t?s["TileMatrixSetLink"].findIndex((function(e){const i=n.find((function(t){return t["Identifier"]==e["TileMatrixSet"]})),s=i["SupportedCRS"],r=(0,G.get)(s),o=(0,G.get)(t["projection"]);return r&&o?(0,G.equivalent)(r,o):s==t["projection"]})):s["TileMatrixSetLink"].findIndex((function(e){return e["TileMatrixSet"]==t["matrixSet"]})):0,r<0&&(r=0);const o=s["TileMatrixSetLink"][r]["TileMatrixSet"],a=s["TileMatrixSetLink"][r]["TileMatrixSetLimits"];let l=s["Format"][0];"format"in t&&(l=t["format"]),r=s["Style"].findIndex((function(e){return"style"in t?e["Title"]==t["style"]:e["isDefault"]})),r<0&&(r=0);const c=s["Style"][r]["Identifier"],u={};"Dimension"in s&&s["Dimension"].forEach((function(e,t,i){const s=e["Identifier"];let n=e["Default"];void 0===n&&(n=e["Value"][0]),u[s]=n}));const h=e["Contents"]["TileMatrixSet"],d=h.find((function(e){return e["Identifier"]==o}));let p;const m=d["SupportedCRS"];if(m&&(p=(0,G.get)(m)),"projection"in t){const e=(0,G.get)(t["projection"]);e&&(p&&!(0,G.equivalent)(e,p)||(p=e))}let g=!1;const f="ne"==p.getAxisOrientation().substr(0,2);let y=d.TileMatrix[0],v={MinTileCol:0,MinTileRow:0,MaxTileCol:y.MatrixWidth-1,MaxTileRow:y.MatrixHeight-1};if(a){v=a[a.length-1];const e=d.TileMatrix.find((e=>e.Identifier===v.TileMatrix||d.Identifier+":"+e.Identifier===v.TileMatrix));e&&(y=e)}const _=28e-5*y.ScaleDenominator/p.getMetersPerUnit(),w=f?[y.TopLeftCorner[1],y.TopLeftCorner[0]]:y.TopLeftCorner,S=y.TileWidth*_,T=y.TileHeight*_;let b=d["BoundingBox"];b&&f&&(b=[b[1],b[0],b[3],b[2]]);let x=[w[0]+S*v.MinTileCol,w[1]-T*(1+v.MaxTileRow),w[0]+S*(1+v.MaxTileCol),w[1]-T*v.MinTileRow];if(void 0!==b&&!(0,J.ms)(b,x)){const e=s["WGS84BoundingBox"],t=(0,G.get)("EPSG:4326").getExtent();if(x=b,e)g=e[0]===t[0]&&e[2]===t[2];else{const e=(0,G.transformExtent)(b,d["SupportedCRS"],"EPSG:4326");g=e[0]-1e-10<=t[0]&&e[2]+1e-10>=t[2]}}const D=ui(d,x,a),C=[];let A=t["requestEncoding"];if(A=void 0!==A?A:"","OperationsMetadata"in e&&"GetTile"in e["OperationsMetadata"]){const t=e["OperationsMetadata"]["GetTile"]["DCP"]["HTTP"]["Get"];for(let e=0,i=t.length;e<i;++e)if(t[e]["Constraint"]){const i=t[e]["Constraint"].find((function(e){return"GetEncoding"==e["name"]})),s=i["AllowedValues"]["Value"];if(""===A&&(A=s[0]),"KVP"!==A)break;s.includes("KVP")&&C.push(t[e]["href"])}else t[e]["href"]&&(A="KVP",C.push(t[e]["href"]))}return 0===C.length&&(A="REST",s["ResourceURL"].forEach((function(e){"tile"===e["resourceType"]&&(l=e["format"],C.push(e["template"]))}))),{urls:C,layer:t["layer"],matrixSet:o,format:l,projection:p,requestEncoding:A,tileGrid:D,style:c,dimensions:u,wrapX:g,crossOrigin:t["crossOrigin"]}}var gi=i(54602),fi=i(10972),yi=i(16452),vi=class extends fi["default"]{constructor(e){var t=yi.A.create("DIV",{className:(e.className||"")+" ol-timeline"+(e.target?"":" ol-unselectable ol-control")+(e.zoomButton?" ol-hasbutton":"")});super({element:t,target:e.target}),this._scrollDiv=yi.A.create("DIV",{className:"ol-scroll",parent:this.element}),this._buttons=yi.A.create("DIV",{className:"ol-buttons",parent:this.element}),e.zoomButton&&(this.addButton({className:"ol-zoom-in",handleClick:function(){var e=this.get("zoom");e>=1?e++:e=Math.min(1,e+.1),e=Math.round(100*e)/100,this.refresh(e)}.bind(this)}),this.addButton({className:"ol-zoom-out",handleClick:function(){var e=this.get("zoom");e>1?e--:e-=.1,e=Math.round(100*e)/100,this.refresh(e)}.bind(this)})),this._intervalDiv=yi.A.create("DIV",{className:"ol-center-date",parent:this.element}),this.element.addEventListener("mouseover",function(){this._select&&this._select.elt.classList.remove("ol-select")}.bind(this));var i=null;this._scrollDiv.addEventListener("scroll",function(){this._setScrollLeft(),i&&(clearTimeout(i),i=null),i=setTimeout(function(){this.dispatchEvent({type:"scroll",date:this.getDate(),dateStart:this.getDate("start"),dateEnd:this.getDate("end")})}.bind(this),e.scrollTimeout||15)}.bind(this)),yi.A.scrollDiv(this._scrollDiv,{onmove:function(e){this._moving=e}.bind(this)}),this._tline=[],this._scrollLeft=0,this.set("maxWidth",e.maxWidth||2e3),this.set("minDate",e.minDate||1/0),this.set("maxDate",e.maxDate||-1/0),this.set("graduation",e.graduation),this.set("minZoom",e.minZoom||.2),this.set("maxZoom",e.maxZoom||4),this.setInterval(e.interval),e.getHTML&&(this._getHTML=e.getHTML),e.getFeatureDate&&(this._getFeatureDate=e.getFeatureDate),e.endFeatureDate&&(this._endFeatureDate=e.endFeatureDate),this.setFeatures(e.features||e.source,e.zoom)}setMap(e){super.setMap(e),this.refresh(this.get("zoom")||1,!0)}addButton(e){this.element.classList.add("ol-hasbutton"),yi.A.create("BUTTON",{className:e.className||void 0,title:e.title,html:e.html,click:e.handleClick,parent:this._buttons})}setInterval(e){"string"===typeof e&&(e=/s$/.test(e)?1e3*parseFloat(e):/mn$/.test(e)?1e3*parseFloat(e)*60:/h$/.test(e)?1e3*parseFloat(e)*3600:/d$/.test(e)?1e3*parseFloat(e)*3600*24:/y$/.test(e)?1e3*parseFloat(e)*3600*24*365:0),this.set("interval",e||0),e?this.element.classList.add("ol-interval"):this.element.classList.remove("ol-interval"),this.refresh(this.get("zoom"))}_getHTML(e){return e.get("name")||""}_getFeatureDate(e){return e&&e.get?e.get("date"):null}_endFeatureDate(){}isCollapsed(){return this.element.classList.contains("ol-collapsed")}collapse(e){e?this.element.classList.add("ol-collapsed"):this.element.classList.remove("ol-collapsed"),this.dispatchEvent({type:"collapse",collapsed:this.isCollapsed()})}toggle(){this.element.classList.toggle("ol-collapsed"),this.dispatchEvent({type:"collapse",collapsed:this.isCollapsed()})}setFeatures(e,t){this._features=this._source=null,e instanceof gi["default"]?this._source=e:this._features=e instanceof Array?e:[],this.refresh(t)}getFeatures(){return this._features||this._source.getFeatures()}refresh(e,t){if(this.getMap()){e||(e=this.get("zoom")),e=Math.min(this.get("maxZoom"),Math.max(this.get("minZoom"),e||1)),this.set("zoom",e),this._scrollDiv.innerHTML="";var i,s,n=this.getFeatures(),r=this._tline=[];n.forEach(function(e){(i=this._getFeatureDate(e))&&(i instanceof Date||(i=new Date(i)),this._endFeatureDate&&(s=this._endFeatureDate(e),s instanceof Date||(s=new Date(s))),isNaN(i)||r.push({date:i,end:isNaN(s)?null:s,feature:e}))}.bind(this)),r.sort((function(e,t){return e.date<t.date?-1:e.date===t.date?0:1}));var o=yi.A.create("DIV",{parent:this._scrollDiv}),a=this._minDate=Math.min(this.get("minDate"),r.length?r[0].date:1/0),l=this._maxDate=Math.max(this.get("maxDate"),r.length?r[r.length-1].date:-1/0);isFinite(a)||(this._minDate=a=new Date),isFinite(l)||(this._maxDate=l=new Date);var c=l-a,u=this.get("maxWidth"),h=this._scale=(c>u?u/c:1)*e;a=this._minDate=this._minDate-10/h,c=(l-a)*h,yi.A.setStyle(o,{width:c,maxWidth:"unset"}),this._drawTime(o,a,l,h),this.get("interval")?yi.A.setStyle(this._intervalDiv,{width:this.get("interval")*h}):yi.A.setStyle(this._intervalDiv,{width:""});var d=[],p=yi.A.getStyle(this._scrollDiv,"lineHeight"),m=yi.A.create("DIV",{className:"ol-features",parent:o});r.forEach(function(e){for(var t=e.date,i=e.elt=yi.A.create("DIV",{className:"ol-feature",style:{left:Math.round((t-a)*h)},html:this._getHTML(e.feature),parent:m}),s=i.querySelectorAll("img"),n=0;n<s.length;n++)s[n].ondragstart=function(){return!1};e.end&&yi.A.setStyle(i,{minWidth:(e.end-t)*h,width:(e.end-t)*h,maxWidth:"unset"});var r,o,l=yi.A.getStyle(i,"left");for(i.addEventListener("click",function(){this._moving||this.dispatchEvent({type:"select",feature:e.feature})}.bind(this)),r=0;o=d[r];r++)if(l>o)break;d[r]=l+yi.A.getStyle(i,"width"),yi.A.setStyle(i,{top:r*p})}.bind(this)),this._nbline=d.length,t&&this.setDate(this._minDate,{anim:!1,position:"start"}),this.dispatchEvent({type:"scroll",date:this.getDate(),dateStart:this.getDate("start"),dateEnd:this.getDate("end")})}}_getOffsetFromDate(e){return(e-this._minDate)*this._scale}_getDateFromOffset(e){return e/this._scale+this._minDate}_setScrollLeft(e){this._scrollLeft=e,void 0!==e&&(this._scrollDiv.scrollLeft=e)}_getScrollLeft(){return void 0===this._scrollLeft?this._scrollDiv.scrollLeft:this._scrollLeft}_drawTime(e,t,i,s){var n,r,o,a,l=yi.A.create("DIV",{className:"ol-times",parent:e}),c=yi.A.getStyle(l,"left"),u=yi.A.getStyle(l,"height"),h=new Date(this._minDate).getFullYear();r=(new Date(0).setFullYear(String(h))-new Date(0).setFullYear(String(h-1)))*s;var d=Math.round(2*u/r)+1;while(1){if(n=new Date(0).setFullYear(h),n>this._maxDate)break;yi.A.create("DIV",{className:"ol-time ol-year",style:{left:this._getOffsetFromDate(n)-c},html:h,parent:l}),h+=d}if(/day|month/.test(this.get("graduation"))&&(r=(new Date(0,0,1).setFullYear(String(h))-new Date(0,0,1).setFullYear(String(h-1)))*s,a=Math.max(1,Math.round(12/Math.round(r/u/2))),a<12)){h=new Date(this._minDate).getFullYear(),o=a+1;while(1){if(n=new Date(0,0,1),n.setFullYear(h),n.setMonth(o-1),n>this._maxDate)break;yi.A.create("DIV",{className:"ol-time ol-month",style:{left:this._getOffsetFromDate(n)-c},html:n.toLocaleDateString(void 0,{month:"short"}),parent:l}),o+=a,o>12&&(h++,o=a+1)}}if("day"===this.get("graduation")){r=(new Date(0,1,1)-new Date(0,0,1))*s;var p=Math.max(1,Math.round(31/Math.round(r/u/2)));if(p<31){h=new Date(this._minDate).getFullYear(),o=0;var m=p;while(1)if(n=new Date(0,0,1),n.setFullYear(h),n.setMonth(o),n.setDate(m),isNaN(n))o++,o>12&&(o=1,h++),m=p;else{if(n>this._maxDate)break;if(m>1){var g=this._getOffsetFromDate(n);this._getOffsetFromDate(new Date(h,o+1,1))-g>u&&yi.A.create("DIV",{className:"ol-time ol-day",style:{left:g-c},html:m,parent:l})}h=n.getFullYear(),o=n.getMonth(),m=n.getDate()+p,m>new Date(h,o+1,0).getDate()&&(o++,m=p)}}}}setDate(e,t){var i;if(t=t||{},e instanceof Date?i=e:(this.getFeatures().indexOf(e)>=0&&(i=this._getFeatureDate(e)),!i||i instanceof Date||(i=new Date(i)),i&&!isNaN(i)||(i=new Date(String(e)))),!isNaN(i)){!1===t.anim&&this._scrollDiv.classList.add("ol-move");var s=this._getOffsetFromDate(i);if("start"===t.position?s+=yi.A.outerWidth(this._scrollDiv)/2-yi.A.getStyle(this._scrollDiv,"marginLeft")/2:"end"===t.position&&(s-=yi.A.outerWidth(this._scrollDiv)/2-yi.A.getStyle(this._scrollDiv,"marginLeft")/2),this._setScrollLeft(s),!1===t.anim&&this._scrollDiv.classList.remove("ol-move"),e)for(var n,r=0;n=this._tline[r];r++)n.feature===e?(n.elt.classList.add("ol-select"),this._select=n):n.elt.classList.remove("ol-select")}}roundDate(e,t){switch(t){case"mn":return new Date(this._roundTo(e,6e4));case"hour":return new Date(this._roundTo(e,36e5));case"day":return new Date(this._roundTo(e,864e5));case"month":return e=new Date(this._roundTo(e,864e5)),e.getDate()>15&&(e=new Date(e.setMonth(e.getMonth()+1))),e=e.setDate(1),new Date(e);default:return new Date(e)}}getDate(e,t){var i;switch(t||(t=e),e){case"start":i=this.get("interval")?-yi.A.getStyle(this._intervalDiv,"width")/2+yi.A.getStyle(this._scrollDiv,"marginLeft")/2:-yi.A.outerWidth(this._scrollDiv)/2+yi.A.getStyle(this._scrollDiv,"marginLeft")/2;break;case"end":i=this.get("interval")?yi.A.getStyle(this._intervalDiv,"width")/2-yi.A.getStyle(this._scrollDiv,"marginLeft")/2:yi.A.outerWidth(this._scrollDiv)/2-yi.A.getStyle(this._scrollDiv,"marginLeft")/2;break;default:i=0;break}var s=this._getDateFromOffset(this._getScrollLeft()+i);return s=this.roundDate(s,t),new Date(s)}_roundTo(e,t){return Math.round(e/t)*t}getStartDate(){return new Date(this.get("minDate"))}getEndDate(){return new Date(this.get("maxDate"))}};const _i=vi;var wi=i(96763);const Si={mixins:[u.A],data(){return{WMTSCapabilities:{},timeline:null}},methods:{async addWebService(e){switch(e.type.toLowerCase()){case"xyz":return this.updateXYZLayer(e);case"wmts":return await this.updateWMTSLayer(e);default:return o.A.error(this,"Sorry, this web service type is not supported."),null}},getWMTSTimes(e,t){const i=e.Contents.Layer||[];let s=i.find((e=>e.Identifier==t));if(!s||!s.Dimension)return[];let n=s.Dimension.find((e=>"TIME"===e.Identifier));return n?n.Value.sort():[]},async initWMTSLayer(e){if(!this.WMTSCapabilities[e.url])try{let i=new URL(e.url);i.searchParams.set("service","wmts"),i.searchParams.set("request","GetCapabilities");let s=await axios.get(i.toString(),{responseType:"text"});var t=new oi;this.WMTSCapabilities[e.url]=t.read(s.data)}catch(error){o.A.exception(this,error,"WMTS Discovery failed")}return this.WMTSCapabilities[e.url]},async updateWMTSLayer(e,t="Service"){let i=e.attributes||{},s=await this.initWMTSLayer(e);s||o.A.exception(this,error,"WMTS Discovery failed");let n,r=null,a=null,l=null,c=null,u=o.A.getResourceTitle(e,t),h=new Ee.A;Array.isArray(i.layers)?n=i.layers:Array.isArray(s.Contents.Layer)&&(n=layers.map((e=>e.Identifier)));for(let m of n){if(!m)continue;let t=mi(s,{layer:m,matrixSet:"EPSG:3857"});l||(l=new Date(t.dimensions.TIME));let n=this.getWMTSTimes(s,m);if(n.length){let e=new Date(n[0]),t=new Date(n[n.length-1]);(!r||e<r)&&(r=e),(!a||t>a)&&(a=t)}o.A.isObject(i.dimensions)&&Object.assign(t.dimensions,e.attributes.dimensions),c=new pi(t);var d=new Le.A({title:u,source:this.trackTileProgress(c),noSwitcherDelete:!0});h.push(d)}if(r&&a){let e;this.timeline=new _i({className:"ol-pointer",graduation:"day",minDate:r,maxDate:a}),this.timeline.on("scroll",(function(t){!t.date||t.date>a||t.date<r||(e&&window.clearTimeout(e),e=window.setTimeout((()=>{try{let e=t.date.toISOString().substr(0,10);c.updateDimensions({TIME:e});let i=document.getElementsByClassName("timeline-date-label");i[0].innerText=e,i[0].disabled=!0}catch(error){wi.log(error)}e=null}),500))})),this.map.addControl(this.timeline),this.timeline.addButton({className:"timeline-date-label",title:`The date that is shown on the map for the collection '${u}'`,html:"No date"}),this.timeline.setDate(l)}let p=new Fe.A({id:e.id,title:u,layers:h});return p.on("change:visible",(()=>{this.timeline&&this.timeline.element&&(this.timeline.element.style.display=p.getVisible()?"block":"none")})),this.addLayerToMap(p),this.timeline&&this.map.getLayers().on("remove",(e=>{e.element===p&&(this.map.removeControl(this.timeline),this.timeline=null)})),p},updateXYZLayer(e,t="Service"){let i=o.A.replaceParam(e.url,"__editorSessionId",(new Date).getTime()).replace(/%7B/g,"{").replace(/%7D/g,"}"),s=o.A.getResourceTitle(e,t),n=new Le.A({title:s,source:this.trackTileProgress(new Me.A({url:i})),noSwitcherDelete:!0}),r=new Fe.A({id:e.id,title:s,layers:[n]});if(this.addLayerToMap(r),o.A.isObject(e.process)&&o.A.isObject(e.process.process_graph)){const t="urn:ogc:def:crs:OGC:1.3:CRS84",i="EPSG:4326";Object.values(e.process.process_graph).filter((e=>"load_collection"===e.process_id&&o.A.isObject(e.arguments)&&e.arguments.spatial_extent)).forEach((e=>{let s=e.arguments.spatial_extent,n=(s.west||s.east||s.south||s.north)&&(!s.crs||4326===s.crs||s.crs===i),r=s.type&&(!s.crs||o.A.isObject(s.crs)&&"name"===s.crs.type&&(s.crs.properties?.name===i||s.properties?.name===t));(n||r)&&this.addExtent(s,!1)}))}return r}}},Ti=Si;var bi,xi,Di=(0,v.A)(Ti,bi,xi,!1,null,null,null);const Ci=Di.exports;var Ai=i(73902),Ei=i(86717),Fi=i(34142),Li=i(82986),Mi=i(96763);r.A.prototype.getSampleByteSize=function(e){if(this.fileDirectory.BitsPerSample&&0!==this.fileDirectory.BitsPerSample.length)return e>=this.fileDirectory.BitsPerSample.length&&(e=0),Math.ceil(this.fileDirectory.BitsPerSample[e]/8)},r.A.prototype.getReaderForSample=function(e){const t=this.getSampleFormat(e),i=this.getBitsPerSample(e);switch(t){case 1:if(i<=8)return DataView.prototype.getUint8;if(i<=16)return DataView.prototype.getUint16;if(i<=32)return DataView.prototype.getUint32;break;case 2:if(i<=8)return DataView.prototype.getInt8;if(i<=16)return DataView.prototype.getInt16;if(i<=32)return DataView.prototype.getInt32;break;case 3:switch(i){case 16:return function(e,t){return getFloat16(this,e,t)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64;default:break}break;default:break}throw Error("Unsupported data format/bitsPerSample")},r.A.prototype.getSampleFormat=function(e=0){return this.fileDirectory.SampleFormat&&0!==this.fileDirectory.SampleFormat.length?"undefined"!==typeof this.fileDirectory.SampleFormat[e]?this.fileDirectory.SampleFormat[e]:this.fileDirectory.SampleFormat[0]:1},r.A.prototype.getBitsPerSample=function(e=0){if(this.fileDirectory.BitsPerSample&&0!==this.fileDirectory.BitsPerSample.length)return"undefined"!==typeof this.fileDirectory.BitsPerSample[e]?this.fileDirectory.BitsPerSample[e]:this.fileDirectory.BitsPerSample[0]};const Pi={name:"MapViewer",mixins:[u.A,h.A,De,Ce.A,Ci],components:{Pane:c.Z,ScatterChart:Ae.A,Splitpanes:c.S},props:{data:{}},data(){return{loading:!0,chart:null}},computed:{...o.A.mapState(["connection"]),isWebService(){return this.data instanceof Ai.Service&&"string"===typeof this.data.type},isGeoTiff(){return this.data instanceof a.A},isGeoJson(){return this.data instanceof l.A&&this.data.isGeoJson}},mounted(){this.$emit("mounted",this)},methods:{async renderMap(){try{let e,t;if(this.isGeoJson)t=await this.data.loadData(this.connection);else if(this.isGeoTiff){t=await this.data.loadData(this.connection);let i=t.getProjection();i&&(e=i)}else{if(!this.isWebService||!o.A.isMapServiceSupported(this.data.type))throw new Error("Sorry, the given data can't be shown on a web map.");if("wmts"===this.data.type.toLowerCase()){await this.initWMTSLayer(this.data)}}if(await this.createMap(e),this.addLayerSwitcher(),this.addGeocoder((e=>{if(!e)return;let t=this.toExtent(e);t=(0,G.transformExtent)(t,"EPSG:4326",this.map.getView().getProjection()),this.map.getView().fit(t,this.getFitOptions())})),this.isGeoJson)this.addBasemaps(),this.addGeoJson(t,!0);else if(this.isGeoTiff){let e=this.map.getView().getProjection();(e.basemap||["EPSG:3857","EPSG:4326"].includes(e.getCode()))&&this.addBasemaps(),this.addGeoTiff(t);let i=this.data.getContext();i&&this.addExtent(i,!1)}else this.isWebService&&o.A.isMapServiceSupported(this.data.type)&&(this.addBasemaps(),this.addWebService(this.data));this.$listeners&&this.$listeners.drop&&(this.map.getViewport().addEventListener("dragover",(e=>e.preventDefault())),this.map.getViewport().addEventListener("drop",this.$listeners.drop))}catch(error){o.A.exception(this,error)}this.loading=!1},async addCollection(){let e=this.showWebService(this.data);try{let t=service.attributes.bbox,i=[...this.fromLonLat([t.west,t.south]),...this.fromLonLat([t.east,t.north])],s=new Li["default"]({title:"Extent",noSwitcherDelete:!0,source:new gi["default"]({features:[new Ei["default"]((0,Fi.VY)(i))],projection:"EPSG:4326",wrapX:!1})});this.removeLayerFill(s),e.getLayers().push(s),this.map.getView().fit(i,this.getFitOptions(10))}catch(error){Mi.log(error)}}}},Ri=Pi;var Ii=(0,v.A)(Ri,s,n,!1,null,null,null);const ji=Ii.exports}}]);
//# sourceMappingURL=164.3066ee85.js.map