"use strict";(globalThis["webpackChunk_openeo_web_editor"]=globalThis["webpackChunk_openeo_web_editor"]||[]).push([[524],{1717:(e,t,a)=>{a.d(t,{Z:()=>n});var s=a(99943),i=a(89911),r=(a(17607),a(1001)),o=(0,r.Z)(i.Z,s.s,s.x,!1,null,null,null);const n=o.exports},65040:(e,t,a)=>{a.d(t,{Z:()=>c});var s=a(65659),i=a(58661),r=a(82489),o=a(1744),n=a(20456),l=a(52590),p=a(40986);const c={name:"VisualEditor",mixins:[o.Z],components:{ModelBuilder:s["default"],DiscoveryToolbar:r.Z,FullscreenButton:n.Z},props:{id:String,editable:{type:Boolean,default:!0},value:{type:Object,default:()=>null},parent:{type:Object,default:null},parentSchema:{type:Object,default:null},showDiscoveryToolbar:{type:Boolean,default:!1},showIntro:{type:Boolean,default:!1},title:{type:String},defaultValue:{}},computed:{...i.Z.mapState(["connection","collections"]),...i.Z.mapGetters(["processes","supportsMath"]),...i.Z.mapState("editor",["initialNode"]),isMath(){return this.supportsMath&&this.processes.isMath(this.value)}},data(){return{showHelpOverlay:this.showIntro,canUndo:!1,canRedo:!1,canPaste:!1,compactMode:!1,hasSelection:!1,formula:null,isFullScreen:!1}},watch:{value:{immediate:!0,handler(e){if(e&&(this.showHelpOverlay=!1),this.initialNode&&i.Z.isObject(e)&&i.Z.isObject(e.process_graph))try{let t=this.initialNode;"1"==t&&i.Z.size(e.process_graph)&&(t=Object.keys(e.process_graph)[0]),this.openArgumentEditorForNode(t)}catch(t){i.Z.exception(this,t)}finally{this.setInitialNode(null)}}}},mounted(){this.canPaste=navigator&&navigator.clipboard&&"function"===typeof navigator.clipboard.readText},methods:{...i.Z.mapMutations("editor",["setInitialNode"]),commit(e){"undefined"!==typeof this.defaultValue&&i.Z.isObject(e)&&0===i.Z.size(e.process_graph)&&(e=this.defaultValue),this.$emit("input",e)},async paste(){this.canPaste||i.Z.error(this,"error","Pasting is not supported by your browser.");try{const e=await navigator.clipboard.readText();let t=JSON.parse(e);await this.$refs.blocks.import(t)}catch(e){i.Z.exception(this,e,"Paste Error")}},importProcess(){this.broadcast("importProcess")},errorHandler(e,t=null){i.Z.exception(this,e,t)},selectionChanged(e,t){this.hasSelection=Boolean(e.filter((e=>e.$el.allowsDelete)).length||t.length)},historyChanged(e,t){this.canUndo=!!e[t-1],this.canRedo=!!e[t+1]},allowDrop(e){this.showHelpOverlay=!1,e.preventDefault()},onDrop(e){var t=e.dataTransfer.getData("application/vnd.openeo-node");if(t){let a=JSON.parse(t);return this.insertProcess(a,e.pageX,e.pageY),e.preventDefault()}let a=e.dataTransfer.files;if(1===a.length){let t=e.dataTransfer.files[0];if("application/json"===t.type){var s=new FileReader;return s.onload=async e=>{try{let t=JSON.parse(e.target.result);await this.$refs.blocks.import(t)}catch(t){i.Z.exception(this,t,"Parsing JSON file failed")}},s.onerror=e=>i.Z.exception(this,e,"Reading JSON file failed"),s.readAsText(t,"UTF-8"),e.preventDefault()}}},getNameField(e,t="name"){return{value:e,name:t,description:"A unique identifier. Must contain only letters (`a`-`z`), digits (`0`-`9`) and underscores (`_`). `snake_case` is recommended.",label:"Name",schema:{type:"string",pattern:"^\\w+$"},default:null}},getDescriptionField(e,t=!1,a="description",s="Description"){return{value:e,name:a,description:"Provides a detailed description. CommonMark (Markdown) syntax can be used for rich text formatting.",label:s,optional:t,schema:{type:"string",subtype:"commonmark"}}},getOptionalField(e){return{value:e,name:"optional",label:"Optional",description:"Parameters by default are required. CHeck this option to make the parameter optional. For optional parameters a default value should be specified.",optional:!0,schema:{type:"boolean"},default:!1}},getDefaultField(e){return{value:e,name:"default",label:"Default Value",description:"This value is used whenever the user of this process did not specify a value for this parameter.",toggledBy:"optional",optional:!0,schema:{}}},getExperimentalField(e){return{value:e,name:"experimental",label:"Experimental",description:"Declares that this is experimental, which means that it is unstable and likely to change.",optional:!0,schema:{type:"boolean"},default:!1}},getDeprecatedField(e){return{value:e,name:"deprecated",label:"Deprecated",description:"Declares that this is deprecated with the potential to be removed in any of the next versions. It should be transitioned out of usage.",optional:!0,schema:{type:"boolean"},default:!1}},getSchemaField(e,t="schema",a="Data Types"){let s=e?"json-schema":"openeo-datatype";return{value:e,name:t,label:a,description:"Allowed data type(s) as JSON Schema.",schema:[{title:"Single data type",type:"object",subtype:s},{title:"Multiple data types",type:"array",minItems:2,items:{type:"object",subtype:s}}]}},editProcess(e){e=i.Z.isObject(e)?e:{};let t=i.Z.isObject(e.returns)?e.returns:{};var a=[this.getNameField(e.id,"id"),{value:e.summary,name:"summary",description:"A very short description of the process with usually less than 60 characters.",label:"Summary",optional:!0,schema:{type:"string"}},this.getDescriptionField(e.description,!0),{value:e.categories,name:"categories",label:"Categories",optional:!0,schema:{type:"array",items:{type:"string"}}},this.getExperimentalField(e.experimental),this.getDeprecatedField(e.deprecated),{label:"Parameters",description:'The parameters can be edited directly in the "Visual Model" interface.',info:!0},this.getDescriptionField(t.description,!0,"returns_description","Return Value > Description"),this.getSchemaField(t.schema,"returns_schema","Return Value > Data Type"),{value:e.exceptions,name:"exceptions",description:"Declares exceptions (errors) that might occur during execution of this process. This list is just for informative purposes.\n\nThe keys of the object are the error codes, which should only consist of alphanumerical characters. `PascalCase` is recommended.",label:"Errors",optional:!0,schema:{type:"object",additionalProperties:{type:"object",required:["message"],properties:{message:{title:"Error Message",type:"string"},description:{title:"Description",type:"string",subtype:"commonmark"},http:{title:"HTTP Status Code",type:"integer",enum:[400,500,501]}}}}},{value:e.examples,name:"examples",label:"Examples",description:"Example calls for this process with specific values for the parameters (arguments) and the result (return value).",optional:!0,schema:{type:"array",items:{type:"object",required:["arguments"],properties:{title:{title:"Title",type:"string"},title:{title:"Description",type:"string",subtype:"commonmark"},arguments:{title:"Arguments",type:"object",default:{}},returns:{title:"Return Value"}}}}},{value:e.links,name:"links",label:"Links",description:"Links related to this process, e.g. additional documentation.",optional:!0,schema:{type:"array",items:{type:"object",required:["href","rel"],properties:{href:{title:"URL",type:"string"},rel:{title:"Relation",description:"For examples see [IANA relation types](https://www.iana.org/assignments/link-relations/link-relations.xhtml)",type:"string",default:"about"},title:{title:"Title",type:"string"},type:{title:"Media Type",description:"For examples see [IANA media types](https://www.iana.org/assignments/media-types/media-types.xhtml)",type:"string"}}}}}];this.broadcast("showDataForm","Edit Process",a,(async e=>{let t=i.Z.pickFromObject(e,["id","summary","description","categories","experimental","deprecated","exception","examples","links"]);("string"===typeof t.description||i.Z.isObject(t.schema))&&(t.returns={description:e.returns_description,schema:e.returns_schema});let a=this.$refs.blocks.export(!0),s=Object.assign({},a,t);const r={id:"",summary:"",description:"",categories:[],experimental:!1,deprecated:!1,examples:[],links:[],process_graph:{}};for(let o in r)i.Z.equals(r[o],s[o])&&delete s[o];this.commit(s)}))},addParameter(){var e=[this.getNameField(),this.getDescriptionField(),this.getOptionalField(),this.getDefaultField(),this.getExperimentalField(),this.getDeprecatedField(),this.getSchemaField()];this.broadcast("showDataForm","Add Parameter",e,(async e=>{"string"===typeof e.name&&e.name.length>0&&await this.$refs.blocks.addPgParameter(e)}))},editParameter(e,t="Edit Parameter",a=null){var s=[this.getNameField(e.name),this.getDescriptionField(e.description),this.getOptionalField(e.optional),this.getDefaultField(e.default),this.getExperimentalField(e.experimental),this.getDeprecatedField(e.deprecated),this.getSchemaField(e.schema)];this.broadcast("showDataForm",t,s,a)},showExpressionModal(){let e=new p.Z(this.value,this.processes,this.connection,!0);e.setCallbackParameters(this.$refs.blocks.getPgParameters().map((e=>e.spec)));try{e.parse();let t={process:e},a={save:this.insertNodes};this.broadcast("showModal","ExpressionModal",t,a)}catch(t){i.Z.exception(this,t)}},openArgumentEditorForNode(e){let t=i.Z.deepClone(this.value),a=t.process_graph[e],s=this.processes.get(a.process_id,a.namespace);Array.isArray(s.parameters)&&s.parameters.length>0&&this.openArgumentEditor(s.parameters.map((e=>new l.ProcessParameter(e))).filter((e=>e.isEditable())),a.arguments,s.id,!0,null,(e=>{Object.assign(a,{arguments:e}),this.commit(t)}))},openArgumentEditor(e,t,a="Edit",s=!0,i=null,r=null,o=null){let n={title:a,parameters:e,data:t,editable:s,selectParameterName:i,parent:o},l={};"function"===typeof r&&(l.save=r),this.broadcast("showModal","ParameterModal",n,l)},confirmClear(){var e=confirm("Do you really want to clear the existing model?");e&&this.clear()},clear(){this.$refs.blocks&&this.$refs.blocks.clear(),this.commit(null)},insertProcess(e,t=null,a=null){try{var s=this.$refs.blocks.getPositionForPageXY(t,a);let i=e.namespace;"backend"!==i&&"user"!==i||(i=null),this.$refs.blocks.addProcess(e.process_id,e.arguments,s,i)}catch(r){i.Z.exception(this,r)}},async insertNodes(e,t=!1){return await this.$refs.blocks.import({process_graph:e},{clear:t})}}}},48897:(e,t,a)=>{a.d(t,{Z:()=>o});var s=a(29081),i=a(58661),r=a(25108);const o=(e,t,a,o=!0)=>({components:{DataTable:s.Z},data(){return{columns:{},syncTimer:null,lastSyncTime:null}},mounted(){o&&this.updateData()},beforeDestroy(){this.stopSyncTimer()},computed:{...i.Z.mapState(e,{data:e}),...i.Z.mapGetters(e,["supportsList","supportsCreate","supportsRead","supportsUpdate","supportsDelete"])},methods:{...i.Z.mapActions(e,["list","create","read","update","delete"]),getTable(){return this.$refs&&this.$refs.table?this.$refs.table:null},onShow(){this.updateData().catch((e=>i.Z.exception(this,e,`Updating ${a} failed`))),this.startSyncTimer()},onHide(){this.stopSyncTimer()},startSyncTimer(){this.supportsList&&null===this.syncTimer&&(this.syncTimer=setInterval(this.updateData,this.getSyncInterval()))},stopSyncTimer(){null!==this.syncTimer&&(clearInterval(this.syncTimer),this.syncTimer=null)},getSyncInterval(){return 60*this.$config.dataRefreshInterval*1e3},async refreshElement(e,a=null){var s=Object.assign({},e);try{let t=await this.read({data:e});"function"===typeof a&&a(t,s)}catch(r){i.Z.exception(this,r,"Load "+t+" error")}},async updateData(){var e=this.getTable(),s=Date.now()-this.getSyncInterval();if(e&&!(this.lastSyncTime>s))if(this.supportsList)if(this.supportsCreate){var o=this.data.length>0;o||e.setNoData("Loading "+a+"..."),this.lastSyncTime=Date.now();try{let a=await this.list();0==a.length&&e.setNoData("Add your first "+t+" here...")}catch(n){o?r.log(n):(i.Z.exception(this,n),e.setNoData("Sorry, unable to load data from the server."))}}else e.setNoData("Sorry, this feature is not supported by the server.");else e.setNoData("Sorry, listing stored "+a+" is not supported by the server.")}}})}}]);
//# sourceMappingURL=524.045a7a40.js.map