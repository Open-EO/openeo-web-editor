"use strict";(globalThis["webpackChunk_openeo_web_editor"]=globalThis["webpackChunk_openeo_web_editor"]||[]).push([[2896],{20100:(e,t,r)=>{r.d(t,{c:()=>E});var i=r(37596),n=r(91148),s=r(80552),o=r(1888),a=r(20176),l=r(42936),c=r(60552),h=r(1360);class d extends i.c{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){(0,s.Sc)()}calculateMatrices2D(e){const t=e.viewState,r=e.coordinateToPixelTransform,i=e.pixelToCoordinateTransform;(0,o.Jn)(r,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),(0,o.Av)(i,r)}forEachFeatureAtCoordinate(e,t,r,i,n,s,o,l){let d;const u=t.viewState;function g(e,t,r,i){return n.call(s,t,e?r:null,i)}const p=u.projection,f=(0,h.c3)(e.slice(),p),m=[[0,0]];if(p.canWrapX()&&i){const e=p.getExtent(),t=(0,a.K6)(e);m.push([-t,0],[t,0])}const T=t.layerStatesArray,x=T.length,_=[],y=[];for(let a=0;a<m.length;a++)for(let i=x-1;i>=0;--i){const n=T[i],s=n.layer;if(s.hasRenderer()&&(0,c.M)(n,u)&&o.call(l,s)){const i=s.getRenderer(),o=s.getSource();if(i&&o){const s=o.getWrapX()?f:e,l=g.bind(null,n.managed);y[0]=s[0]+m[a][0],y[1]=s[1]+m[a][1],d=i.forEachFeatureAtCoordinate(y,t,r,l,_)}if(d)return d}}if(0===_.length)return;const R=1/_.length;return _.forEach(((e,t)=>e.distanceSq+=t*R)),_.sort(((e,t)=>e.distanceSq-t.distanceSq)),_.some((e=>d=e.callback(e.feature,e.layer,e.geometry))),d}hasFeatureAtCoordinate(e,t,r,i,s,o){const a=this.forEachFeatureAtCoordinate(e,t,r,i,n.sF,this,s,o);return void 0!==a}getMap(){return this.map_}renderFrame(e){(0,s.Sc)()}flushDeclutterItems(e){}scheduleExpireIconCache(e){l.E.canExpireCache()&&e.postRenderFunctions.push(u)}}function u(e,t){l.E.expire()}const g=d;var p=r(49040),f=r(668),m=r(4400),T=r(99040),x=r(37068),_=r(83096),y=r(3104);class R extends g{constructor(e){super(e),this.fontChangeListenerKey_=(0,_.IT)(x.uO,p.c.PROPERTYCHANGE,e.redrawText.bind(e)),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=T.Cs+" ol-layers";const r=e.getViewport();r.insertBefore(this.element_,r.firstChild||null),this.children_=[],this.renderedVisible_=!0,this.declutterLayers_=[]}dispatchRenderEvent(e,t){const r=this.getMap();if(r.hasListener(e)){const i=new f.c(e,void 0,t);r.dispatchEvent(i)}}disposeInternal(){(0,_.Si)(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(e){if(!e)return void(this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1));this.calculateMatrices2D(e),this.dispatchRenderEvent(m.c.PRECOMPOSE,e);const t=e.layerStatesArray.sort((function(e,t){return e.zIndex-t.zIndex})),r=e.viewState;this.children_.length=0;const i=this.declutterLayers_;i.length=0;let n=null;for(let s=0,o=t.length;s<o;++s){const o=t[s];e.layerIndex=s;const a=o.layer,l=a.getSourceState();if(!(0,c.M)(o,r)||"ready"!=l&&"undefined"!=l){a.unrender();continue}const h=a.render(e,n);h&&(h!==n&&(this.children_.push(h),n=h),"getDeclutter"in a&&i.push(a))}this.flushDeclutterItems(e),(0,y.ER)(this.element_,this.children_),this.dispatchRenderEvent(m.c.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}flushDeclutterItems(e){const t=this.declutterLayers_;for(let r=t.length-1;r>=0;--r)t[r].renderDeclutter(e);t.length=0}}const E=R},98760:(e,t,r)=>{r.d(t,{c:()=>l});var i=r(5276),n=r(48356),s=r(65716),o=r(80552);class a extends s.c{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.declutterExecutorGroup=null}getFeatures(e){return(0,o.Sc)()}getData(e){return null}prepareFrame(e){return(0,o.Sc)()}renderFrame(e,t){return(0,o.Sc)()}loadedTileCallback(e,t,r){e[t]||(e[t]={}),e[t][r.tileCoord.toString()]=r}createLoadedTileFinder(e,t,r){return(i,n)=>{const s=this.loadedTileCallback.bind(this,r,i);return e.forEachLoadedTile(t,i,n,s)}}forEachFeatureAtCoordinate(e,t,r,i,n){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){const t=e.target;t.getState()!==n.c.LOADED&&t.getState()!==n.c.ERROR||this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=n.c.LOADED&&t!=n.c.ERROR&&e.addEventListener(i.c.CHANGE,this.boundHandleImageChange_),t==n.c.IDLE&&(e.load(),t=e.getState()),t==n.c.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&"ready"===e.getSourceState()&&e.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}}const l=a},47916:(e,t,r)=>{r.d(t,{c:()=>h});var i=r(7172),n=r(48356),s=r(39552),o=r(1888),a=r(20176),l=r(26440);class c extends i.c{constructor(e){super(e),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],r=e.pixelRatio,i=e.viewState,o=i.resolution,c=this.getLayer().getSource(),h=e.viewHints;let d=e.extent;if(void 0!==t.extent&&(d=(0,a.ii)(d,(0,l.fromUserExtent)(t.extent,i.projection))),!h[s.c.ANIMATING]&&!h[s.c.INTERACTING]&&!(0,a.t7)(d))if(c){const e=i.projection,t=c.getImage(d,o,r,e);t&&(this.loadImage(t)?this.image_=t:t.getState()===n.c.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(e){const t=this.frameState;if(!t)return null;const r=this.getLayer(),i=(0,o.iQ)(t.pixelToCoordinateTransform,e.slice()),n=r.getExtent();if(n&&!(0,a.Ud)(n,i))return null;const s=this.image_.getExtent(),l=this.getImage(),c=(0,a.K6)(s),h=Math.floor(l.width*((i[0]-s[0])/c));if(h<0||h>=l.width)return null;const d=(0,a.YF)(s),u=Math.floor(l.height*((s[3]-i[1])/d));return u<0||u>=l.height?null:this.getImageData(l,h,u)}renderFrame(e,t){const r=this.image_,i=r.getExtent(),n=r.getResolution(),s=r.getPixelRatio(),c=e.layerStatesArray[e.layerIndex],h=e.pixelRatio,d=e.viewState,u=d.center,g=d.resolution,p=h*n/(g*s),f=e.extent,m=d.resolution,T=d.rotation,x=Math.round((0,a.K6)(f)/m*h),_=Math.round((0,a.YF)(f)/m*h);(0,o.Jn)(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/h,1/h,T,-x/2,-_/2),(0,o.Av)(this.inversePixelTransform,this.pixelTransform);const y=(0,o.MR)(this.pixelTransform);this.useContainer(t,y,this.getBackground(e));const R=this.context,E=R.canvas;E.width!=x||E.height!=_?(E.width=x,E.height=_):this.containerReused||R.clearRect(0,0,x,_);let S=!1,C=!0;if(c.extent){const t=(0,l.fromUserExtent)(c.extent,d.projection);C=(0,a.K0)(t,e.extent),S=C&&!(0,a.cP)(t,e.extent),S&&this.clipUnrotated(R,e,t)}const I=this.getImage(),v=(0,o.Jn)(this.tempTransform,x/2,_/2,p,p,0,s*(i[0]-u[0])/n,s*(u[1]-i[3])/n);this.renderedResolution=n*h/s;const w=I.width*v[0],P=I.height*v[3];if(this.getLayer().getSource().getInterpolate()||(R.imageSmoothingEnabled=!1),this.preRender(R,e),C&&w>=.5&&P>=.5){const e=v[4],t=v[5],r=c.opacity;let i;1!==r&&(i=R.globalAlpha,R.globalAlpha=r),R.drawImage(I,0,0,+I.width,+I.height,e,t,w,P),1!==r&&(R.globalAlpha=i)}return this.postRender(R,e),S&&R.restore(),R.imageSmoothingEnabled=!0,y!==E.style.transform&&(E.style.transform=y),this.container}}const h=c},7172:(e,t,r)=>{r.d(t,{c:()=>f,k:()=>d});var i=r(98760),n=r(668),s=r(4400),o=r(1888),a=r(34892),l=r(3104),c=r(38800),h=r(20176);const d=[];let u=null;function g(){u=(0,l.OE)(1,1,void 0,{willReadFrequently:!0})}class p extends i.c{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=(0,o.Su)(),this.pixelTransform=(0,o.Su)(),this.inversePixelTransform=(0,o.Su)(),this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(e,t,r){let i;u||g(),u.clearRect(0,0,1,1);try{u.drawImage(e,t,r,1,1,0,0,1,1),i=u.getImageData(0,0,1,1).data}catch(n){return u=null,null}return i}getBackground(e){const t=this.getLayer();let r=t.getBackground();return"function"===typeof r&&(r=r(e.viewState.resolution)),r||void 0}useContainer(e,t,r){const i=this.getLayer().getClassName();let n,s;if(e&&e.className===i&&(!r||e&&e.style.backgroundColor&&(0,c.yK)((0,a.f4)(e.style.backgroundColor),(0,a.f4)(r)))){const t=e.firstElementChild;t instanceof HTMLCanvasElement&&(s=t.getContext("2d"))}if(s&&s.canvas.style.transform===t?(this.container=e,this.context=s,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){n=document.createElement("div"),n.className=i;let e=n.style;e.position="absolute",e.width="100%",e.height="100%",s=(0,l.OE)();const t=s.canvas;n.appendChild(t),e=t.style,e.position="absolute",e.left="0",e.transformOrigin="top left",this.container=n,this.context=s}this.containerReused||!r||this.container.style.backgroundColor||(this.container.style.backgroundColor=r)}clipUnrotated(e,t,r){const i=(0,h.Iq)(r),n=(0,h.n9)(r),s=(0,h.KQ)(r),a=(0,h.q2)(r);(0,o.iQ)(t.coordinateToPixelTransform,i),(0,o.iQ)(t.coordinateToPixelTransform,n),(0,o.iQ)(t.coordinateToPixelTransform,s),(0,o.iQ)(t.coordinateToPixelTransform,a);const l=this.inversePixelTransform;(0,o.iQ)(l,i),(0,o.iQ)(l,n),(0,o.iQ)(l,s),(0,o.iQ)(l,a),e.save(),e.beginPath(),e.moveTo(Math.round(i[0]),Math.round(i[1])),e.lineTo(Math.round(n[0]),Math.round(n[1])),e.lineTo(Math.round(s[0]),Math.round(s[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.clip()}dispatchRenderEvent_(e,t,r){const i=this.getLayer();if(i.hasListener(e)){const s=new n.c(e,this.inversePixelTransform,r,t);i.dispatchEvent(s)}}preRender(e,t){this.frameState=t,this.dispatchRenderEvent_(s.c.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(s.c.POSTRENDER,e,t)}getRenderTransform(e,t,r,i,n,s,a){const l=n/2,c=s/2,h=i/t,d=-h,u=-e[0]+a,g=-e[1];return(0,o.Jn)(this.tempTransform,l,c,h,d,-r,u,g)}disposeInternal(){delete this.frameState,super.disposeInternal()}}const f=p},43256:(e,t,r)=>{r.d(t,{c:()=>f});var i=r(7172),n=r(60549),s=r(43824),o=r(69320),a=r(65004),l=r(1888),c=r(38800),h=r(20176),d=r(26440),u=r(80552),g=r(15660);class p extends i.c{constructor(e){super(e),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=(0,h.Gu)(),this.tmpTileRange_=new o.c(0,0,0,0)}isDrawableTile(e){const t=this.getLayer(),r=e.getState(),i=t.getUseInterimTilesOnError();return r==a.c.LOADED||r==a.c.EMPTY||r==a.c.ERROR&&!i}getTile(e,t,r,i){const n=i.pixelRatio,s=i.viewState.projection,o=this.getLayer(),l=o.getSource();let c=l.getTile(e,t,r,n,s);return c.getState()==a.c.ERROR&&o.getUseInterimTilesOnError()&&o.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(c)||(c=c.getInterimTile()),c}getData(e){const t=this.frameState;if(!t)return null;const r=this.getLayer(),i=(0,l.iQ)(t.pixelToCoordinateTransform,e.slice()),o=r.getExtent();if(o&&!(0,h.Ud)(o,i))return null;const c=t.pixelRatio,d=t.viewState.projection,u=t.viewState,p=r.getRenderSource(),f=p.getTileGridForProjection(u.projection),m=p.getTilePixelRatio(t.pixelRatio);for(let l=f.getZForResolution(u.resolution);l>=f.getMinZoom();--l){const e=f.getTileCoordForCoordAndZ(i,l),t=p.getTile(l,e[1],e[2],c,d);if(!(t instanceof n.c||t instanceof s.c)||t instanceof s.c&&t.getState()===a.c.EMPTY)return null;if(t.getState()!==a.c.LOADED)continue;const r=f.getOrigin(l),o=(0,g._2)(f.getTileSize(l)),h=f.getResolution(l),T=Math.floor(m*((i[0]-r[0])/h-e[1]*o[0])),x=Math.floor(m*((r[1]-i[1])/h-e[2]*o[1])),_=Math.round(m*p.getGutterForProjection(u.projection));return this.getImageData(t.getImage(),T+_,x+_)}return null}loadedTileCallback(e,t,r){return!!this.isDrawableTile(r)&&super.loadedTileCallback(e,t,r)}prepareFrame(e){return!!this.getLayer().getSource()}renderFrame(e,t){const r=e.layerStatesArray[e.layerIndex],i=e.viewState,n=i.projection,s=i.resolution,o=i.center,g=i.rotation,p=e.pixelRatio,f=this.getLayer(),m=f.getSource(),T=m.getRevision(),x=m.getTileGridForProjection(n),_=x.getZForResolution(s,m.zDirection),y=x.getResolution(_);let R=e.extent;const E=e.viewState.resolution,S=m.getTilePixelRatio(p),C=Math.round((0,h.K6)(R)/E*p),I=Math.round((0,h.YF)(R)/E*p),v=r.extent&&(0,d.fromUserExtent)(r.extent,n);v&&(R=(0,h.ii)(R,(0,d.fromUserExtent)(r.extent,n)));const w=y*C/2/S,P=y*I/2/S,F=[o[0]-w,o[1]-P,o[0]+w,o[1]+P],A=x.getTileRangeForExtentAndZ(R,_),b={};b[_]={};const D=this.createLoadedTileFinder(m,n,b),L=this.tmpExtent,M=this.tmpTileRange_;this.newTiles_=!1;const G=g?(0,h.Ux)(i.center,E,g,e.size):void 0;for(let l=A.minX;l<=A.maxX;++l)for(let t=A.minY;t<=A.maxY;++t){if(g&&!x.tileCoordIntersectsViewport([_,l,t],G))continue;const i=this.getTile(_,l,t,e);if(this.isDrawableTile(i)){const t=(0,u.gV)(this);if(i.getState()==a.c.LOADED){b[_][i.tileCoord.toString()]=i;let e=i.inTransition(t);e&&1!==r.opacity&&(i.endTransition(t),e=!1),this.newTiles_||!e&&this.renderedTiles.includes(i)||(this.newTiles_=!0)}if(1===i.getAlpha(t,e.time))continue}const n=x.getTileCoordChildTileRange(i.tileCoord,M,L);let s=!1;n&&(s=D(_+1,n)),s||x.forEachTileCoordParentTileRange(i.tileCoord,D,M,L)}const O=y/s*p/S;(0,l.Jn)(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/p,1/p,g,-C/2,-I/2);const N=(0,l.MR)(this.pixelTransform);this.useContainer(t,N,this.getBackground(e));const B=this.context,U=B.canvas;(0,l.Av)(this.inversePixelTransform,this.pixelTransform),(0,l.Jn)(this.tempTransform,C/2,I/2,O,O,0,-C/2,-I/2),U.width!=C||U.height!=I?(U.width=C,U.height=I):this.containerReused||B.clearRect(0,0,C,I),v&&this.clipUnrotated(B,e,v),m.getInterpolate()||(B.imageSmoothingEnabled=!1),this.preRender(B,e),this.renderedTiles.length=0;let k,j,z,K=Object.keys(b).map(Number);K.sort(c.XE),1!==r.opacity||this.containerReused&&!m.getOpaque(e.viewState.projection)?(k=[],j=[]):K=K.reverse();for(let a=K.length-1;a>=0;--a){const t=K[a],r=m.getTilePixelSize(t,p,n),i=x.getResolution(t),s=i/y,o=r[0]*s*O,c=r[1]*s*O,d=x.getTileCoordForCoordAndZ((0,h.Iq)(F),t),g=x.getTileCoordExtent(d),f=(0,l.iQ)(this.tempTransform,[S*(g[0]-F[0])/y,S*(F[3]-g[3])/y]),T=S*m.getGutterForProjection(n),R=b[t];for(const n in R){const r=R[n],i=r.tileCoord,s=d[1]-i[1],a=Math.round(f[0]-(s-1)*o),l=d[2]-i[2],g=Math.round(f[1]-(l-1)*c),p=Math.round(f[0]-s*o),x=Math.round(f[1]-l*c),y=a-p,E=g-x,S=_===t,C=S&&1!==r.getAlpha((0,u.gV)(this),e.time);let I=!1;if(!C)if(k){z=[p,x,p+y,x,p+y,x+E,p,x+E];for(let e=0,r=k.length;e<r;++e)if(_!==t&&t<j[e]){const t=k[e];(0,h.K0)([p,x,p+y,x+E],[t[0],t[3],t[4],t[7]])&&(I||(B.save(),I=!0),B.beginPath(),B.moveTo(z[0],z[1]),B.lineTo(z[2],z[3]),B.lineTo(z[4],z[5]),B.lineTo(z[6],z[7]),B.moveTo(t[6],t[7]),B.lineTo(t[4],t[5]),B.lineTo(t[2],t[3]),B.lineTo(t[0],t[1]),B.clip())}k.push(z),j.push(t)}else B.clearRect(p,x,y,E);this.drawTileImage(r,e,p,x,y,E,T,S),k&&!C?(I&&B.restore(),this.renderedTiles.unshift(r)):this.renderedTiles.push(r),this.updateUsedTiles(e.usedTiles,m,r)}}return this.renderedRevision=T,this.renderedResolution=y,this.extentChanged=!this.renderedExtent_||!(0,h.yK)(this.renderedExtent_,F),this.renderedExtent_=F,this.renderedPixelRatio=p,this.renderedProjection=n,this.manageTilePyramid(e,m,x,p,n,R,_,f.getPreload()),this.scheduleExpireCache(e,m),this.postRender(B,e),r.extent&&B.restore(),B.imageSmoothingEnabled=!0,N!==U.style.transform&&(U.style.transform=N),this.container}drawTileImage(e,t,r,i,n,s,o,a){const l=this.getTileImage(e);if(!l)return;const c=(0,u.gV)(this),h=t.layerStatesArray[t.layerIndex],d=h.opacity*(a?e.getAlpha(c,t.time):1),g=d!==this.context.globalAlpha;g&&(this.context.save(),this.context.globalAlpha=d),this.context.drawImage(l,o,o,l.width-2*o,l.height-2*o,r,i,n,s),g&&this.context.restore(),d!==h.opacity?t.animate=!0:a&&e.endTransition(c)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}scheduleExpireCache(e,t){if(t.canExpireCache()){const r=function(e,t,r){const i=(0,u.gV)(e);i in r.usedTiles&&e.expireCache(r.viewState.projection,r.usedTiles[i])}.bind(null,t);e.postRenderFunctions.push(r)}}updateUsedTiles(e,t,r){const i=(0,u.gV)(t);i in e||(e[i]={}),e[i][r.getKey()]=!0}manageTilePyramid(e,t,r,i,n,s,o,l,c){const d=(0,u.gV)(t);d in e.wantedTiles||(e.wantedTiles[d]={});const g=e.wantedTiles[d],p=e.tileQueue,f=r.getMinZoom(),m=e.viewState.rotation,T=m?(0,h.Ux)(e.viewState.center,e.viewState.resolution,m,e.size):void 0;let x,_,y,R,E,S,C=0;for(S=f;S<=o;++S)for(_=r.getTileRangeForExtentAndZ(s,S,_),y=r.getResolution(S),R=_.minX;R<=_.maxX;++R)for(E=_.minY;E<=_.maxY;++E)m&&!r.tileCoordIntersectsViewport([S,R,E],T)||(o-S<=l?(++C,x=t.getTile(S,R,E,i,n),x.getState()==a.c.IDLE&&(g[x.getKey()]=!0,p.isKeyQueued(x.getKey())||p.enqueue([x,d,r.getTileCoordCenter(x.tileCoord),y])),void 0!==c&&c(x)):t.useTile(S,R,E,n));t.updateCacheSize(C,n)}}const f=p},22328:(e,t,r)=>{r.d(t,{c:()=>x});var i=r(2240),n=r(7172),s=r(84686),o=r(4400),a=r(39552),l=r(3540),c=r(1888),h=r(20176),d=r(3104),u=r(70080),g=r(38800),p=r(26440),f=r(80552),m=r(1360);class T extends n.c{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=(0,h.Gu)(),this.wrappedRenderedExtent_=(0,h.Gu)(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.declutterExecutorGroup=null,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(e,t,r){const i=t.extent,n=t.viewState,s=n.center,o=n.resolution,l=n.projection,c=n.rotation,d=l.getExtent(),u=this.getLayer().getSource(),g=t.pixelRatio,p=t.viewHints,f=!(p[a.c.ANIMATING]||p[a.c.INTERACTING]),m=this.compositionContext_,T=Math.round(t.size[0]*g),x=Math.round(t.size[1]*g),_=u.getWrapX()&&l.canWrapX(),y=_?(0,h.K6)(d):null,R=_?Math.ceil((i[2]-d[2])/y)+1:1;let E=_?Math.floor((i[0]-d[0])/y):0;do{const t=this.getRenderTransform(s,o,c,g,T,x,E*y);e.execute(m,1,t,c,f,void 0,r)}while(++E<R)}setupCompositionContext_(){if(1!==this.opacity_){const e=(0,d.OE)(this.context.canvas.width,this.context.canvas.height,n.k);this.compositionContext_=e}else this.compositionContext_=this.context}releaseCompositionContext_(){if(1!==this.opacity_){const e=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=e,(0,d.gR)(this.compositionContext_),n.k.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(e){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,e,e.declutterTree),this.releaseCompositionContext_())}renderFrame(e,t){const r=e.pixelRatio,i=e.layerStatesArray[e.layerIndex];(0,c.qQ)(this.pixelTransform,1/r,1/r),(0,c.Av)(this.inversePixelTransform,this.pixelTransform);const n=(0,c.MR)(this.pixelTransform);this.useContainer(t,n,this.getBackground(e));const s=this.context,a=s.canvas,l=this.replayGroup_,d=this.declutterExecutorGroup;let u=l&&!l.isEmpty()||d&&!d.isEmpty();if(!u){const e=this.getLayer().hasListener(o.c.PRERENDER)||this.getLayer().hasListener(o.c.POSTRENDER);if(!e)return null}const g=Math.round(e.size[0]*r),f=Math.round(e.size[1]*r);a.width!=g||a.height!=f?(a.width=g,a.height=f,a.style.transform!==n&&(a.style.transform=n)):this.containerReused||s.clearRect(0,0,g,f),this.preRender(s,e);const m=e.viewState,T=m.projection;this.opacity_=i.opacity,this.setupCompositionContext_();let x=!1;if(u&&i.extent&&this.clipping){const t=(0,p.fromUserExtent)(i.extent,T);u=(0,h.K0)(t,e.extent),x=u&&!(0,h.cP)(t,e.extent),x&&this.clipUnrotated(this.compositionContext_,e,t)}return u&&this.renderWorlds(l,e),x&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(s,e),this.renderedRotation_!==m.rotation&&(this.renderedRotation_=m.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(e){return new Promise((t=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const e=[this.context.canvas.width,this.context.canvas.height];(0,c.iQ)(this.pixelTransform,e);const t=this.renderedCenter_,r=this.renderedResolution_,i=this.renderedRotation_,n=this.renderedProjection_,s=this.wrappedRenderedExtent_,o=this.getLayer(),a=[],d=e[0]*l.y0,u=e[1]*l.y0;a.push(this.getRenderTransform(t,r,i,l.y0,d,u,0).slice());const g=o.getSource(),p=n.getExtent();if(g.getWrapX()&&n.canWrapX()&&!(0,h.cP)(p,s)){let e=s[0];const n=(0,h.K6)(p);let o,c=0;while(e<p[0])--c,o=n*c,a.push(this.getRenderTransform(t,r,i,l.y0,d,u,o).slice()),e+=n;c=0,e=s[2];while(e>p[2])++c,o=n*c,a.push(this.getRenderTransform(t,r,i,l.y0,d,u,o).slice()),e-=n}this.hitDetectionImageData_=(0,l.yk)(e,a,this.renderedFeatures_,o.getStyleFunction(),s,r,i)}t((0,l.g7)(e,this.renderedFeatures_,this.hitDetectionImageData_))}))}forEachFeatureAtCoordinate(e,t,r,i,n){if(!this.replayGroup_)return;const s=t.viewState.resolution,o=t.viewState.rotation,a=this.getLayer(),l={},c=function(e,t,r){const s=(0,f.gV)(e),o=l[s];if(o){if(!0!==o&&r<o.distanceSq){if(0===r)return l[s]=!0,n.splice(n.lastIndexOf(o),1),i(e,a,t);o.geometry=t,o.distanceSq=r}}else{if(0===r)return l[s]=!0,i(e,a,t);n.push(l[s]={feature:e,layer:a,geometry:t,distanceSq:r,callback:i})}};let h;const d=[this.replayGroup_];return this.declutterExecutorGroup&&d.push(this.declutterExecutorGroup),d.some((i=>h=i.forEachFeatureAtCoordinate(e,s,o,r,c,i===this.declutterExecutorGroup&&t.declutterTree?t.declutterTree.all().map((e=>e.value)):null))),h}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const t=this.getLayer(),r=t.getSource();if(!r)return!1;const n=e.viewHints[a.c.ANIMATING],o=e.viewHints[a.c.INTERACTING],l=t.getUpdateWhileAnimating(),c=t.getUpdateWhileInteracting();if(this.ready&&!l&&n||!c&&o)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const d=e.extent,f=e.viewState,T=f.projection,x=f.resolution,_=e.pixelRatio,y=t.getRevision(),R=t.getRenderBuffer();let E=t.getRenderOrder();void 0===E&&(E=u.WI);const S=f.center.slice(),C=(0,h.cz)(d,R*x),I=C.slice(),v=[C.slice()],w=T.getExtent();if(r.getWrapX()&&T.canWrapX()&&!(0,h.cP)(w,e.extent)){const e=(0,h.K6)(w),t=Math.max((0,h.K6)(C)/2,e);C[0]=w[0]-t,C[2]=w[2]+t,(0,m.c3)(S,T);const r=(0,h.c3)(v[0],T);r[0]<w[0]&&r[2]<w[2]?v.push([r[0]+e,r[1],r[2]+e,r[3]]):r[0]>w[0]&&r[2]>w[2]&&v.push([r[0]-e,r[1],r[2]-e,r[3]])}if(this.ready&&this.renderedResolution_==x&&this.renderedRevision_==y&&this.renderedRenderOrder_==E&&(0,h.cP)(this.wrappedRenderedExtent_,C))return(0,g.yK)(this.renderedExtent_,I)||(this.hitDetectionImageData_=null,this.renderedExtent_=I),this.renderedCenter_=S,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const P=new i.c((0,u.QH)(x,_),C,x,_);let F;this.getLayer().getDeclutter()&&(F=new i.c((0,u.QH)(x,_),C,x,_));const A=(0,p.getUserProjection)();let b;if(A){for(let e=0,t=v.length;e<t;++e){const t=v[e],i=(0,p.toUserExtent)(t,T);r.loadFeatures(i,(0,p.toUserResolution)(x,T),A)}b=(0,p.getTransformFromProjections)(A,T)}else for(let i=0,s=v.length;i<s;++i)r.loadFeatures(v[i],x,T);const D=(0,u.ii)(x,_);let L=!0;const M=e=>{let r;const i=e.getStyleFunction()||t.getStyleFunction();if(i&&(r=i(e,x)),r){const t=this.renderFeature(e,D,r,P,b,F);L=L&&!t}},G=(0,p.toUserExtent)(C,T),O=r.getFeaturesInExtent(G);E&&O.sort(E);for(let i=0,s=O.length;i<s;++i)M(O[i]);this.renderedFeatures_=O,this.ready=L;const N=P.finish(),B=new s.c(C,x,_,r.getOverlaps(),N,t.getRenderBuffer());return F&&(this.declutterExecutorGroup=new s.c(C,x,_,r.getOverlaps(),F.finish(),t.getRenderBuffer())),this.renderedResolution_=x,this.renderedRevision_=y,this.renderedRenderOrder_=E,this.renderedExtent_=I,this.wrappedRenderedExtent_=C,this.renderedCenter_=S,this.renderedProjection_=T,this.replayGroup_=B,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,r,i,n,s){if(!r)return!1;let o=!1;if(Array.isArray(r))for(let a=0,l=r.length;a<l;++a)o=(0,u.Uf)(i,e,r[a],t,this.boundHandleStyleImageChange_,n,s)||o;else o=(0,u.Uf)(i,e,r,t,this.boundHandleStyleImageChange_,n,s);return o}}const x=T},29988:(e,t,r)=>{r.d(t,{c:()=>x});var i=r(2240),n=r(84686),s=r(43256),o=r(65004),a=r(39552),l=r(3540),c=r(1888),h=r(20176),d=r(70080),u=r(80552),g=r(15660),p=r(1360);const f={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},m={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class T extends s.c{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.tmpTransform_=(0,c.Su)()}prepareTile(e,t,r){let i;const n=e.getState();return n!==o.c.LOADED&&n!==o.c.ERROR||(this.updateExecutorGroup_(e,t,r),this.tileImageNeedsRender_(e)&&(i=!0)),i}getTile(e,t,r,i){const n=i.pixelRatio,s=i.viewState,o=s.resolution,l=s.projection,c=this.getLayer(),h=c.getSource().getTile(e,t,r,n,l),d=i.viewHints,u=!(d[a.c.ANIMATING]||d[a.c.INTERACTING]);!u&&h.wantedResolution||(h.wantedResolution=o);const g=this.prepareTile(h,n,l);return g&&(u||Date.now()-i.time<8)&&"vector"!==c.getRenderMode()&&this.renderTileImage_(h,i),super.getTile(e,t,r,i)}isDrawableTile(e){const t=this.getLayer();return super.isDrawableTile(e)&&("vector"===t.getRenderMode()?(0,u.gV)(t)in e.executorGroups:e.hasContext(t))}getTileImage(e){return e.getImage(this.getLayer())}prepareFrame(e){const t=this.getLayer().getRevision();return this.renderedLayerRevision_!==t&&(this.renderedLayerRevision_=t,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,t,r){const s=this.getLayer(),a=s.getRevision(),l=s.getRenderOrder()||null,c=e.wantedResolution,g=e.getReplayState(s);if(!g.dirty&&g.renderedResolution===c&&g.renderedRevision==a&&g.renderedRenderOrder==l)return;const p=s.getSource(),f=s.getDeclutter(),m=p.getTileGrid(),T=p.getTileGridForProjection(r),x=T.getTileCoordExtent(e.wrappedTileCoord),_=p.getSourceTiles(t,r,e),y=(0,u.gV)(s);delete e.hitDetectionImageData[y],e.executorGroups[y]=[],f&&(e.declutterExecutorGroups[y]=[]),g.dirty=!1;for(let u=0,R=_.length;u<R;++u){const r=_[u];if(r.getState()!=o.c.LOADED)continue;const a=r.tileCoord,T=m.getTileCoordExtent(a),R=(0,h.ii)(x,T),E=(0,h.cz)(R,s.getRenderBuffer()*c,this.tmpExtent),S=(0,h.yK)(T,R)?null:E,C=new i.c(0,E,c,t),I=f?new i.c(0,R,c,t):void 0,v=(0,d.ii)(c,t),w=function(e){let t;const r=e.getStyleFunction()||s.getStyleFunction();if(r&&(t=r(e,c)),t){const r=this.renderFeature(e,v,t,C,I);g.dirty=g.dirty||r}},P=r.getFeatures();l&&l!==g.renderedRenderOrder&&P.sort(l);for(let e=0,t=P.length;e<t;++e){const t=P[e];S&&!(0,h.K0)(S,t.getGeometry().getExtent())||w.call(this,t)}const F=C.finish(),A="vector"!==s.getRenderMode()&&f&&1===_.length?null:R,b=new n.c(A,c,t,p.getOverlaps(),F,s.getRenderBuffer());if(e.executorGroups[y].push(b),I){const r=new n.c(null,c,t,p.getOverlaps(),I.finish(),s.getRenderBuffer());e.declutterExecutorGroups[y].push(r)}}g.renderedRevision=a,g.renderedRenderOrder=l,g.renderedResolution=c}forEachFeatureAtCoordinate(e,t,r,i,n){const s=t.viewState.resolution,o=t.viewState.rotation;r=void 0==r?0:r;const a=this.getLayer(),l=a.getSource(),c=l.getTileGridForProjection(t.viewState.projection),d=(0,h.cj)([e]);(0,h.cz)(d,s*r,d);const g={},p=function(e,t,r){let s=e.getId();void 0===s&&(s=(0,u.gV)(e));const o=g[s];if(o){if(!0!==o&&r<o.distanceSq){if(0===r)return g[s]=!0,n.splice(n.lastIndexOf(o),1),i(e,a,t);o.geometry=t,o.distanceSq=r}}else{if(0===r)return g[s]=!0,i(e,a,t);n.push(g[s]={feature:e,layer:a,geometry:t,distanceSq:r,callback:i})}},f=this.renderedTiles;let m;for(let T=0,x=f.length;!m&&T<x;++T){const i=f[T],n=c.getTileCoordExtent(i.wrappedTileCoord);if(!(0,h.K0)(n,d))continue;const l=(0,u.gV)(a),g=[i.executorGroups[l]],x=i.declutterExecutorGroups[l];x&&g.push(x),g.some((i=>{const n=i===x?t.declutterTree.all().map((e=>e.value)):null;for(let t=0,a=i.length;t<a;++t){const a=i[t];if(m=a.forEachFeatureAtCoordinate(e,s,o,r,p,n),m)return!0}}))}return m}getFeatures(e){return new Promise(((t,r)=>{const i=this.getLayer(),n=(0,u.gV)(i),s=i.getSource(),a=this.renderedProjection,d=a.getExtent(),f=this.renderedResolution,m=s.getTileGridForProjection(a),T=(0,c.iQ)(this.renderedPixelToCoordinateTransform_,e.slice()),x=m.getTileCoordForCoordAndResolution(T,f);let _;for(let e=0,l=this.renderedTiles.length;e<l;++e)if(x.toString()===this.renderedTiles[e].tileCoord.toString()){if(_=this.renderedTiles[e],_.getState()===o.c.LOADED){const e=m.getTileCoordExtent(_.tileCoord);s.getWrapX()&&a.canWrapX()&&!(0,h.cP)(d,e)&&(0,p.c3)(T,a);break}_=void 0}if(!_||_.loadingSourceTiles>0)return void t([]);const y=m.getTileCoordExtent(_.wrappedTileCoord),R=(0,h.Iq)(y),E=[(T[0]-R[0])/f,(R[1]-T[1])/f],S=_.getSourceTiles().reduce((function(e,t){return e.concat(t.getFeatures())}),[]);let C=_.hitDetectionImageData[n];if(!C){const e=(0,g._2)(m.getTileSize(m.getZForResolution(f,s.zDirection))),t=this.renderedRotation_,r=[this.getRenderTransform(m.getTileCoordCenter(_.wrappedTileCoord),f,0,l.y0,e[0]*l.y0,e[1]*l.y0,0)];C=(0,l.yk)(e,r,S,i.getStyleFunction(),m.getTileCoordExtent(_.wrappedTileCoord),_.getReplayState(i).renderedResolution,t),_.hitDetectionImageData[n]=C}t((0,l.g7)(E,S,C))}))}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&void 0!==this.renderedLayerRevision_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e){const t=this.context,r=t.globalAlpha;t.globalAlpha=this.getLayer().getOpacity();const i=e.viewHints,n=!(i[a.c.ANIMATING]||i[a.c.INTERACTING]),s=this.renderedTiles;for(let o=0,a=s.length;o<a;++o){const t=s[o],r=t.declutterExecutorGroups[(0,u.gV)(this.getLayer())];if(r)for(let i=r.length-1;i>=0;--i)r[i].execute(this.context,1,this.getTileRenderTransform(t,e),e.viewState.rotation,n,void 0,e.declutterTree)}t.globalAlpha=r}getTileRenderTransform(e,t){const r=t.pixelRatio,i=t.viewState,n=i.center,s=i.resolution,o=i.rotation,a=t.size,l=Math.round(a[0]*r),h=Math.round(a[1]*r),d=this.getLayer().getSource(),u=d.getTileGridForProjection(t.viewState.projection),g=e.tileCoord,p=u.getTileCoordExtent(e.wrappedTileCoord),f=u.getTileCoordExtent(g,this.tmpExtent)[0]-p[0],m=(0,c.iW)((0,c.aU)(this.inversePixelTransform.slice(),1/r,1/r),this.getRenderTransform(n,s,o,r,l,h,f));return m}postRender(e,t){const r=t.viewHints,i=!(r[a.c.ANIMATING]||r[a.c.INTERACTING]);this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation;const n=this.getLayer(),s=n.getRenderMode(),o=e.globalAlpha;e.globalAlpha=n.getOpacity();const l=m[s],c=t.viewState,d=c.rotation,g=n.getSource(),p=g.getTileGridForProjection(c.projection),f=p.getZForResolution(c.resolution,g.zDirection),T=this.renderedTiles,x=[],_=[];let y=!0;for(let a=T.length-1;a>=0;--a){const r=T[a];y=y&&!r.getReplayState(n).dirty;const s=r.executorGroups[(0,u.gV)(n)].filter((e=>e.hasExecutors(l)));if(0===s.length)continue;const o=this.getTileRenderTransform(r,t),c=r.tileCoord[0];let g=!1;const p=s[0].getClipCoords(o);if(p){for(let t=0,r=x.length;t<r;++t)if(f!==c&&c<_[t]){const r=x[t];(0,h.K0)([p[0],p[3],p[4],p[7]],[r[0],r[3],r[4],r[7]])&&(g||(e.save(),g=!0),e.beginPath(),e.moveTo(p[0],p[1]),e.lineTo(p[2],p[3]),e.lineTo(p[4],p[5]),e.lineTo(p[6],p[7]),e.moveTo(r[6],r[7]),e.lineTo(r[4],r[5]),e.lineTo(r[2],r[3]),e.lineTo(r[0],r[1]),e.clip())}x.push(p),_.push(c)}for(let t=0,n=s.length;t<n;++t){const r=s[t];r.execute(e,1,o,d,i,l)}g&&e.restore()}e.globalAlpha=o,this.ready=y,super.postRender(e,t)}renderFeature(e,t,r,i,n){if(!r)return!1;let s=!1;if(Array.isArray(r))for(let o=0,a=r.length;o<a;++o)s=(0,d.Uf)(i,e,r[o],t,this.boundHandleStyleImageChange_,void 0,n)||s;else s=(0,d.Uf)(i,e,r,t,this.boundHandleStyleImageChange_,void 0,n);return s}tileImageNeedsRender_(e){const t=this.getLayer();if("vector"===t.getRenderMode())return!1;const r=e.getReplayState(t),i=t.getRevision(),n=e.wantedResolution;return r.renderedTileResolution!==n||r.renderedTileRevision!==i}renderTileImage_(e,t){const r=this.getLayer(),i=e.getReplayState(r),n=r.getRevision(),s=e.executorGroups[(0,u.gV)(r)];i.renderedTileRevision=n;const o=e.wrappedTileCoord,a=o[0],l=r.getSource();let h=t.pixelRatio;const d=t.viewState,g=d.projection,p=l.getTileGridForProjection(g),m=p.getResolution(e.tileCoord[0]),T=t.pixelRatio/e.wantedResolution*m,x=p.getResolution(a),_=e.getContext(r);h=Math.round(Math.max(h,T/h));const y=l.getTilePixelSize(a,h,g);_.canvas.width=y[0],_.canvas.height=y[1];const R=h/T;if(1!==R){const e=(0,c.a_)(this.tmpTransform_);(0,c.aU)(e,R,R),_.setTransform.apply(_,e)}const E=p.getTileCoordExtent(o,this.tmpExtent),S=T/x,C=(0,c.a_)(this.tmpTransform_);(0,c.aU)(C,S,-S),(0,c.GS)(C,-E[0],-E[3]);for(let c=0,u=s.length;c<u;++c){const e=s[c];e.execute(_,R,C,0,!0,f[r.getRenderMode()])}i.renderedTileResolution=e.wantedResolution}}const x=T},70080:(e,t,r)=>{r.d(t,{QH:()=>c,Uf:()=>d,WI:()=>a,ii:()=>l});var i=r(48356),n=r(80552);const s=.5,o={Point:x,LineString:f,Polygon:y,MultiPoint:_,MultiLineString:m,MultiPolygon:T,GeometryCollection:p,Circle:h};function a(e,t){return parseInt((0,n.gV)(e),10)-parseInt((0,n.gV)(t),10)}function l(e,t){const r=c(e,t);return r*r}function c(e,t){return s*e/t}function h(e,t,r,i,n){const s=r.getFill(),o=r.getStroke();if(s||o){const n=e.getBuilder(r.getZIndex(),"Circle");n.setFillStrokeStyle(s,o),n.drawCircle(t,i)}const a=r.getText();if(a&&a.getText()){const s=(n||e).getBuilder(r.getZIndex(),"Text");s.setTextStyle(a),s.drawText(t,i)}}function d(e,t,r,n,s,o,a){let l=!1;const c=r.getImage();if(c){const e=c.getImageState();e==i.c.LOADED||e==i.c.ERROR?c.unlistenImageChange(s):(e==i.c.IDLE&&c.load(),c.listenImageChange(s),l=!0)}return u(e,t,r,n,o,a),l}function u(e,t,r,i,n,s){const a=r.getGeometryFunction()(t);if(!a)return;const l=a.simplifyTransformed(i,n),c=r.getRenderer();if(c)g(e,l,r,t);else{const i=o[l.getType()];i(e,l,r,t,s)}}function g(e,t,r,i){if("GeometryCollection"==t.getType()){const n=t.getGeometries();for(let t=0,s=n.length;t<s;++t)g(e,n[t],r,i);return}const n=e.getBuilder(r.getZIndex(),"Default");n.drawCustom(t,i,r.getRenderer(),r.getHitDetectionRenderer())}function p(e,t,r,i,n){const s=t.getGeometriesArray();let a,l;for(a=0,l=s.length;a<l;++a){const t=o[s[a].getType()];t(e,s[a],r,i,n)}}function f(e,t,r,i,n){const s=r.getStroke();if(s){const n=e.getBuilder(r.getZIndex(),"LineString");n.setFillStrokeStyle(null,s),n.drawLineString(t,i)}const o=r.getText();if(o&&o.getText()){const s=(n||e).getBuilder(r.getZIndex(),"Text");s.setTextStyle(o),s.drawText(t,i)}}function m(e,t,r,i,n){const s=r.getStroke();if(s){const n=e.getBuilder(r.getZIndex(),"LineString");n.setFillStrokeStyle(null,s),n.drawMultiLineString(t,i)}const o=r.getText();if(o&&o.getText()){const s=(n||e).getBuilder(r.getZIndex(),"Text");s.setTextStyle(o),s.drawText(t,i)}}function T(e,t,r,i,n){const s=r.getFill(),o=r.getStroke();if(o||s){const n=e.getBuilder(r.getZIndex(),"Polygon");n.setFillStrokeStyle(s,o),n.drawMultiPolygon(t,i)}const a=r.getText();if(a&&a.getText()){const s=(n||e).getBuilder(r.getZIndex(),"Text");s.setTextStyle(a),s.drawText(t,i)}}function x(e,t,r,n,s){const o=r.getImage(),a=r.getText();let l;if(o){if(o.getImageState()!=i.c.LOADED)return;let c=e;if(s){const i=o.getDeclutterMode();if("none"!==i)if(c=s,"obstacle"===i){const i=e.getBuilder(r.getZIndex(),"Image");i.setImageStyle(o,l),i.drawPoint(t,n)}else a&&a.getText()&&(l={})}const h=c.getBuilder(r.getZIndex(),"Image");h.setImageStyle(o,l),h.drawPoint(t,n)}if(a&&a.getText()){let i=e;s&&(i=s);const o=i.getBuilder(r.getZIndex(),"Text");o.setTextStyle(a,l),o.drawText(t,n)}}function _(e,t,r,n,s){const o=r.getImage(),a=r.getText();let l;if(o){if(o.getImageState()!=i.c.LOADED)return;let c=e;if(s){const i=o.getDeclutterMode();if("none"!==i)if(c=s,"obstacle"===i){const i=e.getBuilder(r.getZIndex(),"Image");i.setImageStyle(o,l),i.drawMultiPoint(t,n)}else a&&a.getText()&&(l={})}const h=c.getBuilder(r.getZIndex(),"Image");h.setImageStyle(o,l),h.drawMultiPoint(t,n)}if(a&&a.getText()){let i=e;s&&(i=s);const o=i.getBuilder(r.getZIndex(),"Text");o.setTextStyle(a,l),o.drawText(t,n)}}function y(e,t,r,i,n){const s=r.getFill(),o=r.getStroke();if(s||o){const n=e.getBuilder(r.getZIndex(),"Polygon");n.setFillStrokeStyle(s,o),n.drawPolygon(t,i)}const a=r.getText();if(a&&a.getText()){const s=(n||e).getBuilder(r.getZIndex(),"Text");s.setTextStyle(a),s.drawText(t,i)}}},75684:(e,t,r)=>{r.d(t,{c:()=>h});var i=r(48216),n=r(98760),s=r(668),o=r(4400),a=r(98776),l=r(1888);class c extends n.c{constructor(e,t){super(e),t=t||{},this.inversePixelTransform_=(0,l.Su)(),this.pixelContext_=null,this.postProcesses_=t.postProcesses,this.uniforms_=t.uniforms,this.helper,e.addChangeListener(i.c.MAP,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(e,t){const r=this.getLayer();if(r.hasListener(o.c.PRECOMPOSE)){const i=new s.c(o.c.PRECOMPOSE,void 0,t,e);r.dispatchEvent(i)}}dispatchPostComposeEvent(e,t){const r=this.getLayer();if(r.hasListener(o.c.POSTCOMPOSE)){const i=new s.c(o.c.POSTCOMPOSE,void 0,t,e);r.dispatchEvent(i)}}reset(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(e){if(this.getLayer().getRenderSource()){let t,r=!0,i=-1;for(let s=0,o=e.layerStatesArray.length;s<o;s++){const n=e.layerStatesArray[s].layer,o=n.getRenderer();if(!(o instanceof c)){r=!0;continue}const a=n.getClassName();if((r||a!==t)&&(i+=1,r=!1),t=a,o===this)break}const n="map/"+e.mapId+"/group/"+i;this.helper&&this.helper.canvasCacheKeyMatches(n)||(this.removeHelper(),this.helper=new a.cp({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:n}),t&&(this.helper.getCanvas().className=t),this.afterHelperCreated())}return this.prepareFrameInternal(e)}afterHelperCreated(){}prepareFrameInternal(e){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(e,t,r){const i=this.getLayer();if(i.hasListener(e)){(0,l.Jn)(this.inversePixelTransform_,0,0,r.pixelRatio,-r.pixelRatio,0,0,-r.size[1]);const n=new s.c(e,this.inversePixelTransform_,r,t);i.dispatchEvent(n)}}preRender(e,t){this.dispatchRenderEvent_(o.c.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(o.c.POSTRENDER,e,t)}}const h=c},29740:(e,t,r)=>{r.d(t,{c:()=>R});var i=r(9796),n=r(38620),s=r(39552),o=r(87952),a=r(75684),l=r(61464),c=r(32496),h=r(98776);const d={GENERATE_POLYGON_BUFFERS:"GENERATE_POLYGON_BUFFERS",GENERATE_POINT_BUFFERS:"GENERATE_POINT_BUFFERS",GENERATE_LINE_STRING_BUFFERS:"GENERATE_LINE_STRING_BUFFERS"};var u=r(1888),g=r(35192),p=r(20176);r(41948);function f(e,t){t=t||[];const r=256,i=r-1;return t[0]=Math.floor(e/r/r/r)/i,t[1]=Math.floor(e/r/r)%r/i,t[2]=Math.floor(e/r)%r/i,t[3]=e%r/i,t}function m(e){let t=0;const r=256,i=r-1;return t+=Math.round(e[0]*r*r*r*i),t+=Math.round(e[1]*r*r*i),t+=Math.round(e[2]*r*i),t+=Math.round(e[3]*i),t}var T=r(95064),x=r(80552),_=r(83096);class y extends a.c{constructor(e,t){const r=t.uniforms||{},i=(0,u.Su)();r[h.PJ.PROJECTION_MATRIX]=i,super(e,{uniforms:r,postProcesses:t.postProcesses}),this.sourceRevision_=-1,this.verticesBuffer_=new o.cp(c.Uk,c.ey),this.indicesBuffer_=new o.cp(c.oN,c.ey),this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.program_,this.hitDetectionEnabled_=t.hitDetectionEnabled??!0;const s=t.attributes?t.attributes.map((function(e){return{name:"a_"+e.name,size:1,type:h.KS.FLOAT}})):[];this.attributes=[{name:"a_position",size:2,type:h.KS.FLOAT},{name:"a_index",size:1,type:h.KS.FLOAT}],this.hitDetectionEnabled_&&(this.attributes.push({name:"a_hitColor",size:4,type:h.KS.FLOAT}),this.attributes.push({name:"a_featureUid",size:1,type:h.KS.FLOAT})),this.attributes.push(...s),this.customAttributes=t.attributes?t.attributes:[],this.previousExtent_=(0,p.Gu)(),this.currentTransform_=i,this.renderTransform_=(0,u.Su)(),this.invertRenderTransform_=(0,u.Su)(),this.renderInstructions_=new Float32Array(0),this.hitRenderTarget_,this.lastSentId=0,this.worker_=(0,T.S)(),this.worker_.addEventListener("message",(e=>{const t=e.data;if(t.type===d.GENERATE_POINT_BUFFERS){const r=t.projectionTransform;this.verticesBuffer_.fromArrayBuffer(t.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_),this.indicesBuffer_.fromArrayBuffer(t.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=r,(0,u.Av)(this.invertRenderTransform_,this.renderTransform_),this.renderInstructions_=new Float32Array(e.data.renderInstructions),t.id===this.lastSentId&&(this.ready=!0),this.getLayer().changed()}})),this.featureCache_={},this.featureCount_=0;const a=this.getLayer().getSource();this.sourceListenKeys_=[(0,_.IT)(a,n.c.ADDFEATURE,this.handleSourceFeatureAdded_,this),(0,_.IT)(a,n.c.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),(0,_.IT)(a,n.c.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),(0,_.IT)(a,n.c.CLEAR,this.handleSourceFeatureClear_,this)],a.forEachFeature((e=>{this.featureCache_[(0,x.gV)(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()},this.featureCount_++}))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new l.c(this.helper))}handleSourceFeatureAdded_(e){const t=e.feature;this.featureCache_[(0,x.gV)(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()},this.featureCount_++}handleSourceFeatureChanged_(e){const t=e.feature;this.featureCache_[(0,x.gV)(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()}}handleSourceFeatureDelete_(e){const t=e.feature;delete this.featureCache_[(0,x.gV)(t)],this.featureCount_--}handleSourceFeatureClear_(){this.featureCache_={},this.featureCount_=0}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e);const[r,i,n]=this.getWorldParameters_(e);this.renderWorlds(e,!1,r,i,n),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const s=this.helper.getCanvas();return this.hitDetectionEnabled_&&(this.renderWorlds(e,!0,r,i,n),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e),s}getWorldParameters_(e){const t=e.viewState.projection,r=this.getLayer(),i=r.getSource(),n=i.getWrapX()&&t.canWrapX(),s=t.getExtent(),o=e.extent,a=n?(0,p.K6)(s):null,l=n?Math.ceil((o[2]-s[2])/a)+1:1,c=n?Math.floor((o[0]-s[0])/a):0;return[c,l,a]}prepareFrameInternal(e){const t=this.getLayer(),r=t.getSource(),n=e.viewState,o=!e.viewHints[s.c.ANIMATING]&&!e.viewHints[s.c.INTERACTING],a=!(0,p.yK)(this.previousExtent_,e.extent),l=this.sourceRevision_<r.getRevision();if(l&&(this.sourceRevision_=r.getRevision()),o&&(a||l)){const s=n.projection,o=n.resolution,a=t instanceof i.c?t.getRenderBuffer():0,l=(0,p.cz)(e.extent,a*o);r.loadFeatures(l,o,s),this.rebuildBuffers_(e),this.previousExtent_=e.extent.slice()}return this.helper.useProgram(this.program_,e),this.helper.prepareDraw(e),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0}rebuildBuffers_(e){const t=(0,u.Su)();this.helper.makeProjectionTransform(e,t);const r=this.hitDetectionEnabled_?7:2,i=r+this.customAttributes.length,n=i*this.featureCount_;let s,o;this.renderInstructions_&&this.renderInstructions_.length===n||(this.renderInstructions_=new Float32Array(n));const a=[],l=[];let c=-1;for(const d in this.featureCache_)if(s=this.featureCache_[d],o=s.geometry,o&&"Point"===o.getType()){if(a[0]=o.getFlatCoordinates()[0],a[1]=o.getFlatCoordinates()[1],(0,u.iQ)(t,a),this.renderInstructions_[++c]=a[0],this.renderInstructions_[++c]=a[1],this.hitDetectionEnabled_){const e=f(c+5,l);this.renderInstructions_[++c]=e[0],this.renderInstructions_[++c]=e[1],this.renderInstructions_[++c]=e[2],this.renderInstructions_[++c]=e[3],this.renderInstructions_[++c]=Number(d)}for(let e=0;e<this.customAttributes.length;e++){const t=this.customAttributes[e].callback(s.feature,s.properties);this.renderInstructions_[++c]=t}}const h={id:++this.lastSentId,type:d.GENERATE_POINT_BUFFERS,renderInstructions:this.renderInstructions_.buffer,customAttributesSize:i-2};h["projectionTransform"]=t,this.ready=!1,this.worker_.postMessage(h,[this.renderInstructions_.buffer]),this.renderInstructions_=null}forEachFeatureAtCoordinate(e,t,r,i,n){if((0,g.U)(this.hitDetectionEnabled_,66),!this.renderInstructions_||!this.hitDetectionEnabled_)return;const s=(0,u.iQ)(t.coordinateToPixelTransform,e.slice()),o=this.hitRenderTarget_.readPixel(s[0]/2,s[1]/2),a=[o[0]/255,o[1]/255,o[2]/255,o[3]/255],l=m(a),c=this.renderInstructions_[l],h=Math.floor(c).toString(),d=this.getLayer().getSource(),p=d.getFeatureByUid(h);return p?i(p,this.getLayer(),null):void 0}renderWorlds(e,t,r,i,n){let s=r;this.helper.useProgram(this.program_,e),t&&(this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0)),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes);do{this.helper.makeProjectionTransform(e,this.currentTransform_),(0,u.GS)(this.currentTransform_,s*n,0),(0,u.iW)(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(e),this.helper.applyHitDetectionUniform(t);const r=this.indicesBuffer_.getSize();this.helper.drawElements(0,r)}while(++s<i)}disposeInternal(){this.worker_.terminate(),this.layer_=null,this.sourceListenKeys_.forEach((function(e){(0,_.Si)(e)})),this.sourceListenKeys_=null,super.disposeInternal()}}const R=y}}]);
//# sourceMappingURL=2896.2f7a16a1.js.map