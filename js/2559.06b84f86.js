"use strict";(globalThis["webpackChunk_openeo_web_editor"]=globalThis["webpackChunk_openeo_web_editor"]||[]).push([[2559],{69796:(e,t,r)=>{r.d(t,{A:()=>d});var i=r(96769),n=r(6141),s=r(62703),o=r(9703),a=r(70915),l=r(89718);class h extends i.A{constructor(e){super(e),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],r=e.pixelRatio,i=e.viewState,o=i.resolution,h=this.getLayer().getSource(),d=e.viewHints;let c=e.extent;if(void 0!==t.extent&&(c=(0,a._N)(c,(0,l.fromUserExtent)(t.extent,i.projection))),!d[s.A.ANIMATING]&&!d[s.A.INTERACTING]&&!(0,a.Im)(c))if(h){const e=i.projection,t=h.getImage(c,o,r,e);t&&(this.loadImage(t)?this.image_=t:t.getState()===n.A.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(e){const t=this.frameState;if(!t)return null;const r=this.getLayer(),i=(0,o.Bb)(t.pixelToCoordinateTransform,e.slice()),n=r.getExtent();if(n&&!(0,a.Ym)(n,i))return null;const s=this.image_.getExtent(),l=this.image_.getImage(),h=(0,a.RG)(s),d=Math.floor(l.width*((i[0]-s[0])/h));if(d<0||d>=l.width)return null;const c=(0,a.Oq)(s),u=Math.floor(l.height*((s[3]-i[1])/c));return u<0||u>=l.height?null:this.getImageData(l,d,u)}renderFrame(e,t){const r=this.image_,i=r.getExtent(),n=r.getResolution(),[s,h]=Array.isArray(n)?n:[n,n],d=r.getPixelRatio(),c=e.layerStatesArray[e.layerIndex],u=e.pixelRatio,g=e.viewState,p=g.center,f=g.resolution,T=u*s/(f*d),m=u*h/(f*d);this.prepareContainer(e,t);const _=this.context.canvas.width,x=this.context.canvas.height,R=this.getRenderContext(e);let y=!1,v=!0;if(c.extent){const t=(0,l.fromUserExtent)(c.extent,g.projection);v=(0,a.HY)(t,e.extent),y=v&&!(0,a.ms)(t,e.extent),y&&this.clipUnrotated(R,e,t)}const E=r.getImage(),S=(0,o.Zz)(this.tempTransform,_/2,x/2,T,m,0,d*(i[0]-p[0])/s,d*(p[1]-i[3])/h);this.renderedResolution=h*u/d;const C=E.width*S[0],A=E.height*S[3];if(this.getLayer().getSource().getInterpolate()||(R.imageSmoothingEnabled=!1),this.preRender(R,e),v&&C>=.5&&A>=.5){const e=S[4],t=S[5],r=c.opacity;1!==r&&(R.save(),R.globalAlpha=r),R.drawImage(E,0,0,+E.width,+E.height,e,t,C,A),1!==r&&R.restore()}return this.postRender(this.context,e),y&&R.restore(),R.imageSmoothingEnabled=!0,this.container}}const d=h},96769:(e,t,r)=>{r.d(t,{A:()=>T,B:()=>u});var i=r(5986),n=r(9960),s=r(83984),o=r(40808),a=r(9703),l=r(89352),h=r(68711),d=r(66514),c=r(70915);const u=[];let g=null;function p(){g=(0,h.Y)(1,1,void 0,{willReadFrequently:!0})}class f extends i.A{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=(0,a.vt)(),this.pixelTransform=(0,a.vt)(),this.inversePixelTransform=(0,a.vt)(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(e,t,r){let i;g||p(),g.clearRect(0,0,1,1);try{g.drawImage(e,t,r,1,1,0,0,1,1),i=g.getImageData(0,0,1,1).data}catch(n){return g=null,null}return i}getBackground(e){const t=this.getLayer();let r=t.getBackground();return"function"===typeof r&&(r=r(e.viewState.resolution)),r||void 0}useContainer(e,t,r){const i=this.getLayer().getClassName();let n,s;if(e&&e.className===i&&(!r||e&&e.style.backgroundColor&&(0,d.aI)((0,l._j)(e.style.backgroundColor),(0,l._j)(r)))){const t=e.firstElementChild;t instanceof HTMLCanvasElement&&(s=t.getContext("2d"))}if(s&&s.canvas.style.transform===t?(this.container=e,this.context=s,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){n=document.createElement("div"),n.className=i;let e=n.style;e.position="absolute",e.width="100%",e.height="100%",s=(0,h.Y)();const t=s.canvas;n.appendChild(t),e=t.style,e.position="absolute",e.left="0",e.transformOrigin="top left",this.container=n,this.context=s}this.containerReused||!r||this.container.style.backgroundColor||(this.container.style.backgroundColor=r)}clipUnrotated(e,t,r){const i=(0,c.Py)(r),n=(0,c.WU)(r),s=(0,c.k_)(r),o=(0,c.R)(r);(0,a.Bb)(t.coordinateToPixelTransform,i),(0,a.Bb)(t.coordinateToPixelTransform,n),(0,a.Bb)(t.coordinateToPixelTransform,s),(0,a.Bb)(t.coordinateToPixelTransform,o);const l=this.inversePixelTransform;(0,a.Bb)(l,i),(0,a.Bb)(l,n),(0,a.Bb)(l,s),(0,a.Bb)(l,o),e.save(),e.beginPath(),e.moveTo(Math.round(i[0]),Math.round(i[1])),e.lineTo(Math.round(n[0]),Math.round(n[1])),e.lineTo(Math.round(s[0]),Math.round(s[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.clip()}prepareContainer(e,t){const r=e.extent,i=e.viewState.resolution,n=e.viewState.rotation,s=e.pixelRatio,o=Math.round((0,c.RG)(r)/i*s),l=Math.round((0,c.Oq)(r)/i*s);(0,a.Zz)(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/s,1/s,n,-o/2,-l/2),(0,a.T9)(this.inversePixelTransform,this.pixelTransform);const h=(0,a.dI)(this.pixelTransform);if(this.useContainer(t,h,this.getBackground(e)),!this.containerReused){const e=this.context.canvas;e.width!=o||e.height!=l?(e.width=o,e.height=l):this.context.clearRect(0,0,o,l),h!==e.style.transform&&(e.style.transform=h)}}dispatchRenderEvent_(e,t,r){const i=this.getLayer();if(i.hasListener(e)){const s=new n.A(e,this.inversePixelTransform,r,t);i.dispatchEvent(s)}}preRender(e,t){this.frameState=t,t.declutter||this.dispatchRenderEvent_(s.A.PRERENDER,e,t)}postRender(e,t){t.declutter||this.dispatchRenderEvent_(s.A.POSTRENDER,e,t)}renderDeferredInternal(e){}getRenderContext(e){return e.declutter&&!this.deferredContext_&&(this.deferredContext_=new o.A),e.declutter?this.deferredContext_.getContext():this.context}renderDeferred(e){e.declutter&&(this.dispatchRenderEvent_(s.A.PRERENDER,this.context,e),e.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(e),this.dispatchRenderEvent_(s.A.POSTRENDER,this.context,e))}getRenderTransform(e,t,r,i,n,s,o){const l=n/2,h=s/2,d=i/t,c=-d,u=-e[0]+o,g=-e[1];return(0,a.Zz)(this.tempTransform,l,h,d,c,-r,u,g)}disposeInternal(){delete this.frameState,super.disposeInternal()}}const T=f},24029:(e,t,r)=>{r.d(t,{A:()=>f});var i=r(96769),n=r(40190),s=r(97404),o=r(91110),a=r(11078),l=r(9703),h=r(66514),d=r(70915),c=r(89718),u=r(4087),g=r(6782);class p extends i.A{constructor(e){super(e),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=(0,d.S5)(),this.tmpTileRange_=new o.A(0,0,0,0)}isDrawableTile(e){const t=this.getLayer(),r=e.getState(),i=t.getUseInterimTilesOnError();return r==a.A.LOADED||r==a.A.EMPTY||r==a.A.ERROR&&!i}getTile(e,t,r,i){const n=i.pixelRatio,s=i.viewState.projection,o=this.getLayer(),l=o.getSource();let h=l.getTile(e,t,r,n,s);return h.getState()==a.A.ERROR&&o.getUseInterimTilesOnError()&&o.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(h)||(h=h.getInterimTile()),h}getData(e){const t=this.frameState;if(!t)return null;const r=this.getLayer(),i=(0,l.Bb)(t.pixelToCoordinateTransform,e.slice()),o=r.getExtent();if(o&&!(0,d.Ym)(o,i))return null;const h=t.pixelRatio,c=t.viewState.projection,u=t.viewState,p=r.getRenderSource(),f=p.getTileGridForProjection(u.projection),T=p.getTilePixelRatio(t.pixelRatio);for(let l=f.getZForResolution(u.resolution);l>=f.getMinZoom();--l){const e=f.getTileCoordForCoordAndZ(i,l),t=p.getTile(l,e[1],e[2],h,c);if(!(t instanceof n.A||t instanceof s.A)||t instanceof s.A&&t.getState()===a.A.EMPTY)return null;if(t.getState()!==a.A.LOADED)continue;const r=f.getOrigin(l),o=(0,g.xq)(f.getTileSize(l)),d=f.getResolution(l),m=Math.floor(T*((i[0]-r[0])/d-e[1]*o[0])),_=Math.floor(T*((r[1]-i[1])/d-e[2]*o[1])),x=Math.round(T*p.getGutterForProjection(u.projection));return this.getImageData(t.getImage(),m+x,_+x)}return null}loadedTileCallback(e,t,r){return!!this.isDrawableTile(r)&&super.loadedTileCallback(e,t,r)}prepareFrame(e){return!!this.getLayer().getSource()}renderFrame(e,t){const r=e.layerStatesArray[e.layerIndex],i=e.viewState,n=i.projection,s=i.resolution,o=i.center,g=i.rotation,p=e.pixelRatio,f=this.getLayer(),T=f.getSource(),m=T.getRevision(),_=T.getTileGridForProjection(n),x=_.getZForResolution(s,T.zDirection),R=_.getResolution(x);let y=e.extent;const v=e.viewState.resolution,E=T.getTilePixelRatio(p);this.prepareContainer(e,t);const S=this.context.canvas.width,C=this.context.canvas.height,A=r.extent&&(0,c.fromUserExtent)(r.extent,n);A&&(y=(0,d._N)(y,(0,c.fromUserExtent)(r.extent,n)));const I=R*S/2/E,w=R*C/2/E,P=[o[0]-I,o[1]-w,o[0]+I,o[1]+w],b=_.getTileRangeForExtentAndZ(y,x),F={};F[x]={};const D=this.createLoadedTileFinder(T,n,F),L=this.tmpExtent,O=this.tmpTileRange_;this.newTiles_=!1;const G=g?(0,d.Yw)(i.center,v,g,e.size):void 0;for(let l=b.minX;l<=b.maxX;++l)for(let t=b.minY;t<=b.maxY;++t){if(g&&!_.tileCoordIntersectsViewport([x,l,t],G))continue;const i=this.getTile(x,l,t,e);if(this.isDrawableTile(i)){const t=(0,u.v6)(this);if(i.getState()==a.A.LOADED){F[x][i.tileCoord.toString()]=i;let e=i.inTransition(t);e&&1!==r.opacity&&(i.endTransition(t),e=!1),this.newTiles_||!e&&this.renderedTiles.includes(i)||(this.newTiles_=!0)}if(1===i.getAlpha(t,e.time))continue}const n=_.getTileCoordChildTileRange(i.tileCoord,O,L);let s=!1;n&&(s=D(x+1,n)),s||_.forEachTileCoordParentTileRange(i.tileCoord,D,O,L)}const M=R/s*p/E,j=this.getRenderContext(e);(0,l.Zz)(this.tempTransform,S/2,C/2,M,M,0,-S/2,-C/2),A&&this.clipUnrotated(j,e,A),T.getInterpolate()||(j.imageSmoothingEnabled=!1),this.preRender(j,e),this.renderedTiles.length=0;let N,B,U,H=Object.keys(F).map(Number);H.sort(h.V_),1!==r.opacity||this.containerReused&&!T.getOpaque(e.viewState.projection)?(N=[],B=[]):H=H.reverse();for(let a=H.length-1;a>=0;--a){const t=H[a],r=T.getTilePixelSize(t,p,n),i=_.getResolution(t),s=i/R,o=r[0]*s*M,h=r[1]*s*M,c=_.getTileCoordForCoordAndZ((0,d.Py)(P),t),g=_.getTileCoordExtent(c),f=(0,l.Bb)(this.tempTransform,[E*(g[0]-P[0])/R,E*(P[3]-g[3])/R]),m=E*T.getGutterForProjection(n),y=F[t];for(const n in y){const r=y[n],i=r.tileCoord,s=c[1]-i[1],a=Math.round(f[0]-(s-1)*o),l=c[2]-i[2],g=Math.round(f[1]-(l-1)*h),p=Math.round(f[0]-s*o),_=Math.round(f[1]-l*h),R=a-p,v=g-_,E=x===t,S=E&&1!==r.getAlpha((0,u.v6)(this),e.time);let C=!1;if(!S)if(N){U=[p,_,p+R,_,p+R,_+v,p,_+v];for(let e=0,r=N.length;e<r;++e)if(x!==t&&t<B[e]){const t=N[e];(0,d.HY)([p,_,p+R,_+v],[t[0],t[3],t[4],t[7]])&&(C||(j.save(),C=!0),j.beginPath(),j.moveTo(U[0],U[1]),j.lineTo(U[2],U[3]),j.lineTo(U[4],U[5]),j.lineTo(U[6],U[7]),j.moveTo(t[6],t[7]),j.lineTo(t[4],t[5]),j.lineTo(t[2],t[3]),j.lineTo(t[0],t[1]),j.clip())}N.push(U),B.push(t)}else j.clearRect(p,_,R,v);this.drawTileImage(r,e,p,_,R,v,m,E),N&&!S?(C&&j.restore(),this.renderedTiles.unshift(r)):this.renderedTiles.push(r),this.updateUsedTiles(e.usedTiles,T,r)}}return this.renderedRevision=m,this.renderedResolution=R,this.extentChanged=!this.renderedExtent_||!(0,d.aI)(this.renderedExtent_,P),this.renderedExtent_=P,this.renderedPixelRatio=p,this.renderedProjection=n,this.manageTilePyramid(e,T,_,p,n,y,x,f.getPreload()),this.scheduleExpireCache(e,T),this.postRender(this.context,e),r.extent&&j.restore(),j.imageSmoothingEnabled=!0,this.container}drawTileImage(e,t,r,i,n,s,o,a){const l=this.getTileImage(e);if(!l)return;const h=this.getRenderContext(t),d=(0,u.v6)(this),c=t.layerStatesArray[t.layerIndex],g=c.opacity*(a?e.getAlpha(d,t.time):1),p=g!==h.globalAlpha;p&&(h.save(),h.globalAlpha=g),h.drawImage(l,o,o,l.width-2*o,l.height-2*o,r,i,n,s),p&&h.restore(),g!==c.opacity?t.animate=!0:a&&e.endTransition(d)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}scheduleExpireCache(e,t){if(t.canExpireCache()){const r=function(e,t,r){const i=(0,u.v6)(e);i in r.usedTiles&&e.expireCache(r.viewState.projection,r.usedTiles[i])}.bind(null,t);e.postRenderFunctions.push(r)}}updateUsedTiles(e,t,r){const i=(0,u.v6)(t);i in e||(e[i]={}),e[i][r.getKey()]=!0}manageTilePyramid(e,t,r,i,n,s,o,l,h){const c=(0,u.v6)(t);c in e.wantedTiles||(e.wantedTiles[c]={});const g=e.wantedTiles[c],p=e.tileQueue,f=r.getMinZoom(),T=e.viewState.rotation,m=T?(0,d.Yw)(e.viewState.center,e.viewState.resolution,T,e.size):void 0;let _,x,R,y,v,E,S=0;for(E=f;E<=o;++E)for(x=r.getTileRangeForExtentAndZ(s,E,x),R=r.getResolution(E),y=x.minX;y<=x.maxX;++y)for(v=x.minY;v<=x.maxY;++v)T&&!r.tileCoordIntersectsViewport([E,y,v],m)||(o-E<=l?(++S,_=t.getTile(E,y,v,i,n),_.getState()==a.A.IDLE&&(g[_.getKey()]=!0,p.isKeyQueued(_.getKey())||p.enqueue([_,c,r.getTileCoordCenter(_.tileCoord),R])),void 0!==h&&h(_)):t.useTile(E,y,v,n));t.updateCacheSize(S,n)}}const f=p},32348:(e,t,r)=>{r.d(t,{A:()=>m});var i=r(70587),n=r(96769),s=r(4961),o=r(83984),a=r(62703),l=r(57849),h=r(70915),d=r(68711),c=r(73608),u=r(66514),g=r(89718),p=r(4087),f=r(6933);class T extends n.A{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=(0,h.S5)(),this.wrappedRenderedExtent_=(0,h.S5)(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(e,t,r){const i=t.extent,n=t.viewState,o=n.center,l=n.resolution,d=n.projection,c=n.rotation,u=d.getExtent(),g=this.getLayer().getSource(),p=this.getLayer().getDeclutter(),f=t.pixelRatio,T=t.viewHints,m=!(T[a.A.ANIMATING]||T[a.A.INTERACTING]),_=this.context,x=Math.round((0,h.RG)(i)/l*f),R=Math.round((0,h.Oq)(i)/l*f),y=g.getWrapX()&&d.canWrapX(),v=y?(0,h.RG)(u):null,E=y?Math.ceil((i[2]-u[2])/v)+1:1;let S=y?Math.floor((i[0]-u[0])/v):0;do{let i=this.getRenderTransform(o,l,0,f,x,R,S*v);t.declutter&&(i=i.slice(0)),e.execute(_,[_.canvas.width,_.canvas.height],i,c,m,void 0===r?s.y2:r?s.$i:s.x$,r?p&&t.declutter[p]:void 0)}while(++S<E)}setDrawContext_(){1!==this.opacity_&&(this.targetContext_=this.context,this.context=(0,d.Y)(this.context.canvas.width,this.context.canvas.height,n.B))}resetDrawContext_(){if(1!==this.opacity_){const e=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=e,(0,d.Yg)(this.context),n.B.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(e){this.replayGroup_&&this.getLayer().getDeclutter()&&this.renderWorlds(this.replayGroup_,e,!0)}renderDeferredInternal(e){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(e,t){const r=e.layerStatesArray[e.layerIndex];this.opacity_=r.opacity;const i=e.viewState;this.prepareContainer(e,t);const n=this.context,s=this.replayGroup_;let a=s&&!s.isEmpty();if(!a){const e=this.getLayer().hasListener(o.A.PRERENDER)||this.getLayer().hasListener(o.A.POSTRENDER);if(!e)return null}this.setDrawContext_(),this.preRender(n,e);const l=i.projection;if(this.clipped_=!1,a&&r.extent&&this.clipping){const t=(0,g.fromUserExtent)(r.extent,l);a=(0,h.HY)(t,e.extent),this.clipped_=a&&!(0,h.ms)(t,e.extent),this.clipped_&&this.clipUnrotated(n,e,t)}return a&&this.renderWorlds(s,e,!this.getLayer().getDeclutter()&&void 0),!e.declutter&&this.clipped_&&n.restore(),this.postRender(n,e),this.renderedRotation_!==i.rotation&&(this.renderedRotation_=i.rotation,this.hitDetectionImageData_=null),e.declutter||this.resetDrawContext_(),this.container}getFeatures(e){return new Promise((t=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const e=this.frameState.size.slice(),t=this.renderedCenter_,r=this.renderedResolution_,i=this.renderedRotation_,n=this.renderedProjection_,s=this.wrappedRenderedExtent_,o=this.getLayer(),a=[],d=e[0]*l.tF,u=e[1]*l.tF;a.push(this.getRenderTransform(t,r,i,l.tF,d,u,0).slice());const p=o.getSource(),f=n.getExtent();if(p.getWrapX()&&n.canWrapX()&&!(0,h.ms)(f,s)){let e=s[0];const n=(0,h.RG)(f);let o,c=0;while(e<f[0])--c,o=n*c,a.push(this.getRenderTransform(t,r,i,l.tF,d,u,o).slice()),e+=n;c=0,e=s[2];while(e>f[2])++c,o=n*c,a.push(this.getRenderTransform(t,r,i,l.tF,d,u,o).slice()),e-=n}const T=(0,g.getUserProjection)();this.hitDetectionImageData_=(0,l._7)(e,a,this.renderedFeatures_,o.getStyleFunction(),s,r,i,(0,c.j)(r,this.renderedPixelRatio_),T?n:null)}t((0,l.F8)(e,this.renderedFeatures_,this.hitDetectionImageData_))}))}forEachFeatureAtCoordinate(e,t,r,i,n){if(!this.replayGroup_)return;const s=t.viewState.resolution,o=t.viewState.rotation,a=this.getLayer(),l={},h=function(e,t,r){const s=(0,p.v6)(e),o=l[s];if(o){if(!0!==o&&r<o.distanceSq){if(0===r)return l[s]=!0,n.splice(n.lastIndexOf(o),1),i(e,a,t);o.geometry=t,o.distanceSq=r}}else{if(0===r)return l[s]=!0,i(e,a,t);n.push(l[s]={feature:e,layer:a,geometry:t,distanceSq:r,callback:i})}};let d;const c=[this.replayGroup_],u=this.getLayer().getDeclutter();return c.some((i=>d=i.forEachFeatureAtCoordinate(e,s,o,r,h,u&&t.declutter[u]?t.declutter[u].all().map((e=>e.value)):null))),d}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const t=this.getLayer(),r=t.getSource();if(!r)return!1;const n=e.viewHints[a.A.ANIMATING],o=e.viewHints[a.A.INTERACTING],l=t.getUpdateWhileAnimating(),d=t.getUpdateWhileInteracting();if(this.ready&&!l&&n||!d&&o)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const p=e.extent,T=e.viewState,m=T.projection,_=T.resolution,x=e.pixelRatio,R=t.getRevision(),y=t.getRenderBuffer();let v=t.getRenderOrder();void 0===v&&(v=c.Eo);const E=T.center.slice(),S=(0,h.r)(p,y*_),C=S.slice(),A=[S.slice()],I=m.getExtent();if(r.getWrapX()&&m.canWrapX()&&!(0,h.ms)(I,e.extent)){const e=(0,h.RG)(I),t=Math.max((0,h.RG)(S)/2,e);S[0]=I[0]-t,S[2]=I[2]+t,(0,f.Li)(E,m);const r=(0,h.Li)(A[0],m);r[0]<I[0]&&r[2]<I[2]?A.push([r[0]+e,r[1],r[2]+e,r[3]]):r[0]>I[0]&&r[2]>I[2]&&A.push([r[0]-e,r[1],r[2]-e,r[3]])}if(this.ready&&this.renderedResolution_==_&&this.renderedRevision_==R&&this.renderedRenderOrder_==v&&this.renderedFrameDeclutter_===!!e.declutter&&(0,h.ms)(this.wrappedRenderedExtent_,S))return(0,u.aI)(this.renderedExtent_,C)||(this.hitDetectionImageData_=null,this.renderedExtent_=C),this.renderedCenter_=E,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const w=new i.A((0,c.gY)(_,x),S,_,x),P=(0,g.getUserProjection)();let b;if(P){for(let e=0,t=A.length;e<t;++e){const t=A[e],i=(0,g.toUserExtent)(t,m);r.loadFeatures(i,(0,g.toUserResolution)(_,m),P)}b=(0,g.getTransformFromProjections)(P,m)}else for(let i=0,s=A.length;i<s;++i)r.loadFeatures(A[i],_,m);const F=(0,c.j)(_,x);let D=!0;const L=(e,r)=>{let i;const n=e.getStyleFunction()||t.getStyleFunction();if(n&&(i=n(e,_)),i){const t=this.renderFeature(e,F,i,w,b,this.getLayer().getDeclutter(),r);D=D&&!t}},O=(0,g.toUserExtent)(S,m),G=r.getFeaturesInExtent(O);v&&G.sort(v);for(let i=0,s=G.length;i<s;++i)L(G[i],i);this.renderedFeatures_=G,this.ready=D;const M=w.finish(),j=new s.Ay(S,_,x,r.getOverlaps(),M,t.getRenderBuffer(),!!e.declutter);return this.renderedResolution_=_,this.renderedRevision_=R,this.renderedRenderOrder_=v,this.renderedFrameDeclutter_=!!e.declutter,this.renderedExtent_=C,this.wrappedRenderedExtent_=S,this.renderedCenter_=E,this.renderedProjection_=m,this.renderedPixelRatio_=x,this.replayGroup_=j,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,r,i,n,s,o){if(!r)return!1;let a=!1;if(Array.isArray(r))for(let l=0,h=r.length;l<h;++l)a=(0,c.nl)(i,e,r[l],t,this.boundHandleStyleImageChange_,n,s,o)||a;else a=(0,c.nl)(i,e,r,t,this.boundHandleStyleImageChange_,n,s,o);return a}}const m=T},25288:(e,t,r)=>{r.d(t,{A:()=>R});var i=r(70587),n=r(4961),s=r(24029),o=r(11078),a=r(62703),l=r(40808),h=r(57849),d=r(9703),c=r(66514),u=r(70915),g=r(73608),p=r(4087),f=r(6782),T=r(6933);const m={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},_={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class x extends s.A{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=(0,d.vt)(),this.tileClipContexts_=null}prepareTile(e,t,r){let i;const n=e.getState();return n!==o.A.LOADED&&n!==o.A.ERROR||(this.updateExecutorGroup_(e,t,r),this.tileImageNeedsRender_(e)&&(i=!0)),i}getTile(e,t,r,i){const n=i.pixelRatio,s=i.viewState,o=s.resolution,l=s.projection,h=this.getLayer(),d=h.getSource().getTile(e,t,r,n,l),c=i.viewHints,u=!(c[a.A.ANIMATING]||c[a.A.INTERACTING]);!u&&d.wantedResolution||(d.wantedResolution=o);const g=this.prepareTile(d,n,l);return g&&(u||Date.now()-i.time<8)&&"vector"!==h.getRenderMode()&&this.renderTileImage_(d,i),super.getTile(e,t,r,i)}isDrawableTile(e){const t=this.getLayer();return super.isDrawableTile(e)&&("vector"===t.getRenderMode()?(0,p.v6)(t)in e.executorGroups:e.hasContext(t))}getTileImage(e){return e.getImage(this.getLayer())}prepareFrame(e){const t=this.getLayer().getRevision();return this.renderedLayerRevision_!==t&&(this.renderedLayerRevision_=t,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,t,r){const s=this.getLayer(),a=s.getRevision(),l=s.getRenderOrder()||null,h=e.wantedResolution,d=e.getReplayState(s);if(!d.dirty&&d.renderedResolution===h&&d.renderedRevision==a&&d.renderedRenderOrder==l)return;const c=s.getSource(),f=!!s.getDeclutter(),T=c.getTileGrid(),m=c.getTileGridForProjection(r),_=m.getTileCoordExtent(e.wrappedTileCoord),x=c.getSourceTiles(t,r,e),R=(0,p.v6)(s);delete e.hitDetectionImageData[R],e.executorGroups[R]=[],d.dirty=!1;for(let p=0,y=x.length;p<y;++p){const r=x[p];if(r.getState()!=o.A.LOADED)continue;const a=r.tileCoord,m=T.getTileCoordExtent(a),y=(0,u._N)(_,m),v=(0,u.r)(y,s.getRenderBuffer()*h,this.tmpExtent),E=(0,u.aI)(m,y)?null:v,S=new i.A(0,y,h,t),C=(0,g.j)(h,t),A=function(e,t){let r;const i=e.getStyleFunction()||s.getStyleFunction();if(i&&(r=i(e,h)),r){const i=this.renderFeature(e,C,r,S,f,t);d.dirty=d.dirty||i}},I=r.getFeatures();l&&l!==d.renderedRenderOrder&&I.sort(l);for(let e=0,t=I.length;e<t;++e){const t=I[e];E&&!(0,u.HY)(E,t.getGeometry().getExtent())||A.call(this,t,e)}const w=S.finish(),P="vector"!==s.getRenderMode()&&f&&1===x.length?null:y,b=new n.Ay(P,h,t,c.getOverlaps(),w,s.getRenderBuffer(),!0);e.executorGroups[R].push(b)}d.renderedRevision=a,d.renderedRenderOrder=l,d.renderedResolution=h}forEachFeatureAtCoordinate(e,t,r,i,n){const s=t.viewState.resolution,o=t.viewState.rotation;r=void 0==r?0:r;const a=this.getLayer(),l=a.getSource(),h=l.getTileGridForProjection(t.viewState.projection),d=(0,u.Tr)([e]);(0,u.r)(d,s*r,d);const c={},g=function(e,t,r){let s=e.getId();void 0===s&&(s=(0,p.v6)(e));const o=c[s];if(o){if(!0!==o&&r<o.distanceSq){if(0===r)return c[s]=!0,n.splice(n.lastIndexOf(o),1),i(e,a,t);o.geometry=t,o.distanceSq=r}}else{if(0===r)return c[s]=!0,i(e,a,t);n.push(c[s]={feature:e,layer:a,geometry:t,distanceSq:r,callback:i})}},f=this.renderedTiles;let T;for(let m=0,_=f.length;!T&&m<_;++m){const i=f[m],n=h.getTileCoordExtent(i.wrappedTileCoord);if(!(0,u.HY)(n,d))continue;const l=(0,p.v6)(a),c=[i.executorGroups[l]],_=a.getDeclutter();c.some((i=>{const n=_?t.declutter[_].all().map((e=>e.value)):null;for(let t=0,a=i.length;t<a;++t){const a=i[t];if(T=a.forEachFeatureAtCoordinate(e,s,o,r,g,n),T)return!0}}))}return T}getFeatures(e){return new Promise(((t,r)=>{const i=this.getLayer(),n=(0,p.v6)(i),s=i.getSource(),a=this.renderedProjection,l=a.getExtent(),c=this.renderedResolution,g=s.getTileGridForProjection(a),m=(0,d.Bb)(this.renderedPixelToCoordinateTransform_,e.slice()),_=g.getTileCoordForCoordAndResolution(m,c);let x;for(let e=0,h=this.renderedTiles.length;e<h;++e)if(_.toString()===this.renderedTiles[e].tileCoord.toString()){if(x=this.renderedTiles[e],x.getState()===o.A.LOADED){const e=g.getTileCoordExtent(x.tileCoord);s.getWrapX()&&a.canWrapX()&&!(0,u.ms)(l,e)&&(0,T.Li)(m,a);break}x=void 0}if(!x||x.loadingSourceTiles>0)return void t([]);const R=g.getTileCoordExtent(x.wrappedTileCoord),y=(0,u.Py)(R),v=[(m[0]-y[0])/c,(y[1]-m[1])/c],E=x.getSourceTiles().reduce((function(e,t){return e.concat(t.getFeatures())}),[]);let S=x.hitDetectionImageData[n];if(!S){const e=(0,f.xq)(g.getTileSize(g.getZForResolution(c,s.zDirection))),t=this.renderedRotation_,r=[this.getRenderTransform(g.getTileCoordCenter(x.wrappedTileCoord),c,0,h.tF,e[0]*h.tF,e[1]*h.tF,0)];S=(0,h._7)(e,r,E,i.getStyleFunction(),g.getTileCoordExtent(x.wrappedTileCoord),x.getReplayState(i).renderedResolution,t),x.hitDetectionImageData[n]=S}t((0,h.F8)(v,E,S))}))}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&void 0!==this.renderedLayerRevision_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e,t){const r=this.context,i=r.globalAlpha;r.globalAlpha=t.opacity;const s=e.viewHints,o=!(s[a.A.ANIMATING]||s[a.A.INTERACTING]),l=this.renderedTiles;for(let a=0,h=l.length;a<h;++a){const t=l[a],r=t.executorGroups[(0,p.v6)(this.getLayer())],i=this.getLayer().getDeclutter();if(r)for(let s=r.length-1;s>=0;--s)r[s].execute(this.context,[this.context.canvas.width,this.context.canvas.height],this.getTileRenderTransform(t,e),e.viewState.rotation,o,n.$i,i?e.declutter[i]:void 0)}r.globalAlpha=i}renderDeferredInternal(e){const t=this.renderedTiles,r=t.reduce(((e,t,r)=>(t.executorGroups[(0,p.v6)(this.getLayer())].forEach((t=>e.push({executorGroup:t,index:r}))),e)),[]),i=r.map((({executorGroup:e})=>e.getDeferredZIndexContexts())),n={};for(let o=0,a=r.length;o<a;++o){const e=r[o].executorGroup.getDeferredZIndexContexts();for(const t in e)n[t]=!0}const s=Object.keys(n).sort(c.V_);s.map(Number).forEach((e=>{i.forEach(((t,i)=>{t[e]&&(t[e].forEach((e=>{const{executorGroup:t,index:n}=r[i],s=t.getRenderedContext(),o=s.globalAlpha;s.globalAlpha=this.renderedOpacity_;const a=this.tileClipContexts_[n];a&&a.draw(s),e.draw(s),a&&s.restore(),s.globalAlpha=o,e.clear()})),t[e].length=0)}))}))}getTileRenderTransform(e,t){const r=t.pixelRatio,i=t.viewState,n=i.center,s=i.resolution,o=i.rotation,a=t.size,l=Math.round(a[0]*r),h=Math.round(a[1]*r),c=this.getLayer().getSource(),u=c.getTileGridForProjection(t.viewState.projection),g=e.tileCoord,p=u.getTileCoordExtent(e.wrappedTileCoord),f=u.getTileCoordExtent(g,this.tmpExtent)[0]-p[0],T=(0,d.lw)((0,d.hs)(this.inversePixelTransform.slice(),1/r,1/r),this.getRenderTransform(n,s,o,r,l,h,f));return T}postRender(e,t){const r=t.viewHints,i=!(r[a.A.ANIMATING]||r[a.A.INTERACTING]);this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation,this.renderedOpacity_=t.layerStatesArray[t.layerIndex].opacity;const s=this.getLayer(),o=s.getRenderMode(),h=e.globalAlpha;e.globalAlpha=this.renderedOpacity_;const d=s.getDeclutter(),c=d?_[o].filter((e=>!n.$i.includes(e))):_[o],g=t.viewState,f=g.rotation,T=s.getSource(),m=T.getTileGridForProjection(g.projection),x=m.getZForResolution(g.resolution,T.zDirection),R=this.renderedTiles,y=[],v=[],E=[];let S=!0;for(let n=R.length-1;n>=0;--n){const r=R[n];S=S&&!r.getReplayState(s).dirty;const o=r.executorGroups[(0,p.v6)(s)].filter((e=>e.hasExecutors(c)));if(0===o.length)continue;const a=this.getTileRenderTransform(r,t),h=r.tileCoord[0];let g=!1;const T=o[0].getClipCoords(a);let m,_=e;if(T){m=new l.A,_=m.getContext();for(let e=0,t=y.length;e<t;++e)if(x!==h&&h<v[e]){const t=y[e];(0,u.HY)([T[0],T[3],T[4],T[7]],[t[0],t[3],t[4],t[7]])&&(g||(_.save(),g=!0),_.beginPath(),_.moveTo(T[0],T[1]),_.lineTo(T[2],T[3]),_.lineTo(T[4],T[5]),_.lineTo(T[6],T[7]),_.moveTo(t[6],t[7]),_.lineTo(t[4],t[5]),_.lineTo(t[2],t[3]),_.lineTo(t[0],t[1]),_.clip())}y.push(T),v.push(h)}for(let n=0,s=o.length;n<s;++n){const r=o[n];r.execute(e,[e.canvas.width,e.canvas.height],a,f,i,c,t.declutter?.[d])}g&&(_===e?_.restore():E[n]=m)}e.globalAlpha=h,this.ready=S,this.tileClipContexts_=E,t.declutter||this.renderDeferredInternal(t),super.postRender(e,t)}renderFeature(e,t,r,i,n,s){if(!r)return!1;let o=!1;if(Array.isArray(r))for(let a=0,l=r.length;a<l;++a)o=(0,g.nl)(i,e,r[a],t,this.boundHandleStyleImageChange_,void 0,n,s)||o;else o=(0,g.nl)(i,e,r,t,this.boundHandleStyleImageChange_,void 0,n,s);return o}tileImageNeedsRender_(e){const t=this.getLayer();if("vector"===t.getRenderMode())return!1;const r=e.getReplayState(t),i=t.getRevision(),n=e.wantedResolution;return r.renderedTileResolution!==n||r.renderedTileRevision!==i}renderTileImage_(e,t){const r=this.getLayer(),i=e.getReplayState(r),n=r.getRevision(),s=e.executorGroups[(0,p.v6)(r)];i.renderedTileRevision=n;const o=e.wrappedTileCoord,a=o[0],l=r.getSource();let h=t.pixelRatio;const c=t.viewState,u=c.projection,g=l.getTileGridForProjection(u),f=g.getResolution(e.tileCoord[0]),T=t.pixelRatio/e.wantedResolution*f,_=g.getResolution(a),x=e.getContext(r);h=Math.round(Math.max(h,T/h));const R=l.getTilePixelSize(a,h,u);x.canvas.width=R[0],x.canvas.height=R[1];const y=h/T;if(1!==y){const e=(0,d.cL)(this.tmpTransform_);(0,d.hs)(e,y,y),x.setTransform.apply(x,e)}const v=g.getTileCoordExtent(o,this.tmpExtent),E=T/_,S=(0,d.cL)(this.tmpTransform_);(0,d.hs)(S,E,-E),(0,d.Tl)(S,-v[0],-v[3]);for(let d=0,p=s.length;d<p;++d){const e=s[d];e.execute(x,[x.canvas.width*y,x.canvas.height*y],S,0,!0,m[r.getRenderMode()],null)}i.renderedTileResolution=e.wantedResolution}}const R=x},73608:(e,t,r)=>{r.d(t,{Eo:()=>a,gY:()=>h,j:()=>l,nl:()=>c});var i=r(6141),n=r(4087);const s=.5,o={Point:_,LineString:f,Polygon:R,MultiPoint:x,MultiLineString:T,MultiPolygon:m,GeometryCollection:p,Circle:d};function a(e,t){return parseInt((0,n.v6)(e),10)-parseInt((0,n.v6)(t),10)}function l(e,t){const r=h(e,t);return r*r}function h(e,t){return s*e/t}function d(e,t,r,i,n){const s=r.getFill(),o=r.getStroke();if(s||o){const a=e.getBuilder(r.getZIndex(),"Circle");a.setFillStrokeStyle(s,o),a.drawCircle(t,i,n)}const a=r.getText();if(a&&a.getText()){const n=e.getBuilder(r.getZIndex(),"Text");n.setTextStyle(a),n.drawText(t,i)}}function c(e,t,r,n,s,o,a,l){const h=[],d=r.getImage();if(d){let e=!0;const t=d.getImageState();t==i.A.LOADED||t==i.A.ERROR?e=!1:t==i.A.IDLE&&d.load(),e&&h.push(d.ready())}const c=r.getFill();c&&c.loading()&&h.push(c.ready());const g=h.length>0;return g&&Promise.all(h).then((()=>s(null))),u(e,t,r,n,o,a,l),g}function u(e,t,r,i,n,s,a){const l=r.getGeometryFunction()(t);if(!l)return;const h=l.simplifyTransformed(i,n),d=r.getRenderer();if(d)g(e,h,r,t,a);else{const i=o[h.getType()];i(e,h,r,t,a,s)}}function g(e,t,r,i,n){if("GeometryCollection"==t.getType()){const s=t.getGeometries();for(let t=0,o=s.length;t<o;++t)g(e,s[t],r,i,n);return}const s=e.getBuilder(r.getZIndex(),"Default");s.drawCustom(t,i,r.getRenderer(),r.getHitDetectionRenderer(),n)}function p(e,t,r,i,n,s){const a=t.getGeometriesArray();let l,h;for(l=0,h=a.length;l<h;++l){const t=o[a[l].getType()];t(e,a[l],r,i,n,s)}}function f(e,t,r,i,n){const s=r.getStroke();if(s){const o=e.getBuilder(r.getZIndex(),"LineString");o.setFillStrokeStyle(null,s),o.drawLineString(t,i,n)}const o=r.getText();if(o&&o.getText()){const s=e.getBuilder(r.getZIndex(),"Text");s.setTextStyle(o),s.drawText(t,i,n)}}function T(e,t,r,i,n){const s=r.getStroke();if(s){const o=e.getBuilder(r.getZIndex(),"LineString");o.setFillStrokeStyle(null,s),o.drawMultiLineString(t,i,n)}const o=r.getText();if(o&&o.getText()){const s=e.getBuilder(r.getZIndex(),"Text");s.setTextStyle(o),s.drawText(t,i,n)}}function m(e,t,r,i,n){const s=r.getFill(),o=r.getStroke();if(o||s){const a=e.getBuilder(r.getZIndex(),"Polygon");a.setFillStrokeStyle(s,o),a.drawMultiPolygon(t,i,n)}const a=r.getText();if(a&&a.getText()){const s=e.getBuilder(r.getZIndex(),"Text");s.setTextStyle(a),s.drawText(t,i,n)}}function _(e,t,r,n,s,o){const a=r.getImage(),l=r.getText(),h=l&&l.getText(),d=o&&a&&h?{}:void 0;if(a){if(a.getImageState()!=i.A.LOADED)return;const o=e.getBuilder(r.getZIndex(),"Image");o.setImageStyle(a,d),o.drawPoint(t,n,s)}if(h){const i=e.getBuilder(r.getZIndex(),"Text");i.setTextStyle(l,d),i.drawText(t,n,s)}}function x(e,t,r,n,s,o){const a=r.getImage(),l=a&&0!==a.getOpacity(),h=r.getText(),d=h&&h.getText(),c=o&&l&&d?{}:void 0;if(l){if(a.getImageState()!=i.A.LOADED)return;const o=e.getBuilder(r.getZIndex(),"Image");o.setImageStyle(a,c),o.drawMultiPoint(t,n,s)}if(d){const i=e.getBuilder(r.getZIndex(),"Text");i.setTextStyle(h,c),i.drawText(t,n,s)}}function R(e,t,r,i,n){const s=r.getFill(),o=r.getStroke();if(s||o){const a=e.getBuilder(r.getZIndex(),"Polygon");a.setFillStrokeStyle(s,o),a.drawPolygon(t,i,n)}const a=r.getText();if(a&&a.getText()){const s=e.getBuilder(r.getZIndex(),"Text");s.setTextStyle(a),s.drawText(t,i,n)}}},60492:(e,t,r)=>{r.d(t,{A:()=>d});var i=r(75332),n=r(5986),s=r(9960),o=r(83984),a=r(63722),l=r(9703);class h extends n.A{constructor(e,t){super(e),t=t||{},this.inversePixelTransform_=(0,l.vt)(),this.pixelContext_=null,this.postProcesses_=t.postProcesses,this.uniforms_=t.uniforms,this.helper,e.addChangeListener(i.A.MAP,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(e,t){const r=this.getLayer();if(r.hasListener(o.A.PRECOMPOSE)){const i=new s.A(o.A.PRECOMPOSE,void 0,t,e);r.dispatchEvent(i)}}dispatchPostComposeEvent(e,t){const r=this.getLayer();if(r.hasListener(o.A.POSTCOMPOSE)){const i=new s.A(o.A.POSTCOMPOSE,void 0,t,e);r.dispatchEvent(i)}}reset(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(e){if(this.getLayer().getRenderSource()){let t,r=!0,i=-1;for(let s=0,o=e.layerStatesArray.length;s<o;s++){const n=e.layerStatesArray[s].layer,o=n.getRenderer();if(!(o instanceof h)){r=!0;continue}const a=n.getClassName();if((r||a!==t)&&(i+=1,r=!1),t=a,o===this)break}const n="map/"+e.mapId+"/group/"+i;this.helper&&this.helper.canvasCacheKeyMatches(n)&&!this.helper.needsToBeRecreated()||(this.removeHelper(),this.helper=new a.Ay({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:n}),t&&(this.helper.getCanvas().className=t),this.afterHelperCreated())}return this.prepareFrameInternal(e)}afterHelperCreated(){}prepareFrameInternal(e){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(e,t,r){const i=this.getLayer();if(i.hasListener(e)){(0,l.Zz)(this.inversePixelTransform_,0,0,r.pixelRatio,-r.pixelRatio,0,0,-r.size[1]);const n=new s.A(e,this.inversePixelTransform_,r,t);i.dispatchEvent(n)}}preRender(e,t){this.dispatchRenderEvent_(o.A.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(o.A.POSTRENDER,e,t)}}const d=h},78537:(e,t,r)=>{r.d(t,{A:()=>v});var i=r(16323),n=r(88280),s=r(62703),o=r(20259),a=r(60492),l=r(89940),h=r(90130),d=r(63722),c=r(835),u=r(9703),g=r(90588),p=r(70915),f=r(32627),T=r(35339),m=r(89718),_=r(4087);function x(e,t){const r=e.viewState.projection,i=t.getSource(),n=i.getWrapX()&&r.canWrapX(),s=r.getExtent(),o=e.extent,a=n?(0,p.RG)(s):null,l=n?Math.ceil((o[2]-s[2])/a)+1:1,h=n?Math.floor((o[0]-s[0])/a):0;return[h,l,a]}var R=r(9438);class y extends a.A{constructor(e,t){const r=t.uniforms||{},i=(0,u.vt)();r[d.M8.PROJECTION_MATRIX]=i,super(e,{uniforms:r,postProcesses:t.postProcesses}),this.sourceRevision_=-1,this.verticesBuffer_=new o.Ay(h.H7,h.Be),this.indicesBuffer_=new o.Ay(h.IP,h.Be),this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.program_,this.hitDetectionEnabled_=t.hitDetectionEnabled??!0;const s=t.attributes?t.attributes.map((function(e){return{name:"a_prop_"+e.name,size:1,type:d.jQ.FLOAT}})):[];this.attributes=[{name:"a_position",size:2,type:d.jQ.FLOAT},{name:"a_index",size:1,type:d.jQ.FLOAT}],this.hitDetectionEnabled_&&(this.attributes.push({name:"a_prop_hitColor",size:4,type:d.jQ.FLOAT}),this.attributes.push({name:"a_featureUid",size:1,type:d.jQ.FLOAT})),this.attributes.push(...s),this.customAttributes=t.attributes?t.attributes:[],this.previousExtent_=(0,p.S5)(),this.currentTransform_=i,this.renderTransform_=(0,u.vt)(),this.invertRenderTransform_=(0,u.vt)(),this.renderInstructions_=new Float32Array(0),this.hitRenderTarget_,this.lastSentId=0,this.worker_=(0,T.v)(),this.worker_.addEventListener("message",(e=>{const t=e.data;if(t.type===c.x.GENERATE_POINT_BUFFERS){const r=t.projectionTransform;this.verticesBuffer_.fromArrayBuffer(t.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_),this.indicesBuffer_.fromArrayBuffer(t.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=r,(0,u.T9)(this.invertRenderTransform_,this.renderTransform_),this.renderInstructions_=new Float32Array(e.data.renderInstructions),t.id===this.lastSentId&&(this.ready=!0),this.getLayer().changed()}})),this.featureCache_={},this.featureCount_=0;const a=this.getLayer().getSource();this.sourceListenKeys_=[(0,R.KT)(a,n.A.ADDFEATURE,this.handleSourceFeatureAdded_,this),(0,R.KT)(a,n.A.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),(0,R.KT)(a,n.A.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),(0,R.KT)(a,n.A.CLEAR,this.handleSourceFeatureClear_,this)],a.forEachFeature((e=>{this.featureCache_[(0,_.v6)(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()},this.featureCount_++}))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new l.A(this.helper))}handleSourceFeatureAdded_(e){const t=e.feature;this.featureCache_[(0,_.v6)(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()},this.featureCount_++}handleSourceFeatureChanged_(e){const t=e.feature;this.featureCache_[(0,_.v6)(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()}}handleSourceFeatureDelete_(e){const t=e.feature;delete this.featureCache_[(0,_.v6)(t)],this.featureCount_--}handleSourceFeatureClear_(){this.featureCache_={},this.featureCount_=0}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e);const[r,i,n]=x(e,this.getLayer());this.renderWorlds(e,!1,r,i,n),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent),this.hitDetectionEnabled_&&(this.renderWorlds(e,!0,r,i,n),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e);const s=this.helper.getCanvas();return s}prepareFrameInternal(e){const t=this.getLayer(),r=t.getSource(),n=e.viewState,o=!e.viewHints[s.A.ANIMATING]&&!e.viewHints[s.A.INTERACTING],a=!(0,p.aI)(this.previousExtent_,e.extent),l=this.sourceRevision_<r.getRevision();if(l&&(this.sourceRevision_=r.getRevision()),o&&(a||l)){const s=n.projection,o=n.resolution,a=t instanceof i.A?t.getRenderBuffer():0,l=(0,p.r)(e.extent,a*o);r.loadFeatures(l,o,s),this.rebuildBuffers_(e),this.previousExtent_=e.extent.slice()}return this.helper.useProgram(this.program_,e),this.helper.prepareDraw(e),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0}rebuildBuffers_(e){const t=(0,u.vt)();this.helper.makeProjectionTransform(e,t);const r=(0,m.getUserProjection)(),i=this.hitDetectionEnabled_?7:2,n=i+this.customAttributes.length,s=n*this.featureCount_;let o,a;this.renderInstructions_&&this.renderInstructions_.length===s||(this.renderInstructions_=new Float32Array(s));const l=[],h=[];let d=-1;for(const c in this.featureCache_)if(o=this.featureCache_[c],a=o.geometry,a&&"Point"===a.getType()){if(r){const t=(0,m.fromUserCoordinate)(a.getFlatCoordinates(),e.viewState.projection);l[0]=t[0],l[1]=t[1]}else l[0]=a.getFlatCoordinates()[0],l[1]=a.getFlatCoordinates()[1];if((0,u.Bb)(t,l),this.renderInstructions_[++d]=l[0],this.renderInstructions_[++d]=l[1],this.hitDetectionEnabled_){const e=(0,f.bA)(d+5,h);this.renderInstructions_[++d]=e[0],this.renderInstructions_[++d]=e[1],this.renderInstructions_[++d]=e[2],this.renderInstructions_[++d]=e[3],this.renderInstructions_[++d]=Number(c)}for(let e=0;e<this.customAttributes.length;e++){const t=this.customAttributes[e].callback(o.feature,o.properties);this.renderInstructions_[++d]=t}}const g={id:++this.lastSentId,type:c.x.GENERATE_POINT_BUFFERS,renderInstructions:this.renderInstructions_.buffer,customAttributesSize:n-2};g["projectionTransform"]=t,this.ready=!1,this.worker_.postMessage(g,[this.renderInstructions_.buffer]),this.renderInstructions_=null}forEachFeatureAtCoordinate(e,t,r,i,n){if((0,g.v)(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.renderInstructions_||!this.hitDetectionEnabled_)return;const s=(0,u.Bb)(t.coordinateToPixelTransform,e.slice()),o=this.hitRenderTarget_.readPixel(s[0]/2,s[1]/2),a=[o[0]/255,o[1]/255,o[2]/255,o[3]/255],l=(0,f.LW)(a),h=this.renderInstructions_[l],d=Math.floor(h).toString(),c=this.getLayer().getSource(),p=c.getFeatureByUid(d);return p?i(p,this.getLayer(),null):void 0}renderWorlds(e,t,r,i,n){let s=r;this.helper.useProgram(this.program_,e),t&&(this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0)),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes);do{this.helper.makeProjectionTransform(e,this.currentTransform_),(0,u.Tl)(this.currentTransform_,s*n,0),(0,u.lw)(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(e),this.helper.applyHitDetectionUniform(t);const r=this.indicesBuffer_.getSize();this.helper.drawElements(0,r)}while(++s<i)}disposeInternal(){this.worker_.terminate(),this.layer_=null,this.sourceListenKeys_.forEach((function(e){(0,R.JH)(e)})),this.sourceListenKeys_=null,super.disposeInternal()}renderDeclutter(){}}const v=y},566:(e,t,r)=>{r.d(t,{eS:()=>D,gF:()=>F,Ay:()=>G});var i=r(98596),n=r(97404),s=r(11078),o=r(50104),a=r(20259),l=r(14969),h=r(91110),d=r(60492),c=r(4087),u=r(83954),g=r(40186),p=r(9703),f=r(66514),T=r(89718),m=r(70915),_=r(6782);const x={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"},R={};function y(e){return 1/(e+2)}function v(){return{tileIds:new Set,representationsByZ:{}}}function E(e,t){return e.tileIds.has((0,c.v6)(t))}function S(e,t,r){const i=e.representationsByZ;r in i||(i[r]=new Set),i[r].add(t),e.tileIds.add((0,c.v6)(t.tile))}function C(e,t){const r=e.layerStatesArray[e.layerIndex];r.extent&&(t=(0,m._N)(t,(0,T.fromUserExtent)(r.extent,e.viewState.projection)));const i=r.layer.getRenderSource();if(!i.getWrapX()){const r=i.getTileGridForProjection(e.viewState.projection).getExtent();r&&(t=(0,m._N)(t,r))}return t}function A(e,t){return`${e.getKey()},${(0,g.i7)(t)}`}class I extends d.A{constructor(e,t){super(e,{uniforms:t.uniforms,postProcesses:t.postProcesses}),this.renderComplete=!1,this.tileTransform_=(0,p.vt)(),this.tempMat4=(0,u.v)(),this.tempTileRange_=new h.A(0,0,0,0),this.tempTileCoord_=(0,g.N)(0,0,0),this.tempSize_=[0,0];const r=void 0!==t.cacheSize?t.cacheSize:512;this.tileRepresentationCache=new l.A(r),this.frameState=null,this.projection_=void 0}reset(e){super.reset({uniforms:e.uniforms})}isDrawableTile_(e){const t=this.getLayer(),r=e.getState(),i=t.getUseInterimTilesOnError();return r==s.A.LOADED||r==s.A.EMPTY||r==s.A.ERROR&&!i}prepareFrameInternal(e){this.projection_?e.viewState.projection!==this.projection_&&(this.clearCache(),this.projection_=e.viewState.projection):this.projection_=e.viewState.projection;const t=this.getLayer(),r=t.getRenderSource();return!!r&&(!(0,m.Im)(C(e,e.extent))&&"ready"===r.getState())}createTileRepresentation(e){return(0,c.b0)()}enqueueTiles(e,t,r,i,n){const o=e.viewState,a=this.getLayer(),l=a.getRenderSource(),h=l.getTileGridForProjection(o.projection),d=l.getGutterForProjection(o.projection),u=(0,c.v6)(l);u in e.wantedTiles||(e.wantedTiles[u]={});const p=e.wantedTiles[u],f=this.tileRepresentationCache,T=a.getMapInternal(),m=Math.max(r-n,h.getMinZoom(),h.getZForResolution(Math.min(a.getMaxResolution(),T?T.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):h.getResolution(0)),l.zDirection));for(let c=r;c>=m;--c){const r=h.getTileRangeForExtentAndZ(t,c,this.tempTileRange_),n=h.getResolution(c);for(let t=r.minX;t<=r.maxX;++t)for(let a=r.minY;a<=r.maxY;++a){const r=(0,g.N)(c,t,a,this.tempTileCoord_),T=A(l,r);let m,_;if(f.containsKey(T)&&(m=f.get(T),_=m.tile),m&&m.tile.key===l.getKey()||(_=l.getTile(c,t,a,e.pixelRatio,o.projection)),E(i,_))continue;if(m)if(this.isDrawableTile_(_))m.setTile(_);else{const e=_.getInterimTile();m.setTile(e)}else m=this.createTileRepresentation({tile:_,grid:h,helper:this.helper,gutter:d}),f.set(T,m);S(i,m,c);const x=_.getKey();p[x]=!0,_.getState()===s.A.IDLE&&(e.tileQueue.isKeyQueued(x)||e.tileQueue.enqueue([_,u,h.getTileCoordCenter(r),n]))}}}beforeTilesRender(e,t){this.helper.prepareDraw(this.frameState,!t,!0)}beforeTilesMaskRender(e){return!1}renderTile(e,t,r,i,n,s,o,a,l,h,d){}renderTileMask(e,t,r,i){}drawTile_(e,t,r,i,n,s,o){if(!t.ready)return;const a=t.tile,l=a.tileCoord,h=(0,g.i7)(l),d=h in s?s[h]:1,c=o.getResolution(r),u=(0,_.xq)(o.getTileSize(r),this.tempSize_),f=o.getOrigin(r),T=o.getTileCoordExtent(l),m=d<1?-1:y(r);d<1&&(e.animate=!0);const x=e.viewState,R=x.center[0],v=x.center[1],E=u[0]+2*i,S=u[1]+2*i,C=E/S,A=(R-f[0])/(u[0]*c),I=(f[1]-v)/(u[1]*c),w=x.resolution/c,P=l[1],b=l[2];(0,p.cL)(this.tileTransform_),(0,p.hs)(this.tileTransform_,2/(e.size[0]*w/E),-2/(e.size[1]*w/E)),(0,p.e$)(this.tileTransform_,x.rotation),(0,p.hs)(this.tileTransform_,1,1/C),(0,p.Tl)(this.tileTransform_,(u[0]*(P-A)-i)/E,(u[1]*(b-I)-i)/S),this.renderTile(t,this.tileTransform_,e,n,c,u,f,T,m,i,d)}renderFrame(e){this.frameState=e,this.renderComplete=!0;const t=this.helper.getGL();this.preRender(t,e);const r=e.viewState,o=this.getLayer(),a=o.getRenderSource(),l=a.getTileGridForProjection(r.projection),h=a.getGutterForProjection(r.projection),d=C(e,e.extent),u=l.getZForResolution(r.resolution,a.zDirection),p=v(),T=o.getPreload();if(e.nextExtent){const t=l.getZForResolution(r.nextResolution,a.zDirection),i=C(e,e.nextExtent);this.enqueueTiles(e,i,t,p,T)}this.enqueueTiles(e,d,u,p,0),T>0&&setTimeout((()=>{this.enqueueTiles(e,d,u-1,p,T-1)}),0);const m={},_=(0,c.v6)(this),x=e.time;let E=!1;for(const c of p.representationsByZ[u]){const e=c.tile;if((e instanceof n.A||e instanceof i.A)&&e.getState()===s.A.EMPTY)continue;const t=e.tileCoord;if(c.ready){const r=e.getAlpha(_,x);if(1===r){e.endTransition(_);continue}E=!0;const i=(0,g.i7)(t);m[i]=r}this.renderComplete=!1;const r=this.findAltTiles_(l,t,u+1,p);if(r)continue;const o=l.getMinZoom();for(let i=u-1;i>=o;--i){const e=this.findAltTiles_(l,t,i,p);if(e)break}}const S=p.representationsByZ,A=Object.keys(S).map(Number).sort(f.rG),I=this.beforeTilesMaskRender(e);if(I)for(let i=0,n=A.length;i<n;++i){const e=A[i];for(const t of S[e]){const r=t.tile.tileCoord,i=(0,g.i7)(r);if(i in m)continue;const n=l.getTileCoordExtent(r);this.renderTileMask(t,e,n,y(e))}}this.beforeTilesRender(e,E);for(let i=0,n=A.length;i<n;++i){const t=A[i];for(const r of S[t]){const i=r.tile.tileCoord,n=(0,g.i7)(i);n in m||this.drawTile_(e,r,t,h,d,m,l)}}for(const i of S[u]){const t=i.tile.tileCoord,r=(0,g.i7)(t);r in m&&this.drawTile_(e,i,u,h,d,m,l)}this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const w=this.helper.getCanvas(),P=this.tileRepresentationCache;while(P.canExpireCache()){const e=P.pop();e.dispose()}const b=function(e,t){a.updateCacheSize(.1,t.viewState.projection),a.expireCache(t.viewState.projection,R)};return e.postRenderFunctions.push(b),this.postRender(t,e),w}findAltTiles_(e,t,r,i){const n=e.getTileRangeForTileCoordAndZ(t,r,this.tempTileRange_);if(!n)return!1;let s=!0;const o=this.tileRepresentationCache,a=this.getLayer().getRenderSource();for(let l=n.minX;l<=n.maxX;++l)for(let e=n.minY;e<=n.maxY;++e){const t=A(a,[r,l,e]);let n=!1;if(o.containsKey(t)){const e=o.get(t);e.ready&&!E(i,e.tile)&&(S(i,e,r),n=!0)}n||(s=!1)}return s}clearCache(){const e=this.tileRepresentationCache;e.forEach((e=>e.dispose())),e.clear()}removeHelper(){this.helper&&this.clearCache(),super.removeHelper()}disposeInternal(){super.disposeInternal(),delete this.frameState}}const w=I;var P=r(63722),b=r(90130);const F={...x,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},D={TEXTURE_COORD:"a_textureCoord"},L=[{name:D.TEXTURE_COORD,size:2,type:P.jQ.FLOAT}];class O extends w{constructor(e,t){super(e,t),this.program_,this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.indices_=new a.Ay(b.IP,b.Ek),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=t.paletteTextures||[]}reset(e){if(super.reset(e),this.helper){const e=this.helper.getGL();for(const t of this.paletteTextures_)t.delete(e)}this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.paletteTextures_=e.paletteTextures||[],this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}removeHelper(){if(this.helper){const e=this.helper.getGL();for(const t of this.paletteTextures_)t.delete(e)}super.removeHelper()}createTileRepresentation(e){return new o.A(e)}beforeTilesRender(e,t){super.beforeTilesRender(e,t),this.helper.useProgram(this.program_,e)}renderTile(e,t,r,i,n,s,o,a,l,h,d){const c=this.helper.getGL();this.helper.bindBuffer(e.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(L);let g=0;while(g<e.textures.length){const t=`${F.TILE_TEXTURE_ARRAY}[${g}]`;this.helper.bindTexture(e.textures[g],g,t),++g}for(let u=0;u<this.paletteTextures_.length;++u){const e=this.paletteTextures_[u],t=e.getTexture(c);this.helper.bindTexture(t,g,e.name),++g}const p=r.viewState,f=s[0]+2*h,T=s[1]+2*h,_=e.tile,x=_.tileCoord,R=x[1],y=x[2];this.helper.setUniformMatrixValue(F.TILE_TRANSFORM,(0,u.Z)(this.tempMat4,t)),this.helper.setUniformFloatValue(F.TRANSITION_ALPHA,d),this.helper.setUniformFloatValue(F.DEPTH,l);let v=i;h>0&&(v=a,(0,m._N)(v,i,v)),this.helper.setUniformFloatVec4(F.RENDER_EXTENT,v),this.helper.setUniformFloatValue(F.RESOLUTION,p.resolution),this.helper.setUniformFloatValue(F.ZOOM,p.zoom),this.helper.setUniformFloatValue(F.TEXTURE_PIXEL_WIDTH,f),this.helper.setUniformFloatValue(F.TEXTURE_PIXEL_HEIGHT,T),this.helper.setUniformFloatValue(F.TEXTURE_RESOLUTION,n),this.helper.setUniformFloatValue(F.TEXTURE_ORIGIN_X,o[0]+R*s[0]*n-h*n),this.helper.setUniformFloatValue(F.TEXTURE_ORIGIN_Y,o[1]-y*s[1]*n+h*n),this.helper.drawElements(0,this.indices_.getSize())}getData(e){const t=this.helper.getGL();if(!t)return null;const r=this.frameState;if(!r)return null;const o=this.getLayer(),a=(0,p.Bb)(r.pixelToCoordinateTransform,e.slice()),l=r.viewState,h=o.getExtent();if(h&&!(0,m.Ym)((0,T.fromUserExtent)(h,l.projection),a))return null;const d=o.getSources((0,m.Tr)([a]),l.resolution);let c,u,g;for(c=d.length-1;c>=0;--c)if(u=d[c],"ready"===u.getState()){if(g=u.getTileGridForProjection(l.projection),u.getWrapX())break;const e=g.getExtent();if(!e||(0,m.Ym)(e,a))break}if(c<0)return null;const f=this.tileRepresentationCache;for(let p=g.getZForResolution(l.resolution);p>=g.getMinZoom();--p){const e=g.getTileCoordForCoordAndZ(a,p),t=A(u,e);if(!f.containsKey(t))continue;const r=f.get(t),o=r.tile;if((o instanceof n.A||o instanceof i.A)&&o.getState()===s.A.EMPTY)return null;if(!r.loaded)continue;const l=g.getOrigin(p),h=(0,_.xq)(g.getTileSize(p)),d=g.getResolution(p),c=(a[0]-l[0])/d-e[1]*h[0],T=(l[1]-a[1])/d-e[2]*h[1];return r.getPixelData(c,T)}return null}disposeInternal(){const e=this.helper;if(e){const t=e.getGL();for(const e of this.paletteTextures_)e.delete(t);this.paletteTextures_.length=0,t.deleteProgram(this.program_),delete this.program_,e.deleteBuffer(this.indices_)}super.disposeInternal(),delete this.indices_}}const G=O}}]);
//# sourceMappingURL=2559.06b84f86.js.map