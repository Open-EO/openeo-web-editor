"use strict";(globalThis["webpackChunk_openeo_web_editor"]=globalThis["webpackChunk_openeo_web_editor"]||[]).push([[2693],{53266:(e,r,t)=>{t.r(r),t.d(r,{default:()=>f});var s=function(){var e=this,r=e._self._c;return r("Modal",{attrs:{show:e.show,width:"80%",title:"Formula Editor"},on:{closed:function(r){return e.$emit("closed")}},scopedSlots:e._u([{key:"default",fn:function(){return[r("div",{staticClass:"content"},[r("TextEditor",{ref:"editor",staticClass:"editor",attrs:{id:"input",language:"math",placeholder:"e.g. x * 2.5 / (x - y)"},on:{drop:e.onDrop,dragover:e.allowDrop},model:{value:e.input,callback:function(r){e.input=r},expression:"input"}}),r("div",{staticClass:"description"},[r("p",[r("i",{staticClass:"fas fa-info-circle"}),e._v(" Above you can insert a mathematical formula and it will be converted to openEO code for you.")]),r("p",[r("strong",[e._v("Operators")]),e._v(":"),r("br"),e._l(e.operators,(function(t){return r("kbd",{key:t.op,staticClass:"click",attrs:{title:t.title,draggable:"true"},on:{click:function(r){return e.broadcast("showProcess",{id:t.processId})},dragstart:function(r){return e.onDrag(r,"operators",t.op)}}},[e._v(e._s(t.op))])}))],2),r("p",[e._v("Supported "),r("strong",[e._v("mathematical functions")]),e._v(": "),e.mathProcesses.length?[r("br"),e._l(e.mathProcesses,(function(t){return r("kbd",{key:t.id,staticClass:"click",attrs:{title:t.summary,draggable:"true"},on:{click:function(r){return e.broadcast("showProcess",t)},dragstart:function(r){return e.onDrag(r,"functions",t)}}},[e._v(e._s(t.id))])}))]:[e._v("None")]],2),r("p",[e._v("Available "),r("strong",[e._v("output from processes")]),e._v(": "),e.results.length?[r("br"),e._l(e.results,(function(t){return r("kbd",{key:t,attrs:{draggable:"true"},on:{dragstart:function(r){return e.onDrag(r,"results",t)}}},[e._v("#"+e._s(t))])}))]:[e._v("None")]],2),r("p",[r("strong",[e._v("Parameters")]),e._v(": If a variable is found in the formula which can't be resolved to a pre-defined parameter, a new parameter will be created for it. Available pre-defined parameters: "),e.pgParameters.length?[r("br"),e._l(e.pgParameters,(function(t){return r("kbd",{key:t.id,staticClass:"click",attrs:{draggable:"true"},on:{click:function(r){return e.broadcast("showProcessParameter",t)},dragstart:function(r){return e.onDrag(r,"pgParameters",t.name)}}},[e._v(e._s(t.name))])}))]:[e._v("None")]],2),e.supportsArrayElement?r("p",[e._v("If the first pre-defined parameter is a (labeled) "),r("strong",[e._v("array")]),e._v(", the value for a specific index or label can be accessed by typing the numeric index or textual label with a "),r("kbd",[e._v("$")]),e._v(" in front, for example "),r("kbd",[e._v("$B1")]),e._v(" for the label B1 or "),r("kbd",[e._v("$0")]),e._v(" for the first element in the array. You can access subsequent parameters by adding additional $ characters at the beginning, e.g. "),r("kbd",[e._v("$$0")]),e._v(" for the first element of an array in the second parameter, "),r("kbd",[e._v("$$$0")]),e._v(" for the same behavior in the third parameter etc. Numeric labels are not supported.")]):e._e()])],1)]},proxy:!0},{key:"footer",fn:function(){return[r("div",{staticClass:"footer"},[r("button",{attrs:{type:"button"},on:{click:e.createResult}},[e._v("Insert")])])]},proxy:!0}])})},a=[],o=(t(98992),t(54520),t(81454),t(94679)),n=t(2566),i=t(57497),l=t(61663),p=t(60478),c=t(73902);const u={name:"ExpressionModal",mixins:[l.A],components:{Modal:o.A,TextEditor:i.A},props:{process:{type:Object,default:()=>({})}},data(){return{show:!0,input:"",arrayElements:{},result:{},replace:!1}},created(){try{this.importFormula()}catch(e){console.info(e)}if(this.arrayElements={},!this.replace)for(let r in this.process.getNodes()){let e=this.process.getNode(r);if("array_element"===e.process_id){let r=this.process.getArrayElementPlaceholder(e);this.arrayElements[r]={from_node:e.id}}}},computed:{...n.A.mapGetters(["processes"]),mathProcesses(){return this.processes.getMathProcesses()},pgParameters(){return this.process.getCallbackParameters()},operators(){var e=[];for(var r in c.Formula.operatorMapping){let t=c.Formula.operatorMapping[r],s=this.processes.get(t).summary;e.push({op:r,processId:t,title:s})}return e},results(){let e=[];for(var r in this.process.getNodes()){var t=this.process.getNode(r),s=this.processes.get(t.process_id);p.A.isMathProcess(s)&&e.push(r)}return e},supportsArrayElement(){return 0!==this.pgParameters.length&&this.processes.has("array_element")}},methods:{onDrag(e,r,t){switch(r){case"functions":let e=(t.parameters||[]).map((e=>e.name));t=t.id+"("+e.join(", ")+")";break;case"results":t="#"+t;break}e.dataTransfer.setData("text/plain",t)},allowDrop(e){e.preventDefault()},onDrop(e){var r=e.dataTransfer.getData("text/plain");r&&(e.preventDefault(),this.$refs.editor.insert(r,!1))},importFormula(){let e=this.process.toFormulaString();e&&(this.input=e,this.replace=!0)},createResult(){if(0!==this.input.length)try{this.result={};let e=new c.Formula(this.input),r=this.parseTree(e.tree);if(!n.A.isObject(r)||!r.from_node)throw new Error("Invalid formula specified.");this.result[r.from_node].result=!0,this.$emit("save",this.result,this.replace),this.show=!1}catch(e){n.A.exception(this,e)}else this.show=!1},parseTree(e){let r=Object.keys(e)[0];switch(r){case"Number":return Number.parseFloat(e.Number);case"Identifier":return this.getRef(e.Identifier);case"Expression":return this.parseTree(e.Expression);case"FunctionCall":let t=[];for(let r in e.FunctionCall.args)t.push(this.parseTree(e.FunctionCall.args[r]));return this.addProcess(e.FunctionCall.name,t);case"Binary":return this.addOperatorProcess(e.Binary.operator,this.parseTree(e.Binary.left),this.parseTree(e.Binary.right));case"Unary":let s=this.parseTree(e.Unary.expression);return"-"===e.Unary.operator?"number"===typeof s?-s:this.addOperatorProcess("*",-1,s):s;default:throw new Error("Operation "+r+" not supported.")}},getRef(e){if("true"===e)return!0;if("false"===e)return!1;if("null"===e)return null;if("string"===typeof e&&e.startsWith("#")){let r=e.substring(1);if(this.results.includes(r))return{from_node:r}}if(this.supportsArrayElement&&"string"===typeof e){let r=e.match(/^\$+/),t=r?r[0].length:0;if(t>0){let r=e.substring(t);if(!(e in this.arrayElements)){let s={data:{from_parameter:this.pgParameters[t-1].name}};r.match(/^\d+$/)?s.index=Number.parseInt(r,10):s.label=r,this.arrayElements[e]=this.addProcess("array_element",s)}return this.arrayElements[e]}}return this.pgParameters.filter((r=>r.name===e)).length,{from_parameter:e}},addOperatorProcess(e,r,t){if("undefined"!==typeof c.Formula.operatorMapping[e]){let s=this.processes.get(c.Formula.operatorMapping[e]),a={};if(!s||!Array.isArray(s.parameters)||s.parameters.length<2)throw new Error("Process for operator "+e+" must have at least two parameters");return a[s.parameters[0].name||"x"]=r,a[s.parameters[1].name||"y"]=t,this.addProcess(s,a)}throw new Error("Operator "+e+" not supported.")},addProcess(e,r){if("string"===typeof e&&(e=this.processes.get(e)),!e)throw new Error("Process not available: "+name);if(r.length>n.A.size(e.parameters))throw new Error("Number of given arguments exceeds number of process parameters for process '"+name+"'.");if(Array.isArray(r)){let t={};for(let s in r){let a=e.parameters[s];t[a.name]=r[s]}r=t}let t=n.A.getUniqueId(),s={process_id:e.id,arguments:r};return this.result[t]=s,{from_node:t}}}},d=u;var h=t(81656),m=(0,h.A)(d,s,a,!1,null,"cc5174a6",null);const f=m.exports}}]);
//# sourceMappingURL=2693.dd73dbf1.js.map