{"version":3,"file":"js/chunk-vendors-8cbd2506.d3e7ed5a.js","mappings":"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","sources":["webpack://@openeo/web-editor/./node_modules/@radiantearth/stac-migrate/migrate.js","webpack://@openeo/web-editor/./node_modules/uint8arrays/concat.js","webpack://@openeo/web-editor/./node_modules/uint8arrays/from-string.js","webpack://@openeo/web-editor/./node_modules/uint8arrays/to-string.js","webpack://@openeo/web-editor/./node_modules/uint8arrays/util/bases.js"],"sourcesContent":["// Migration rules partly based on PySTAC and @openeo/js-commons,\r\n// see https://github.com/stac-utils/pystac/tree/v0.5.4/pystac/serialization/migrate.py\r\n// and https://github.com/Open-EO/openeo-js-commons/tree/v1.2.0/src/migrate/collections.js\r\n\r\nvar compareVersions = require('compare-versions');\r\n\r\nconst LATEST_VERSION = '1.0.0';\r\nconst DONE = true; // This is used to verify in code coverage whether something has been used or not\r\nconst SCHEMAS = {\r\n\t'datacube': 'https://stac-extensions.github.io/datacube/v1.0.0/schema.json',\r\n\t'eo': 'https://stac-extensions.github.io/eo/v1.0.0/schema.json',\r\n\t'file': 'https://stac-extensions.github.io/file/v1.0.0/schema.json',\r\n\t'item-assets': 'https://stac-extensions.github.io/item-assets/v1.0.0/schema.json',\r\n\t'label': 'https://stac-extensions.github.io/label/v1.0.0/schema.json',\r\n\t'pointcloud': 'https://stac-extensions.github.io/pointcloud/v1.0.0/schema.json',\r\n\t'processing': 'https://stac-extensions.github.io/processing/v1.0.0/schema.json',\r\n\t'projection': 'https://stac-extensions.github.io/projection/v1.0.0/schema.json',\r\n\t'raster': 'https://stac-extensions.github.io/raster/v1.0.0/schema.json',\r\n\t'sar': 'https://stac-extensions.github.io/sar/v1.0.0/schema.json',\r\n\t'sat': 'https://stac-extensions.github.io/sat/v1.0.0/schema.json',\r\n\t'scientific': 'https://stac-extensions.github.io/scientific/v1.0.0/schema.json',\r\n\t'timestamps': 'https://stac-extensions.github.io/timestamps/v1.0.0/schema.json',\r\n\t'version': 'https://stac-extensions.github.io/version/v1.0.0/schema.json',\r\n\t'view': 'https://stac-extensions.github.io/view/v1.0.0/schema.json'\r\n};\r\nconst EXTENSIONS = {\r\n\t// Add a : at the end to indicate it has a prefix, otherwise list all fields separately (see version extension for example).\r\n\titemAndCollection: {\r\n\t\t// with prefix\r\n\t\t'cube:': SCHEMAS.datacube,\r\n\t\t'eo:': SCHEMAS.eo,\r\n\t\t'file:': SCHEMAS.file,\r\n\t\t'label:': SCHEMAS.label,\r\n\t\t'pc:': SCHEMAS.pointcloud,\r\n\t\t'processing:': SCHEMAS.processing,\r\n\t\t'proj:': SCHEMAS.projection,\r\n\t\t'raster:': SCHEMAS.raster,\r\n\t\t'sar:': SCHEMAS.sar,\r\n\t\t'sat:': SCHEMAS.sat,\r\n\t\t'sci:': SCHEMAS.scientific,\r\n\t\t'view:': SCHEMAS.view,\r\n\t\t// without prefix\r\n\t\t'version': SCHEMAS.version,\r\n\t\t'deprecated': SCHEMAS.version,\r\n\t\t'published': SCHEMAS.timestamps,\r\n\t\t'expires': SCHEMAS.timestamps,\r\n\t\t'unpublished': SCHEMAS.timestamps\r\n\t},\r\n\tcatalog: {\r\n\t\t// None yet\r\n\t},\r\n\tcollection: {\r\n\t\t'item_assets': SCHEMAS['item-assets']\r\n\t},\r\n\titem: {\r\n\t\t// None yet\r\n\t},\r\n};\r\nEXTENSIONS.collection = Object.assign(EXTENSIONS.collection, EXTENSIONS.itemAndCollection);\r\nEXTENSIONS.item = Object.assign(EXTENSIONS.item, EXTENSIONS.itemAndCollection);\r\n\r\nvar V = {\r\n\tversion: LATEST_VERSION,\r\n\r\n\tset(version) {\r\n\t\tif (!version) {\r\n\t\t\tversion = '0.6.0'; // Assume the worst case, it doesn't seem there's a clear indicator for 0.7.0\r\n\t\t}\r\n\t\tV.version = version;\r\n\t},\r\n\r\n\tbefore(version) {\r\n\t\treturn compareVersions.compare(V.version, version, '<');\r\n\t}\r\n};\r\n\r\nvar _ = {\r\n\r\n\ttype(val) {\r\n\t\tlet type = typeof val;\r\n\t\tif (type === 'object') {\r\n\t\t\tif (val === null) {\r\n\t\t\t\treturn 'null';\r\n\t\t\t}\r\n\t\t\telse if (Array.isArray(val)) {\r\n\t\t\t\treturn 'array';\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn type;\r\n\t},\r\n\r\n\tis(val, type) {\r\n\t\treturn (_.type(val) === type);\r\n\t},\r\n\r\n\tisDefined(val) {\r\n\t\treturn (typeof val !== 'undefined');\r\n\t},\r\n\r\n\tisObject(obj) {\r\n\t\treturn (typeof obj === 'object' && obj === Object(obj) && !Array.isArray(obj));\r\n\t},\r\n\r\n\trename(obj, oldKey, newKey) {\r\n\t\tif (typeof obj[oldKey] !== 'undefined' && typeof obj[newKey] === 'undefined') {\r\n\t\t\tobj[newKey] = obj[oldKey];\r\n\t\t\tdelete obj[oldKey];\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\ttoArray(obj, key) {\r\n\t\tif (typeof obj[key] !== 'undefined' && !Array.isArray(obj[key])) {\r\n\t\t\tobj[key] = [obj[key]];\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\tflattenArray(obj, key, newKeys, summary = false) {\r\n\t\tif (Array.isArray(obj[key])) {\r\n\t\t\tfor(let i in obj[key]) {\r\n\t\t\t\tif (typeof newKeys[i] === 'string') {\r\n\t\t\t\t\tlet value = obj[key][i];\r\n\t\t\t\t\tobj[newKeys[i]] = summary ? [value] : value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tdelete obj[key];\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\tflattenOneElementArray(obj, key, summary = false) {\r\n\t\tif (!summary && Array.isArray(obj[key])) {\r\n\t\t\tif (obj[key].length === 1) {\r\n\t\t\t\tobj[key] = obj[key][0];\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn false; // It's still an array and we don't know which element to choose\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true; // It's already a single element\r\n\t},\r\n\r\n\tremoveFromArray(obj, key, valueToRemove) {\r\n\t\tif (Array.isArray(obj[key])) {\r\n\t\t\tlet index = obj[key].indexOf(valueToRemove);\r\n\t\t\tif (index > -1) {\r\n\t\t\t\tobj[key].splice(index, 1);\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\taddToArrayIfNotExists(obj, key, valueToAdd) {\r\n\t\tif (Array.isArray(obj[key])) {\r\n\t\t\tlet index = obj[key].indexOf(valueToAdd);\r\n\t\t\tif (index === -1) {\r\n\t\t\t\tobj[key].push(valueToAdd);\r\n\t\t\t}\r\n\t\t\tobj[key].sort();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\tensure(obj, key, defaultValue) {\r\n\t\tif (_.type(defaultValue) !== _.type(obj[key])) {\r\n\t\t\tobj[key] = defaultValue;\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\r\n\taddExtension(context, newExtension) {\r\n\t\tif (!_.isObject(context)) {\r\n\t\t\treturn true; // We are likely in summaries and don't need to do anything\r\n\t\t}\r\n\r\n\t\treturn _.addToArrayIfNotExists(context, 'stac_extensions', newExtension) && DONE;\r\n\t},\r\n\r\n\tremoveExtension(context, oldExtension) {\r\n\t\tif (!_.isObject(context)) {\r\n\t\t\treturn true; // We are likely in summaries and don't need to do anything\r\n\t\t}\r\n\r\n\t\treturn _.removeFromArray(context, 'stac_extensions', oldExtension) && DONE;\r\n\t},\r\n\r\n\tmigrateExtensionShortnames(context) {\r\n\t\tlet oldShortnames = Object.keys(SCHEMAS);\r\n\t\tlet newSchemas = Object.values(SCHEMAS);\r\n\t\treturn _.mapValues(context, 'stac_extensions', oldShortnames, newSchemas);\r\n\t},\r\n\r\n\tpopulateExtensions(context, type) {\r\n\t\tlet objectsToCheck = [];\r\n\t\tif (type == 'catalog' || type == 'collection') {\r\n\t\t\tobjectsToCheck.push(context);\r\n\t\t}\r\n\t\tif ((type == 'item' || type == 'collection') && _.isObject(context.assets)) {\r\n\t\t\tobjectsToCheck = objectsToCheck.concat(Object.values(context.assets));\r\n\t\t}\r\n\t\tif (type == 'collection' && _.isObject(context.item_assets)) {\r\n\t\t\tobjectsToCheck = objectsToCheck.concat(Object.values(context.item_assets));\r\n\t\t}\r\n\t\tif (type == 'collection' && _.isObject(context.summaries)) {\r\n\t\t\tobjectsToCheck = objectsToCheck.concat(Object.values(context.summaries));\r\n\t\t}\r\n\t\tif (type == 'item' && _.isObject(context.properties)) {\r\n\t\t\tobjectsToCheck.push(context.properties);\r\n\t\t}\r\n\r\n\t\tfor (let obj of objectsToCheck) {\r\n\t\t\tObject.keys(obj).forEach(key => {\r\n\t\t\t\tlet prefix = key.match(/^(\\w+:|[^:]+$)/i);\r\n\t\t\t\tif (Array.isArray(prefix)) {\r\n\t\t\t\t\tlet ext = EXTENSIONS[type][prefix[0]];\r\n\t\t\t\t\t_.is(ext, 'string') && _.addExtension(context, ext) && DONE;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\tmapValues(obj, key, oldValues, newValues) {\r\n\t\tlet fn = value => {\r\n\t\t\tlet index = oldValues.indexOf(value);\r\n\t\t\tif (index >= 0) {\r\n\t\t\t\treturn newValues[index];\r\n\t\t\t}\r\n\t\t\treturn value;\t\r\n\t\t};\r\n\t\tif (Array.isArray(obj[key])) {\r\n\t\t\tobj[key] = obj[key].map(fn);\r\n\t\t}\r\n\t\telse if (typeof obj[key] !== 'undefined') {\r\n\t\t\tobj[key] = fn(obj[key]);\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\r\n\tmapObject(obj, fn) {\r\n\t\tfor(let key in obj) {\r\n\t\t\tobj[key] = fn(obj[key], key);\r\n\t\t}\r\n\t},\r\n\r\n\tmoveTo(obj, key, context, fromSummary = false, mergedSummary = false) {\r\n\t\tlet condition;\r\n\t\tif (fromSummary) {\r\n\t\t\tif (mergedSummary) {\r\n\t\t\t\tcondition = val => Array.isArray(val);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tcondition = val => Array.isArray(val) && val.length === 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tcondition = _.isDefined\r\n\t\t}\r\n\t\tif (condition(obj[key])) {\r\n\t\t\tcontext[key] = fromSummary && !mergedSummary ? obj[key][0] : obj[key];\r\n\t\t\tdelete obj[key];\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\trunAll(migrations, obj, context = null) {\r\n\t\tfor(let fn in migrations) {\r\n\t\t\tif (!fn.startsWith('migrate')) {\r\n\t\t\t\tmigrations[fn](obj, context);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\ttoUTC(obj, key) {\r\n\t\tif (typeof obj[key] === 'string') {\r\n\t\t\ttry {\r\n\t\t\t\tobj[key] = this.toISOString(obj[key]);\r\n\t\t\t\treturn true;\r\n\t\t\t} catch(error) {}\r\n\t\t}\r\n\t\tdelete obj[key];\r\n\t\treturn false;\r\n\t},\r\n\r\n\ttoISOString(date) {\r\n\t\tif (!(date instanceof Date)) {\r\n\t\t\tdate = new Date(date);\r\n\t\t}\r\n\t\treturn date.toISOString().replace('.000', ''); // Don't export milliseconds if not needed\r\n\t}\r\n\r\n};\r\n\r\nvar Checksum = {\r\n\r\n\thexToUint8(hexString) {\r\n\t\tif(hexString.length === 0 || hexString.length % 2 !== 0){\r\n\t\t\tthrow new Error(`The string \"${hexString}\" is not valid hex.`)\r\n\t\t}\r\n  \t\treturn new Uint8Array(hexString.match(/.{1,2}/g).map(byte => parseInt(byte, 16)));\r\n\t},\r\n\r\n\tuint8ToHex(bytes) {\r\n\t\treturn bytes.reduce((str, byte) => str + byte.toString(16).padStart(2, '0'), '');\r\n\t},\r\n\r\n\ttoMultihash(obj, key, algo) {\r\n\t\tif (!_.is(obj[key], 'string')) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tconst multihash = require('multihashes');\r\n\t\t\tconst encoded = multihash.encode(Checksum.hexToUint8(obj[key]), algo);\r\n\t\t\tobj[key] = Checksum.uint8ToHex(encoded);\r\n\t\t\treturn true;\r\n\t\t} catch (error) {\r\n\t\t\tconsole.warn(error);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n};\r\n\r\nvar Catalog = {\r\n\r\n\tmigrate(catalog, updateVersionNumber = true) {\r\n\t\tV.set(catalog.stac_version);\r\n\t\tif (updateVersionNumber) {\r\n\t\t\tcatalog.stac_version = LATEST_VERSION;\r\n\t\t}\r\n\t\tcatalog.type = 'Catalog';\r\n\t\tV.before('1.0.0-rc.1') && _.migrateExtensionShortnames(catalog) && DONE;\r\n\r\n\t\t_.ensure(catalog, 'id', '') && DONE;\r\n\t\t_.ensure(catalog, 'description', '') && DONE;\r\n\t\t_.ensure(catalog, 'links', []) && DONE;\r\n\r\n\t\t_.runAll(Catalog, catalog, catalog);\r\n\r\n\t\t_.ensure(catalog, 'stac_extensions', []) && DONE;\r\n\t\tV.before('0.8.0') && _.populateExtensions(catalog, 'catalog') && DONE;\r\n\t},\r\n\r\n\topeneo(obj) {\r\n\t\t_.rename(obj, 'api_version', 'openeo:api_version') && DONE;\r\n\t\t_.rename(obj, 'backend_version', 'openeo:backend_version') && DONE;\r\n\t\t_.rename(obj, 'production', 'openeo:production') && DONE;\r\n\t\t_.rename(obj, 'endpoints', 'openeo:endpoints') && DONE;\r\n\t\t_.rename(obj, 'billing', 'openeo:billing') && DONE;\r\n\t},\r\n\r\n};\r\n\r\nvar Collection = {\r\n\r\n\tmigrate(collection, updateVersionNumber = true) {\r\n\t\tCatalog.migrate(collection, updateVersionNumber); // Migrates stac_version, stac_extensions, id, title, description, links\r\n\t\tcollection.type = 'Collection';\r\n\t\tV.before('1.0.0-rc.1') && _.migrateExtensionShortnames(collection) && DONE;\r\n\r\n\t\t_.ensure(collection, 'license', 'proprietary') && DONE;\r\n\t\t_.ensure(collection, 'extent', {\r\n\t\t\tspatial: {\r\n\t\t\t\tbbox: []\r\n\t\t\t},\r\n\t\t\ttemporal: {\r\n\t\t\t\tinterval: []\r\n\t\t\t}\r\n\t\t}) && DONE;\r\n\r\n\t\t_.runAll(Collection, collection, collection);\r\n\r\n\t\t// Migrate Commons extension - part 3\r\n\t\tif (_.isObject(collection.properties)) {\r\n\t\t\t_.removeFromArray(collection, 'stac_extensions', 'commons') && DONE;\r\n\t\t\tdelete collection.properties;\r\n\t\t}\r\n\r\n\t\tV.before('0.8.0') && _.populateExtensions(collection, 'collection') && DONE;\r\n\t\tV.before('1.0.0-beta.1') && _.mapValues(collection, 'stac_extensions', ['assets'], ['item-assets']) && DONE;\r\n\t},\r\n\r\n\textent(collection) {\r\n\t\t_.ensure(collection, \"extent\", {});\r\n\r\n\t\tif (V.before('0.8.0')) {\r\n\t\t\t// Restructure spatial extent\r\n\t\t\tif (Array.isArray(collection.extent.spatial)) {\r\n\t\t\t\tcollection.extent.spatial = {\r\n\t\t\t\t\tbbox: [\r\n\t\t\t\t\t\tcollection.extent.spatial\r\n\t\t\t\t\t]\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\t// Restructure temporal extent\r\n\t\t\tif (Array.isArray(collection.extent.temporal)) {\r\n\t\t\t\tcollection.extent.temporal = {\r\n\t\t\t\t\tinterval: [\r\n\t\t\t\t\t\tcollection.extent.temporal\r\n\t\t\t\t\t]\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t_.ensure(collection.extent, \"spatial\", {});\r\n\t\t_.ensure(collection.extent.spatial, \"bbox\", []);\r\n\t\t_.ensure(collection.extent, \"temporal\", {});\r\n\t\t_.ensure(collection.extent.temporal, \"interval\", []);\r\n\r\n\t\tif (V.before('1.0.0-rc.3')) {\r\n\t\t\t// The first extent in a Collection is always the overall extent, followed by more specific extents.\r\n\t\t\tif (collection.extent.temporal.interval.length > 1) {\r\n\t\t\t\tlet min, max;\r\n\t\t\t\tfor(let interval of collection.extent.temporal.interval) {\r\n\t\t\t\t\tif (interval[0] === null) {\r\n\t\t\t\t\t\tmin = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (typeof interval[0] === 'string' && min !== null) {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tlet start = new Date(interval[0]);\r\n\t\t\t\t\t\t\tif (typeof min === 'undefined' || start < min) {\r\n\t\t\t\t\t\t\t\tmin = start;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} catch (error) {}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (interval[1] === null) {\r\n\t\t\t\t\t\tmax = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (typeof interval[1] === 'string' && max !== null) {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tlet end = new Date(interval[1]);\r\n\t\t\t\t\t\t\tif (typeof max === 'undefined' || end > max) {\r\n\t\t\t\t\t\t\t\tmax = end;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} catch (error) {}\r\n\t\t\t\t\t} \r\n\t\t\t\t}\r\n\t\t\t\tcollection.extent.temporal.interval.unshift([\r\n\t\t\t\t\tmin ? _.toISOString(min) : null,\r\n\t\t\t\t\tmax ? _.toISOString(max) : null\r\n\t\t\t\t]);\r\n\t\t\t}\r\n\t\t\tif (collection.extent.spatial.bbox.length > 1) {\r\n\t\t\t\tlet count = collection.extent.spatial.bbox.reduce((val, bbox) => Array.isArray(bbox) ? Math.max(bbox.length, val) : val, 4);\r\n\t\t\t\tif (count >= 4) {\r\n\t\t\t\t\tlet union = new Array(count).fill(null);\r\n\t\t\t\t\tlet middle = count / 2;\r\n\t\t\t\t\tfor(let bbox of collection.extent.spatial.bbox) {\r\n\t\t\t\t\t\tif (!Array.isArray(bbox) || bbox.length < 4) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfor(let i in bbox) {\r\n\t\t\t\t\t\t\tlet c = bbox[i];\r\n\t\t\t\t\t\t\tif (union[i] === null) {\r\n\t\t\t\t\t\t\t\tunion[i] = c;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if (i < middle) {\r\n\t\t\t\t\t\t\t\tunion[i] = Math.min(c, union[i]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tunion[i] = Math.max(c, union[i]);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (union.findIndex(c => c === null) === -1) {\r\n\t\t\t\t\t\tcollection.extent.spatial.bbox.unshift(union);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tcollectionAssets(collection) {\r\n\t\tV.before('1.0.0-rc.1') && _.removeExtension(collection, 'collection-assets') && DONE;\r\n\r\n\t\tAsset.migrateAll(collection);\r\n\t},\r\n\r\n\titemAsset(collection) {\r\n\t\tV.before('1.0.0-beta.2') && _.rename(collection, 'item_assets', 'assets');\r\n\r\n\t\tAsset.migrateAll(collection, 'item_assets');\r\n\t},\r\n\r\n\tsummaries(collection) {\r\n\t\t_.ensure(collection, 'summaries', {});\r\n\r\n\t\t// other_properties: An early version of the Collection summaries with a similar structure\r\n\t\t// Was mostly used in standalone collctions from openEO and GEE. Move other_properties to summaries.\r\n\t\tif (V.before('0.8.0') && _.isObject(collection.other_properties)) {\r\n\t\t\tfor(let key in collection.other_properties) {\r\n\t\t\t\tlet prop = collection.other_properties[key];\r\n\t\t\t\tif (Array.isArray(prop.extent) && prop.extent.length === 2) {\r\n\t\t\t\t\tcollection.summaries[key] = {\r\n\t\t\t\t\t\tminimum: prop.extent[0],\r\n\t\t\t\t\t\tmaximum: prop.extent[1],\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\telse if (Array.isArray(prop.values)) {\r\n\t\t\t\t\tif (prop.values.filter(v => Array.isArray(v)).length === prop.values.length) {\r\n\t\t\t\t\t\t// If it is an array of arrays, merge the arrays\r\n\t\t\t\t\t\tcollection.summaries[key] = prop.values.reduce((a, b) => a.concat(b), []);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tcollection.summaries[key] = prop.values;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tdelete collection.other_properties;\r\n\t\t}\r\n\r\n\t\t// Migrate Commons extension - part 2\r\n\t\t// Move properties to (single element) summaries if the Collection is standalone\r\n\t\t// see also https://github.com/stac-utils/stac-migrate/issues/3\r\n\t\tif (V.before('1.0.0-beta.1') && _.isObject(collection.properties) && !collection.links.find(link => ['child', 'item'].includes(link.rel))) {\r\n\t\t\tfor(let key in collection.properties) {\r\n\t\t\t\tlet value = collection.properties[key];\r\n\t\t\t\tif (!Array.isArray(value)) {\r\n\t\t\t\t\tvalue = [value];\r\n\t\t\t\t}\r\n\t\t\t\tcollection.summaries[key] = value;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (V.before('1.0.0-rc.1')) {\r\n\t\t\t_.mapObject(collection.summaries, val => {\r\n\t\t\t\t_.rename(val, 'min', 'minimum') && DONE;\r\n\t\t\t\t_.rename(val, 'max', 'maximum') && DONE;\r\n\t\t\t\treturn val;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// now we can work on all summaries and migrate them\r\n\t\tFields.migrate(collection.summaries);\r\n\r\n\t\t// Some fields should usually be on root-level if there's only one element\r\n\t\t_.moveTo(collection.summaries, 'sci:doi', collection, true) && _.addExtension(collection, SCHEMAS.scientific) && DONE;\r\n\t\t_.moveTo(collection.summaries, 'sci:publications', collection, true, true) && _.addExtension(collection, SCHEMAS.scientific) && DONE;\r\n\t\t_.moveTo(collection.summaries, 'sci:citation', collection, true) && _.addExtension(collection, SCHEMAS.scientific) && DONE;\r\n\t\t_.moveTo(collection.summaries, 'cube:dimensions', collection, true) && _.addExtension(collection, SCHEMAS.datacube) && DONE;\r\n\r\n\t\t// Remove summary field if empty\r\n\t\tif (Object.keys(collection.summaries).length === 0) {\r\n\t\t\tdelete collection.summaries;\r\n\t\t}\r\n\t}\r\n\r\n};\r\n\r\nvar Item = {\r\n\r\n\tmigrate(item, collection = null, updateVersionNumber = true) {\r\n\t\tV.set(item.stac_version);\r\n\t\tif (updateVersionNumber) {\r\n\t\t\titem.stac_version = LATEST_VERSION;\r\n\t\t}\r\n\t\tV.before('1.0.0-rc.1') && _.migrateExtensionShortnames(item) && DONE;\r\n\r\n\t\t_.ensure(item, 'id', '') && DONE;\r\n\t\t_.ensure(item, 'type', 'Feature') && DONE;\r\n\t\tif (!_.isObject(item.geometry)) {\r\n\t\t\titem.geometry = null;\r\n\t\t}\r\n\t\tif (item.geometry !== null) {\r\n\t\t\t_.ensure(item, 'bbox', []) && DONE;\r\n\t\t}\r\n\t\t_.ensure(item, 'properties', {}) && DONE;\r\n\t\t_.ensure(item, 'links', []) && DONE;\r\n\t\t_.ensure(item, 'assets', {}) && DONE;\r\n\r\n\t\t// Migrate Commons extension - part 1\r\n\t\tlet commons = false;\r\n\t\tif (_.isObject(collection) && _.isObject(collection.properties)) {\r\n\t\t\t_.removeFromArray(item, 'stac_extensions', 'commons');\r\n\t\t\titem.properties = Object.assign({}, collection.properties, item.properties);\r\n\t\t\tcommons = true;\r\n\t\t}\r\n\r\n\t\t_.runAll(Item, item, item);\r\n\r\n\t\tFields.migrate(item.properties, item);\r\n\r\n\t\tAsset.migrateAll(item);\r\n\r\n\t\t_.ensure(item, 'stac_extensions', []) && DONE;\r\n\t\t// Also populate extensions if commons has been implemented\r\n\t\t(V.before('0.8.0') || commons) && _.populateExtensions(item, 'item') && DONE;\r\n\t}\r\n\r\n};\r\n\r\nvar Asset = {\r\n\r\n\tmigrateAll(context, field = 'assets') {\r\n\t\tfor(let key in context[field]) {\r\n\t\t\tAsset.migrate(context[field][key], context);\r\n\t\t}\r\n\t},\r\n\r\n\tmigrate(asset, context) {\r\n\t\t_.runAll(Asset, asset, context);\r\n\t\tFields.migrate(asset, context);\r\n\t},\r\n\r\n\tmediaTypes(asset) {\r\n\t\t_.is(asset.type, 'string') && _.mapValues(\r\n\t\t\tasset, 'type',\r\n\t\t\t['image/vnd.stac.geotiff', \t\t\t'image/vnd.stac.geotiff; cloud-optimized=true'],\r\n\t\t\t['image/tiff; application=geotiff',\t'image/tiff; application=geotiff; profile=cloud-optimized']\r\n\t\t);\r\n\t},\r\n\r\n\teo(asset, context) {\r\n\t\tlet bands = _.isObject(context.properties) && Array.isArray(context.properties['eo:bands']) ? context.properties['eo:bands'] : [];\r\n\t\tif (Array.isArray(asset['eo:bands'])) {\r\n\t\t\tfor(let i in asset['eo:bands']) {\r\n\t\t\t\tlet band = asset['eo:bands'][i];\r\n\t\t\t\tif (_.is(band, 'number') && _.isObject(bands[band])) {\r\n\t\t\t\t\tband = bands[band];\r\n\t\t\t\t}\r\n\t\t\t\telse if (!_.isObject(band)) {\r\n\t\t\t\t\tband = {}; // \"Fix\" invalid band index\r\n\t\t\t\t}\r\n\t\t\t\tasset['eo:bands'][i] = band;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n};\r\n\r\nvar Fields = {\r\n\r\n\t// If no context is given, we are working in summaries\r\n\tmigrate(obj, context) {\r\n\t\t_.runAll(Fields, obj, context);\r\n\t},\r\n\r\n\t_commonMetadata(obj) {\r\n\t\t// Timestamps must be always in UTC\r\n\t\t// datetime, start_datetime and end_datetime already required UTC before\r\n\t\tif (V.before('1.0.0-rc.3')) {\r\n\t\t\t_.toUTC(obj, 'created') && DONE;\r\n\t\t\t_.toUTC(obj, 'updated') && DONE;\r\n\t\t}\r\n\t},\r\n\r\n\t_timestamps(obj) {\r\n\t\t// Timestamps must be always in UTC\r\n\t\t_.toUTC(obj, 'published') && DONE;\r\n\t\t_.toUTC(obj, 'expires') && DONE;\r\n\t\t_.toUTC(obj, 'unpublished') && DONE;\r\n\t},\r\n\r\n\t_versioningIndicator(obj) {\r\n\t\t// Nothing to do\r\n\t},\r\n\r\n\tchecksum(obj, context) {\r\n\t\tif (V.before('0.9.0')) {\r\n\t\t\t_.rename(obj, 'checksum:md5', 'checksum:multihash') && Checksum.toMultihash(obj, 'checksum:multihash', 'md5') && DONE;\r\n\t\t\t_.rename(obj, 'checksum:sha1', 'checksum:multihash') && Checksum.toMultihash(obj, 'checksum:multihash', 'sha1') && DONE;\r\n\t\t\t// We assume sha2/3-256 although that may fail in some cases and other lengths are chosen\r\n\t\t\t// Never seen this implemtned in the wild, so let's try this until another use case comes up\r\n\t\t\t_.rename(obj, 'checksum:sha2', 'checksum:multihash') && Checksum.toMultihash(obj, 'checksum:multihash', 'sha2-256') && DONE;\r\n\t\t\t_.rename(obj, 'checksum:sha3', 'checksum:multihash') && Checksum.toMultihash(obj, 'checksum:multihash', 'sha3-256') && DONE;\r\n\t\t}\r\n\r\n\t\tV.before('1.0.0-rc.1') && _.rename(obj, 'checksum:multihash', 'file:checksum') && _.addExtension(context, SCHEMAS.file) && DONE;\r\n\t},\r\n\r\n\tcube() {\r\n\t\t// Nothing to do\r\n\t},\r\n\r\n\tdtr(obj, context) {\r\n\t\tif (V.before('0.9.0')) {\r\n\t\t\t_.rename(obj, 'dtr:start_datetime', 'start_datetime') && DONE;\r\n\t\t\t_.rename(obj, 'dtr:end_datetime', 'end_datetime') && DONE;\r\n\t\t\t_.removeExtension(context, 'datetime-range') && DONE;\r\n\t\t}\r\n\t},\r\n\r\n\teo(obj, context) {\r\n\t\tif (V.before('0.9.0')) {\r\n\t\t\t_.rename(obj, 'eo:epsg', 'proj:epsg') && _.addExtension(context, SCHEMAS.projection) && DONE;\r\n\t\t\t_.rename(obj, 'eo:platform', 'platform') && DONE;\r\n\t\t\t_.rename(obj, 'eo:instrument', 'instruments') && _.toArray(obj, 'instruments') && DONE;\r\n\t\t\t_.rename(obj, 'eo:constellation', 'constellation') && DONE;\r\n\t\t\t_.rename(obj, 'eo:off_nadir', 'view:off_nadir') && _.addExtension(context, SCHEMAS.view) && DONE;\r\n\t\t\t_.rename(obj, 'eo:azimuth', 'view:azimuth') && _.addExtension(context, SCHEMAS.view) && DONE;\r\n\t\t\t_.rename(obj, 'eo:incidence_angle', 'view:incidence_angle') && _.addExtension(context, SCHEMAS.view) && DONE;\r\n\t\t\t_.rename(obj, 'eo:sun_azimuth', 'view:sun_azimuth') && _.addExtension(context, SCHEMAS.view) && DONE;\r\n\t\t\t_.rename(obj, 'eo:sun_elevation', 'view:sun_elevation') && _.addExtension(context, SCHEMAS.view) && DONE;\r\n\t\t}\r\n\r\n\t\tV.before('1.0.0-beta.1') && _.rename(obj, 'eo:gsd', 'gsd') && DONE;\r\n\t},\r\n\r\n\tlabel(obj) {\r\n\t\t// Migrate 0.8.0-rc1 non-pluralized forms\r\n\t\tif (V.before('0.8.0')) {\r\n\t\t\t_.rename(obj, 'label:property', 'label:properties') && DONE;\r\n\t\t\t_.rename(obj, 'label:task', 'label:tasks') && DONE;\r\n\t\t\t_.rename(obj, 'label:overview', 'label:overviews') && _.toArray(obj, 'label:overviews') && DONE;\r\n\t\t\t_.rename(obj, 'label:method', 'label:methods') && DONE;\r\n\t\t\t_.toArray(obj, 'label:classes') && DONE;\r\n\t\t}\r\n\t},\r\n\r\n\tpc(obj) {\r\n\t\tV.before('0.8.0') && _.rename(obj, 'pc:schema', 'pc:schemas') && DONE;\r\n\t},\r\n\r\n\tproj(obj) {\r\n\t\t// Nothing to do\r\n\t},\r\n\r\n\tsar(obj, context) {\r\n\t\t// If no context is given, it's in summaries\r\n\t\tlet summary = !context;\r\n\r\n\t\t// Which version have they been (re)moved?\r\n\t\t_.rename(obj, 'sar:incidence_angle', 'view:incidence_angle') && _.addExtension(context, SCHEMAS.view) && DONE;\r\n\t\t_.rename(obj, 'sar:pass_direction', 'sat:orbit_state') && _.mapValues(obj, 'sat:orbit_state', [null], ['geostationary']) && _.addExtension(context, SCHEMAS.sat) && DONE;\r\n\r\n\t\tif (V.before('0.7.0')) {\r\n\t\t\t_.flattenArray(obj, 'sar:resolution', ['sar:resolution_range', 'sar:resolution_azimuth'], summary) && DONE;\r\n\t\t\t_.flattenArray(obj, 'sar:pixel_spacing', ['sar:pixel_spacing_range', 'sar:pixel_spacing_azimuth'], summary) && DONE;\r\n\t\t\t_.flattenArray(obj, 'sar:looks', ['sar:looks_range', 'sar:looks_azimuth', 'sar:looks_equivalent_number'], summary) && DONE;\r\n\t\t\t_.rename(obj, 'sar:off_nadir', 'view:off_nadir') && _.addExtension(context, SCHEMAS.view) && DONE;\r\n\t\t}\r\n\r\n\t\tif (V.before('0.9.0')) {\r\n\t\t\t_.rename(obj, 'sar:platform', 'platform') && DONE;\r\n\t\t\t_.rename(obj, 'sar:instrument', 'instruments') && _.toArray(obj, 'instruments') && DONE;\r\n\t\t\t_.rename(obj, 'sar:constellation', 'constellation') && DONE;\r\n\t\t\t_.rename(obj, 'sar:type', 'sar:product_type') && DONE;\r\n\t\t\t_.rename(obj, 'sar:polarization', 'sar:polarizations') && DONE;\r\n\t\t\t_.flattenOneElementArray(obj, 'sar:absolute_orbit', summary) && _.rename(obj, 'sar:absolute_orbit', 'sat:absolute_orbit') && _.addExtension(context, SCHEMAS.sat) && DONE;\r\n\t\t\t_.flattenOneElementArray(obj, 'sar:relative_orbit', summary) && _.rename(obj, 'sar:relative_orbit', 'sat:relative_orbit') && _.addExtension(context, SCHEMAS.sat) && DONE;\r\n\t\t}\r\n\t},\r\n\r\n\tsat(obj) {\r\n\t\t// Migrate 0.9.0-rc _angle suffixes\r\n\t\tif (V.before('0.9.0')) {\r\n\t\t\t_.rename(obj, 'sat:off_nadir_angle', 'sat:off_nadir') && DONE;\r\n\t\t\t_.rename(obj, 'sat:azimuth_angle', 'sat:azimuth') && DONE;\r\n\t\t\t_.rename(obj, 'sat:sun_azimuth_angle', 'sat:sun_azimuth') && DONE;\r\n\t\t\t_.rename(obj, 'sat:sun_elevation_angle', 'sat:sun_elevation') && DONE;\r\n\t\t}\r\n\t},\r\n\r\n\tsci(obj) {\r\n\t\t// Nothing to do\r\n\t},\r\n\r\n\titem(obj) { // Single Item\r\n\t\tif (V.before('0.8.0')) {\r\n\t\t\t_.rename(obj, 'item:license', 'license') && DONE;\r\n\t\t\t_.rename(obj, 'item:providers', 'providers') && DONE;\r\n\t\t\t// No need to remove the extension from stac_extensions as it was not available before 0.8.0\r\n\t\t}\r\n\t},\r\n\r\n\tview(obj) {\r\n\t\t// Nothing to do\r\n\t}\r\n\r\n};\r\n\r\nvar Migrate = {\r\n\r\n\titem(item, collection = null, updateVersionNumber = true) {\r\n\t\tItem.migrate(item, collection, updateVersionNumber);\r\n\t\treturn item;\r\n\t},\r\n\t\r\n\tcatalog(catalog, updateVersionNumber = true) {\r\n\t\tCatalog.migrate(catalog, updateVersionNumber);\r\n\t\treturn catalog;\r\n\t},\r\n\t\r\n\tcollection(collection, updateVersionNumber = true) {\r\n\t\tCollection.migrate(collection, updateVersionNumber);\r\n\t\treturn collection;\r\n\t},\r\n\t\r\n\tstac(object, updateVersionNumber = true) {\r\n\t\tif (object.type === 'Feature') {\r\n\t\t\treturn Migrate.item(object, null, updateVersionNumber);\r\n\t\t}\r\n\t\telse if (object.type === 'Collection' || _.isDefined(object.extent) || _.isDefined(object.license)) {\r\n\t\t\treturn Migrate.collection(object,  updateVersionNumber);\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn Migrate.catalog(object, updateVersionNumber);\r\n\t\t}\r\n\t}\r\n\r\n};\r\n\r\nmodule.exports = Migrate;","'use strict'\n\n/**\n * Returns a new Uint8Array created by concatenating the passed ArrayLikes\n *\n * @param {Array<ArrayLike<number>>} arrays\n * @param {number} [length]\n */\nfunction concat (arrays, length) {\n  if (!length) {\n    length = arrays.reduce((acc, curr) => acc + curr.length, 0)\n  }\n\n  const output = new Uint8Array(length)\n  let offset = 0\n\n  for (const arr of arrays) {\n    output.set(arr, offset)\n    offset += arr.length\n  }\n\n  return output\n}\n\nmodule.exports = concat\n","'use strict'\n\nconst bases = require('./util/bases')\n\n/**\n * @typedef {import('./util/bases').SupportedEncodings} SupportedEncodings\n */\n\n/**\n * Create a `Uint8Array` from the passed string\n *\n * Supports `utf8`, `utf-8`, `hex`, and any encoding supported by the multiformats module.\n *\n * Also `ascii` which is similar to node's 'binary' encoding.\n *\n * @param {string} string\n * @param {SupportedEncodings} [encoding=utf8] - utf8, base16, base64, base64urlpad, etc\n * @returns {Uint8Array}\n */\nfunction fromString (string, encoding = 'utf8') {\n  const base = bases[encoding]\n\n  if (!base) {\n    throw new Error(`Unsupported encoding \"${encoding}\"`)\n  }\n\n  // add multibase prefix\n  return base.decoder.decode(`${base.prefix}${string}`)\n}\n\nmodule.exports = fromString\n","'use strict'\n\nconst bases = require('./util/bases')\n\n/**\n * @typedef {import('./util/bases').SupportedEncodings} SupportedEncodings\n */\n\n/**\n * Turns a `Uint8Array` into a string.\n *\n * Supports `utf8`, `utf-8` and any encoding supported by the multibase module.\n *\n * Also `ascii` which is similar to node's 'binary' encoding.\n *\n * @param {Uint8Array} array - The array to turn into a string\n * @param {SupportedEncodings} [encoding=utf8] - The encoding to use\n * @returns {string}\n */\nfunction toString (array, encoding = 'utf8') {\n  const base = bases[encoding]\n\n  if (!base) {\n    throw new Error(`Unsupported encoding \"${encoding}\"`)\n  }\n\n  // strip multibase prefix\n  return base.encoder.encode(array).substring(1)\n}\n\nmodule.exports = toString\n","  'use strict'\n\nconst { bases } = require('multiformats/basics')\n\n/**\n * @typedef {import('multiformats/bases/interface').MultibaseCodec<any>} MultibaseCodec\n */\n\n/**\n * @param {string} name\n * @param {string} prefix\n * @param {(buf: Uint8Array) => string} encode\n * @param {(str: string) => Uint8Array} decode\n * @returns {MultibaseCodec}\n */\nfunction createCodec (name, prefix, encode, decode) {\n  return {\n    name,\n    prefix,\n    encoder: {\n      name,\n      prefix,\n      encode\n    },\n    decoder: {\n      decode\n    }\n  }\n}\n\nconst string = createCodec('utf8', 'u', (buf) => {\n  const decoder = new TextDecoder('utf8')\n  return 'u' + decoder.decode(buf)\n}, (str) => {\n  const encoder = new TextEncoder()\n  return encoder.encode(str.substring(1))\n})\n\nconst ascii = createCodec('ascii', 'a', (buf) => {\n  let string = 'a'\n\n  for (let i = 0; i < buf.length; i++) {\n    string += String.fromCharCode(buf[i])\n  }\n  return string\n}, (str) => {\n  str = str.substring(1)\n  const buf = new Uint8Array(str.length)\n\n  for (let i = 0; i < str.length; i++) {\n    buf[i] = str.charCodeAt(i)\n  }\n\n  return buf\n})\n\n/**\n * @typedef {'utf8' | 'utf-8' | 'hex' | 'latin1' | 'ascii' | 'binary' | keyof bases } SupportedEncodings\n */\n\n/**\n * @type {Record<SupportedEncodings, MultibaseCodec>}\n */\nconst BASES = {\n  'utf8': string,\n  'utf-8': string,\n  'hex': bases.base16,\n  'latin1': ascii,\n  'ascii': ascii,\n  'binary': ascii,\n\n  ...bases\n}\n\nmodule.exports = BASES\n"],"names":["compareVersions","LATEST_VERSION","DONE","SCHEMAS","EXTENSIONS","itemAndCollection","datacube","eo","file","label","pointcloud","processing","projection","raster","sar","sat","scientific","view","version","timestamps","catalog","collection","item","Object","assign","V","set","before","compare","_","type","val","Array","isArray","is","isDefined","isObject","obj","rename","oldKey","newKey","toArray","key","flattenArray","newKeys","summary","i","value","flattenOneElementArray","length","removeFromArray","valueToRemove","index","indexOf","splice","addToArrayIfNotExists","valueToAdd","push","sort","ensure","defaultValue","addExtension","context","newExtension","removeExtension","oldExtension","migrateExtensionShortnames","oldShortnames","keys","newSchemas","values","mapValues","populateExtensions","objectsToCheck","assets","concat","item_assets","summaries","properties","forEach","prefix","match","ext","oldValues","newValues","fn","map","mapObject","moveTo","fromSummary","mergedSummary","condition","runAll","migrations","startsWith","toUTC","this","toISOString","error","date","Date","replace","Checksum","hexToUint8","hexString","Error","Uint8Array","byte","parseInt","uint8ToHex","bytes","reduce","str","toString","padStart","toMultihash","algo","multihash","encoded","encode","console","warn","Catalog","migrate","updateVersionNumber","stac_version","openeo","Collection","spatial","bbox","temporal","interval","extent","min","max","start","end","unshift","count","Math","union","fill","middle","c","findIndex","collectionAssets","Asset","migrateAll","itemAsset","other_properties","prop","minimum","maximum","filter","v","a","b","links","find","link","includes","rel","Fields","Item","geometry","commons","field","asset","mediaTypes","bands","band","_commonMetadata","_timestamps","_versioningIndicator","checksum","cube","dtr","pc","proj","sci","Migrate","stac","object","license","module","exports","arrays","acc","curr","output","offset","arr","bases","fromString","string","encoding","base","decoder","decode","array","encoder","substring","createCodec","name","buf","TextDecoder","TextEncoder","ascii","String","fromCharCode","charCodeAt","BASES","base16"],"sourceRoot":""}