"use strict";(globalThis["webpackChunk_openeo_web_editor"]=globalThis["webpackChunk_openeo_web_editor"]||[]).push([[8098],{69636:(t,e,r)=>{r.d(e,{Z:()=>g});var n=r(24832),i=r(58661),o=r(81090),a=r(2033),s=r(92371),l=r(22556);const c={mixins:[n.Z],methods:{async addExtent(t,e=!0){let r=null;r=i.Z.isObject(t)?"Collection"===t.type?t.extent.spatial.bbox.map((t=>i.Z.extentToBBox(t))):"Feature"!==t.type||t.geometry||t.bbox?t:null:t,Array.isArray(r)&&r.length>0?this.addRectangles(r,e):r&&this.addGeoJson(r,!1,"Footprint",e)},addRectangles(t,e=!0){let r=this.map.getView().getProjection(),n=t.map((t=>{let e=(0,a.oJ)([t.west,t.south,t.east,t.north]).transform("EPSG:4326",r);return new o.Z(e)})),i=new l.Z({features:n,projection:r,wrapX:!1}),c=new s.Z({title:"Bounding Boxes",displayInLayerSwitcher:!1,source:i});return e||this.removeLayerFill(c),this.map.addLayer(c),this.map.getView().fit(i.getExtent(),this.getFitOptions()),c},removeLayerFill(t){let e=t.getStyle();"function"===typeof e&&(e=e()[0]),e.setFill(null)}}},u=c;var h,f,p=r(1001),d=(0,p.Z)(u,h,f,!1,null,null,null);const g=d.exports},45281:(t,e,r)=>{r.d(e,{Z:()=>u});var n=function(){var t=this,e=t._self._c;return t.texts.length>0?e("div",{staticClass:"ol-unselectable ol-control value",class:{pointer:t.texts.length>1},on:{click:t.toggle}},[t._v(" "+t._s(t.current)+" ")]):t._e()},i=[],o=r(89518);const a={name:"TextControl",mixins:[o.Z],data(){return{i:0}},computed:{texts(){return Array.isArray(this.text)?this.text:"string"===typeof this.text&&this.text.length>0?[this.text]:[]},current(){return 0===this.texts.length?"":this.texts[this.i%this.text.length]}},props:{text:{text:[String,Array],default:""}},methods:{toggle(){this.i++}}},s=a;var l=r(1001),c=(0,l.Z)(s,n,i,!1,null,"fe2bcd86",null);const u=c.exports},41221:(t,e,r)=>{r.r(e),r.d(e,{default:()=>zn});var n=function(){var t=this,e=t._self._c;return e("Splitpanes",{staticClass:"default-theme",attrs:{horizontal:""}},[e("Pane",{attrs:{id:"map"}},[e("div",{staticClass:"map-viewer",attrs:{id:t.id}},[e("ProgressControl",{ref:"progress",attrs:{map:t.map}}),t.isGeoTiff?e("TextControl",{attrs:{text:t.textControlText}}):t._e(),t.isGeoTiff&&!t.colorMap?e("ChannelControl",{attrs:{bands:t.bands},on:{update:t.updateGeoTiffStyle}}):t._e(),t.loading?e("div",{staticClass:"map-loading"},[e("i",{staticClass:"fas fa-spinner fa-spin"}),e("span",[t._v("Loading map...")])]):t._e()],1)]),t.chart?e("Pane",{attrs:{id:"chart",size:33}},[e("ScatterChart",t._b({attrs:{height:220}},"ScatterChart",t.chart,!1))],1):t._e()],1)},i=[],o=(r(26699),r(76943)),a=r(58661),s=r(5695),l=r(25171),c=r(66209),u=r(69636),h=r(45281),f=function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"show",rawName:"v-show",value:t.channels.length>0,expression:"channels.length > 0"}],staticClass:"ol-unselectable ol-control channels"},[e("table",[e("thead",[e("tr",[t.isGray?t._e():e("th",[t._v("Channel")]),t.multiBand?e("th",[t._v("Band")]):t._e(),e("th",[t._v("Min")]),e("th",[t._v("Max")])])]),e("tbody",t._l(t.channels,(function(r,n){return e("tr",{key:n},[t.isGray?t._e():e("th",[t._v(t._s(t.labels[n]))]),t.multiBand?e("td",[e("select",{directives:[{name:"model",rawName:"v-model.number",value:r.id,expression:"channel.id",modifiers:{number:!0}}],on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(e){var r="_value"in e?e._value:e.value;return t._n(r)}));t.$set(r,"id",e.target.multiple?n:n[0])}}},t._l(t.bands,(function(r){return e("option",{key:r.id,domProps:{value:r.id}},[t._v(t._s(r.name||r.id))])})),0)]):t._e(),e("td",[e("input",{directives:[{name:"model",rawName:"v-model.number",value:r.min,expression:"channel.min",modifiers:{number:!0}}],attrs:{type:"number",required:""},domProps:{value:r.min},on:{input:function(e){e.target.composing||t.$set(r,"min",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]),e("td",[e("input",{directives:[{name:"model",rawName:"v-model.number",value:r.max,expression:"channel.max",modifiers:{number:!0}}],attrs:{type:"number",required:""},domProps:{value:r.max},on:{input:function(e){e.target.composing||t.$set(r,"max",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})])])})),0),t.multiBand?e("tfoot",[e("tr",[e("td",{attrs:{colspan:t.cols}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.isGray,expression:"isGray"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.isGray)?t._i(t.isGray,null)>-1:t.isGray},on:{change:function(e){var r=t.isGray,n=e.target,i=!!n.checked;if(Array.isArray(r)){var o=null,a=t._i(r,o);n.checked?a<0&&(t.isGray=r.concat([o])):a>-1&&(t.isGray=r.slice(0,a).concat(r.slice(a+1)))}else t.isGray=i}}}),t._v(" Grayscale ")])])]):t._e()])])},p=[],d=r(89518);const g={name:"ChannelControl",mixins:[d.Z],props:{bands:{type:Array,default:()=>[]}},computed:{multiBand(){return this.bands.length>1},cols(){return this.isGray?this.multiBand?3:2:4},labels(){return this.isGray?["Grayscale"]:["Red","Green","Blue"]}},data(){return{channels:[],isGray:1===this.bands.length}},watch:{bands:{immediate:!0,handler(){1===this.bands.length&&(this.isGray=!0),this.updateChannels()}},isGray(){this.updateChannels(),this.emit()},channels:{deep:!0,handler(){this.emit()}}},methods:{isValid(t){return"number"===typeof t},updateChannels(){this.channels=this.bands.slice(0,this.isGray?1:3).map((t=>Object.assign({},t))),2===this.channels.length&&this.channels.push(Object.assign({},this.channels[1]))},emit(){this.channels.filter((t=>this.isValid(t.min)&&this.isValid(t.max))).length>0&&this.$emit("update","channels",this.channels)}}},m=g;var v=r(1001),_=(0,v.Z)(m,f,p,!1,null,null,null);const y=_.exports;var T=r(94272),E=r(71912),x=r(44562),w=r(46131),S=r(2519),R=r(37195),D=r(94806),b=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),O=function(t){function e(e){var r=this,n=R.Z.IDLE;return r=t.call(this,e.tileCoord,n,{transition:e.transition,interpolate:e.interpolate})||this,r.loader_=e.loader,r.data_=null,r.error_=null,r}return b(e,t),e.prototype.getData=function(){return this.data_},e.prototype.getError=function(){return this.error_},e.prototype.load=function(){this.state=R.Z.LOADING,this.changed();var t=this;this.loader_().then((function(e){t.data_=e,t.state=R.Z.LOADED,t.changed()})).catch((function(e){t.error_=e,t.state=R.Z.ERROR,t.changed()}))},e}(D.Z);const C=O;var A=r(208),N=r(85487),L=r(20825),M=r(96113),I=r(22988),P=r(41536),U=r(11481),G=r(69374),F=r(68326),Z=r(4307),B=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function X(t,e,r){var n=r?t.LINEAR:t.NEAREST;t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,n)}function j(t,e,r,n){X(t,e,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)}function V(t,e,r,n,i,o){var a,s,l=t.getGL();if(r instanceof Float32Array){a=l.FLOAT,t.getExtension("OES_texture_float");var c=t.getExtension("OES_texture_float_linear");s=null!==c}else a=l.UNSIGNED_BYTE,s=!0;X(l,e,o&&s);var u,h=r.byteLength/n[1],f=1;switch(h%8===0?f=8:h%4===0?f=4:h%2===0&&(f=2),i){case 1:u=l.LUMINANCE;break;case 2:u=l.LUMINANCE_ALPHA;break;case 3:u=l.RGB;break;case 4:u=l.RGBA;break;default:throw new Error("Unsupported number of bands: ".concat(i))}var p=l.getParameter(l.UNPACK_ALIGNMENT);l.pixelStorei(l.UNPACK_ALIGNMENT,f),l.texImage2D(l.TEXTURE_2D,0,u,n[0],n[1],0,u,a,r),l.pixelStorei(l.UNPACK_ALIGNMENT,p)}var k=null;function z(){var t=document.createElement("canvas");t.width=1,t.height=1,k=t.getContext("2d")}var W=function(t){function e(e){var r=t.call(this)||this;r.tile,r.textures=[],r.handleTileChange_=r.handleTileChange_.bind(r),r.size=(0,Z.Pq)(e.grid.getTileSize(e.tile.tileCoord[0])),r.tilePixelRatio_=e.tilePixelRatio||1,r.gutter_=e.gutter||0,r.bandCount=NaN,r.helper_=e.helper;var n=new I.ZP(P.qO,P.MB);return n.fromArray([0,1,1,1,1,0,0,0]),r.helper_.flushBufferData(n),r.coords=n,r.setTile(e.tile),r}return B(e,t),e.prototype.setTile=function(t){if(t!==this.tile)if(this.tile&&this.tile.removeEventListener(N.Z.CHANGE,this.handleTileChange_),this.tile=t,this.textures.length=0,this.loaded=t.getState()===R.Z.LOADED,this.loaded)this.uploadTile_();else{if(t instanceof L.Z){var e=t.getImage();e instanceof Image&&!e.crossOrigin&&(e.crossOrigin="anonymous")}t.addEventListener(N.Z.CHANGE,this.handleTileChange_)}},e.prototype.uploadTile_=function(){var t=this.helper_,e=t.getGL(),r=this.tile;if(r instanceof L.Z||r instanceof M.Z){var n=r.getImage();if(0!==this.gutter_){var i=this.tilePixelRatio_*this.gutter_,o=Math.round(n.width-2*i),a=Math.round(n.height-2*i),s=(0,F.E4)(o,a);r.interpolate||(0,G.f0)(s,U.$),s.drawImage(n,i,i,o,a,0,0,o,a),n=s.canvas}var l=e.createTexture();return this.textures.push(l),this.bandCount=4,void j(e,l,n,r.interpolate)}var c=[this.size[0]*this.tilePixelRatio_,this.size[1]*this.tilePixelRatio_],u=r.getData(),h=u instanceof Float32Array,f=c[0]*c[1],p=h?Float32Array:Uint8Array,d=p.BYTES_PER_ELEMENT,g=u.byteLength/c[1];this.bandCount=Math.floor(g/d/c[0]);var m=Math.ceil(this.bandCount/4);if(1===m){l=e.createTexture();return this.textures.push(l),void V(t,l,u,c,this.bandCount,r.interpolate)}for(var v=new Array(m),_=0;_<m;++_){l=e.createTexture();this.textures.push(l);var y=_<m-1?4:this.bandCount%4;v[_]=new p(f*y)}for(var T=0,E=0,x=c[0]*this.bandCount,w=0;w<c[1];++w){for(var S=0;S<x;++S){var R=u[E+S],D=Math.floor(T/this.bandCount),b=S%this.bandCount,O=(_=Math.floor(b/4),v[_]),C=(y=O.length/f,b%4);O[D*y+C]=R,++T}E+=g/d}for(_=0;_<m;++_){l=this.textures[_],O=v[_],y=O.length/f;V(t,l,O,c,y,r.interpolate)}},e.prototype.handleTileChange_=function(){this.tile.getState()===R.Z.LOADED&&(this.loaded=!0,this.uploadTile_(),this.dispatchEvent(N.Z.CHANGE))},e.prototype.disposeInternal=function(){var t=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(var e=0;e<this.textures.length;++e)t.deleteTexture(this.textures[e]);this.tile.removeEventListener(N.Z.CHANGE,this.handleTileChange_)},e.prototype.getPixelData=function(t,e){if(!this.loaded)return null;if(t=Math.floor(this.tilePixelRatio_*t),e=Math.floor(this.tilePixelRatio_*e),this.tile instanceof C){var r=this.tile.getData(),n=Math.floor(this.tilePixelRatio_*this.size[0]);if(r instanceof DataView){var i=r.byteLength/(this.size[0]*this.size[1]),o=e*n*i+t*i,a=r.buffer.slice(o,o+i);return new DataView(a)}var s=e*n*this.bandCount+t*this.bandCount;return r.slice(s,s+this.bandCount)}var l;k||z(),k.clearRect(0,0,1,1);var c=this.tile.getImage();try{k.drawImage(c,t,e,1,1,0,0,1,1),l=k.getImageData(0,0,1,1).data}catch(u){return null}return l},e}(A.Z);const H=W;var Y=r(35455),K=r(37751),q=r(6101),$=r(28641),J=r(81428),Q=r(98634),tt=r(63432),et=r(74187),rt=r(65537),nt=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),it={TILE_TEXTURE_ARRAY:"u_tileTextures",TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY",RENDER_EXTENT:"u_renderExtent",RESOLUTION:"u_resolution",ZOOM:"u_zoom"},ot={TEXTURE_COORD:"a_textureCoord"},at=[{name:ot.TEXTURE_COORD,size:2,type:K.GC.FLOAT}],st={};function lt(t){return 2*(1-1/(t+1))-1}function ct(t,e,r){r in t||(t[r]=[]),t[r].push(e)}function ut(t,e){var r=t.layerStatesArray[t.layerIndex];r.extent&&(e=(0,$.Ed)(e,(0,tt.dY)(r.extent,t.viewState.projection)));var n=r.layer.getRenderSource();if(!n.getWrapX()){var i=n.getTileGridForProjection(t.viewState.projection).getExtent();i&&(e=(0,$.Ed)(e,i))}return e}function ht(t,e){return"".concat(t.getKey(),",").concat((0,Q.km)(e))}var ft=function(t){function e(e,r){var n=t.call(this,e,{uniforms:r.uniforms})||this;n.renderComplete=!1,n.tileTransform_=(0,q.Ue)(),n.tempMat4_=(0,J.U)(),n.tempTileRange_=new S.Z(0,0,0,0),n.tempTileCoord_=(0,Q.T9)(0,0,0),n.tempSize_=[0,0],n.program_,n.vertexShader_=r.vertexShader,n.fragmentShader_=r.fragmentShader,n.indices_=new I.ZP(P.cX,P.MB),n.indices_.fromArray([0,1,3,1,2,3]);var i=void 0!==r.cacheSize?r.cacheSize:512;return n.tileTextureCache_=new w.Z(i),n.paletteTextures_=r.paletteTextures||[],n.frameState_=null,n}return nt(e,t),e.prototype.reset=function(e){t.prototype.reset.call(this,{uniforms:e.uniforms}),this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.paletteTextures_=e.paletteTextures||[],this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))},e.prototype.afterHelperCreated=function(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)},e.prototype.isDrawableTile_=function(t){var e=this.getLayer(),r=t.getState(),n=e.getUseInterimTilesOnError();return r==R.Z.LOADED||r==R.Z.EMPTY||r==R.Z.ERROR&&!n},e.prototype.prepareFrameInternal=function(t){var e=this.getLayer(),r=e.getRenderSource();return!!r&&(!(0,$.xb)(ut(t,t.extent))&&r.getState()===x.Z.READY)},e.prototype.enqueueTiles=function(t,e,r,n){var i=t.viewState,o=this.getLayer(),a=o.getRenderSource(),s=a.getTileGridForProjection(i.projection),l=a.getTilePixelRatio(t.pixelRatio),c=a.getGutterForProjection(i.projection),u=(0,et.sq)(a);u in t.wantedTiles||(t.wantedTiles[u]={});for(var h=t.wantedTiles[u],f=this.tileTextureCache_,p=Math.max(r-o.getPreload(),s.getMinZoom(),o.getMinZoom()),d=r;d>=p;--d)for(var g=s.getTileRangeForExtentAndZ(e,d,this.tempTileRange_),m=s.getResolution(d),v=g.minX;v<=g.maxX;++v)for(var _=g.minY;_<=g.maxY;++_){var y=(0,Q.T9)(d,v,_,this.tempTileCoord_),T=ht(a,y),E=void 0,x=void 0;if(f.containsKey(T)&&(E=f.get(T),x=E.tile),!E||E.tile.key!==a.getKey())if(x=a.getTile(d,v,_,t.pixelRatio,i.projection),E)if(this.isDrawableTile_(x))E.setTile(x);else{var w=x.getInterimTile();E.setTile(w)}else E=new H({tile:x,grid:s,helper:this.helper,tilePixelRatio:l,gutter:c}),f.set(T,E);ct(n,E,d);var S=x.getKey();h[S]=!0,x.getState()===R.Z.IDLE&&(t.tileQueue.isKeyQueued(S)||t.tileQueue.enqueue([x,u,s.getTileCoordCenter(y),m]))}},e.prototype.renderFrame=function(t){this.frameState_=t,this.renderComplete=!0;var e=this.helper.getGL();this.preRender(e,t);var r=t.viewState,n=this.getLayer(),i=n.getRenderSource(),o=i.getTileGridForProjection(r.projection),a=ut(t,t.extent),s=o.getZForResolution(r.resolution,i.zDirection),l={};if(t.nextExtent){var c=o.getZForResolution(r.nextResolution,i.zDirection),u=ut(t,t.nextExtent);this.enqueueTiles(t,u,c,l)}this.enqueueTiles(t,a,s,l);for(var h={},f=(0,et.sq)(this),p=t.time,d=!1,g=l[s],m=0,v=g.length;m<v;++m){var _=g[m],y=_.tile,T=y.tileCoord;if(_.loaded){var E=y.getAlpha(f,p);if(1===E){y.endTransition(f);continue}d=!0;var x=(0,Q.km)(T);h[x]=E}this.renderComplete=!1;var w=this.findAltTiles_(o,T,s+1,l);if(!w)for(var S=o.getMinZoom(),R=s-1;R>=S;--R){var D=this.findAltTiles_(o,T,R,l);if(D)break}}this.helper.useProgram(this.program_),this.helper.prepareDraw(t,!d);for(var b=Object.keys(l).map(Number).sort(rt.kK),O=r.center[0],C=r.center[1],A=0,N=b.length;A<N;++A){var L=b[A],M=o.getResolution(L),I=(0,Z.Pq)(o.getTileSize(L),this.tempSize_),P=o.getOrigin(L),U=(O-P[0])/(I[0]*M),G=(P[1]-C)/(I[1]*M),F=r.resolution/M,B=lt(L),X=l[L];for(m=0,v=X.length;m<v;++m){_=X[m];if(_.loaded){y=_.tile,T=y.tileCoord,x=(0,Q.km)(T);var j=T[1],V=T[2];(0,q.qC)(this.tileTransform_,0,0,2/(t.size[0]*F/I[0]),-2/(t.size[1]*F/I[1]),r.rotation,-(U-j),-(G-V)),this.helper.setUniformMatrixValue(it.TILE_TRANSFORM,(0,J.u)(this.tempMat4_,this.tileTransform_)),this.helper.bindBuffer(_.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(at);var k=0;while(k<_.textures.length){var z="TEXTURE"+k,W="".concat(it.TILE_TEXTURE_ARRAY,"[").concat(k,"]");e.activeTexture(e[z]),e.bindTexture(e.TEXTURE_2D,_.textures[k]),e.uniform1i(this.helper.getUniformLocation(W),k),++k}for(var H=0;H<this.paletteTextures_.length;++H){var Y=this.paletteTextures_[H];e.activeTexture(e["TEXTURE"+k]);var K=Y.getTexture(e);e.bindTexture(e.TEXTURE_2D,K),e.uniform1i(this.helper.getUniformLocation(Y.name),k),++k}E=x in h?h[x]:1;E<1&&(t.animate=!0),this.helper.setUniformFloatValue(it.TRANSITION_ALPHA,E),this.helper.setUniformFloatValue(it.DEPTH,B),this.helper.setUniformFloatValue(it.TEXTURE_PIXEL_WIDTH,I[0]),this.helper.setUniformFloatValue(it.TEXTURE_PIXEL_HEIGHT,I[1]),this.helper.setUniformFloatValue(it.TEXTURE_RESOLUTION,M),this.helper.setUniformFloatValue(it.TEXTURE_ORIGIN_X,P[0]+j*I[0]*M),this.helper.setUniformFloatValue(it.TEXTURE_ORIGIN_Y,P[1]-V*I[1]*M),this.helper.setUniformFloatVec4(it.RENDER_EXTENT,a),this.helper.setUniformFloatValue(it.RESOLUTION,r.resolution),this.helper.setUniformFloatValue(it.ZOOM,r.zoom),this.helper.drawElements(0,this.indices_.getSize())}}}this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);var $=this.helper.getCanvas(),tt=this.tileTextureCache_;while(tt.canExpireCache()){_=tt.pop();_.dispose()}var nt=function(t,e){i.expireCache(e.viewState.projection,st)};return t.postRenderFunctions.push(nt),this.postRender(e,t),$},e.prototype.getData=function(t){var e=this.helper.getGL();if(!e)return null;var r=this.frameState_;if(!r)return null;var n=this.getLayer(),i=(0,q.nn)(r.pixelToCoordinateTransform,t.slice()),o=r.viewState,a=n.getExtent();if(a&&!(0,$.b8)((0,tt.dY)(a,o.projection),i))return null;var s=n.getRenderSource(),l=s.getTileGridForProjection(o.projection);if(!s.getWrapX()){var c=l.getExtent();if(c&&!(0,$.b8)(c,i))return null}for(var u=this.tileTextureCache_,h=l.getZForResolution(o.resolution);h>=l.getMinZoom();--h){var f=l.getTileCoordForCoordAndZ(i,h),p=ht(s,f);if(u.containsKey(p)){var d=u.get(p);if(d.loaded){var g=l.getOrigin(h),m=(0,Z.Pq)(l.getTileSize(h)),v=l.getResolution(h),_=(i[0]-g[0])/v-f[1]*m[0],y=(g[1]-i[1])/v-f[2]*m[1];return d.getPixelData(_,y)}}}return null},e.prototype.findAltTiles_=function(t,e,r,n){var i=t.getTileRangeForTileCoordAndZ(e,r,this.tempTileRange_);if(!i)return!1;for(var o=!0,a=this.tileTextureCache_,s=this.getLayer().getRenderSource(),l=i.minX;l<=i.maxX;++l)for(var c=i.minY;c<=i.maxY;++c){var u=ht(s,[r,l,c]),h=!1;if(a.containsKey(u)){var f=a.get(u);f.loaded&&(ct(n,f,r),h=!0)}h||(o=!1)}return o},e.prototype.removeHelper=function(){if(this.helper){var e=this.tileTextureCache_;e.forEach((function(t){return t.dispose()})),e.clear()}t.prototype.removeHelper.call(this)},e.prototype.disposeInternal=function(){var e=this.helper;if(e){var r=e.getGL();r.deleteProgram(this.program_),delete this.program_,e.deleteBuffer(this.indices_)}t.prototype.disposeInternal.call(this),delete this.indices_,delete this.tileTextureCache_,delete this.frameState_},e}(Y.ZP);const pt=ft;var dt=function(){function t(t,e){this.name=t,this.data=e,this.texture_=null}return t.prototype.getTexture=function(t){if(!this.texture_){var e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.data.length/4,1,0,t.RGBA,t.UNSIGNED_BYTE,this.data),this.texture_=e}return this.texture_},t}();const gt=dt;var mt=r(79706),vt=r(33983),_t={NUMBER:1,STRING:2,COLOR:4,BOOLEAN:8,NUMBER_ARRAY:16,ANY:31,NONE:0},yt={};function Tt(t){if("number"===typeof t)return _t.NUMBER;if("boolean"===typeof t)return _t.BOOLEAN;if("string"===typeof t)return(0,mt.e1)(t)?_t.COLOR|_t.STRING:_t.STRING;if(!Array.isArray(t))throw new Error("Unhandled value type: ".concat(JSON.stringify(t)));var e=t,r=e.every((function(t){return"number"===typeof t}));if(r)return 3===e.length||4===e.length?_t.COLOR|_t.NUMBER_ARRAY:_t.NUMBER_ARRAY;if("string"!==typeof e[0])throw new Error("Expected an expression operator but received: ".concat(JSON.stringify(e)));var n=yt[e[0]];if(void 0===n)throw new Error("Unrecognized expression operator: ".concat(JSON.stringify(e)));return n.getReturnType(e.slice(1))}function Et(t){return(0,vt.k3)(t)%1===0}function xt(t){var e=t.toString();return-1===e.indexOf(".")?e+".0":e}function wt(t){if(t.length<2||t.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return"vec".concat(t.length,"(").concat(t.map(xt).join(", "),")")}function St(t){var e=(0,mt._2)(t).slice();return e.length<4&&e.push(1),wt(e.map((function(t,e){return e<3?t/255:t})))}function Rt(t,e){return void 0===t.stringLiteralsMap[e]&&(t.stringLiteralsMap[e]=Object.keys(t.stringLiteralsMap).length),t.stringLiteralsMap[e]}function Dt(t,e){return xt(Rt(t,e))}function bt(t,e,r){if(Array.isArray(e)&&"string"===typeof e[0]){var n=yt[e[0]];if(void 0===n)throw new Error("Unrecognized expression operator: ".concat(JSON.stringify(e)));return n.toGlsl(t,e.slice(1),r)}var i=Tt(e);if((i&_t.NUMBER)>0)return xt(e);if((i&_t.BOOLEAN)>0)return e.toString();if((i&_t.STRING)>0&&(void 0===r||r==_t.STRING))return Dt(t,e.toString());if((i&_t.COLOR)>0&&(void 0===r||r==_t.COLOR))return St(e);if((i&_t.NUMBER_ARRAY)>0)return wt(e);throw new Error("Unexpected expression ".concat(e," (expected type ").concat(r,")"))}function Ot(t){if(!(Tt(t)&_t.NUMBER))throw new Error("A numeric value was expected, got ".concat(JSON.stringify(t)," instead"))}function Ct(t){for(var e=0;e<t.length;e++)Ot(t[e])}function At(t){if(!(Tt(t)&_t.STRING))throw new Error("A string value was expected, got ".concat(JSON.stringify(t)," instead"))}function Nt(t){if(!(Tt(t)&_t.BOOLEAN))throw new Error("A boolean value was expected, got ".concat(JSON.stringify(t)," instead"))}function Lt(t,e){if(t.length!==e)throw new Error("Exactly ".concat(e," arguments were expected, got ").concat(t.length," instead"))}function Mt(t,e){if(t.length<e)throw new Error("At least ".concat(e," arguments were expected, got ").concat(t.length," instead"))}function It(t,e){if(t.length>e)throw new Error("At most ".concat(e," arguments were expected, got ").concat(t.length," instead"))}function Pt(t){if(t.length%2!==0)throw new Error("An even amount of arguments was expected, got ".concat(t," instead"))}function Ut(t){if(t.length%2===0)throw new Error("An odd amount of arguments was expected, got ".concat(t," instead"))}function Gt(t,e){if(!Et(e))throw new Error("Could not infer only one type from the following expression: ".concat(JSON.stringify(t)))}function Ft(t){return"u_var_"+t}yt["get"]={getReturnType:function(t){return _t.ANY},toGlsl:function(t,e){Lt(e,1),At(e[0]);var r=e[0].toString();-1===t.attributes.indexOf(r)&&t.attributes.push(r);var n=t.inFragmentShader?"v_":"a_";return n+r}},yt["var"]={getReturnType:function(t){return _t.ANY},toGlsl:function(t,e){Lt(e,1),At(e[0]);var r=e[0].toString();return-1===t.variables.indexOf(r)&&t.variables.push(r),Ft(r)}};var Zt="u_paletteTextures";yt["palette"]={getReturnType:function(t){return _t.COLOR},toGlsl:function(t,e){Lt(e,2),Ot(e[0]);var r=bt(t,e[0]),n=e[1];if(!Array.isArray(n))throw new Error("The second argument of palette must be an array");for(var i=n.length,o=new Uint8Array(4*i),a=0;a<i;a++){var s=n[a],l=void 0;if("string"===typeof s)l=(0,mt.mL)(s);else{if(!Array.isArray(s))throw new Error("The second argument of palette must be an array of strings or colors");var c=s.length;if(4===c)l=s;else{if(3!==c)throw new Error("Expected palette color to have 3 or 4 values, got ".concat(c));l=[s[0],s[1],s[2],1]}}var u=4*a;o[u]=l[0],o[u+1]=l[1],o[u+2]=l[2],o[u+3]=255*l[3]}t.paletteTextures||(t.paletteTextures=[]);var h="".concat(Zt,"[").concat(t.paletteTextures.length,"]"),f=new gt(h,o);return t.paletteTextures.push(f),"texture2D(".concat(h,", vec2((").concat(r," + 0.5) / ").concat(i,".0, 0.5))")}};var Bt="getBandValue";function Xt(t){return{getReturnType:function(t){return _t.BOOLEAN},toGlsl:function(e,r){Lt(r,2);for(var n=_t.ANY,i=0;i<r.length;i++)n&=Tt(r[i]);if(n===_t.NONE)throw new Error("All arguments should be of compatible type, got ".concat(JSON.stringify(r)," instead"));return n&=~_t.COLOR,"(".concat(bt(e,r[0],n)," ").concat(t," ").concat(bt(e,r[1],n),")")}}}function jt(t){return{getReturnType:function(t){return _t.BOOLEAN},toGlsl:function(e,r){Mt(r,2);for(var n=0;n<r.length;n++)Nt(r[n]);var i="";return i=r.map((function(t){return bt(e,t)})).join(" ".concat(t," ")),i="(".concat(i,")"),i}}}yt["band"]={getReturnType:function(t){return _t.NUMBER},toGlsl:function(t,e){Mt(e,1),It(e,3);var r=e[0];if(!(Bt in t.functions)){for(var n="",i=t.bandCount||1,o=0;o<i;o++){var a=Math.floor(o/4),s=o%4;s===i-1&&1===s&&(s=3);var l="".concat(it.TILE_TEXTURE_ARRAY,"[").concat(a,"]");n+="\n          if (band == ".concat(o+1,".0) {\n            return texture2D(").concat(l,", v_textureCoord + vec2(dx, dy))[").concat(s,"];\n          }\n        ")}t.functions[Bt]="\n        float getBandValue(float band, float xOffset, float yOffset) {\n          float dx = xOffset / ".concat(it.TEXTURE_PIXEL_WIDTH,";\n          float dy = yOffset / ").concat(it.TEXTURE_PIXEL_HEIGHT,";\n          ").concat(n,"\n        }\n      ")}var c=bt(t,r),u=bt(t,e[1]||0),h=bt(t,e[2]||0);return"".concat(Bt,"(").concat(c,", ").concat(u,", ").concat(h,")")}},yt["time"]={getReturnType:function(t){return _t.NUMBER},toGlsl:function(t,e){return Lt(e,0),"u_time"}},yt["zoom"]={getReturnType:function(t){return _t.NUMBER},toGlsl:function(t,e){return Lt(e,0),"u_zoom"}},yt["resolution"]={getReturnType:function(t){return _t.NUMBER},toGlsl:function(t,e){return Lt(e,0),"u_resolution"}},yt["*"]={getReturnType:function(t){return _t.NUMBER},toGlsl:function(t,e){return Lt(e,2),Ct(e),"(".concat(bt(t,e[0])," * ").concat(bt(t,e[1]),")")}},yt["/"]={getReturnType:function(t){return _t.NUMBER},toGlsl:function(t,e){return Lt(e,2),Ct(e),"(".concat(bt(t,e[0])," / ").concat(bt(t,e[1]),")")}},yt["+"]={getReturnType:function(t){return _t.NUMBER},toGlsl:function(t,e){return Lt(e,2),Ct(e),"(".concat(bt(t,e[0])," + ").concat(bt(t,e[1]),")")}},yt["-"]={getReturnType:function(t){return _t.NUMBER},toGlsl:function(t,e){return Lt(e,2),Ct(e),"(".concat(bt(t,e[0])," - ").concat(bt(t,e[1]),")")}},yt["clamp"]={getReturnType:function(t){return _t.NUMBER},toGlsl:function(t,e){Lt(e,3),Ct(e);var r=bt(t,e[1]),n=bt(t,e[2]);return"clamp(".concat(bt(t,e[0]),", ").concat(r,", ").concat(n,")")}},yt["%"]={getReturnType:function(t){return _t.NUMBER},toGlsl:function(t,e){return Lt(e,2),Ct(e),"mod(".concat(bt(t,e[0]),", ").concat(bt(t,e[1]),")")}},yt["^"]={getReturnType:function(t){return _t.NUMBER},toGlsl:function(t,e){return Lt(e,2),Ct(e),"pow(".concat(bt(t,e[0]),", ").concat(bt(t,e[1]),")")}},yt["abs"]={getReturnType:function(t){return _t.NUMBER},toGlsl:function(t,e){return Lt(e,1),Ct(e),"abs(".concat(bt(t,e[0]),")")}},yt["floor"]={getReturnType:function(t){return _t.NUMBER},toGlsl:function(t,e){return Lt(e,1),Ct(e),"floor(".concat(bt(t,e[0]),")")}},yt["round"]={getReturnType:function(t){return _t.NUMBER},toGlsl:function(t,e){return Lt(e,1),Ct(e),"floor(".concat(bt(t,e[0])," + 0.5)")}},yt["ceil"]={getReturnType:function(t){return _t.NUMBER},toGlsl:function(t,e){return Lt(e,1),Ct(e),"ceil(".concat(bt(t,e[0]),")")}},yt["sin"]={getReturnType:function(t){return _t.NUMBER},toGlsl:function(t,e){return Lt(e,1),Ct(e),"sin(".concat(bt(t,e[0]),")")}},yt["cos"]={getReturnType:function(t){return _t.NUMBER},toGlsl:function(t,e){return Lt(e,1),Ct(e),"cos(".concat(bt(t,e[0]),")")}},yt["atan"]={getReturnType:function(t){return _t.NUMBER},toGlsl:function(t,e){return Mt(e,1),It(e,2),Ct(e),2===e.length?"atan(".concat(bt(t,e[0]),", ").concat(bt(t,e[1]),")"):"atan(".concat(bt(t,e[0]),")")}},yt[">"]={getReturnType:function(t){return _t.BOOLEAN},toGlsl:function(t,e){return Lt(e,2),Ct(e),"(".concat(bt(t,e[0])," > ").concat(bt(t,e[1]),")")}},yt[">="]={getReturnType:function(t){return _t.BOOLEAN},toGlsl:function(t,e){return Lt(e,2),Ct(e),"(".concat(bt(t,e[0])," >= ").concat(bt(t,e[1]),")")}},yt["<"]={getReturnType:function(t){return _t.BOOLEAN},toGlsl:function(t,e){return Lt(e,2),Ct(e),"(".concat(bt(t,e[0])," < ").concat(bt(t,e[1]),")")}},yt["<="]={getReturnType:function(t){return _t.BOOLEAN},toGlsl:function(t,e){return Lt(e,2),Ct(e),"(".concat(bt(t,e[0])," <= ").concat(bt(t,e[1]),")")}},yt["=="]=Xt("=="),yt["!="]=Xt("!="),yt["!"]={getReturnType:function(t){return _t.BOOLEAN},toGlsl:function(t,e){return Lt(e,1),Nt(e[0]),"(!".concat(bt(t,e[0]),")")}},yt["all"]=jt("&&"),yt["any"]=jt("||"),yt["between"]={getReturnType:function(t){return _t.BOOLEAN},toGlsl:function(t,e){Lt(e,3),Ct(e);var r=bt(t,e[1]),n=bt(t,e[2]),i=bt(t,e[0]);return"(".concat(i," >= ").concat(r," && ").concat(i," <= ").concat(n,")")}},yt["array"]={getReturnType:function(t){return _t.NUMBER_ARRAY},toGlsl:function(t,e){Mt(e,2),It(e,4),Ct(e);var r=e.map((function(e){return bt(t,e,_t.NUMBER)}));return"vec".concat(e.length,"(").concat(r.join(", "),")")}},yt["color"]={getReturnType:function(t){return _t.COLOR},toGlsl:function(t,e){Mt(e,3),It(e,4),Ct(e);var r=e;3===e.length&&r.push(1);var n=e.map((function(e,r){return bt(t,e,_t.NUMBER)+(r<3?" / 255.0":"")}));return"vec".concat(e.length,"(").concat(n.join(", "),")")}},yt["interpolate"]={getReturnType:function(t){for(var e=_t.COLOR|_t.NUMBER,r=3;r<t.length;r+=2)e&=Tt(t[r]);return e},toGlsl:function(t,e,r){Pt(e),Mt(e,6);var n,i=e[0];switch(i[0]){case"linear":n=1;break;case"exponential":n=i[1];break;default:n=null}if(!n)throw new Error('Invalid interpolation type for "interpolate" operator, received: '.concat(JSON.stringify(i)));var o=void 0!==r?r:_t.ANY,a=yt["interpolate"].getReturnType(e)&o;Gt(e,a);for(var s=bt(t,e[1]),l=xt(n),c="",u=2;u<e.length-2;u+=2){var h=bt(t,e[u]),f=c||bt(t,e[u+1],a),p=bt(t,e[u+2]),d=bt(t,e[u+3],a);c="mix(".concat(f,", ").concat(d,", pow(clamp((").concat(s," - ").concat(h,") / (").concat(p," - ").concat(h,"), 0.0, 1.0), ").concat(l,"))")}return c}},yt["match"]={getReturnType:function(t){for(var e=_t.ANY,r=2;r<t.length;r+=2)e&=Tt(t[r]);return e&=Tt(t[t.length-1]),e},toGlsl:function(t,e,r){Pt(e),Mt(e,4);var n=void 0!==r?r:_t.ANY,i=yt["match"].getReturnType(e)&n;Gt(e,i);for(var o=bt(t,e[0]),a=bt(t,e[e.length-1],i),s=null,l=e.length-3;l>=1;l-=2){var c=bt(t,e[l]),u=bt(t,e[l+1],i);s="(".concat(o," == ").concat(c," ? ").concat(u," : ").concat(s||a,")")}return s}},yt["case"]={getReturnType:function(t){for(var e=_t.ANY,r=1;r<t.length;r+=2)e&=Tt(t[r]);return e&=Tt(t[t.length-1]),e},toGlsl:function(t,e,r){Ut(e),Mt(e,3);var n=void 0!==r?r:_t.ANY,i=yt["case"].getReturnType(e)&n;Gt(e,i);for(var o=0;o<e.length-1;o+=2)Nt(e[o]);var a=bt(t,e[e.length-1],i),s=null;for(o=e.length-3;o>=0;o-=2){var l=bt(t,e[o]),c=bt(t,e[o+1],i);s="(".concat(l," ? ").concat(c," : ").concat(s||a,")")}return s}};var Vt=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function kt(t,e){var r="\n    attribute vec2 ".concat(ot.TEXTURE_COORD,";\n    uniform mat4 ").concat(it.TILE_TRANSFORM,";\n    uniform float ").concat(it.TEXTURE_PIXEL_WIDTH,";\n    uniform float ").concat(it.TEXTURE_PIXEL_HEIGHT,";\n    uniform float ").concat(it.TEXTURE_RESOLUTION,";\n    uniform float ").concat(it.TEXTURE_ORIGIN_X,";\n    uniform float ").concat(it.TEXTURE_ORIGIN_Y,";\n    uniform float ").concat(it.DEPTH,";\n\n    varying vec2 v_textureCoord;\n    varying vec2 v_mapCoord;\n\n    void main() {\n      v_textureCoord = ").concat(ot.TEXTURE_COORD,";\n      v_mapCoord = vec2(\n        ").concat(it.TEXTURE_ORIGIN_X," + ").concat(it.TEXTURE_RESOLUTION," * ").concat(it.TEXTURE_PIXEL_WIDTH," * v_textureCoord[0],\n        ").concat(it.TEXTURE_ORIGIN_Y," - ").concat(it.TEXTURE_RESOLUTION," * ").concat(it.TEXTURE_PIXEL_HEIGHT," * v_textureCoord[1]\n      );\n      gl_Position = ").concat(it.TILE_TRANSFORM," * vec4(").concat(ot.TEXTURE_COORD,", ").concat(it.DEPTH,", 1.0);\n    }\n  "),n={inFragmentShader:!0,variables:[],attributes:[],stringLiteralsMap:{},functions:{},bandCount:e},i=[];if(void 0!==t.color){var o=bt(n,t.color,_t.COLOR);i.push("color = ".concat(o,";"))}if(void 0!==t.contrast){var a=bt(n,t.contrast,_t.NUMBER);i.push("color.rgb = clamp((".concat(a," + 1.0) * color.rgb - (").concat(a," / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));"))}if(void 0!==t.exposure){var s=bt(n,t.exposure,_t.NUMBER);i.push("color.rgb = clamp((".concat(s," + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));"))}if(void 0!==t.saturation){var l=bt(n,t.saturation,_t.NUMBER);i.push("\n      float saturation = ".concat(l," + 1.0;\n      float sr = (1.0 - saturation) * 0.2126;\n      float sg = (1.0 - saturation) * 0.7152;\n      float sb = (1.0 - saturation) * 0.0722;\n      mat3 saturationMatrix = mat3(\n        sr + saturation, sr, sr,\n        sg, sg + saturation, sg,\n        sb, sb, sb + saturation\n      );\n      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));\n    "))}if(void 0!==t.gamma){var c=bt(n,t.gamma,_t.NUMBER);i.push("color.rgb = pow(color.rgb, vec3(1.0 / ".concat(c,"));"))}if(void 0!==t.brightness){var u=bt(n,t.brightness,_t.NUMBER);i.push("color.rgb = clamp(color.rgb + ".concat(u,", vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));"))}var h={},f=n.variables.length;if(f>1&&!t.variables)throw new Error("Missing variables in style (expected ".concat(n.variables,")"));for(var p=function(e){var r=n.variables[e];if(!(r in t.variables))throw new Error("Missing '".concat(r,"' in style variables"));var i=Ft(r);h[i]=function(){var e=t.variables[r];return"string"===typeof e&&(e=Rt(n,e)),void 0!==e?e:-9999999}},d=0;d<f;++d)p(d);var g=Object.keys(h).map((function(t){return"uniform float ".concat(t,";")})),m=Math.ceil(e/4);g.push("uniform sampler2D ".concat(it.TILE_TEXTURE_ARRAY,"[").concat(m,"];")),n.paletteTextures&&g.push("uniform sampler2D ".concat(Zt,"[").concat(n.paletteTextures.length,"];"));var v=Object.keys(n.functions).map((function(t){return n.functions[t]})),_="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    #else\n    precision mediump float;\n    #endif\n\n    varying vec2 v_textureCoord;\n    varying vec2 v_mapCoord;\n    uniform vec4 ".concat(it.RENDER_EXTENT,";\n    uniform float ").concat(it.TRANSITION_ALPHA,";\n    uniform float ").concat(it.TEXTURE_PIXEL_WIDTH,";\n    uniform float ").concat(it.TEXTURE_PIXEL_HEIGHT,";\n    uniform float ").concat(it.RESOLUTION,";\n    uniform float ").concat(it.ZOOM,";\n\n    ").concat(g.join("\n"),"\n\n    ").concat(v.join("\n"),"\n\n    void main() {\n      if (\n        v_mapCoord[0] < ").concat(it.RENDER_EXTENT,"[0] ||\n        v_mapCoord[1] < ").concat(it.RENDER_EXTENT,"[1] ||\n        v_mapCoord[0] > ").concat(it.RENDER_EXTENT,"[2] ||\n        v_mapCoord[1] > ").concat(it.RENDER_EXTENT,"[3]\n      ) {\n        discard;\n      }\n\n      vec4 color = texture2D(").concat(it.TILE_TEXTURE_ARRAY,"[0],  v_textureCoord);\n\n      ").concat(i.join("\n"),"\n\n      if (color.a == 0.0) {\n        discard;\n      }\n\n      gl_FragColor = color;\n      gl_FragColor.rgb *= gl_FragColor.a;\n      gl_FragColor *= ").concat(it.TRANSITION_ALPHA,";\n    }");return{vertexShader:r,fragmentShader:_,uniforms:h,paletteTextures:n.paletteTextures}}var zt=function(t){function e(e){var r=this,n=e?(0,G.f0)({},e):{},i=n.style||{};delete n.style;var o=n.cacheSize;return delete n.cacheSize,r=t.call(this,n)||this,r.sources_=n.sources,r.renderedSource_=null,r.renderedResolution_=NaN,r.style_=i,r.cacheSize_=o,r.styleVariables_=r.style_.variables||{},r.addChangeListener(E.Z.SOURCE,r.handleSourceUpdate_),r}return Vt(e,t),e.prototype.getSources=function(t,e){var r=this.getSource();return this.sources_?"function"===typeof this.sources_?this.sources_(t,e):this.sources_:r?[r]:[]},e.prototype.getRenderSource=function(){return this.renderedSource_||this.getSource()},e.prototype.getSourceState=function(){var t=this.getRenderSource();return t?t.getState():x.Z.UNDEFINED},e.prototype.handleSourceUpdate_=function(){this.getSource()&&this.setStyle(this.style_)},e.prototype.getSourceBandCount_=function(){var t=this.getSource();return t&&"bandCount"in t?t.bandCount:4},e.prototype.createRenderer=function(){var t=kt(this.style_,this.getSourceBandCount_());return new pt(this,{vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,cacheSize:this.cacheSize_,paletteTextures:t.paletteTextures})},e.prototype.renderSources=function(t,e){for(var r,n=this.getRenderer(),i=0,o=e.length;i<o;++i)this.renderedSource_=e[i],n.prepareFrame(t)&&(r=n.renderFrame(t));return r},e.prototype.render=function(t,e){var r=this;this.rendered=!0;for(var n=t.viewState,i=this.getSources(t.extent,n.resolution),o=!0,a=function(t,e){var n=i[t],a=n.getState();if(a==x.Z.LOADING){var s=function(){n.getState()==x.Z.READY&&(n.removeEventListener("change",s),r.changed())};n.addEventListener("change",s)}o=o&&a==x.Z.READY},s=0,l=i.length;s<l;++s)a(s,l);var c=this.renderSources(t,i);if(this.getRenderer().renderComplete&&o)return this.renderedResolution_=n.resolution,c;if(this.renderedResolution_>.5*n.resolution){var u=this.getSources(t.extent,this.renderedResolution_).filter((function(t){return!i.includes(t)}));if(u.length>0)return this.renderSources(t,u)}return c},e.prototype.setStyle=function(t){this.styleVariables_=t.variables||{},this.style_=t;var e=kt(this.style_,this.getSourceBandCount_()),r=this.getRenderer();r.reset({vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,paletteTextures:e.paletteTextures}),this.changed()},e.prototype.updateStyleVariables=function(t){(0,G.f0)(this.styleVariables_,t),this.changed()},e}(T.Z);zt.prototype.dispose;const Wt=zt;var Ht=r(88815),Yt=r(57302),Kt=r(57248),qt=r(36885),$t=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Jt=function(t){function e(e){var r=this,n=void 0===e.projection?"EPSG:3857":e.projection,i=e.tileGrid;return void 0===i&&n&&(i=(0,Kt.dl)({extent:(0,Kt.Tl)(n),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize})),r=t.call(this,{cacheSize:.1,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:n,tileGrid:i,opaque:e.opaque,state:e.state,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate})||this,r.tileLoadingKeys_={},r.loader_=e.loader,r.handleTileChange_=r.handleTileChange_.bind(r),r.bandCount=void 0===e.bandCount?4:e.bandCount,r}return $t(e,t),e.prototype.setLoader=function(t){this.loader_=t},e.prototype.getTile=function(t,e,r,n,i){var o=(0,Q.lg)(t,e,r);if(this.tileCache.containsKey(o))return this.tileCache.get(o);var a=this.loader_;function s(){return(0,qt.Vi)((function(){return a(t,e,r)}))}var l=new C((0,G.f0)({tileCoord:[t,e,r],loader:s},this.tileOptions));return l.key=this.getKey(),l.addEventListener(N.Z.CHANGE,this.handleTileChange_),this.tileCache.set(o,l),l},e.prototype.handleTileChange_=function(t){var e,r=t.target,n=(0,et.sq)(r),i=r.getState();i==R.Z.LOADING?(this.tileLoadingKeys_[n]=!0,e=Ht.Z.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],e=i==R.Z.ERROR?Ht.Z.TILELOADERROR:i==R.Z.LOADED?Ht.Z.TILELOADEND:void 0),e&&this.dispatchEvent(new Yt.s(e,r))},e}(Yt.Z);const Qt=Jt;var te=r(8738),ee=r(50652),re=r(14812);const ne="undefined"!==typeof navigator&&navigator.hardwareConcurrency||2;class ie{constructor(t=ne,e){this.workers=null,this._awaitingDecoder=null,this.size=t,this.messageId=0,t&&(this._awaitingDecoder=e?Promise.resolve(e):new Promise((t=>{r.e(8831).then(r.bind(r,28831)).then((e=>{t(e.create)}))})),this._awaitingDecoder.then((e=>{this._awaitingDecoder=null,this.workers=[];for(let r=0;r<t;r++)this.workers.push({worker:e(),idle:!0})})))}async decode(t,e){return this._awaitingDecoder&&await this._awaitingDecoder,0===this.size?(0,re.X)(t).then((r=>r.decode(t,e))):new Promise((r=>{const n=this.workers.find((t=>t.idle))||this.workers[Math.floor(Math.random()*this.size)];n.idle=!1;const i=this.messageId++,o=t=>{t.data.id===i&&(n.idle=!0,r(t.data.decoded),n.worker.removeEventListener("message",o))};n.worker.addEventListener("message",o),n.worker.postMessage({fileDirectory:t,buffer:e,id:i},[e])}))}destroy(){this.workers&&(this.workers.forEach((t=>{t.worker.terminate()})),this.workers=null)}}const oe=ie;var ae,se=r(58375),le=r(25108),ce=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ue="STATISTICS_MAXIMUM",he="STATISTICS_MINIMUM";function fe(){return ae||(ae=new oe),ae}function pe(t){try{return t.getBoundingBox()}catch(r){var e=t.fileDirectory;return[0,0,e.ImageWidth,e.ImageLength]}}function de(t){try{return t.getOrigin().slice(0,2)}catch(e){return[0,t.fileDirectory.ImageLength]}}function ge(t,e){try{return t.getResolution(e)[0]}catch(r){return e.fileDirectory.ImageWidth/t.fileDirectory.ImageWidth}}function me(t){var e=t.geoKeys;if(!e)return null;if(e.ProjectedCSTypeGeoKey){var r="EPSG:"+e.ProjectedCSTypeGeoKey,n=(0,tt.U2)(r);if(!n){var i=(0,se.Ne)(e.ProjLinearUnitsGeoKey);i&&(n=new tt.kv({code:r,units:i}))}return n}if(e.GeographicTypeGeoKey){r="EPSG:"+e.GeographicTypeGeoKey,n=(0,tt.U2)(r);if(!n){i=(0,se.Ne)(e.GeogAngularUnitsGeoKey);i&&(n=new tt.kv({code:r,units:i}))}return n}return null}function ve(t){return t.getImageCount().then((function(e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t.getImage(n);return Promise.all(r)}))}function _e(t,e){var r;return r=t.overviews?(0,ee.MS)(t.url,t.overviews,e):(0,ee.W0)(t.url,e),r.then(ve)}function ye(t,e,r,n,i){if(Array.isArray(t)){var o=t.length;if(!Array.isArray(e)||o!=e.length){var a=new Error(n);throw i(a),a}for(var s=0;s<o;++s)ye(t[s],e[s],r,n,i)}else if(Math.abs(t-e)>r*t)throw new Error(n)}function Te(t){return t instanceof Int8Array?-128:t instanceof Int16Array?-32768:t instanceof Int32Array?-2147483648:t instanceof Float32Array?12e-39:0}function Ee(t){return t instanceof Int8Array?127:t instanceof Uint8Array||t instanceof Uint8ClampedArray?255:t instanceof Int16Array?32767:t instanceof Uint16Array?65535:t instanceof Int32Array?2147483647:t instanceof Uint32Array?4294967295:t instanceof Float32Array?34e37:255}var xe=function(t){function e(e){var r=t.call(this,{state:x.Z.LOADING,tileGrid:null,projection:null,opaque:e.opaque,transition:e.transition,interpolate:!1!==e.interpolate,wrapX:e.wrapX})||this;r.sourceInfo_=e.sources;var n=r.sourceInfo_.length;r.sourceOptions_=e.sourceOptions,r.sourceImagery_=new Array(n),r.resolutionFactors_=new Array(n),r.samplesPerPixel_,r.nodataValues_,r.metadata_,r.normalize_=!1!==e.normalize,r.addAlpha_=!1,r.error_=null,r.readMethod_=e.convertToRGB?"readRGB":"readRasters",r.setKey(r.sourceInfo_.map((function(t){return t.url})).join(","));for(var i=r,o=new Array(n),a=0;a<n;++a)o[a]=_e(r.sourceInfo_[a],r.sourceOptions_);return Promise.all(o).then((function(t){i.configure_(t)})).catch((function(t){le.error(t),i.error_=t,i.setState(x.Z.ERROR)})),r}return ce(e,t),e.prototype.getError=function(){return this.error_},e.prototype.configure_=function(t){for(var e,r,n,i,o=new Array(t.length),a=new Array(t.length),s=new Array(t.length),l=0,c=t.length,u=function(c){var u=t[c],f=u.length,p=void 0,d=void 0,g=new Array(f),m=new Array(f);a[c]=new Array(f),s[c]=new Array(f);for(var v=0;v<f;++v){var _=u[v],y=_.getGDALNoData();s[c][v]=_.getGDALMetadata(0),a[c][v]=null===y?NaN:y;var T=h.sourceInfo_[c].bands;o[c]=T?T.length:_.getSamplesPerPixel();var E=f-(v+1);p||(p=pe(_)),d||(d=de(_)),m[E]=ge(_,u[0]),g[E]=[_.getTileWidth(),_.getTileHeight()]}if(e?(0,$.Ed)(e,p,e):e=p,r){var x="Origin mismatch for source ".concat(c,", got [").concat(d,"] but expected [").concat(r,"]");ye(r,d,0,x,h.viewRejector)}else r=d;if(i){i.length-l>m.length&&(l=i.length-m.length);var w=i[i.length-1]/m[m.length-1];h.resolutionFactors_[c]=w;var S=m.map((function(t){return t*w}));x="Resolution mismatch for source ".concat(c,", got [").concat(S,"] but expected [").concat(i,"]");ye(i.slice(l,i.length),S,.02,x,h.viewRejector)}else i=m,h.resolutionFactors_[c]=1;n?ye(n.slice(l,n.length),g,0,"Tile size mismatch for source ".concat(c),h.viewRejector):n=g,h.sourceImagery_[c]=u.reverse()},h=this,f=0;f<c;++f)u(f);for(var p=0,d=this.sourceImagery_.length;p<d;++p){var g=this.sourceImagery_[p];while(g.length<i.length)g.unshift(void 0)}if(!this.getProjection()){var m=t[0];for(p=m.length-1;p>=0;--p){var v=m[p],_=me(v);if(_){this.projection=_;break}}}this.samplesPerPixel_=o,this.nodataValues_=a,this.metadata_=s;t:for(f=0;f<c;++f){if(void 0!==this.sourceInfo_[f].nodata){this.addAlpha_=!0;break}var y=a[f],T=this.sourceInfo_[f].bands;if(T){for(p=0;p<T.length;++p)if(!isNaN(y[T[p]-1])){this.addAlpha_=!0;break t}}else for(var E=0;E<y.length;++E)if(!isNaN(y[E])){this.addAlpha_=!0;break t}}var w=this.addAlpha_?1:0;this.bandCount=o.reduce((function(t,e){return t+=e,t}),0)+w;var S=new te.Z({extent:e,minZoom:l,origin:r,resolutions:i,tileSizes:n});this.tileGrid=S,this.setLoader(this.loadTile_.bind(this)),this.setState(x.Z.READY),this.viewResolver({projection:this.projection,resolutions:i,center:(0,tt.lO)((0,$.qg)(e),this.projection),extent:(0,tt.Fj)(e,this.projection),zoom:0})},e.prototype.loadTile_=function(t,e,r){for(var n=(0,Z.Pq)(this.tileGrid.getTileSize(t)),i=this.sourceImagery_.length,o=new Array(i),a=this.addAlpha_,s=this.bandCount,l=this.samplesPerPixel_,c=this.nodataValues_,u=this.sourceInfo_,h=function(i){var a=u[i],s=f.resolutionFactors_[i],l=[Math.round(e*(n[0]*s)),Math.round(r*(n[1]*s)),Math.round((e+1)*(n[0]*s)),Math.round((r+1)*(n[1]*s))],h=f.sourceImagery_[i][t],p=void 0;a.bands&&(p=a.bands.map((function(t){return t-1})));var d=void 0;d=isNaN(a.nodata)?p?p.map((function(t){return c[i][t]})):c[i]:a.nodata,o[i]=h[f.readMethod_]({window:l,width:n[0],height:n[1],samples:p,fillValue:d,pool:fe(),interleave:!1})},f=this,p=0;p<i;++p)h(p);var d=n[0]*n[1],g=d*s,m=this.normalize_,v=this.metadata_;return Promise.all(o).then((function(t){var e;e=m?new Uint8Array(g):new Float32Array(g);for(var r=0,n=0;n<d;++n){for(var o=a,s=0;s<i;++s){var h=u[s],f=h.min,p=h.max,_=void 0,y=void 0;if(m){var T=v[s][0];void 0===f&&(f=T&&he in T?parseFloat(T[he]):Te(t[s][0])),void 0===p&&(p=T&&ue in T?parseFloat(T[ue]):Ee(t[s][0])),_=255/(p-f),y=-f*_}for(var E=0;E<l[s];++E){var x=t[s][E][n],w=void 0;if(w=m?(0,vt.uZ)(_*x+y,0,255):x,a){var S=h.nodata;if(void 0===S){var R=void 0;R=h.bands?h.bands[E]-1:E,S=c[s][R]}x!==S&&(o=!1,e[r]=w)}else e[r]=w;r++}}a&&(o||(e[r]=255),r++)}return e}))},e}(Qt);xe.prototype.getView;const we=xe,Se={components:{ChannelControl:y,TextControl:h.Z},data(){return{textControlText:"Pixel Value: -",layer:null,source:null,colorMap:null,noData:[],channels:[],bands:[]}},methods:{getBandVar(t){return["band",["var",`${t}band`]]},getFormula(t){let e=["var",`${t}min`],r=["var",`${t}max`],n=this.getBandVar(t),i=["*",["/",["-",n,e],["-",r,e]],255];return["clamp",i,0,255]},getNoDataFormula(){let t=this.getBandVar("alpha");return["case",["==",t,0],0,1]},async addGeoTiff(t,e="GeoTiff"){this.bands=t.getBands(),this.colorMap=t.getColorMap(),this.noData=t.getNoData(),this.source=new we({interpolate:!1,normalize:!1,convertToRGB:t.convertToRGB,sources:[{url:t.getUrl(),nodata:this.noData[0]}]}),this.layer=new Wt({id:t.getUrl(),title:e,source:this.source,cacheSize:2048}),this.layer.set("events",{pointermove:t=>{let e=this.layer.getData(t.pixel),r=a.Z.displayRGBA(e,this.noData,this.noData.length>0),n=`Pixel Value: ${r}`,i=this.formatCoords(t.coordinate);this.textControlText=[n,`${n} @ ${i}`]},click:t=>{let e=this.layer.getData(t.pixel);if(!e)return void(this.chart=null);if(e=Array.from(e).slice(0,this.bands.length),e.length<2||e.every((t=>!isFinite(t))))return void(this.chart=null);let r=this.formatCoords(t.coordinate),n=`Coordinate: ${r}`,i=[{label:n,data:e}];this.chart={labels:this.bands.map((t=>String(t.name||t.id))),datasets:i}}}),this.addLayerToMap(this.layer);let r=t.getExtent();return r&&this.map.getView().fit(r,this.getFitOptions(10)),await new Promise((t=>setTimeout(t,1250))),this.setStyle(),this.source},formatCoords(t){return t.map((t=>String(parseFloat(t.toFixed(6))))).join(", ")},updateGeoTiffStyle(t,e){switch(t){case"channels":this.channels=e;break}this.setStyle()},setStyle(){if(!this.layer)return;let t={};for(let r in this.channels){let e=this.channels[r];t[`${r}band`]=e.id,t[`${r}min`]=e.min,t[`${r}max`]=e.max}t.alphaband=this.bands.length+1;let e=[];if(this.colorMap)e.push("palette"),e.push(["band",1]),e.push(this.colorMap);else{if(0===this.channels.length)return null;if(1===this.channels.length){e.push("color");let t=this.getFormula(0);e.push(t),e.push(t),e.push(t),this.noData.length>0&&e.push(this.getNoDataFormula())}else e.push("color"),e.push(this.getFormula(0)),e.push(this.getFormula(1)),e.push(this.getFormula(2)),this.noData.length>0&&e.push(this.getNoDataFormula())}this.layer.setStyle({variables:t,color:e})}}},Re=Se;var De,be,Oe=(0,v.Z)(Re,De,be,!1,null,null,null);const Ce=Oe.exports;var Ae=r(12766),Ne=r(94782),Le=r(78714),Me=r(68734),Ie=r(41666),Pe=r(54680);function Ue(t,e){return Ke().createElementNS(t,e)}function Ge(t,e){return Fe(t,e,[]).join("")}function Fe(t,e,r){if(t.nodeType==Node.CDATA_SECTION_NODE||t.nodeType==Node.TEXT_NODE)e?r.push(String(t.nodeValue).replace(/(\r\n|\r|\n)/g,"")):r.push(t.nodeValue);else{var n=void 0;for(n=t.firstChild;n;n=n.nextSibling)Fe(n,e,r)}return r}function Ze(t){return"documentElement"in t}function Be(t){return(new DOMParser).parseFromString(t,"application/xml")}function Xe(t,e){return function(r,n){var i=t.call(void 0!==e?e:this,r,n);if(void 0!==i){var o=n[n.length-1];o.push(i)}}}function je(t,e,r){return function(n,i){var o=t.call(void 0!==r?r:this,n,i);if(void 0!==o){var a=i[i.length-1],s=void 0!==e?e:n.localName,l=void 0;s in a?l=a[s]:(l=[],a[s]=l),l.push(o)}}}function Ve(t,e,r){return function(n,i){var o=t.call(void 0!==r?r:this,n,i);if(void 0!==o){var a=i[i.length-1],s=void 0!==e?e:n.localName;a[s]=o}}}function ke(t,e){var r=t;return function(t,n,i){var o=n[n.length-1],a=o.node,s=r;void 0===s&&(s=i);var l=void 0!==e?e:a.namespaceURI;return Ue(l,s)}}ke();function ze(t,e,r){var n,i,o=void 0!==r?r:{};for(n=0,i=t.length;n<i;++n)o[t[n]]=e;return o}function We(t,e,r,n){var i;for(i=e.firstElementChild;i;i=i.nextElementSibling){var o=t[i.namespaceURI];if(void 0!==o){var a=o[i.localName];void 0!==a&&a.call(n,i,r)}}}function He(t,e,r,n,i){return n.push(t),We(e,r,n,i),n.pop()}var Ye=void 0;function Ke(){return void 0===Ye&&"undefined"!==typeof document&&(Ye=document.implementation.createDocument("","",null)),Ye}var qe=function(){function t(){}return t.prototype.read=function(t){if(t){if("string"===typeof t){var e=Be(t);return this.readFromDocument(e)}return Ze(t)?this.readFromDocument(t):this.readFromNode(t)}return null},t.prototype.readFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null},t.prototype.readFromNode=function(t){},t}();const $e=qe;var Je="http://www.w3.org/1999/xlink";function Qe(t){return t.getAttributeNS(Je,"href")}function tr(t){var e=Ge(t,!1);return er(e)}function er(t){var e=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(t);return e?parseFloat(e[1]):void 0}function rr(t){var e=Ge(t,!1);return nr(e)}function nr(t){var e=/^\s*(\d+)\s*$/.exec(t);return e?parseInt(e[1],10):void 0}function ir(t){return Ge(t,!1).trim()}var or=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ar=[null,"http://www.opengis.net/ows/1.1"],sr=ze(ar,{ServiceIdentification:Ve(Lr),ServiceProvider:Ve(Ir),OperationsMetadata:Ve(Ar)}),lr=function(t){function e(){return t.call(this)||this}return or(e,t),e.prototype.readFromNode=function(t){var e=He({},sr,t,[]);return e||null},e}($e),cr=ze(ar,{DeliveryPoint:Ve(ir),City:Ve(ir),AdministrativeArea:Ve(ir),PostalCode:Ve(ir),Country:Ve(ir),ElectronicMailAddress:Ve(ir)}),ur=ze(ar,{Value:je(Pr)}),hr=ze(ar,{AllowedValues:Ve(wr)}),fr=ze(ar,{Phone:Ve(Nr),Address:Ve(xr)}),pr=ze(ar,{HTTP:Ve(Or)}),dr=ze(ar,{Get:je(br),Post:void 0}),gr=ze(ar,{DCP:Ve(Dr)}),mr=ze(ar,{Operation:Cr}),vr=ze(ar,{Voice:Ve(ir),Facsimile:Ve(ir)}),_r=ze(ar,{Constraint:je(Sr)}),yr=ze(ar,{IndividualName:Ve(ir),PositionName:Ve(ir),ContactInfo:Ve(Rr)}),Tr=ze(ar,{Abstract:Ve(ir),AccessConstraints:Ve(ir),Fees:Ve(ir),Title:Ve(ir),ServiceTypeVersion:Ve(ir),ServiceType:Ve(ir)}),Er=ze(ar,{ProviderName:Ve(ir),ProviderSite:Ve(Qe),ServiceContact:Ve(Mr)});function xr(t,e){return He({},cr,t,e)}function wr(t,e){return He({},ur,t,e)}function Sr(t,e){var r=t.getAttribute("name");if(r)return He({name:r},hr,t,e)}function Rr(t,e){return He({},fr,t,e)}function Dr(t,e){return He({},pr,t,e)}function br(t,e){var r=Qe(t);if(r)return He({href:r},_r,t,e)}function Or(t,e){return He({},dr,t,e)}function Cr(t,e){var r=t.getAttribute("name"),n=He({},gr,t,e);if(n){var i=e[e.length-1];i[r]=n}}function Ar(t,e){return He({},mr,t,e)}function Nr(t,e){return He({},vr,t,e)}function Lr(t,e){return He({},Tr,t,e)}function Mr(t,e){return He({},yr,t,e)}function Ir(t,e){return He({},Er,t,e)}function Pr(t,e){return ir(t)}const Ur=lr;var Gr=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Fr=[null,"http://www.opengis.net/wmts/1.0"],Zr=[null,"http://www.opengis.net/ows/1.1"],Br=ze(Fr,{Contents:Ve(Jr)}),Xr=function(t){function e(){var e=t.call(this)||this;return e.owsParser_=new Ur,e}return Gr(e,t),e.prototype.readFromNode=function(t){var e=t.getAttribute("version");e&&(e=e.trim());var r=this.owsParser_.readFromNode(t);return r?(r["version"]=e,r=He(r,Br,t,[]),r||null):null},e}($e),jr=ze(Fr,{Layer:je(Qr),TileMatrixSet:je(tn)}),Vr=ze(Fr,{Style:je(en),Format:je(ir),TileMatrixSetLink:je(rn),Dimension:je(nn),ResourceURL:je(on)},ze(Zr,{Title:Ve(ir),Abstract:Ve(ir),WGS84BoundingBox:Ve(an),Identifier:Ve(ir)})),kr=ze(Fr,{LegendURL:je(sn)},ze(Zr,{Title:Ve(ir),Identifier:Ve(ir)})),zr=ze(Fr,{TileMatrixSet:Ve(ir),TileMatrixSetLimits:Ve(un)}),Wr=ze(Fr,{TileMatrixLimits:Xe(hn)}),Hr=ze(Fr,{TileMatrix:Ve(ir),MinTileRow:Ve(rr),MaxTileRow:Ve(rr),MinTileCol:Ve(rr),MaxTileCol:Ve(rr)}),Yr=ze(Fr,{Default:Ve(ir),Value:je(ir)},ze(Zr,{Identifier:Ve(ir)})),Kr=ze(Zr,{LowerCorner:Xe(ln),UpperCorner:Xe(ln)}),qr=ze(Fr,{WellKnownScaleSet:Ve(ir),TileMatrix:je(cn)},ze(Zr,{SupportedCRS:Ve(ir),Identifier:Ve(ir),BoundingBox:Ve(an)})),$r=ze(Fr,{TopLeftCorner:Ve(ln),ScaleDenominator:Ve(tr),TileWidth:Ve(rr),TileHeight:Ve(rr),MatrixWidth:Ve(rr),MatrixHeight:Ve(rr)},ze(Zr,{Identifier:Ve(ir)}));function Jr(t,e){return He({},jr,t,e)}function Qr(t,e){return He({},Vr,t,e)}function tn(t,e){return He({},qr,t,e)}function en(t,e){var r=He({},kr,t,e);if(r){var n="true"===t.getAttribute("isDefault");return r["isDefault"]=n,r}}function rn(t,e){return He({},zr,t,e)}function nn(t,e){return He({},Yr,t,e)}function on(t,e){var r=t.getAttribute("format"),n=t.getAttribute("template"),i=t.getAttribute("resourceType"),o={};return r&&(o["format"]=r),n&&(o["template"]=n),i&&(o["resourceType"]=i),o}function an(t,e){var r=He([],Kr,t,e);if(2==r.length)return(0,$.hI)(r)}function sn(t,e){var r={};return r["format"]=t.getAttribute("format"),r["href"]=Qe(t),r}function ln(t,e){var r=ir(t).split(/\s+/);if(r&&2==r.length){var n=+r[0],i=+r[1];if(!isNaN(n)&&!isNaN(i))return[n,i]}}function cn(t,e){return He({},$r,t,e)}function un(t,e){return He([],Wr,t,e)}function hn(t,e){return He({},Hr,t,e)}const fn=Xr;var pn=r(88799);const dn={KVP:"KVP",REST:"REST"};function gn(t,e){var r=[];Object.keys(e).forEach((function(t){null!==e[t]&&void 0!==e[t]&&r.push(t+"="+encodeURIComponent(e[t]))}));var n=r.join("&");return t=t.replace(/[?&]$/,""),t=-1===t.indexOf("?")?t+"?":t+"&",t+n}var mn=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),vn=function(t){function e(e){var r=t.call(this,{extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes})||this;return r.matrixIds_=e.matrixIds,r}return mn(e,t),e.prototype.getMatrixId=function(t){return this.matrixIds_[t]},e.prototype.getMatrixIds=function(){return this.matrixIds_},e}(te.Z);function _n(t,e,r){var n=[],i=[],o=[],a=[],s=[],l=void 0!==r?r:[],c="SupportedCRS",u="TileMatrix",h="Identifier",f="ScaleDenominator",p="TopLeftCorner",d="TileWidth",g="TileHeight",m=t[c],v=(0,tt.U2)(m),_=v.getMetersPerUnit(),y="ne"==v.getAxisOrientation().substr(0,2);return t[u].sort((function(t,e){return e[f]-t[f]})),t[u].forEach((function(e){var r;if(r=!(l.length>0)||(0,rt.sE)(l,(function(r){return e[h]==r[u]||-1===e[h].indexOf(":")&&t[h]+":"+e[h]===r[u]})),r){i.push(e[h]);var c=28e-5*e[f]/_,m=e[d],v=e[g];y?o.push([e[p][1],e[p][0]]):o.push(e[p]),n.push(c),a.push(m==v?m:[m,v]),s.push([e["MatrixWidth"],e["MatrixHeight"]])}})),new vn({extent:e,origins:o,resolutions:n,matrixIds:i,tileSizes:a,sizes:s})}var yn=r(67848),Tn=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),En=function(t){function e(e){var r=this,n=void 0===e.imageSmoothing||e.imageSmoothing;void 0!==e.interpolate&&(n=e.interpolate);var i=void 0!==e.requestEncoding?e.requestEncoding:dn.KVP,o=e.tileGrid,a=e.urls;return void 0===a&&void 0!==e.url&&(a=(0,yn.Gk)(e.url)),r=t.call(this,{attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:n,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:o,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,urls:a,wrapX:void 0!==e.wrapX&&e.wrapX,transition:e.transition,zDirection:e.zDirection})||this,r.version_=void 0!==e.version?e.version:"1.0.0",r.format_=void 0!==e.format?e.format:"image/jpeg",r.dimensions_=void 0!==e.dimensions?e.dimensions:{},r.layer_=e.layer,r.matrixSet_=e.matrixSet,r.style_=e.style,r.requestEncoding_=i,r.setKey(r.getKeyForDimensions_()),a&&a.length>0&&(r.tileUrlFunction=(0,yn.Un)(a.map(r.createFromWMTSTemplate.bind(r)))),r}return Tn(e,t),e.prototype.setUrls=function(t){this.urls=t;var e=t.join("\n");this.setTileUrlFunction((0,yn.Un)(t.map(this.createFromWMTSTemplate.bind(this))),e)},e.prototype.getDimensions=function(){return this.dimensions_},e.prototype.getFormat=function(){return this.format_},e.prototype.getLayer=function(){return this.layer_},e.prototype.getMatrixSet=function(){return this.matrixSet_},e.prototype.getRequestEncoding=function(){return this.requestEncoding_},e.prototype.getStyle=function(){return this.style_},e.prototype.getVersion=function(){return this.version_},e.prototype.getKeyForDimensions_=function(){var t=0,e=[];for(var r in this.dimensions_)e[t++]=r+"-"+this.dimensions_[r];return e.join("/")},e.prototype.updateDimensions=function(t){(0,G.f0)(this.dimensions_,t),this.setKey(this.getKeyForDimensions_())},e.prototype.createFromWMTSTemplate=function(t){var e=this.requestEncoding_,r={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};e==dn.KVP&&(0,G.f0)(r,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),t=e==dn.KVP?gn(t,r):t.replace(/\{(\w+?)\}/g,(function(t,e){return e.toLowerCase()in r?r[e.toLowerCase()]:t}));var n=this.tileGrid,i=this.dimensions_;return function(r,o,a){if(r){var s={TileMatrix:n.getMatrixId(r[0]),TileCol:r[1],TileRow:r[2]};(0,G.f0)(s,i);var l=t;return l=e==dn.KVP?gn(l,s):l.replace(/\{(\w+?)\}/g,(function(t,e){return s[e]})),l}}},e}(pn.Z);const xn=En;function wn(t,e){var r=t["Contents"]["Layer"],n=(0,rt.sE)(r,(function(t,r,n){return t["Identifier"]==e["layer"]}));if(null===n)return null;var i,o=t["Contents"]["TileMatrixSet"];i=n["TileMatrixSetLink"].length>1?"projection"in e?(0,rt.cx)(n["TileMatrixSetLink"],(function(t,r,n){var i=(0,rt.sE)(o,(function(e){return e["Identifier"]==t["TileMatrixSet"]})),a=i["SupportedCRS"],s=(0,tt.U2)(a),l=(0,tt.U2)(e["projection"]);return s&&l?(0,tt.OP)(s,l):a==e["projection"]})):(0,rt.cx)(n["TileMatrixSetLink"],(function(t,r,n){return t["TileMatrixSet"]==e["matrixSet"]})):0,i<0&&(i=0);var a=n["TileMatrixSetLink"][i]["TileMatrixSet"],s=n["TileMatrixSetLink"][i]["TileMatrixSetLimits"],l=n["Format"][0];"format"in e&&(l=e["format"]),i=(0,rt.cx)(n["Style"],(function(t,r,n){return"style"in e?t["Title"]==e["style"]:t["isDefault"]})),i<0&&(i=0);var c=n["Style"][i]["Identifier"],u={};"Dimension"in n&&n["Dimension"].forEach((function(t,e,r){var n=t["Identifier"],i=t["Default"];void 0===i&&(i=t["Value"][0]),u[n]=i}));var h,f=t["Contents"]["TileMatrixSet"],p=(0,rt.sE)(f,(function(t,e,r){return t["Identifier"]==a})),d=p["SupportedCRS"];if(d&&(h=(0,tt.U2)(d)),"projection"in e){var g=(0,tt.U2)(e["projection"]);g&&(h&&!(0,tt.OP)(g,h)||(h=g))}var m=!1,v="ne"==h.getAxisOrientation().substr(0,2),_=p.TileMatrix[0],y={MinTileCol:0,MinTileRow:0,MaxTileCol:_.MatrixWidth-1,MaxTileRow:_.MatrixHeight-1};if(s){y=s[s.length-1];var T=(0,rt.sE)(p.TileMatrix,(function(t){return t.Identifier===y.TileMatrix||p.Identifier+":"+t.Identifier===y.TileMatrix}));T&&(_=T)}var E=28e-5*_.ScaleDenominator/h.getMetersPerUnit(),x=v?[_.TopLeftCorner[1],_.TopLeftCorner[0]]:_.TopLeftCorner,w=_.TileWidth*E,S=_.TileHeight*E,R=p["BoundingBox"],D=[x[0]+w*y.MinTileCol,x[1]-S*(1+y.MaxTileRow),x[0]+w*(1+y.MaxTileCol),x[1]-S*y.MinTileRow];if(void 0!==R&&!(0,$.r4)(R,D)){var b=n["WGS84BoundingBox"],O=(0,tt.U2)("EPSG:4326").getExtent();if(D=R,b)m=b[0]===O[0]&&b[2]===O[2];else{var C=(0,tt.$A)(R,p["SupportedCRS"],"EPSG:4326");m=C[0]-1e-10<=O[0]&&C[2]+1e-10>=O[2]}}var A=_n(p,D,s),N=[],L=e["requestEncoding"];if(L=void 0!==L?L:"","OperationsMetadata"in t&&"GetTile"in t["OperationsMetadata"])for(var M=t["OperationsMetadata"]["GetTile"]["DCP"]["HTTP"]["Get"],I=0,P=M.length;I<P;++I)if(M[I]["Constraint"]){var U=(0,rt.sE)(M[I]["Constraint"],(function(t){return"GetEncoding"==t["name"]})),G=U["AllowedValues"]["Value"];if(""===L&&(L=G[0]),L!==dn.KVP)break;(0,rt.q9)(G,dn.KVP)&&N.push(M[I]["href"])}else M[I]["href"]&&(L=dn.KVP,N.push(M[I]["href"]));return 0===N.length&&(L=dn.REST,n["ResourceURL"].forEach((function(t){"tile"===t["resourceType"]&&(l=t["format"],N.push(t["template"]))}))),{urls:N,layer:e["layer"],matrixSet:a,format:l,projection:h,requestEncoding:L,tileGrid:A,style:c,dimensions:u,wrapX:m,crossOrigin:e["crossOrigin"]}}var Sn=r(10044),Rn=r(22556),Dn=r(88775),bn=r(52463),On=function(t){var e=bn.Z.create("DIV",{className:(t.className||"")+" ol-timeline"+(t.target?"":" ol-unselectable ol-control")+(t.zoomButton?" ol-hasbutton":"")});Dn.Z.call(this,{element:e,target:t.target}),this._scrollDiv=bn.Z.create("DIV",{className:"ol-scroll",parent:this.element}),this._buttons=bn.Z.create("DIV",{className:"ol-buttons",parent:this.element}),t.zoomButton&&(this.addButton({className:"ol-zoom-in",handleClick:function(){var t=this.get("zoom");t>=1?t++:t=Math.min(1,t+.1),t=Math.round(100*t)/100,this.refresh(t)}.bind(this)}),this.addButton({className:"ol-zoom-out",handleClick:function(){var t=this.get("zoom");t>1?t--:t-=.1,t=Math.round(100*t)/100,this.refresh(t)}.bind(this)})),this._intervalDiv=bn.Z.create("DIV",{className:"ol-center-date",parent:this.element}),this.element.addEventListener("mouseover",function(){this._select&&this._select.elt.classList.remove("ol-select")}.bind(this));var r=null;this._scrollDiv.addEventListener("scroll",function(){this._setScrollLeft(),r&&(clearTimeout(r),r=null),r=setTimeout(function(){this.dispatchEvent({type:"scroll",date:this.getDate(),dateStart:this.getDate("start"),dateEnd:this.getDate("end")})}.bind(this),t.scrollTimeout||15)}.bind(this)),bn.Z.scrollDiv(this._scrollDiv,{onmove:function(t){this._moving=t}.bind(this)}),this._tline=[],this._scrollLeft=0,this.set("maxWidth",t.maxWidth||2e3),this.set("minDate",t.minDate||1/0),this.set("maxDate",t.maxDate||-1/0),this.set("graduation",t.graduation),this.set("minZoom",t.minZoom||.2),this.set("maxZoom",t.maxZoom||4),this.setInterval(t.interval),t.getHTML&&(this._getHTML=t.getHTML),t.getFeatureDate&&(this._getFeatureDate=t.getFeatureDate),t.endFeatureDate&&(this._endFeatureDate=t.endFeatureDate),this.setFeatures(t.features||t.source,t.zoom)};(0,Sn.Z)(On,Dn.Z),On.prototype.setMap=function(t){Dn.Z.prototype.setMap.call(this,t),this.refresh(this.get("zoom")||1,!0)},On.prototype.addButton=function(t){this.element.classList.add("ol-hasbutton"),bn.Z.create("BUTTON",{className:t.className||void 0,title:t.title,html:t.html,click:t.handleClick,parent:this._buttons})},On.prototype.setInterval=function(t){"string"===typeof t&&(t=/s$/.test(t)?1e3*parseFloat(t):/mn$/.test(t)?1e3*parseFloat(t)*60:/h$/.test(t)?1e3*parseFloat(t)*3600:/d$/.test(t)?1e3*parseFloat(t)*3600*24:/y$/.test(t)?1e3*parseFloat(t)*3600*24*365:0),this.set("interval",t||0),t?this.element.classList.add("ol-interval"):this.element.classList.remove("ol-interval"),this.refresh(this.get("zoom"))},On.prototype._getHTML=function(t){return t.get("name")||""},On.prototype._getFeatureDate=function(t){return t&&t.get?t.get("date"):null},On.prototype._endFeatureDate=function(){},On.prototype.isCollapsed=function(){return this.element.classList.contains("ol-collapsed")},On.prototype.collapse=function(t){t?this.element.classList.add("ol-collapsed"):this.element.classList.remove("ol-collapsed"),this.dispatchEvent({type:"collapse",collapsed:this.isCollapsed()})},On.prototype.toggle=function(){this.element.classList.toggle("ol-collapsed"),this.dispatchEvent({type:"collapse",collapsed:this.isCollapsed()})},On.prototype.setFeatures=function(t,e){this._features=this._source=null,t instanceof Rn.Z?this._source=t:this._features=t instanceof Array?t:[],this.refresh(e)},On.prototype.getFeatures=function(){return this._features||this._source.getFeatures()},On.prototype.refresh=function(t,e){if(this.getMap()){t||(t=this.get("zoom")),t=Math.min(this.get("maxZoom"),Math.max(this.get("minZoom"),t||1)),this.set("zoom",t),this._scrollDiv.innerHTML="";var r,n,i=this.getFeatures(),o=this._tline=[];i.forEach(function(t){(r=this._getFeatureDate(t))&&(r instanceof Date||(r=new Date(r)),this._endFeatureDate&&(n=this._endFeatureDate(t),n instanceof Date||(n=new Date(n))),isNaN(r)||o.push({date:r,end:isNaN(n)?null:n,feature:t}))}.bind(this)),o.sort((function(t,e){return t.date<e.date?-1:t.date===e.date?0:1}));var a=bn.Z.create("DIV",{parent:this._scrollDiv}),s=this._minDate=Math.min(this.get("minDate"),o.length?o[0].date:1/0),l=this._maxDate=Math.max(this.get("maxDate"),o.length?o[o.length-1].date:-1/0);isFinite(s)||(this._minDate=s=new Date),isFinite(l)||(this._maxDate=l=new Date);var c=l-s,u=this.get("maxWidth"),h=this._scale=(c>u?u/c:1)*t;s=this._minDate=this._minDate-10/h,c=(l-s)*h,bn.Z.setStyle(a,{width:c,maxWidth:"unset"}),this._drawTime(a,s,l,h),this.get("interval")?bn.Z.setStyle(this._intervalDiv,{width:this.get("interval")*h}):bn.Z.setStyle(this._intervalDiv,{width:""});var f=[],p=bn.Z.getStyle(this._scrollDiv,"lineHeight"),d=bn.Z.create("DIV",{className:"ol-features",parent:a});o.forEach(function(t){for(var e=t.date,r=t.elt=bn.Z.create("DIV",{className:"ol-feature",style:{left:Math.round((e-s)*h)},html:this._getHTML(t.feature),parent:d}),n=r.querySelectorAll("img"),i=0;i<n.length;i++)n[i].ondragstart=function(){return!1};t.end&&bn.Z.setStyle(r,{minWidth:(t.end-e)*h,width:(t.end-e)*h,maxWidth:"unset"});var o,a,l=bn.Z.getStyle(r,"left");for(r.addEventListener("click",function(){this._moving||this.dispatchEvent({type:"select",feature:t.feature})}.bind(this)),o=0;a=f[o];o++)if(l>a)break;f[o]=l+bn.Z.getStyle(r,"width"),bn.Z.setStyle(r,{top:o*p})}.bind(this)),this._nbline=f.length,e&&this.setDate(this._minDate,{anim:!1,position:"start"}),this.dispatchEvent({type:"scroll",date:this.getDate(),dateStart:this.getDate("start"),dateEnd:this.getDate("end")})}},On.prototype._getOffsetFromDate=function(t){return(t-this._minDate)*this._scale},On.prototype._getDateFromOffset=function(t){return t/this._scale+this._minDate},On.prototype._setScrollLeft=function(t){this._scrollLeft=t,void 0!==t&&(this._scrollDiv.scrollLeft=t)},On.prototype._getScrollLeft=function(){return void 0===this._scrollLeft?this._scrollDiv.scrollLeft:this._scrollLeft},On.prototype._drawTime=function(t,e,r,n){var i,o,a,s,l=bn.Z.create("DIV",{className:"ol-times",parent:t}),c=bn.Z.getStyle(l,"left"),u=bn.Z.getStyle(l,"height"),h=new Date(this._minDate).getFullYear();o=(new Date(0).setFullYear(String(h))-new Date(0).setFullYear(String(h-1)))*n;var f=Math.round(2*u/o)+1;while(1){if(i=new Date(0).setFullYear(h),i>this._maxDate)break;bn.Z.create("DIV",{className:"ol-time ol-year",style:{left:this._getOffsetFromDate(i)-c},html:h,parent:l}),h+=f}if(/day|month/.test(this.get("graduation"))&&(o=(new Date(0,0,1).setFullYear(String(h))-new Date(0,0,1).setFullYear(String(h-1)))*n,s=Math.max(1,Math.round(12/Math.round(o/u/2))),s<12)){h=new Date(this._minDate).getFullYear(),a=s+1;while(1){if(i=new Date(0,0,1),i.setFullYear(h),i.setMonth(a-1),i>this._maxDate)break;bn.Z.create("DIV",{className:"ol-time ol-month",style:{left:this._getOffsetFromDate(i)-c},html:i.toLocaleDateString(void 0,{month:"short"}),parent:l}),a+=s,a>12&&(h++,a=s+1)}}if("day"===this.get("graduation")){o=(new Date(0,1,1)-new Date(0,0,1))*n;var p=Math.max(1,Math.round(31/Math.round(o/u/2)));if(p<31){h=new Date(this._minDate).getFullYear(),a=0;var d=p;while(1)if(i=new Date(0,0,1),i.setFullYear(h),i.setMonth(a),i.setDate(d),isNaN(i))a++,a>12&&(a=1,h++),d=p;else{if(i>this._maxDate)break;if(d>1){var g=this._getOffsetFromDate(i);this._getOffsetFromDate(new Date(h,a+1,1))-g>u&&bn.Z.create("DIV",{className:"ol-time ol-day",style:{left:g-c},html:d,parent:l})}h=i.getFullYear(),a=i.getMonth(),d=i.getDate()+p,d>new Date(h,a+1,0).getDate()&&(a++,d=p)}}}},On.prototype.setDate=function(t,e){var r;if(e=e||{},t instanceof Date?r=t:(this.getFeatures().indexOf(t)>=0&&(r=this._getFeatureDate(t)),!r||r instanceof Date||(r=new Date(r)),r&&!isNaN(r)||(r=new Date(String(t)))),!isNaN(r)){!1===e.anim&&this._scrollDiv.classList.add("ol-move");var n=this._getOffsetFromDate(r);if("start"===e.position?n+=bn.Z.outerWidth(this._scrollDiv)/2-bn.Z.getStyle(this._scrollDiv,"marginLeft")/2:"end"===e.position&&(n-=bn.Z.outerWidth(this._scrollDiv)/2-bn.Z.getStyle(this._scrollDiv,"marginLeft")/2),this._setScrollLeft(n),!1===e.anim&&this._scrollDiv.classList.remove("ol-move"),t)for(var i,o=0;i=this._tline[o];o++)i.feature===t?(i.elt.classList.add("ol-select"),this._select=i):i.elt.classList.remove("ol-select")}},On.prototype.roundDate=function(t,e){switch(e){case"mn":return new Date(this._roundTo(t,6e4));case"hour":return new Date(this._roundTo(t,36e5));case"day":return new Date(this._roundTo(t,864e5));case"month":return t=new Date(this._roundTo(t,864e5)),t.getDate()>15&&(t=new Date(t.setMonth(t.getMonth()+1))),t=t.setDate(1),new Date(t);default:return new Date(t)}},On.prototype.getDate=function(t,e){var r;switch(e||(e=t),t){case"start":r=this.get("interval")?-bn.Z.getStyle(this._intervalDiv,"width")/2+bn.Z.getStyle(this._scrollDiv,"marginLeft")/2:-bn.Z.outerWidth(this._scrollDiv)/2+bn.Z.getStyle(this._scrollDiv,"marginLeft")/2;break;case"end":r=this.get("interval")?bn.Z.getStyle(this._intervalDiv,"width")/2-bn.Z.getStyle(this._scrollDiv,"marginLeft")/2:bn.Z.outerWidth(this._scrollDiv)/2-bn.Z.getStyle(this._scrollDiv,"marginLeft")/2;break;default:r=0;break}var n=this._getDateFromOffset(this._getScrollLeft()+r);return n=this.roundDate(n,e),new Date(n)},On.prototype._roundTo=function(t,e){return Math.round(t/e)*e},On.prototype.getStartDate=function(){return new Date(this.get("minDate"))},On.prototype.getEndDate=function(){return new Date(this.get("maxDate"))};const Cn=On;var An=r(25108);const Nn={data(){return{WMTSCapabilities:{},timeline:null}},methods:{async addWebService(t){switch(t.type.toLowerCase()){case"xyz":return this.updateXYZLayer(t);case"wmts":return await this.updateWMTSLayer(t);default:return a.Z.error(this,"Sorry, this web service type is not supported."),null}},getWMTSTimes(t,e){const r=t.Contents.Layer||[];let n=r.find((t=>t.Identifier==e));if(!n||!n.Dimension)return[];let i=n.Dimension.find((t=>"TIME"===t.Identifier));return i?i.Value.sort():[]},async initWMTSLayer(t){if(!this.WMTSCapabilities[t.url])try{let r=new URL(t.url);r.searchParams.set("service","wmts"),r.searchParams.set("request","GetCapabilities");let n=await axios.get(r.toString(),{responseType:"text"});var e=new fn;this.WMTSCapabilities[t.url]=e.read(n.data)}catch(error){a.Z.exception(this,error,"WMTS Discovery failed")}return this.WMTSCapabilities[t.url]},async updateWMTSLayer(t,e="Service"){let r=t.attributes||{},n=await this.initWMTSLayer(t);n||a.Z.exception(this,error,"WMTS Discovery failed");let i,o=null,s=null,l=null,c=null,u=a.Z.getResourceTitle(t,e),h=new Le.Z;Array.isArray(r.layers)?i=r.layers:Array.isArray(n.Contents.Layer)&&(i=layers.map((t=>t.Identifier)));for(let d of i){if(!d)continue;let e=wn(n,{layer:d,matrixSet:"EPSG:3857"});l||(l=new Date(e.dimensions.TIME));let i=this.getWMTSTimes(n,d);if(i.length){let t=new Date(i[0]),e=new Date(i[i.length-1]);(!o||t<o)&&(o=t),(!s||e>s)&&(s=e)}a.Z.isObject(r.dimensions)&&Object.assign(e.dimensions,t.attributes.dimensions),c=new xn(e);var f=new Ie.Z({title:u,source:this.trackTileProgress(c),noSwitcherDelete:!0});h.push(f)}if(o&&s){let t;this.timeline=new Cn({className:"ol-pointer",graduation:"day",minDate:o,maxDate:s}),this.timeline.on("scroll",(function(e){!e.date||e.date>s||e.date<o||(t&&window.clearTimeout(t),t=window.setTimeout((()=>{try{let t=e.date.toISOString().substr(0,10);c.updateDimensions({TIME:t});let r=document.getElementsByClassName("timeline-date-label");r[0].innerText=t,r[0].disabled=!0}catch(error){An.log(error)}t=null}),500))})),this.map.addControl(this.timeline),this.timeline.addButton({className:"timeline-date-label",title:`The date that is shown on the map for the collection '${u}'`,html:"No date"}),this.timeline.setDate(l)}let p=new Me.Z({id:t.id,title:u,layers:h});return p.on("change:visible",(()=>{this.timeline&&this.timeline.element&&(this.timeline.element.style.display=p.getVisible()?"block":"none")})),this.addLayerToMap(p),this.timeline&&this.map.getLayers().on("remove",(t=>{t.element===p&&(this.map.removeControl(this.timeline),this.timeline=null)})),p},updateXYZLayer(t,e="Service"){let r=a.Z.replaceParam(t.url,"__editorSessionId",(new Date).getTime()).replace(/%7B/g,"{").replace(/%7D/g,"}"),n=a.Z.getResourceTitle(t,e),i=new Ie.Z({title:n,source:this.trackTileProgress(new Pe.Z({url:r})),noSwitcherDelete:!0}),o=new Me.Z({id:t.id,title:n,layers:[i]});return this.addLayerToMap(o),o}}},Ln=Nn;var Mn,In,Pn=(0,v.Z)(Ln,Mn,In,!1,null,null,null);const Un=Pn.exports;var Gn=r(6139),Fn=r(81090),Zn=r(2033),Bn=r(92371),Xn=r(25108);o.Z.prototype.getSampleByteSize=function(t){if(this.fileDirectory.BitsPerSample&&0!==this.fileDirectory.BitsPerSample.length)return t>=this.fileDirectory.BitsPerSample.length&&(t=0),Math.ceil(this.fileDirectory.BitsPerSample[t]/8)},o.Z.prototype.getReaderForSample=function(t){const e=this.getSampleFormat(t),r=this.getBitsPerSample(t);switch(e){case 1:if(r<=8)return DataView.prototype.getUint8;if(r<=16)return DataView.prototype.getUint16;if(r<=32)return DataView.prototype.getUint32;break;case 2:if(r<=8)return DataView.prototype.getInt8;if(r<=16)return DataView.prototype.getInt16;if(r<=32)return DataView.prototype.getInt32;break;case 3:switch(r){case 16:return function(t,e){return getFloat16(this,t,e)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64;default:break}break;default:break}throw Error("Unsupported data format/bitsPerSample")},o.Z.prototype.getSampleFormat=function(t=0){return this.fileDirectory.SampleFormat&&0!==this.fileDirectory.SampleFormat.length?"undefined"!==typeof this.fileDirectory.SampleFormat[t]?this.fileDirectory.SampleFormat[t]:this.fileDirectory.SampleFormat[0]:1},o.Z.prototype.getBitsPerSample=function(t=0){if(this.fileDirectory.BitsPerSample&&0!==this.fileDirectory.BitsPerSample.length)return"undefined"!==typeof this.fileDirectory.BitsPerSample[t]?this.fileDirectory.BitsPerSample[t]:this.fileDirectory.BitsPerSample[0]};const jn={name:"MapViewer",mixins:[u.Z,Ce,Ae.Z,Un],components:{Pane:c.X,ScatterChart:Ne.Z,Splitpanes:c.F},props:{data:{}},data(){return{loading:!0,chart:null}},computed:{...a.Z.mapState(["connection"]),isWebService(){return this.data instanceof Gn.Service&&"string"===typeof this.data.type},isGeoTiff(){return this.data instanceof s.Z},isGeoJson(){return this.data instanceof l.Z&&this.data.isGeoJson}},mounted(){this.$emit("mounted",this)},methods:{async renderMap(){try{let t,e;if(this.isGeoJson)e=await this.data.loadData(this.connection);else if(this.isGeoTiff){e=await this.data.loadData(this.connection);let r=e.getProjection();r&&(t=r)}else{if(!this.isWebService||!a.Z.isMapServiceSupported(this.data.type))throw new Error("Sorry, the given data can't be shown on a web map.");if("wmts"===this.data.type.toLowerCase()){await this.initWMTSLayer(this.data)}}if(await this.createMap(t),this.addLayerSwitcher(),this.isGeoJson)this.addBasemaps(),this.addGeoJson(e,!0);else if(this.isGeoTiff){let t=this.map.getView().getProjection();(t.basemap||["EPSG:3857","EPSG:4326"].includes(t.getCode()))&&this.addBasemaps();let r=this.data.getContext();r&&this.addExtent(r,!1),this.addGeoTiff(e)}else this.isWebService&&a.Z.isMapServiceSupported(this.data.type)&&(this.addBasemaps(),this.addWebService(this.data));this.$listeners&&this.$listeners.drop&&(this.map.getViewport().addEventListener("dragover",(t=>t.preventDefault())),this.map.getViewport().addEventListener("drop",this.$listeners.drop))}catch(error){a.Z.exception(this,error)}this.loading=!1},async addCollection(){let t=this.showWebService(this.data);try{let e=service.attributes.bbox,r=[...this.fromLonLat([e.west,e.south]),...this.fromLonLat([e.east,e.north])],n=new Bn.Z({title:"Extent",noSwitcherDelete:!0,source:new Rn.Z({features:[new Fn.Z((0,Zn.oJ)(r))],projection:"EPSG:4326",wrapX:!1})});this.removeLayerFill(n),t.getLayers().push(n),this.map.getView().fit(r,this.getFitOptions(10))}catch(error){Xn.log(error)}}}},Vn=jn;var kn=(0,v.Z)(Vn,n,i,!1,null,null,null);const zn=kn.exports}}]);
//# sourceMappingURL=8098.6475b08c.js.map