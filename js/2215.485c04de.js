"use strict";(globalThis["webpackChunk_openeo_web_editor"]=globalThis["webpackChunk_openeo_web_editor"]||[]).push([[2215],{31660:(e,t,a)=>{a.d(t,{A:()=>d});a(61701);var i=a(66684),s=a.n(i);a(22489);class r{constructor(e,t=!1){this.url=e,this.geojson=t}getParameters(e){return{url:this.url,params:{q:e.query,format:"json",limit:10,"accept-language":"en",polygon_geojson:this.geojson?1:0,polygon_threshold:.001}}}handleResponse(e){return 0===e.length?[]:e.filter(e=>["boundary","geological","leisure","natural","place","water","waterway"].includes(e.class)).map(e=>({lon:e.lon,lat:e.lat,bbox:e.boundingbox,address:{name:e.display_name},original:{formatted:e.display_name,details:e.address,geojson:e.geojson}}))}}const n={methods:{addGeocoder(e,t=!1){if(!this.$config.geocoder)return;const a={provider:new r(this.$config.geocoder,t),placeholder:"Search for ...",keepOpen:!0,preventDefault:!0},i=new(s())("nominatim",a);i.on("addresschosen",a=>{if(t)e(a.place?.original?.geojson,a);else if(a.place.bbox){let t=a.place.bbox.map(e=>parseFloat(e)),i={west:t[2],east:t[3],north:t[1],south:t[0]};e(i,a)}else e(null,a)}),this.map.addControl(i)}}},o=n;var l,h,c=a(81656),p=(0,c.A)(o,l,h,!1,null,null,null);const d=p.exports},62215:(e,t,a)=>{a.r(t),a.d(t,{default:()=>se});a(61701);var i=function(){var e=this,t=e._self._c;return t("Splitpanes",{staticClass:"default-theme",attrs:{horizontal:""}},[t("Pane",{attrs:{id:"map"}},[t("div",{staticClass:"map-viewer",attrs:{id:e.id}},[t("ProgressControl",{ref:"progress",attrs:{map:e.map}}),t("UserLocationControl",{attrs:{map:e.map}}),t("AddDataControl",{attrs:{map:e.map},on:{add:e.addData}}),e.isGeoTiff?[t("TextControl",{attrs:{text:e.textControlText}}),t("div",{staticClass:"ol-unselectable ol-control geotiff-channels"},[e._l(e.geotiffs,function(a){return[a.colorMap?e._e():t("ChannelControl",{key:a.layer.id,attrs:{bands:a.bands,defaultChannels:a.defaultChannels,title:e.geotiffs.length>1?a.layer.get("title"):""},on:{update:(t,i)=>e.updateGeoTiffStyle(a,t,i)}})]})],2)]:e._e(),e.loading?t("div",{staticClass:"map-loading"},[t("i",{staticClass:"fas fa-spinner fa-spin"}),t("span",[e._v("Loading map...")])]):e._e()],2)]),e.chart?t("Pane",{attrs:{id:"chart",size:33}},[t("span",{staticClass:"close",on:{click:e.closeChart}},[t("i",{staticClass:"fa fa-times",attrs:{"aria-hidden":"true"}})]),t("ScatterChart",e._b({attrs:{height:220}},"ScatterChart",e.chart,!1))],1):e._e()],1)},s=[],r=(a(29314),a(81148),a(22489),a(17642),a(15024),a(31698),a(2566)),n=a(76130),o=a(75024),l=a(44304),h=a(38363),c=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ol-add-data ol-unselectable ol-control",staticStyle:{"pointer-events":"auto"}},[t("button",{attrs:{type:"button",title:"Add external data source"},on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.openModal.apply(null,arguments)}}},[t("i",{staticClass:"fas fa-image"})])])},p=[],d=a(23634),m=a(61663);const u={name:"AddDataControl",mixins:[d.A,m.A],methods:{openModal(){let e={save:this.addLayer};this.broadcast("showModal","AddMapDataModal",{},e)},addLayer(e){this.$emit("add",e)}}},g=u;var f=a(81656),y=(0,f.A)(g,c,p,!1,null,"046026ef",null);const v=y.exports;var S=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"show",rawName:"v-show",value:e.channels.length>0,expression:"channels.length > 0"}],staticClass:"channels"},[t("table",[t("thead",[e.title?t("tr",[t("th",{attrs:{colspan:e.cols}},[e._v(e._s(e.title))])]):e._e(),t("tr",[e.isGray?e._e():t("th",[e._v("Channel")]),e.multiBand?t("th",[e._v("Band")]):e._e(),t("th",[e._v("Min")]),t("th",[e._v("Max")])])]),t("tbody",e._l(e.channels,function(a,i){return t("tr",{key:i},[e.isGray?e._e():t("th",[e._v(e._s(e.labels[i]))]),e.multiBand?t("td",[t("select",{directives:[{name:"model",rawName:"v-model.number",value:a.id,expression:"channel.id",modifiers:{number:!0}}],on:{change:function(t){var i=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(t){var a="_value"in t?t._value:t.value;return e._n(a)});e.$set(a,"id",t.target.multiple?i:i[0])}}},e._l(e.bands,function(a){return t("option",{key:a.id,domProps:{value:a.id}},[e._v(e._s(a.name||a.id))])}),0)]):e._e(),t("td",[t("input",{directives:[{name:"model",rawName:"v-model.number",value:a.min,expression:"channel.min",modifiers:{number:!0}}],attrs:{type:"number",required:""},domProps:{value:a.min},on:{input:function(t){t.target.composing||e.$set(a,"min",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})]),t("td",[t("input",{directives:[{name:"model",rawName:"v-model.number",value:a.max,expression:"channel.max",modifiers:{number:!0}}],attrs:{type:"number",required:""},domProps:{value:a.max},on:{input:function(t){t.target.composing||e.$set(a,"max",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])])}),0),e.multiBand?t("tfoot",[t("tr",[t("td",{attrs:{colspan:e.cols}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.isGray,expression:"isGray"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.isGray)?e._i(e.isGray,null)>-1:e.isGray},on:{change:function(t){var a=e.isGray,i=t.target,s=!!i.checked;if(Array.isArray(a)){var r=null,n=e._i(a,r);i.checked?n<0&&(e.isGray=a.concat([r])):n>-1&&(e.isGray=a.slice(0,n).concat(a.slice(n+1)))}else e.isGray=s}}}),e._v(" Grayscale ")])])]):e._e()])])},b=[];const w={name:"ChannelControl",mixins:[d.A],props:{title:{type:String,default:""},bands:{type:Array,default:()=>[]},defaultChannels:{type:Array,default:()=>[]}},computed:{multiBand(){return this.bands.length>1},cols(){return this.isGray?this.multiBand?3:2:4},labels(){return this.isGray?["Grayscale"]:["Red","Green","Blue"]}},data(){return{channels:this.defaultChannels,isGray:1===this.defaultChannels.length||1===this.bands.length}},mounted(){},watch:{bands:{immediate:!0,handler(){1===this.bands.length&&(this.isGray=!0),this.updateChannels()}},isGray(){this.updateChannels(),this.emit()},channels:{deep:!0,handler(){this.emit()}}},methods:{isValid(e){return"number"===typeof e},updateChannels(){this.defaultChannels.length>0?(this.channels=this.defaultChannels,1===this.defaultChannels.length&&(this.isGray=!0)):this.channels=this.bands.slice(0,this.isGray?1:3).map(e=>Object.assign({},e)),2===this.channels.length&&this.channels.push(Object.assign({},this.channels[1]))},emit(){this.channels.filter(e=>this.isValid(e.min)&&this.isValid(e.max)).length>0&&this.$emit("update","channels",this.channels)}}},_=w;var x=(0,f.A)(_,S,b,!1,null,"5223a7ca",null);const C=x.exports;var A=a(66451),T=a(31660),M=a(95104),L=a(63105),D=(a(20116),a(7588),a(50071)),G=a(35598),P=a(30945),E=a(10702),B=a(53885),R=a(35316),F=a(53672);const V={mixins:[A.A],data(){return{WMTSCapabilities:{},timeline:null}},methods:{async addWebService(e){switch(e.type.toLowerCase()){case"xyz":return this.updateXYZLayer(e);case"wmts":return await this.updateWMTSLayer(e);default:return r.A.error(this,"Sorry, this web service type is not supported."),null}},getWMTSTimes(e,t){const a=e.Contents.Layer||[];let i=a.find(e=>e.Identifier==t);if(!i||!i.Dimension)return[];let s=i.Dimension.find(e=>"TIME"===e.Identifier);return s?s.Value.sort():[]},async initWMTSLayer(e){if(!this.WMTSCapabilities[e.url])try{let a=new URL(e.url);a.searchParams.set("service","wmts"),a.searchParams.set("request","GetCapabilities");let i=await r.A.axios().get(a.toString(),{responseType:"text"});var t=new B.A;this.WMTSCapabilities[e.url]=t.read(i.data)}catch(error){r.A.exception(this,error,"WMTS Discovery failed")}return this.WMTSCapabilities[e.url]},async updateWMTSLayer(e,t="Service"){let a=e.attributes||{},i=await this.initWMTSLayer(e);i||r.A.exception(this,error,"WMTS Discovery failed");let s,n=null,o=null,l=null,h=null,c=r.A.getResourceTitle(e,t),p=new D.A;Array.isArray(a.layers)?s=a.layers:Array.isArray(i.Contents.Layer)&&(s=layers.map(e=>e.Identifier));for(let u of s){if(!u)continue;let t=(0,R.t)(i,{layer:u,matrixSet:"EPSG:3857"});l||(l=new Date(t.dimensions.TIME));let s=this.getWMTSTimes(i,u);if(s.length){let e=new Date(s[0]),t=new Date(s[s.length-1]);(!n||e<n)&&(n=e),(!o||t>o)&&(o=t)}r.A.isObject(a.dimensions)&&Object.assign(t.dimensions,e.attributes.dimensions),h=new R.A(t);var d=new P.A({title:c,source:this.trackTileProgress(h),noSwitcherDelete:!0});p.push(d)}if(n&&o){let e;this.timeline=new F.A({className:"ol-pointer",graduation:"day",minDate:n,maxDate:o}),this.timeline.on("scroll",function(t){!t.date||t.date>o||t.date<n||(e&&window.clearTimeout(e),e=window.setTimeout(()=>{try{let e=t.date.toISOString().substr(0,10);h.updateDimensions({TIME:e});let a=document.getElementsByClassName("timeline-date-label");a[0].innerText=e,a[0].disabled=!0}catch(error){console.log(error)}e=null},500))}),this.map.addControl(this.timeline),this.timeline.addButton({className:"timeline-date-label",title:`The date that is shown on the map for the collection '${c}'`,html:"No date"}),this.timeline.setDate(l)}let m=new G.A({id:e.id,title:c,layers:p});return m.on("change:visible",()=>{this.timeline&&this.timeline.element&&(this.timeline.element.style.display=m.getVisible()?"block":"none")}),this.addLayerToMap(m),this.timeline&&this.map.getLayers().on("remove",e=>{e.element===m&&(this.map.removeControl(this.timeline),this.timeline=null)}),m},updateXYZLayer(e,t="Service"){let a=r.A.replaceParam(e.url,"__editorSessionId",(new Date).getTime()).replace(/%7B/g,"{").replace(/%7D/g,"}"),i=r.A.getResourceTitle(e,t),s=new P.A({title:i,source:this.trackTileProgress(new E.A({url:a})),noSwitcherDelete:!0}),n=new G.A({id:e.id,title:i,layers:[s]});if(this.addLayerToMap(n),r.A.isObject(e.process)&&r.A.isObject(e.process.process_graph)){const t="urn:ogc:def:crs:OGC:1.3:CRS84",a="EPSG:4326";Object.values(e.process.process_graph).filter(e=>"load_collection"===e.process_id&&r.A.isObject(e.arguments)&&e.arguments.spatial_extent).forEach(e=>{let i=e.arguments.spatial_extent,s=(i.west||i.east||i.south||i.north)&&(!i.crs||4326===i.crs||i.crs===a),n=i.type&&(!i.crs||r.A.isObject(i.crs)&&"name"===i.crs.type&&(i.crs.properties?.name===a||i.properties?.name===t));(s||n)&&this.addExtent(i,!1)})}return n}}},k=V;var O,$,z=(0,f.A)(k,O,$,!1,null,null,null);const j=z.exports;class I{constructor(e){this.layer=null,this.colorMap=e.getColorMap(),this.noData=e.getNoData(),this.bands=e.getBands(),this.defaultChannels=this.bands.slice(0,3),this.channels=this.bands.slice(0,3),this.file=e}getBandVar(e){return["band",["var",`${e}band`]]}getFormula(e){let t=["var",`${e}min`],a=["var",`${e}max`],i=this.getBandVar(e),s=["*",["/",["-",i,t],["-",a,t]],255];return["clamp",s,0,255]}getNoDataFormula(){let e=this.getBandVar("alpha");return["case",["==",e,0],0,1]}setStyle(){if(!this.layer)return;let e={};for(let a in this.channels){let t=this.channels[a];e[`${a}band`]=t.id,e[`${a}min`]=t.min,e[`${a}max`]=t.max}e.alphaband=this.bands.length+1;let t=[];if(this.colorMap)t.push("palette"),t.push(["band",1]),t.push(this.colorMap);else{if(0===this.channels.length)return null;if(1===this.channels.length){t.push("color");let e=this.getFormula(0);t.push(e),t.push(e),t.push(e),this.noData.length>0&&t.push(this.getNoDataFormula())}else t.push("color"),t.push(this.getFormula(0)),t.push(this.getFormula(1)),t.push(this.getFormula(2)),this.noData.length>0&&t.push(this.getNoDataFormula())}this.layer.setStyle({variables:e,color:t})}}var N=a(11585);N.A.prototype.getSampleByteSize=function(e){if(this.fileDirectory.BitsPerSample&&0!==this.fileDirectory.BitsPerSample.length)return e>=this.fileDirectory.BitsPerSample.length&&(e=0),Math.ceil(this.fileDirectory.BitsPerSample[e]/8)},N.A.prototype.getReaderForSample=function(e){const t=this.getSampleFormat(e),a=this.getBitsPerSample(e);switch(t){case 1:if(a<=8)return DataView.prototype.getUint8;if(a<=16)return DataView.prototype.getUint16;if(a<=32)return DataView.prototype.getUint32;break;case 2:if(a<=8)return DataView.prototype.getInt8;if(a<=16)return DataView.prototype.getInt16;if(a<=32)return DataView.prototype.getInt32;break;case 3:switch(a){case 16:return function(e,t){return getFloat16(this,e,t)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64;default:break}break;default:break}throw Error("Unsupported data format/bitsPerSample")},N.A.prototype.getSampleFormat=function(e=0){return this.fileDirectory.SampleFormat&&0!==this.fileDirectory.SampleFormat.length?"undefined"!==typeof this.fileDirectory.SampleFormat[e]?this.fileDirectory.SampleFormat[e]:this.fileDirectory.SampleFormat[0]:1},N.A.prototype.getBitsPerSample=function(e=0){if(this.fileDirectory.BitsPerSample&&0!==this.fileDirectory.BitsPerSample.length)return"undefined"!==typeof this.fileDirectory.BitsPerSample[e]?this.fileDirectory.BitsPerSample[e]:this.fileDirectory.BitsPerSample[0]};var W=a(73902),U=a(86717),J=a(34142),X=a(89718),Y=a(82986),q=a(66922),Z=a(84777),H=a(54602),K=a(10972),Q=class extends K["default"]{constructor(e){e=e||{};var t=document.createElement("div");super({element:t}),t.className=(e.className||"ol-swipe")+" ol-unselectable ol-control";var a=document.createElement("button");t.appendChild(a),t.addEventListener("mousedown",this.move.bind(this)),t.addEventListener("touchstart",this.move.bind(this)),this.precomposeRight_=this.precomposeRight.bind(this),this.precomposeLeft_=this.precomposeLeft.bind(this),this.postcompose_=this.postcompose.bind(this),this.layers=[],e.layers&&this.addLayer(e.layers,!1),e.rightLayers&&this.addLayer(e.rightLayers,!0),this.on("propertychange",function(e){if(this.getMap())try{this.getMap().renderSync()}catch(e){}"horizontal"===this.get("orientation")?(this.element.style.top=100*this.get("position")+"%",this.element.style.left=""):("vertical"!==this.get("orientation")&&this.set("orientation","vertical"),this.element.style.left=100*this.get("position")+"%",this.element.style.top=""),"orientation"===e.key&&(this.element.classList.remove("horizontal","vertical"),this.element.classList.add(this.get("orientation"))),this.isMoving||this.layers.forEach(function(e){e.layer.getImageRatio&&e.layer.changed()})}.bind(this)),this.set("position",e.position||.5),this.set("orientation",e.orientation||"vertical")}setMap(e){var t,a;if(this.getMap()){for(t=0;t<this.layers.length;t++)a=this.layers[t],a.right?a.layer.un(["precompose","prerender"],this.precomposeRight_):a.layer.un(["precompose","prerender"],this.precomposeLeft_),a.layer.un(["postcompose","postrender"],this.postcompose_);try{this.getMap().renderSync()}catch(i){}}if(super.setMap(e),e){for(this._listener=[],t=0;t<this.layers.length;t++)a=this.layers[t],a.right?a.layer.on(["precompose","prerender"],this.precomposeRight_):a.layer.on(["precompose","prerender"],this.precomposeLeft_),a.layer.on(["postcompose","postrender"],this.postcompose_);try{e.renderSync()}catch(i){}}}isLayer_(e){for(var t=0;t<this.layers.length;t++)if(this.layers[t].layer===e)return t;return-1}addLayer(e,t){e instanceof Array||(e=[e]);for(var a=0;a<e.length;a++){var i=e[a];if(this.isLayer_(i)<0&&(this.layers.push({layer:i,right:t}),this.getMap())){t?i.on(["precompose","prerender"],this.precomposeRight_):i.on(["precompose","prerender"],this.precomposeLeft_),i.on(["postcompose","postrender"],this.postcompose_);try{this.getMap().renderSync()}catch(s){}}}}removeLayers(){var e=[];this.layers.forEach(function(t){e.push(t.layer)}),this.removeLayer(e)}removeLayer(e){e instanceof Array||(e=[e]);for(var t=0;t<e.length;t++){var a=this.isLayer_(e[t]);a>=0&&this.getMap()&&(this.layers[a].right?e[t].un(["precompose","prerender"],this.precomposeRight_):e[t].un(["precompose","prerender"],this.precomposeLeft_),e[t].un(["postcompose","postrender"],this.postcompose_),this.layers.splice(a,1))}if(this.getMap())try{this.getMap().renderSync()}catch(i){}}getRectangle(){var e;return"vertical"===this.get("orientation")?(e=this.getMap().getSize(),[0,0,e[0]*this.get("position"),e[1]]):(e=this.getMap().getSize(),[0,0,e[0],e[1]*this.get("position")])}move(e){var t,a=this;switch(this._movefn||(this._movefn=this.move.bind(this)),e.type){case"touchcancel":case"touchend":case"mouseup":a.isMoving=!1,["mouseup","mousemove","touchend","touchcancel","touchmove"].forEach(function(e){document.removeEventListener(e,a._movefn)}),this.layers.forEach(function(e){e.layer.getImageRatio&&e.layer.changed()});break;case"mousedown":case"touchstart":a.isMoving=!0,["mouseup","mousemove","touchend","touchcancel","touchmove"].forEach(function(e){document.addEventListener(e,a._movefn)});case"mousemove":case"touchmove":if(a.isMoving)if("vertical"===a.get("orientation")){var i=e.pageX||e.touches&&e.touches.length&&e.touches[0].pageX||e.changedTouches&&e.changedTouches.length&&e.changedTouches[0].pageX;if(!i)break;i-=a.getMap().getTargetElement().getBoundingClientRect().left+window.pageXOffset-document.documentElement.clientLeft,t=a.getMap().getSize()[0];var s=t-Math.min(Math.max(0,t-i),t);t=s/t,a.set("position",t),a.dispatchEvent({type:"moving",size:[s,a.getMap().getSize()[1]],position:[t,0]})}else{var r=e.pageY||e.touches&&e.touches.length&&e.touches[0].pageY||e.changedTouches&&e.changedTouches.length&&e.changedTouches[0].pageY;if(!r)break;r-=a.getMap().getTargetElement().getBoundingClientRect().top+window.pageYOffset-document.documentElement.clientTop,t=a.getMap().getSize()[1];var n=t-Math.min(Math.max(0,t-r),t);t=n/t,a.set("position",t),a.dispatchEvent({type:"moving",size:[a.getMap().getSize()[0],n],position:[0,t]})}break;default:break}}_transformPt(e,t){var a=e.inversePixelTransform,i=t[0],s=t[1];return t[0]=a[0]*i+a[2]*s+a[4],t[1]=a[1]*i+a[3]*s+a[5],t}_drawRect(e,t){var a=e.inversePixelTransform;if(a){var i=[[t[0][0],t[0][1]],[t[0][0],t[1][1]],[t[1][0],t[1][1]],[t[1][0],t[0][1]],[t[0][0],t[0][1]]];if(e.context.save(),e.target.getImageRatio){var s=-Math.atan2(e.frameState.pixelToCoordinateTransform[1],e.frameState.pixelToCoordinateTransform[0]);e.context.translate(e.frameState.size[0]/2,e.frameState.size[1]/2),e.context.rotate(s),e.context.translate(-e.frameState.size[0]/2,-e.frameState.size[1]/2)}i.forEach(function(t,i){t=[t[0]*a[0]-t[1]*a[1]+a[4],-t[0]*a[2]+t[1]*a[3]+a[5]],i?e.context.lineTo(t[0],t[1]):e.context.moveTo(t[0],t[1])}),e.context.restore()}else{var r=e.frameState.pixelRatio;e.context.rect(t[0][0]*r,t[0][1]*r,t[1][0]*r,t[1][1]*r)}}precomposeLeft(e){var t=e.context;if(t instanceof WebGLRenderingContext){if("prerender"===e.type){this._lefttime!=e.frameState.time&&(t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),this._lefttime=e.frameState.time),t.enable(t.SCISSOR_TEST);var a,i,s=this.getMap().getSize(),r=this._transformPt(e,[0,s[1]]),n=this._transformPt(e,[s[0],0]),o=n[0]-r[0],l=n[1]-r[1];"vertical"===this.get("orientation")?(a=Math.round(o*this.get("position")),i=l):(a=o,i=Math.round(l*this.get("position")),r[1]+=l-i),t.scissor(r[0],r[1],a,i),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)}}else{var h=e.frameState.size;t.save(),t.beginPath();var c=[[0,0],[h[0],h[1]]];"vertical"===this.get("orientation")?c[1]=[.5*h[0]+this.getMap().getSize()[0]*(this.get("position")-.5),h[1]]:c[1]=[h[0],.5*h[1]+this.getMap().getSize()[1]*(this.get("position")-.5)],this._drawRect(e,c),t.clip()}}precomposeRight(e){var t=e.context;if(t instanceof WebGLRenderingContext){if("prerender"===e.type){this._righttime!=e.frameState.time&&(t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),this._righttime=e.frameState.time),t.enable(t.SCISSOR_TEST);var a,i,s=this.getMap().getSize(),r=this._transformPt(e,[0,s[1]]),n=this._transformPt(e,[s[0],0]),o=n[0]-r[0],l=n[1]-r[1];"vertical"===this.get("orientation")?(i=l,a=Math.round(o*(1-this.get("position"))),r[0]+=o-a):(a=o,i=Math.round(l*(1-this.get("position")))),t.scissor(r[0],r[1],a,i),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)}}else{var h=e.frameState.size;t.save(),t.beginPath();var c=[[0,0],[h[0],h[1]]];"vertical"===this.get("orientation")?c[0]=[.5*h[0]+this.getMap().getSize()[0]*(this.get("position")-.5),0]:c[0]=[0,.5*h[1]+this.getMap().getSize()[1]*(this.get("position")-.5)],this._drawRect(e,c),t.clip()}}postcompose(e){if(e.context instanceof WebGLRenderingContext){if("postrender"===e.type){var t=e.context;t.disable(t.SCISSOR_TEST)}}else e.target.getClassName&&"ol-layer"!==e.target.getClassName()&&e.target.get("declutter")?setTimeout(function(){e.context.restore()},0):e.context.restore()}};const ee=Q,te={name:"MapViewer",mixins:[A.A,T.A,M.A,j],components:{AddDataControl:v,ChannelControl:C,Pane:l.Z,ScatterChart:h.A,Splitpanes:l.S,TextControl:L.A},props:{data:{}},data(){return{textControlText:"Value: -",loading:!0,chart:null,geotiffs:[],swipe:null,layerId:0}},computed:{...r.A.mapState(["connection"]),...r.A.mapState("editor",["appMode"]),isWebService(){return this.data instanceof W.Service&&"string"===typeof this.data.type},isGeoTiff(){return this.data instanceof n.A},isGeoJson(){return this.data instanceof o.A&&this.data.isGeoJson}},mounted(){this.$emit("mounted",this)},methods:{async renderMap(){try{let e,t;if(this.isGeoJson)t=await this.data.loadData(this.connection);else if(this.isGeoTiff){t=await this.data.loadData(this.connection);let a=t.getProjection();a&&(e=a)}else{if(!this.isWebService||!r.A.isMapServiceSupported(this.data.type))throw new Error("Sorry, the given data can't be shown on a web map.");if("wmts"===this.data.type.toLowerCase()){await this.initWMTSLayer(this.data)}}await this.createMap(e);const a=this.map.getLayers();if(a.on("add",e=>{const t=e.element.get("geotiff");t&&(this.geotiffs.push(t),this.updateSwiper())}),a.on("remove",e=>{const t=e.element.get("geotiff"),a=this.geotiffs.indexOf(t);a>-1&&(this.geotiffs.splice(a,1),this.updateSwiper())}),this.addLayerSwitcher(),this.addGeocoder(e=>{if(!e)return;let t=this.toExtent(e);t=(0,X.transformExtent)(t,"EPSG:4326",this.map.getView().getProjection()),this.map.getView().fit(t,this.getFitOptions())}),this.isGeoJson)this.addBasemaps(),this.addGeoJson(t,!0);else if(this.isGeoTiff){let e=this.map.getView().getProjection();(e.basemap||["EPSG:3857","EPSG:4326"].includes(e.getCode()))&&this.addBasemaps(),this.addGeoTiff(t,t.title);let a=this.data.getContext();a&&this.addExtent(a,!1)}else this.isWebService&&r.A.isMapServiceSupported(this.data.type)&&(this.addBasemaps(),this.addWebService(this.data));this.$listeners&&this.$listeners.drop&&(this.map.getViewport().addEventListener("dragover",e=>e.preventDefault()),this.map.getViewport().addEventListener("drop",this.$listeners.drop)),this.map.on("pointermove",this.onPointerMove),this.map.on("click",this.onClick)}catch(error){r.A.exception(this,error)}this.loading=!1},async addCollection(){let e=this.showWebService(this.data);try{let t=service.attributes.bbox,a=[...this.fromLonLat([t.west,t.south]),...this.fromLonLat([t.east,t.north])],i=new Y["default"]({title:"Extent",noSwitcherDelete:!0,source:new H["default"]({features:[new U["default"]((0,J.VY)(a))],projection:"EPSG:4326",wrapX:!1})});this.removeLayerFill(i),e.getLayers().push(i),this.map.getView().fit(a,this.getFitOptions(10))}catch(error){console.log(error)}},getPixelValues(e){return this.geotiffs.map(t=>{const a=t.layer;let i=a.getData(e);i=i?Array.from(i):[];const s=t.noData,r=s.length>0?i.pop():void 0;i=i.map(e=>0===r||s.includes(e)?NaN:e);const n=i.map((e,a)=>{const i=t.bands[a];if(i){const e=String(i.name||i.id);if(e.length>0)return e}return String(a)});return{title:a.get("title"),data:i,labels:n}})},formatCoords(e){return e.map(e=>String(parseFloat(e.toFixed(6)))).join(", ")},formatValue({data:e}){return Array.isArray(e)&&0!==e.length?e.map(e=>(e=parseFloat(e.toFixed(6)),isNaN(e)?"no data":e)).join(" / "):"-"},onPointerMove(e){const t=this.getPixelValues(e.pixel);let a="-";1===t.length?a=this.formatValue(t[0]):t.length>1&&(a=t.map(e=>`\r\n- ${e.title}: ${this.formatValue(e)}`).join(""));const i=t.length>1?"s":"",s=this.formatCoords(e.coordinate);this.textControlText=[`Value${i}: ${a}`,`Pixel Value${i}: ${a}\r\nCoordinate: ${s}`]},onClick(e){const t=this.getPixelValues(e.pixel),a=t.map(e=>e.data).flat().filter(e=>isFinite(e));if(a.length<2)return void(this.chart=null);let i=t.map(e=>e.labels).flat();i=Array.from(new Set(i));const s=t.map(e=>{const t={};for(let a in e.data)t[e.labels[a]]=e.data[a];return{label:e.title,data:t}}),r=this.formatCoords(e.coordinate);this.chart={title:`Coordinate: ${r}`,labels:i,datasets:s}},closeChart(){this.chart=null},async addGeoTiff(e,t="GeoTiff"){const a=new I(e),i={nodata:a.noData[0]};e.getBlob()?i.blob=e.getBlob():i.url=e.getUrl();const s=new Z.A({interpolate:!1,normalize:!1,convertToRGB:e.convertToRGB,sources:[i]}),r=new q.A({id:e.getUrl(),title:t,source:s,className:"geotiff"+this.layerId++,cacheSize:2048});a.layer=r,r.set("geotiff",a),r.once("prerender",()=>a.setStyle()),r.on("change:visible",()=>this.updateSwiper()),this.addLayerToMap(r);let n=e.getExtent();return n&&this.map.getView().fit(n,this.getFitOptions(10)),r},async addData(e){if(e.length>5&&!r.A.confirmOpenAll(e))return;const t=e.map(async e=>(await e.loadData(this.connection),e instanceof n.A?await this.addGeoTiff(e,e.title):e instanceof o.A&&e.isGeoJson?await this.addGeoJson(e,!1,e.title):void r.A.error(this,new Error(`Sorry, the given data at ${e.href} is not supported.`))));await Promise.all(t)},updateSwiper(){const e=this.map.getLayers().getArray().filter(e=>e.get("geotiff")&&e.getVisible());if(2===e.length){if(this.swipe&&e.every((e,t)=>e===this.swipe.layers[t]))return;const t={layers:e[0],rightLayers:e[1]},a=new ee(t);this.swipe={control:a,layers:e},this.map.addControl(a)}else 2!==e.length&&this.swipe&&(this.map.removeControl(this.swipe.control),this.swipe=null)},updateGeoTiffStyle(e,t,a){switch(t){case"channels":e.channels=a,this.setOptions("channels",a);break}e.setStyle()}}},ae=te;var ie=(0,f.A)(ae,i,s,!1,null,null,null);const se=ie.exports},63105:(e,t,a)=>{a.d(t,{A:()=>c});var i=function(){var e=this,t=e._self._c;return e.texts.length>0?t("div",{staticClass:"ol-unselectable ol-control value",class:{pointer:e.texts.length>1},on:{click:e.toggle}},[e._v(e._s(e.current))]):e._e()},s=[],r=a(23634);const n={name:"TextControl",mixins:[r.A],data(){return{i:0}},computed:{texts(){return Array.isArray(this.text)?this.text:"string"===typeof this.text&&this.text.length>0?[this.text]:[]},current(){return 0===this.texts.length?"":this.texts[this.i%this.text.length]}},props:{text:{type:[String,Array],default:""}},methods:{toggle(){this.i++}}},o=n;var l=a(81656),h=(0,l.A)(o,i,s,!1,null,"b1521986",null);const c=h.exports}}]);
//# sourceMappingURL=2215.485c04de.js.map