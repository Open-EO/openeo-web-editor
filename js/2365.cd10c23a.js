"use strict";(globalThis["webpackChunk_openeo_web_editor"]=globalThis["webpackChunk_openeo_web_editor"]||[]).push([[2365],{52913:(t,e,i)=>{i.d(e,{A:()=>l});var s=i(70915),r=i(89718),o=i(61597);const n=10,h=.25;class a{constructor(t,e,i,o,h,a){this.sourceProj_=t,this.targetProj_=e;let l={};const c=(0,r.getTransform)(this.targetProj_,this.sourceProj_);this.transformInv_=function(t){const e=t[0]+"/"+t[1];return l[e]||(l[e]=c(t)),l[e]},this.maxSourceExtent_=o,this.errorThresholdSquared_=h*h,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!o&&!!this.sourceProj_.getExtent()&&(0,s.RG)(o)>=(0,s.RG)(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?(0,s.RG)(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?(0,s.RG)(this.targetProj_.getExtent()):null;const u=(0,s.Py)(i),_=(0,s.WU)(i),d=(0,s.k_)(i),g=(0,s.R)(i),f=this.transformInv_(u),T=this.transformInv_(_),E=this.transformInv_(d),p=this.transformInv_(g),x=n+(a?Math.max(0,Math.ceil(Math.log2((0,s.UG)(i)/(a*a*256*256)))):0);if(this.addQuad_(u,_,d,g,f,T,E,p,x),this.wrapsXInSource_){let t=1/0;this.triangles_.forEach(function(e,i,s){t=Math.min(t,e.source[0][0],e.source[1][0],e.source[2][0])}),this.triangles_.forEach(e=>{if(Math.max(e.source[0][0],e.source[1][0],e.source[2][0])-t>this.sourceWorldWidth_/2){const i=[[e.source[0][0],e.source[0][1]],[e.source[1][0],e.source[1][1]],[e.source[2][0],e.source[2][1]]];i[0][0]-t>this.sourceWorldWidth_/2&&(i[0][0]-=this.sourceWorldWidth_),i[1][0]-t>this.sourceWorldWidth_/2&&(i[1][0]-=this.sourceWorldWidth_),i[2][0]-t>this.sourceWorldWidth_/2&&(i[2][0]-=this.sourceWorldWidth_);const s=Math.min(i[0][0],i[1][0],i[2][0]),r=Math.max(i[0][0],i[1][0],i[2][0]);r-s<this.sourceWorldWidth_/2&&(e.source=i)}})}l={}}addTriangle_(t,e,i,s,r,o){this.triangles_.push({source:[s,r,o],target:[t,e,i]})}addQuad_(t,e,i,r,n,a,l,c,u){const _=(0,s.Tr)([n,a,l,c]),d=this.sourceWorldWidth_?(0,s.RG)(_)/this.sourceWorldWidth_:null,g=this.sourceWorldWidth_,f=this.sourceProj_.canWrapX()&&d>.5&&d<1;let T=!1;if(u>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const o=(0,s.Tr)([t,e,i,r]),n=(0,s.RG)(o)/this.targetWorldWidth_;T=n>h||T}!f&&this.sourceProj_.isGlobal()&&d&&(T=d>h||T)}if(!T&&this.maxSourceExtent_&&isFinite(_[0])&&isFinite(_[1])&&isFinite(_[2])&&isFinite(_[3])&&!(0,s.HY)(_,this.maxSourceExtent_))return;let E=0;if(!T&&(!isFinite(n[0])||!isFinite(n[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1])||!isFinite(c[0])||!isFinite(c[1])))if(u>0)T=!0;else if(E=(isFinite(n[0])&&isFinite(n[1])?0:8)+(isFinite(a[0])&&isFinite(a[1])?0:4)+(isFinite(l[0])&&isFinite(l[1])?0:2)+(isFinite(c[0])&&isFinite(c[1])?0:1),1!=E&&2!=E&&4!=E&&8!=E)return;if(u>0){if(!T){const e=[(t[0]+i[0])/2,(t[1]+i[1])/2],s=this.transformInv_(e);let r;if(f){const t=((0,o.xP)(n[0],g)+(0,o.xP)(l[0],g))/2;r=t-(0,o.xP)(s[0],g)}else r=(n[0]+l[0])/2-s[0];const h=(n[1]+l[1])/2-s[1],a=r*r+h*h;T=a>this.errorThresholdSquared_}if(T){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){const s=[(e[0]+i[0])/2,(e[1]+i[1])/2],o=this.transformInv_(s),h=[(r[0]+t[0])/2,(r[1]+t[1])/2],_=this.transformInv_(h);this.addQuad_(t,e,s,h,n,a,o,_,u-1),this.addQuad_(h,s,i,r,_,o,l,c,u-1)}else{const s=[(t[0]+e[0])/2,(t[1]+e[1])/2],o=this.transformInv_(s),h=[(i[0]+r[0])/2,(i[1]+r[1])/2],_=this.transformInv_(h);this.addQuad_(t,s,h,r,n,o,_,c,u-1),this.addQuad_(s,e,i,h,o,a,l,_,u-1)}return}}if(f){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}0==(11&E)&&this.addTriangle_(t,i,r,n,l,c),0==(14&E)&&this.addTriangle_(t,i,e,n,l,a),E&&(0==(13&E)&&this.addTriangle_(e,r,t,a,c,n),0==(7&E)&&this.addTriangle_(e,r,i,a,c,l))}calculateSourceExtent(){const t=(0,s.S5)();return this.triangles_.forEach(function(e,i,r){const o=e.source;(0,s.$C)(t,o[0]),(0,s.$C)(t,o[1]),(0,s.$C)(t,o[2])}),t}getTriangles(){return this.triangles_}}const l=a},93101:(t,e,i)=>{i.d(e,{l:()=>s});const s=.5},97404:(t,e,i)=>{i.d(e,{A:()=>g});var s=i(93101),r=i(6837),o=i(8143),n=i(11078),h=i(52913),a=i(33513),l=i(61597),c=i(70915),u=i(9438),_=i(68711);class d extends o.A{constructor(t,e,i,r,o,u,_,d,g,f,T,E){super(o,n.A.IDLE,E),this.renderEdges_=void 0!==T&&T,this.pixelRatio_=_,this.gutter_=d,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=r,this.wrappedTileCoord_=u||o,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=t.canWrapX()?t.getExtent():void 0;const p=r.getTileCoordExtent(this.wrappedTileCoord_),x=this.targetTileGrid_.getExtent();let A=this.sourceTileGrid_.getExtent();const G=x?(0,c._N)(p,x):p;if(0===(0,c.UG)(G))return void(this.state=n.A.EMPTY);const R=t.getExtent();R&&(A=A?(0,c._N)(A,R):R);const m=r.getResolution(this.wrappedTileCoord_[0]),W=(0,a.aY)(t,i,G,m);if(!isFinite(W)||W<=0)return void(this.state=n.A.EMPTY);const P=void 0!==f?f:s.l;if(this.triangulation_=new h.A(t,i,G,A,W*P,m),0===this.triangulation_.getTriangles().length)return void(this.state=n.A.EMPTY);this.sourceZ_=e.getZForResolution(W);let S=this.triangulation_.calculateSourceExtent();if(A&&(t.canWrapX()?(S[1]=(0,l.qE)(S[1],A[1],A[3]),S[3]=(0,l.qE)(S[3],A[1],A[3])):S=(0,c._N)(S,A)),(0,c.UG)(S)){let i=0,s=0;t.canWrapX()&&(i=(0,c.RG)(R),s=Math.floor((S[0]-R[0])/i));const r=(0,c.QJ)(S.slice(),t,!0);r.forEach(t=>{const r=e.getTileRangeForExtentAndZ(t,this.sourceZ_);for(let e=r.minX;e<=r.maxX;e++)for(let t=r.minY;t<=r.maxY;t++){const r=g(this.sourceZ_,e,t,_);if(r){const t=s*i;this.sourceTiles_.push({tile:r,offset:t})}}++s}),0===this.sourceTiles_.length&&(this.state=n.A.EMPTY)}else this.state=n.A.EMPTY}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{const i=e.tile;if(i&&i.getState()==n.A.LOADED){const s=this.sourceTileGrid_.getTileCoordExtent(i.tileCoord);s[0]+=e.offset,s[2]+=e.offset;const r=this.clipExtent_?.slice();r&&(r[0]+=e.offset,r[2]+=e.offset),t.push({extent:s,clipExtent:r,image:i.getImage()})}}),this.sourceTiles_.length=0,0===t.length)this.state=n.A.ERROR;else{const e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),s="number"===typeof i?i:i[0],r="number"===typeof i?i:i[1],o=this.targetTileGrid_.getResolution(e),h=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=(0,a.XX)(s,r,this.pixelRatio_,h,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=n.A.LOADED}this.changed()}load(){if(this.state==n.A.IDLE){this.state=n.A.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{const i=e.getState();if(i==n.A.IDLE||i==n.A.LOADING){t++;const i=(0,u.KT)(e,r.A.CHANGE,function(s){const r=e.getState();r!=n.A.LOADED&&r!=n.A.ERROR&&r!=n.A.EMPTY||((0,u.JH)(i),t--,0===t&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(i)}}),0===t?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:t},e,i){const s=t.getState();s==n.A.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(u.JH),this.sourcesListenerKeys_=null}release(){this.canvas_&&((0,_.Yg)(this.canvas_.getContext("2d")),a.BV.push(this.canvas_),this.canvas_=null),super.release()}}const g=d},98596:(t,e,i)=>{i.d(e,{A:()=>g});var s=i(93101),r=i(27607),o=i(6837),n=i(11078),h=i(52913),a=i(33513),l=i(61597),c=i(68711),u=i(70915),_=i(9438);class d extends r.Ay{constructor(t){super({tileCoord:t.tileCoord,loader:()=>Promise.resolve(new Uint8Array(4)),interpolate:t.interpolate,transition:t.transition}),this.pixelRatio_=t.pixelRatio,this.gutter_=t.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=t.sourceTileGrid,this.targetTileGrid_=t.targetTileGrid,this.wrappedTileCoord_=t.wrappedTileCoord||t.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const e=t.sourceProj,i=e.getExtent(),r=t.sourceTileGrid.getExtent();this.clipExtent_=e.canWrapX()?r?(0,u._N)(i,r):i:r;const o=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),c=this.targetTileGrid_.getExtent();let _=this.sourceTileGrid_.getExtent();const d=c?(0,u._N)(o,c):o;if(0===(0,u.UG)(d))return void(this.state=n.A.EMPTY);i&&(_=_?(0,u._N)(_,i):i);const g=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),f=t.targetProj,T=(0,a.aY)(e,f,d,g);if(!isFinite(T)||T<=0)return void(this.state=n.A.EMPTY);const E=void 0!==t.errorThreshold?t.errorThreshold:s.l;if(this.triangulation_=new h.A(e,f,d,_,T*E,g),0===this.triangulation_.getTriangles().length)return void(this.state=n.A.EMPTY);this.sourceZ_=this.sourceTileGrid_.getZForResolution(T);let p=this.triangulation_.calculateSourceExtent();if(_&&(e.canWrapX()?(p[1]=(0,l.qE)(p[1],_[1],_[3]),p[3]=(0,l.qE)(p[3],_[1],_[3])):p=(0,u._N)(p,_)),(0,u.UG)(p)){let s=0,r=0;e.canWrapX()&&(s=(0,u.RG)(i),r=Math.floor((p[0]-i[0])/s));const o=(0,u.QJ)(p.slice(),e,!0);o.forEach(e=>{const i=this.sourceTileGrid_.getTileRangeForExtentAndZ(e,this.sourceZ_),o=t.getTileFunction;for(let t=i.minX;t<=i.maxX;t++)for(let e=i.minY;e<=i.maxY;e++){const i=o(this.sourceZ_,t,e,this.pixelRatio_);if(i){const t=r*s;this.sourceTiles_.push({tile:i,offset:t})}}++r}),0===this.sourceTiles_.length&&(this.state=n.A.EMPTY)}else this.state=n.A.EMPTY}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{const i=e.tile;if(!i||i.getState()!==n.A.LOADED)return;const s=i.getSize(),o=this.gutter_;let h;const a=(0,r.bL)(i.getData());h=a||(0,r.$r)((0,r.xo)(i.getData()));const l=[s[0]+2*o,s[1]+2*o],c=h instanceof Float32Array,u=l[0]*l[1],_=c?Float32Array:Uint8Array,d=new _(h.buffer),g=_.BYTES_PER_ELEMENT,f=g*d.length/u,T=d.byteLength/l[1],E=Math.floor(T/g/l[0]),p=u*E;let x=d;if(d.length!==p){x=new _(p);let t=0,e=0;const i=l[0]*E;for(let s=0;s<l[1];++s){for(let s=0;s<i;++s)x[t++]=d[e+s];e+=T/g}}const A=this.sourceTileGrid_.getTileCoordExtent(i.tileCoord);A[0]+=e.offset,A[2]+=e.offset;const G=this.clipExtent_?.slice();G&&(G[0]+=e.offset,G[2]+=e.offset),t.push({extent:A,clipExtent:G,data:new Uint8Array(x.buffer),dataType:_,bytesPerPixel:f,pixelSize:l})}),this.sourceTiles_.length=0,0===t.length)this.state=n.A.ERROR;else{const e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),s="number"===typeof i?i:i[0],r="number"===typeof i?i:i[1],o=this.targetTileGrid_.getResolution(e),h=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);let u,_;const d=t[0].bytesPerPixel,g=Math.ceil(d/3);for(let n=g-1;n>=0;--n){const e=[];for(let s=0,r=t.length;s<r;++s){const i=t[s],r=i.data,o=i.pixelSize,h=o[0],l=o[1],u=(0,c.Y)(h,l,a.BV),_=u.createImageData(h,l),g=_.data;let f=3*n;for(let t=0,e=g.length;t<e;t+=4)g[t]=r[f],g[t+1]=r[f+1],g[t+2]=r[f+2],g[t+3]=255,f+=d;u.putImageData(_,0,0),e.push({extent:i.extent,clipExtent:i.clipExtent,image:u.canvas})}const i=(0,a.XX)(s,r,this.pixelRatio_,h,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,e,this.gutter_,!1,!1,!1);for(let t=0,s=e.length;t<s;++t){const i=e[t].image,s=i.getContext("2d");(0,c.Yg)(s),a.BV.push(s.canvas)}const g=i.getContext("2d"),f=g.getImageData(0,0,i.width,i.height);(0,c.Yg)(g),a.BV.push(i),u||(_=new Uint8Array(d*f.width*f.height),u=new t[0].dataType(_.buffer));const T=f.data;let E=3*n;for(let t=0,s=T.length;t<s;t+=4)255===T[t+3]?(_[E]=T[t],_[E+1]=T[t+1],_[E+2]=T[t+2]):(_[E]=0,_[E+1]=0,_[E+2]=0),E+=d}this.reprojData_=u,this.reprojSize_=[Math.round(s*this.pixelRatio_),Math.round(r*this.pixelRatio_)],this.state=n.A.LOADED}this.changed()}load(){if(this.state!==n.A.IDLE&&this.state!==n.A.ERROR)return;this.state=n.A.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{const i=e.getState();if(i!==n.A.IDLE&&i!==n.A.LOADING)return;t++;const s=(0,_.KT)(e,o.A.CHANGE,function(){const i=e.getState();i!=n.A.LOADED&&i!=n.A.ERROR&&i!=n.A.EMPTY||((0,_.JH)(s),t--,0===t&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(s)}),0===t?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:t}){const e=t.getState();e==n.A.IDLE&&t.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(_.JH),this.sourcesListenerKeys_=null}}const g=d}}]);
//# sourceMappingURL=2365.cd10c23a.js.map